import{_ as O}from"./StratoPagingSelector-BY9rDrJk.js";import{s as B}from"./request-BV6gXtmx.js";import{d as W,g as j}from"./blueprint-BwvMAK18.js";import{ac as $,a8 as N,r as I,m as D,o as c,q as k,w as l,d as R,t as F,u as M,y as P,n,b as E,e,i as S,v as q,F as x,B as A,af as J}from"./index-C_jnbPMf.js";import{_ as Q}from"./TagValueSelectorGroup-kSkYehu4.js";import{_ as Y}from"./UserSelector-Bks_jgjv.js";import{_ as z}from"./TenantTreeSelector-DrVO4R-0.js";import{v as X}from"./FormUtil-BL1Y36f_.js";import{u as Z,_ as ee,d as le}from"./CreateResourceForm-CPnav3GR.js";const te=u=>B({url:"/resource-service/describe-resource-stacks",method:"post",data:u}),Ee=u=>B({url:"/resource-service/update-stack-basics",method:"post",data:u}),we=u=>B({url:"/resource-service/drop-resource-stacks",method:"post",data:u}),ae={style:{float:"left"}},oe={style:{float:"right",color:"grey"}},ne={__name:"BlueprintSelector",props:$({placeholder:{required:!1},multiple:{required:!1,default:!1,type:Boolean},disabled:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const o=N(u,"modelValue"),r=u,t=I({blueprintIds:r.multiple?o.value:o.value?[o.value]:void 0});return D(()=>o.value,()=>{t.value.blueprintIds=r.multiple?o.value:o.value?[o.value]:void 0}),(V,f)=>(c(),k(O,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=s=>o.value=s),"paging-request":t.value,"label-getter":s=>s.name,placeholder:u.placeholder,"remote-method":M(W),multiple:u.multiple,disabled:u.disabled,teleported:""},{default:l(s=>[R("span",ae,F(s.row.name),1),R("span",oe,F(s.row.description),1)]),_:1},8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple","disabled"]))}},ue={key:0,style:{"margin-bottom":"24px"}},de={style:{"margin-bottom":"12px"}},re={key:1,style:{"margin-bottom":"24px"}},se={style:{"margin-bottom":"12px"}},me={__name:"ResourceStackNodeForm",props:$({node:{required:!0},nodes:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:o}){const r=N(u,"modelValue"),t=u;function V(_){f.value.validate(_)}o({validate:V});const f=I(),s=Z(),v=I([]),w=I([]);return P(()=>{if(t.node.internalRequirements)for(let _ of t.node.internalRequirements)s.addIgnoredTargetTypeId(_.targetResourceTypeId),v.value.push({connectActionName:_.connectActionName,targetNodeName:_.targetNodeName});if(t.nodes){for(let _ of t.nodes)if(_.internalRequirements)for(let g of _.internalRequirements)g.targetNodeKey===t.node.nodeKey&&(s.addIgnoredCapabilityTypeId(g.relationshipTypeId),w.value.push({connectActionName:g.connectActionName,sourceNodeName:_.nodeName}))}}),(_,g)=>{const b=n("ElText"),d=n("ElTableColumn"),a=n("ElTable");return c(),E(x,null,[v.value&&v.value.length>0?(c(),E("div",ue,[R("div",de,[e(b,{type:"success"},{default:l(()=>[S(" 依赖于下列节点 ")]),_:1})]),e(a,{data:v.value},{default:l(()=>[e(d,{prop:"connectActionName",label:"关系"}),e(d,{prop:"targetNodeName",label:"节点名称"})]),_:1},8,["data"])])):q("",!0),w.value&&w.value.length>0?(c(),E("div",re,[R("div",se,[e(b,{type:"success"},{default:l(()=>[S(" 被下列节点所依赖 ")]),_:1})]),e(a,{data:w.value},{default:l(()=>[e(d,{prop:"connectActionName",label:"关系"}),e(d,{prop:"sourceNodeName",label:"节点名称"})]),_:1},8,["data"])])):q("",!0),e(ee,{ref_key:"formRef",ref:f,modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=p=>r.value=p)},null,8,["modelValue"])],64)}}},he={__name:"CreateStacksForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:o}){const r=I(),t=N(u,"modelValue"),V=I();P(()=>{t.value&&(t.value.blueprintId&&(V.value=t.value.blueprintId),t.value.tags||(t.value.tags=[]))});const f=I(!1);function s(d){var a;d&&d.id!==((a=t.value)==null?void 0:a.blueprintId)&&(f.value=!0,j({blueprintId:d.id}).then(p=>{t.value=p.cmd}).finally(()=>{f.value=!1}))}function v(d){X([r.value,...g.value],d)}o({validate:v});const w=I({blueprintId:[{required:!0,message:"请选择蓝图",trigger:"blur"}],tenantId:[{required:!0,message:"请选择租户",trigger:"blur"}],ownerId:[{required:!0,message:"请选择所有者",trigger:"blur"}],tags:[{validator:(d,a,p)=>{var m;return(m=_.value)==null?void 0:m.validate(d,a,p)},trigger:"change"}]}),_=I(),g=I([]),b=le();return D(()=>{var d;return(d=t.value)==null?void 0:d.tags},()=>{var d;b.tags.value=(d=t.value)==null?void 0:d.tags},{deep:!0,immediate:!0}),(d,a)=>{const p=n("ElFormItem"),m=n("ElCol"),h=n("ElInput"),y=n("ElDatePicker"),C=n("ElInputNumber"),T=n("ElRow"),U=n("ElTabPane"),K=n("ElTabs"),G=n("ElForm");return c(),k(G,{ref_key:"formRef",ref:r,model:t.value,"label-position":"top",rules:w.value},{default:l(()=>[e(p,{label:"蓝图",prop:"blueprintId"},{default:l(()=>[e(ne,{modelValue:V.value,"onUpdate:modelValue":a[0]||(a[0]=i=>V.value=i),onChange:s},null,8,["modelValue"])]),_:1}),V.value?(c(),E(x,{key:0},[e(T,{gutter:12},{default:l(()=>[e(m,{span:12},{default:l(()=>[e(p,{label:"租户",prop:"tenantId"},{default:l(()=>[e(z,{modelValue:t.value.tenantId,"onUpdate:modelValue":a[1]||(a[1]=i=>t.value.tenantId=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"所有者",prop:"ownerId"},{default:l(()=>[e(Y,{modelValue:t.value.ownerId,"onUpdate:modelValue":a[2]||(a[2]=i=>t.value.ownerId=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"资源栈名称"},{default:l(()=>[e(h,{modelValue:t.value.name,"onUpdate:modelValue":a[3]||(a[3]=i=>t.value.name=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"到期时间"},{default:l(()=>[e(y,{style:{width:"100%"},type:"datetime",modelValue:t.value.expireTime,"onUpdate:modelValue":a[4]||(a[4]=i=>t.value.expireTime=i),"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"数量"},{default:l(()=>[e(C,{style:{width:"100%"},min:1,modelValue:t.value.number,"onUpdate:modelValue":a[5]||(a[5]=i=>t.value.number=i)},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:l(()=>[e(p,{label:"标签",prop:"tags"},{default:l(()=>[t.value.tags&&!f.value?(c(),k(Q,{key:0,ref_key:"tagRef",ref:_,"entry-paging-request":{userGroupTaggable:!0,requiredWhenCreating:!0},modelValue:t.value.tags,"onUpdate:modelValue":a[6]||(a[6]=i=>t.value.tags=i),"default-add-all-entries":!0},null,8,["modelValue"])):q("",!0)]),_:1})]),_:1}),e(m,{span:24},{default:l(()=>[e(p,{label:"描述"},{default:l(()=>[e(h,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":a[7]||(a[7]=i=>t.value.description=i)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),f.value?q("",!0):(c(),k(K,{key:0},{default:l(()=>[(c(!0),E(x,null,A(t.value.nodes,i=>(c(),k(U,{label:i.nodeName},{default:l(()=>[e(me,{ref_for:!0,ref_key:"ResourceStackNodeFormRefs",ref:g,node:i,nodes:t.value.nodes,modelValue:i.resourceCmd,"onUpdate:modelValue":L=>i.resourceCmd=L},null,8,["node","nodes","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),256))]),_:1}))],64)):q("",!0)]),_:1},8,["model","rules"])}}},ie={style:{float:"left"}},ce={style:{float:"right",color:"grey"}},H={__name:"ResourceStackSelector",props:$({placeholder:{required:!1},multiple:{required:!1,default:!1,type:Boolean},disabled:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const o=N(u,"modelValue"),r=u,t=I({resourceStackIds:r.multiple?o.value:o.value?[o.value]:void 0});return D(()=>o.value,()=>{t.value.resourceStackIds=r.multiple?o.value:o.value?[o.value]:void 0}),(V,f)=>(c(),k(O,{modelValue:o.value,"onUpdate:modelValue":f[0]||(f[0]=s=>o.value=s),"paging-request":t.value,"label-getter":s=>s.name,placeholder:u.placeholder,"remote-method":M(te),multiple:u.multiple,disabled:u.disabled},{default:l(s=>[R("span",ie,F(s.row.name),1),R("span",ce,F(s.row.description),1)]),_:1},8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple","disabled"]))}},pe=R("div",{style:{"max-width":"240px"}}," 若立即销毁选择否，系统将仅把资源放入回收站，而不在底层执行实际操作 ",-1),Re={__name:"RecycleStacksForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:o}){const r=N(u,"modelValue");o({validate:t});function t(v){V.value.validate(v)}const V=I();function f(){r.value.stacks.push({stackId:void 0,executingDestruction:!0})}function s(v){r.value.stacks.splice(v,1)}return P(()=>{r.value.stacks||(r.value.stacks=[])}),(v,w)=>{const _=n("ElDivider"),g=n("ElFormItem"),b=n("ElCol"),d=n("ElIcon"),a=n("ElTooltip"),p=n("ElSwitch"),m=n("ElButton"),h=n("ElRow"),y=n("ElForm");return c(),k(y,{ref_key:"formRef",ref:V,model:r.value,"label-position":"top"},{default:l(()=>[(c(!0),E(x,null,A(r.value.stacks,(C,T)=>(c(),E(x,null,[T!==0?(c(),k(_,{key:0})):q("",!0),e(h,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:l(()=>[e(b,{span:14},{default:l(()=>[e(g,{label:`待回收资源栈${T+1}`,required:""},{default:l(()=>[e(H,{modelValue:C.stackId,"onUpdate:modelValue":U=>C.stackId=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),e(b,{span:8},{default:l(()=>[e(g,null,{label:l(()=>[R("span",null,[S(" 立即销毁 "),e(a,null,{content:l(()=>[pe]),default:l(()=>[e(d,{style:{cursor:"pointer"}},{default:l(()=>[e(M(J))]),_:1})]),_:1})])]),default:l(()=>[e(p,{modelValue:C.executingDestruction,"onUpdate:modelValue":U=>C.executingDestruction=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(b,{span:2},{default:l(()=>[e(m,{style:{float:"right"},size:"small",circle:"",plain:"",icon:"Minus",onClick:()=>s(T)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),e(m,{style:{width:"100%","margin-top":"20px"},onClick:f,plain:"",icon:"Plus"})]),_:1},8,["model"])}}},qe={__name:"TransferStacksForm",props:{modelValue:{required:!0,default:{transfers:[{stackId:void 0,newOwnerId:void 0,newTenantId:void 0}]}},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:o}){const r=N(u,"modelValue");o({validate:t});function t(v){V.value.validate(v)}const V=I();function f(){r.value.transfers.push({stackId:void 0,newOwnerId:void 0,newTenantId:void 0})}function s(v){r.value.transfers.splice(v,1)}return(v,w)=>{const _=n("ElDivider"),g=n("ElFormItem"),b=n("ElCol"),d=n("ElButton"),a=n("ElRow"),p=n("ElForm");return c(),k(p,{ref_key:"formRef",ref:V,model:r.value,"label-position":"top"},{default:l(()=>[(c(!0),E(x,null,A(r.value.transfers,(m,h)=>(c(),E(x,null,[h!==0?(c(),k(_,{key:0})):q("",!0),e(a,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:l(()=>[e(b,{span:10},{default:l(()=>[e(g,{label:`待移交资源栈${h+1}`,required:""},{default:l(()=>[e(H,{modelValue:m.stackId,"onUpdate:modelValue":y=>m.stackId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),e(b,{span:6},{default:l(()=>[e(g,{label:"租户"},{default:l(()=>[e(z,{modelValue:m.newTenantId,"onUpdate:modelValue":y=>m.newTenantId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(b,{span:6},{default:l(()=>[e(g,{label:"所有者"},{default:l(()=>[e(Y,{modelValue:m.newOwnerId,"onUpdate:modelValue":y=>m.newOwnerId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(b,{span:2},{default:l(()=>[e(d,{style:{float:"right"},size:"small",circle:"",plain:"",icon:"Minus",onClick:()=>s(h)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),e(d,{style:{width:"100%","margin-top":"20px"},onClick:f,plain:"",icon:"Plus"})]),_:1},8,["model"])}}};export{he as _,Re as a,qe as b,te as c,we as d,Ee as u};
