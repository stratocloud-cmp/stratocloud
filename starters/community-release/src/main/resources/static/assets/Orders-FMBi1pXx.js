import{A as G,n as y,o as f,b as T,e as r,w as l,d as S,u as R,a2 as fe,a3 as pe,q as O,I as M,t as w,a9 as _e,aa as ve,r as d,i as V,v as A,a6 as P,F as U,ab as L,a7 as k,E as W,j as K,m as ge,y as J,Y as Ee,a8 as he,B as X,G as re,H as le,x as Z,$ as Ie,a0 as q,a1 as ye,a4 as Oe,ac as Ce,f as be}from"./index-C6PxR8iA.js";import{s as F,u as H,l as te}from"./request-BGZJNm7h.js";import{_ as Re}from"./StratoTable-BQdButlV.js";import{S as $}from"./StratoButton-AnmxT3yq.js";import{_ as z}from"./StratoDrawer-BEn6vZyQ.js";import{_ as Ve}from"./StratoSelector-BPbvdP-M.js";import{_ as oe}from"./StratoPagingSelector-CZtU1yuw.js";import{d as we}from"./workflow-DRJYC4Zy.js";import{_ as Ae,a as Se,b as Te,c as xe,d as Ue,e as De}from"./DeleteUserGroupsForm-DNjy3A__.js";import{_ as Fe}from"./UserSelector-I3vgcqge.js";import{_ as ke}from"./AccountSelector-DslFb1Hj.js";import{a as Be,e as Ne,g as $e,f as ze,d as qe,c as Le,_ as Pe,b as He}from"./ClaimResourcesForm-CzvhHHCZ.js";import{_ as Me}from"./CreateResourceForm-DfoW8jjJ.js";import{m as We}from"./resource-Bh2jHR95.js";import{b as je}from"./ResourceSelector-BiWCNkAM.js";import{v as ee}from"./FormUtil-HRZnD3ka.js";import{b as Ge,a as Ke,_ as Je}from"./TransferStacksForm-Bmubr-Lk.js";import"./TenantTreeSelector-C6fV0oEE.js";import"./TagValueSelectorGroup-Tq596lRF.js";import"./tag-By1EEBOS.js";import"./user-DS2hYLSE.js";import"./account-Dl5yMWLZ.js";import"./AccountContext-KhB6J2Ha.js";import"./StratoDynamicForm-Dzna3_lB.js";import"./IpState-B-GWVa2R.js";import"./role-DCPu0vWf.js";import"./job-BPKVJ0Lh.js";import"./scriptDefinition-3uUc8gRV.js";import"./blueprint-D19VwAjn.js";const ae=e=>F({url:"/order-service/describe-orders",method:"post",data:e}),Ye=e=>F({url:"/order-service/describe-order-rollback-targets",method:"post",data:e}),Qe=e=>F({url:"/order-service/update-order-item",method:"post",data:e}),Ze=e=>F({url:"/order-service/submit-order",method:"post",data:e}),Xe=e=>F({url:"/order-service/approve-order",method:"post",data:e}),et=e=>F({url:"/order-service/confirm-order",method:"post",data:e}),tt=e=>F({url:"/order-service/rollback-order",method:"post",data:e}),rt=e=>F({url:"/order-service/reject-order",method:"post",data:e}),lt=e=>F({url:"/order-service/cancel-order",method:"post",data:e}),ot=e=>F({url:"/order-service/deny-order",method:"post",data:e}),at=e=>F({url:"/order-service/clone-order",method:"post",data:e}),st=e=>F({url:"/order-service/create-order",method:"post",data:e}),nt=["innerHTML"],dt={style:{"margin-left":"6px"}},se={__name:"OrderState",props:{state:{required:!0},errorMessage:{required:!1}},setup(e){const i=e,t={AWAIT_SUBMIT:{name:"待提交",icon:"Clock",type:"info"},PENDING:{icon:"Loading",type:"info"},CANCELED:{name:"已取消",icon:"CircleClose",type:"danger"},DENIED:{name:"已拒绝",icon:"CircleClose",type:"danger"},REJECTED:{name:"已驳回",icon:"Back",type:"warning"},PROCESS_ROLLED_BACK:{name:"已回退",icon:"Back",type:"warning"},AWAIT_APPROVAL:{name:"待审批",icon:"Avatar",type:"warning"},AWAIT_CONFIRM:{name:"待确认",icon:"User",type:"warning"},EXECUTING:{name:"执行中",icon:"Loading",type:"primary"},FINISHED:{name:"已完成",icon:"Check",type:"success"},FAILED:{name:"已失败",icon:"Warning",type:"danger"}},o=G(()=>{let a=t[i.state];return a===void 0&&(a={name:i.state,icon:"QuestionFilled",type:"warning"}),a});return(a,n)=>{const s=y("ElText"),p=y("ElTooltip");return f(),T("span",null,[r(p,{disabled:e.state!=="FAILED"},{content:l(()=>[S("div",{style:{"max-width":"500px","white-space":"pre-wrap","max-height":"400px",overflow:"auto"},innerHTML:e.errorMessage},null,8,nt)]),default:l(()=>[r(s,{style:{cursor:"pointer"},type:o.value.type},{default:l(()=>[r(R(fe),{class:pe(o.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(f(),O(M(o.value.icon)))]),_:1},8,["class"])]),_:1},8,["type"])]),_:1},8,["disabled"]),S("span",dt,w(o.value.name),1)])}}};class ne{constructor(){this.orderItemChangeDetector=[]}registerOrderItemChangeDetector(i){this.orderItemChangeDetector.push(i)}isAnyOrderItemChanged(){for(let i of this.orderItemChangeDetector)if(i())return!0;return!1}}function ut(){const e=new ne;return _e("orderContext",e),e}function Y(){return ve("orderContext",new ne)}const it={__name:"OrderSubmitButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=i,a=d(!1),n=d(!1),s=Y(),p=d(!1);function u(){p.value=s.isAnyOrderItemChanged(),a.value=!0}const I=d({}),h=d();function C(){h.value.validate(c=>{c&&(I.value.orderId=t.selectedOrders[0].id,n.value=!0,Ze(I.value).then(m=>{a.value=!1,o("refresh")}).finally(()=>{n.value=!1}))})}function b(){const c=["AWAIT_SUBMIT","REJECTED"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)}return(c,m)=>{const v=y("ElText"),g=y("ElFormItem"),E=y("ElInput"),_=y("ElForm");return b()?(f(),T(U,{key:0},[r($,{type:"success",plain:"",size:e.size,onClick:u,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 提交 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=x=>a.value=x),title:"提交工单",loading:n.value,onOnConfirm:C},{default:l(()=>[r(_,{ref_key:"formRef",ref:h,model:I.value,"label-position":"top"},{default:l(()=>[p.value?(f(),O(g,{key:0},{default:l(()=>[r(v,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击提交 ")]),_:1})]),_:1})):A("",!0),r(g,{label:"提交说明"},{default:l(()=>[r(E,{type:"textarea",modelValue:I.value.message,"onUpdate:modelValue":m[0]||(m[0]=x=>I.value.message=x)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},mt={__name:"OrderApproveButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1),p=Y(),u=d(!1);function I(){u.value=p.isAnyOrderItemChanged(),n.value=!0}const h=d({}),C=d();function b(){C.value.validate(v=>{v&&(h.value.orderId=t.selectedOrders[0].id,s.value=!0,Xe(h.value).then(g=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function c(){var v;return t.selectedOrders.length===0?!1:((v=t.selectedOrders[0].possibleHandlers)==null?void 0:v.findIndex(g=>g.userId===o.userId))!==-1}function m(){const v=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&v.includes(t.selectedOrders[0].status)&&c()}return(v,g)=>{const E=y("ElText"),_=y("ElFormItem"),x=y("ElInput"),B=y("ElForm");return m()?(f(),T(U,{key:0},[r($,{type:"success",plain:"",size:e.size,onClick:I,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 通过 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":g[1]||(g[1]=N=>n.value=N),title:"审批通过",loading:s.value,onOnConfirm:b},{default:l(()=>[r(B,{ref_key:"formRef",ref:C,model:h.value,"label-position":"top"},{default:l(()=>[u.value?(f(),O(_,{key:0},{default:l(()=>[r(E,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击通过 ")]),_:1})]),_:1})):A("",!0),r(_,{label:"审批意见"},{default:l(()=>[r(x,{type:"textarea",modelValue:h.value.message,"onUpdate:modelValue":g[0]||(g[0]=N=>h.value.message=N)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},ct={__name:"OrderDenyButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1);function p(){n.value=!0}const u=d({}),I=d();function h(){I.value.validate(c=>{c&&(u.value.orderId=t.selectedOrders[0].id,s.value=!0,ot(u.value).then(m=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function C(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function b(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&C()}return(c,m)=>{const v=y("ElInput"),g=y("ElFormItem"),E=y("ElForm");return b()?(f(),T(U,{key:0},[r($,{type:"danger",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 拒绝 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=_=>n.value=_),title:"拒绝工单",loading:s.value,onOnConfirm:h},{default:l(()=>[r(E,{ref_key:"formRef",ref:I,model:u.value,"label-position":"top"},{default:l(()=>[r(g,{label:"审批意见"},{default:l(()=>[r(v,{type:"textarea",modelValue:u.value.message,"onUpdate:modelValue":m[0]||(m[0]=_=>u.value.message=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},ft={__name:"OrderRejectButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1);function p(){n.value=!0}const u=d({}),I=d();function h(){I.value.validate(c=>{c&&(u.value.orderId=t.selectedOrders[0].id,s.value=!0,rt(u.value).then(m=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function C(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function b(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&C()}return(c,m)=>{const v=y("ElInput"),g=y("ElFormItem"),E=y("ElForm");return b()?(f(),T(U,{key:0},[r($,{type:"warning",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 驳回至申请人 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":m[1]||(m[1]=_=>n.value=_),title:"驳回至申请人",loading:s.value,onOnConfirm:h},{default:l(()=>[r(E,{ref_key:"formRef",ref:I,model:u.value,"label-position":"top"},{default:l(()=>[r(g,{label:"审批意见"},{default:l(()=>[r(v,{type:"textarea",modelValue:u.value.message,"onUpdate:modelValue":m[0]||(m[0]=_=>u.value.message=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},pt={style:{color:"grey"}},_t={__name:"RollbackTargetSelector",props:L({orderId:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=d({orderId:e.orderId}),o=k(e,"modelValue");return(a,n)=>(f(),O(Ve,{modelValue:o.value,"onUpdate:modelValue":n[0]||(n[0]=s=>o.value=s),placeholder:"请选择回退节点",request:t.value,"remote-method":R(Ye),"list-getter":s=>s.targets,"label-getter":s=>s.nodeName,"value-getter":s=>s.nodeId},{default:l(s=>{var p;return[S("div",null,w(s.row.nodeName),1),S("div",pt,w((p=s.row.possibleHandlers)==null?void 0:p.map(u=>u.realName).join()),1)]}),_:1},8,["modelValue","request","remote-method","list-getter","label-getter","value-getter"]))}},vt={__name:"OrderRollbackButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1);function p(){n.value=!0}const u=d({}),I=d();function h(){I.value.validate(c=>{c&&(u.value.orderId=t.selectedOrders[0].id,s.value=!0,tt(u.value).then(m=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function C(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function b(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&C()}return(c,m)=>{const v=y("ElFormItem"),g=y("ElInput"),E=y("ElForm");return b()?(f(),T(U,{key:0},[r($,{type:"warning",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 退回至审批人 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":m[2]||(m[2]=_=>n.value=_),title:"退回至审批人",loading:s.value,onOnConfirm:h},{default:l(()=>[n.value?(f(),O(E,{key:0,ref_key:"formRef",ref:I,model:u.value,"label-position":"top"},{default:l(()=>[r(v,{label:"退回至",prop:"nodeId"},{default:l(()=>[r(_t,{modelValue:u.value.nodeId,"onUpdate:modelValue":m[0]||(m[0]=_=>u.value.nodeId=_),"order-id":e.selectedOrders[0].id},null,8,["modelValue","order-id"])]),_:1}),r(v,{label:"审批意见"},{default:l(()=>[r(g,{type:"textarea",modelValue:u.value.message,"onUpdate:modelValue":m[1]||(m[1]=_=>u.value.message=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):A("",!0)]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},gt={__name:"OrderCancelButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1);function p(){n.value=!0}const u=d({}),I=d();function h(){I.value.validate(b=>{b&&(u.value.orderId=t.selectedOrders[0].id,s.value=!0,lt(u.value).then(c=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function C(){const b=["AWAIT_SUBMIT","REJECTED","PROCESS_ROLLED_BACK","AWAIT_APPROVAL","AWAIT_CONFIRM"];return t.selectedOrders.length>0&&b.includes(t.selectedOrders[0].status)&&(o.isSuperAdmin||t.selectedOrders.every(c=>c.id===o.userId))}return(b,c)=>{const m=y("ElInput"),v=y("ElFormItem"),g=y("ElForm");return C()?(f(),T(U,{key:0},[r($,{plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 取消工单 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=E=>n.value=E),title:"取消工单",loading:s.value,onOnConfirm:h},{default:l(()=>[r(g,{ref_key:"formRef",ref:I,model:u.value,"label-position":"top"},{default:l(()=>[r(v,{label:"取消说明"},{default:l(()=>[r(m,{type:"textarea",modelValue:u.value.message,"onUpdate:modelValue":c[0]||(c[0]=E=>u.value.message=E)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},Et={__name:"OrderConfirmButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=H(),a=i,n=d(!1),s=d(!1),p=Y(),u=d(!1);function I(){u.value=p.isAnyOrderItemChanged(),n.value=!0}const h=d({}),C=d();function b(){C.value.validate(v=>{v&&(h.value.orderId=t.selectedOrders[0].id,s.value=!0,et(h.value).then(g=>{n.value=!1,a("refresh")}).finally(()=>{s.value=!1}))})}function c(){var v;return t.selectedOrders.length===0?!1:((v=t.selectedOrders[0].possibleHandlers)==null?void 0:v.findIndex(g=>g.userId===o.userId))!==-1}function m(){const v=["AWAIT_CONFIRM"];return t.selectedOrders.length>0&&v.includes(t.selectedOrders[0].status)&&c()}return(v,g)=>{const E=y("ElText"),_=y("ElFormItem"),x=y("ElInput"),B=y("ElForm");return m()?(f(),T(U,{key:0},[r($,{type:"success",plain:"",size:e.size,onClick:I,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 确认 ")]),_:1},8,["size","disabled"]),(f(),O(P,{to:"body"},[r(z,{modelValue:n.value,"onUpdate:modelValue":g[1]||(g[1]=N=>n.value=N),title:"确认工单",loading:s.value,onOnConfirm:b},{default:l(()=>[u.value?(f(),O(_,{key:0},{default:l(()=>[r(E,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击确认 ")]),_:1})]),_:1})):A("",!0),r(B,{ref_key:"formRef",ref:C,model:h.value,"label-position":"top"},{default:l(()=>[r(_,{label:"审批意见"},{default:l(()=>[r(x,{type:"textarea",modelValue:h.value.message,"onUpdate:modelValue":g[0]||(g[0]=N=>h.value.message=N)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},ht={__name:"OrderCloneButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=i,a=d({}),n=d(!1);function s(){a.value.orderId=t.selectedOrders[0].id,n.value=!0,at(a.value).then(u=>{o("refresh")}).finally(()=>{n.value=!1})}function p(){return t.selectedOrders.length>0}return(u,I)=>p()?(f(),O($,{key:0,plain:"",size:e.size,onClick:s,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项",loading:n.value},{default:l(()=>[V(" 克隆 ")]),_:1},8,["size","disabled","loading"])):A("",!0)}},It={__name:"WorkflowSelector",props:L({placeholder:{required:!1,default:"请选择流程"},multiple:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:L(["change"],["update:modelValue"]),setup(e,{emit:i}){const t=k(e,"modelValue"),o=d({}),a=i;function n(s){a("change",s)}return(s,p)=>(f(),O(oe,{modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value=u),"paging-request":o.value,"label-getter":u=>u.name,placeholder:e.placeholder,"remote-method":R(we),multiple:e.multiple,"id-filter-key":"workflowIds",onChange:n},null,8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple"]))}},yt={__name:"RemoveUsersFromGroupForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:i}){const t=k(e,"modelValue"),o=d();i({validate:a});function a(s){o.value.validate(s)}const n=d({userGroupId:[{required:!0,message:"请选择用户组"}],userIds:[{required:!0,message:"请选择用户"}]});return(s,p)=>(f(),O(R(K),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:n.value},{default:l(()=>[r(R(W),{label:"用户组",prop:"userGroupId"},{default:l(()=>[r(Ae,{"all-groups":"",modelValue:t.value.userGroupId,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value.userGroupId=u)},null,8,["modelValue"])]),_:1}),r(R(W),{label:"移除用户",prop:"userIds"},{default:l(()=>[r(Fe,{multiple:"",modelValue:t.value.userIds,"onUpdate:modelValue":p[1]||(p[1]=u=>t.value.userIds=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ot={__name:"SynchronizeAccountsForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:i}){const t=k(e,"modelValue"),o=d();i({validate:a});function a(s){o.value.validate(s)}const n=d({accountIds:[{required:!0,message:"请选择云账号"}]});return(s,p)=>(f(),O(R(K),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:n.value},{default:l(()=>[r(R(W),{label:"云账号",prop:"accountIds"},{default:l(()=>[r(ke,{modelValue:t.value.accountIds,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value.accountIds=u),multiple:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ct={style:{float:"left"}},bt={style:{float:"right",color:"grey"}},Rt={__name:"RelationshipSelector",props:L({disabled:{required:!1,type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const i=k(e,"modelValue"),t=d({relationshipIds:i.value});ge(i,()=>{t.value.relationshipIds=i.value});function o(a){return a.source.name+" -> "+a.target.name}return(a,n)=>(f(),O(oe,{modelValue:i.value,"onUpdate:modelValue":n[0]||(n[0]=s=>i.value=s),disabled:e.disabled,"paging-request":t.value,"label-getter":o,"remote-method":R(We),placeholder:"请选择关系"},{default:l(s=>[S("span",Ct,w(o(s.row)),1),S("span",bt,[r(Be,{state:s.row.state},null,8,["state"]),V("   ")])]),_:1},8,["modelValue","disabled","paging-request","remote-method"]))}},Vt={__name:"DisconnectResourcesForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:i}){const t=k(e,"modelValue"),o=d();i({validate:a});function a(s){o.value.validate(s)}const n=d({relationshipIds:[{required:!0,message:"请选择资源关系"}]});return(s,p)=>(f(),O(R(K),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:n.value},{default:l(()=>[r(R(W),{label:"解除关系",prop:"relationshipIds"},{default:l(()=>[r(Rt,{modelValue:t.value.relationshipIds,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value.relationshipIds=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},wt={__name:"RestoreResourcesForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:i}){const t=k(e,"modelValue"),o=d();i({validate:a});function a(s){o.value.validate(s)}const n=d({resourceIds:[{required:!0,message:"请选择资源"}]});return(s,p)=>(f(),O(R(K),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:n.value},{default:l(()=>[r(R(W),{label:"资源",prop:"resourceIds"},{default:l(()=>[r(je,{multiple:"",modelValue:t.value.resourceIds,"onUpdate:modelValue":p[0]||(p[0]=u=>t.value.resourceIds=u)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},At={style:{width:"100%",height:"24px"}},St={__name:"BatchFormWrapper",props:L({formComponent:{required:!0,type:Object},itemsPath:{required:!0},cardTitle:{required:!0},enableEdit:{required:!0,type:Boolean}},{modelValue:{required:!0,type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:i}){const t=e,o=k(e,"modelValue"),a=G(()=>o.value[t.itemsPath]);J(()=>{console.log(a.value)});function n(C){o.value[t.itemsPath].splice(C,1)}function s(){o.value[t.itemsPath].push(p.value.getDefaultFormData())}const p=d(),u=d(),I=d([]);i({validate:h});function h(C){ee(I.value,C)}return(C,b)=>{const c=y("ElButton"),m=y("ElCard");return f(),T(U,null,[Ee((f(),O(M(e.formComponent),{ref_key:"hiddenFormRef",ref:p,modelValue:u.value,"onUpdate:modelValue":b[0]||(b[0]=v=>u.value=v)},null,8,["modelValue"])),[[he,!1]]),(f(!0),T(U,null,X(a.value,(v,g)=>(f(),O(m,{style:{"margin-bottom":"12px"}},{header:l(()=>[S("div",At,[S("span",null,w(e.cardTitle+(g+1)),1),e.enableEdit?(f(),O(c,{key:0,link:"",icon:"Close",type:"danger",style:{float:"right"},onClick:()=>n(g)},null,8,["onClick"])):A("",!0)])]),default:l(()=>[(f(),O(M(e.formComponent),{ref_for:!0,ref_key:"formRefs",ref:I,modelValue:a.value[g],"onUpdate:modelValue":E=>a.value[g]=E},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024))),256)),e.enableEdit?(f(),O(c,{key:0,style:{width:"100%"},icon:"Plus",onClick:s},{default:l(()=>[V(" 添加"+w(e.cardTitle),1)]),_:1})):A("",!0)],64)}}},Tt={__name:"FormDataPathWrapper",props:L({formComponent:{required:!0,type:Object},formDataPath:{required:!0}},{modelValue:{required:!0,type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:i}){const t=k(e,"modelValue"),o=d();i({validate:a});function a(n){ee([o.value],n)}return(n,s)=>(f(),O(M(e.formComponent),{ref_key:"formRef",ref:o,modelValue:t.value[e.formDataPath],"onUpdate:modelValue":s[0]||(s[0]=p=>t.value[e.formDataPath]=p)},null,8,["modelValue"]))}};function de(e){return["AWAIT_SUBMIT","REJECTED","PROCESS_ROLLED_BACK","AWAIT_APPROVAL","AWAIT_CONFIRM"].includes(e)}function xt(e){switch(e){case"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS":return{changes:[]};case"BATCH_CONNECT_RESOURCES":return{connections:[]};case"BATCH_CREATE_RESOURCES":return{resources:[]};case"BATCH_RECYCLE_RESOURCES":return{resources:[]};case"BATCH_RUN_RESOURCE_ACTIONS":return{actions:[]};case"TRANSFER_RESOURCES":return{transfers:[]};case"CLAIM_RESOURCES":return{claims:[]};default:return{}}}function ue(e,i){switch(e){case"CREATE_USER_GROUP":return De;case"INVITE_USERS_TO_GROUP":return Ue;case"JOIN_USER_GROUP":return xe;case"REMOVE_USERS_FROM_GROUP":return yt;case"UPDATE_USER_GROUP":return Te;case"DELETE_USER_GROUPS":return Se;case"SYNCHRONIZE_ACCOUNTS":return Ot;case"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS":return Q(He,i,"changes","变更");case"BATCH_CONNECT_RESOURCES":return Q(Pe,i,"connections","资源关系");case"BATCH_DISCONNECT_RESOURCES":return Vt;case"BATCH_CREATE_RESOURCES":return Q(Me,i,"resources","资源");case"BATCH_RECYCLE_RESOURCES":return j(Le,"resources");case"BATCH_RESTORE_RESOURCES":return wt;case"BATCH_RUN_RESOURCE_ACTIONS":return j(qe,"actions");case"SYNCHRONIZE_RESOURCES":return Ne;case"TRANSFER_RESOURCES":return j(ze,"transfers");case"CLAIM_RESOURCES":return j($e,"claims");case"CREATE_RESOURCE_STACKS":return Je;case"RECYCLE_RESOURCE_STACKS":return Ke;case"TRANSFER_STACKS":return Ge}}function Q(e,i,t,o){const a=de(i),n=d();return re({setup(){return()=>le(St,{formComponent:e,itemsPath:t,cardTitle:o,enableEdit:a,ref:n})},expose:["validate"],methods:{validate(s){n.value.validate(s)}}})}function j(e,i){const t=d();return re({setup(){return()=>le(Tt,{formComponent:e,formDataPath:i,ref:t})},expose:["validate"],methods:{validate(o){t.value.validate(o)}}})}const Ut={key:0,style:{"margin-top":"24px"}},Dt={style:{"font-size":"16px"}},Ft={__name:"CreateOrderButton",emits:["refresh"],setup(e,{emit:i}){const t=d(),o=d(),a=d(),n={};function s(g){if(g&&!(t.value&&g.id===t.value.workflowId)){a.value=g,t.value={orderName:void 0,note:void 0,workflowId:g.id,items:g.nodes.filter(E=>E.nodeType==="JOB_NODE").map(E=>({jobNodeKey:E.nodeKey,parameters:xt(E.nodeProperties.jobType)}))};for(let E of g.nodes.filter(_=>_.nodeType==="JOB_NODE")){const _=u(E.nodeKey);if(!_){Z.warning("此流程不支持新建工单"),v();return}n[E.nodeKey]=_}}}function p(g){return a.value.nodes.filter(E=>E.nodeType==="JOB_NODE").filter(E=>E.nodeKey===g)[0]}function u(g){const E=p(g);return ue(E.nodeProperties.jobType,"AWAIT_SUBMIT")}const I=d(!1),h=d(!1);function C(){h.value=!0}const b=i;function c(){if(!t.value){Z.warning("请先选择流程");return}ee(m.value,g=>{g&&(I.value=!0,st(t.value).then(E=>{console.log("Order created: "+E.orderId),h.value=!1,v(),b("refresh")}).finally(()=>{I.value=!1}))})}const m=d([]);function v(){t.value=void 0,a.value=void 0,o.value=void 0}return(g,E)=>{const _=y("ElFormItem"),x=y("ElInput"),B=y("ElForm"),N=y("ElCard");return f(),T(U,null,[r($,{type:"primary",plain:"",onClick:C},{default:l(()=>[V(" 新建 ")]),_:1}),(f(),O(P,{to:"body"},[h.value?(f(),O(z,{key:0,modelValue:h.value,"onUpdate:modelValue":E[3]||(E[3]=D=>h.value=D),title:"新建工单",loading:I.value,onOnConfirm:c,onOnClose:v,size:1e3},{default:l(()=>[r(B,{"label-position":"top"},{default:l(()=>[r(_,{label:"流程"},{default:l(()=>[r(It,{modelValue:o.value,"onUpdate:modelValue":E[0]||(E[0]=D=>o.value=D),onChange:s},null,8,["modelValue"])]),_:1}),t.value?(f(),O(_,{key:0,label:"工单标题"},{default:l(()=>[r(x,{placeholder:"留空则自动生成",modelValue:t.value.orderName,"onUpdate:modelValue":E[1]||(E[1]=D=>t.value.orderName=D)},null,8,["modelValue"])]),_:1})):A("",!0),t.value?(f(),O(_,{key:1,label:"备注"},{default:l(()=>[r(x,{type:"textarea",modelValue:t.value.note,"onUpdate:modelValue":E[2]||(E[2]=D=>t.value.note=D)},null,8,["modelValue"])]),_:1})):A("",!0)]),_:1}),t.value?(f(),T("div",Ut,[(f(!0),T(U,null,X(t.value.items,(D,me)=>(f(),O(N,{shadow:"never"},{header:l(()=>[S("span",Dt,w(`工单项${me+1}: ${p(D.jobNodeKey).nodeName}`),1)]),default:l(()=>[(f(),O(M(n[D.jobNodeKey]),{ref_for:!0,ref_key:"orderItemFormRefs",ref:m,modelValue:D.parameters,"onUpdate:modelValue":ce=>D.parameters=ce},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024))),256))])):A("",!0)]),_:1},8,["modelValue","loading"])):A("",!0)]))],64)}}},ie={__name:"OrderButtonsGroup",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"},showCreate:{type:Boolean,default:!1}},emits:["refresh"],setup(e,{emit:i}){const t=i;function o(){t("refresh")}return(a,n)=>(f(),T(U,null,[e.showCreate?(f(),O(Ft,{key:0,onRefresh:o})):A("",!0),r(it,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(mt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(Et,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(ct,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(ft,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(vt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(gt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(ht,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"])],64))}},kt={style:{width:"100%",height:"32px"}},Bt={__name:"OrderItem",props:{order:{required:!0},orderItem:{required:!0}},emits:["refresh"],setup(e,{emit:i}){const t=e,o=d({orderId:t.order.id,orderItemId:t.orderItem.id});J(()=>{o.value.parameters=te.cloneDeep(t.orderItem.parameters)});function a(){return ue(t.orderItem.jobType,t.order.status)}const n=a(),s=G(()=>!de(t.order.status)),p=d(),u=d(!1),I=i;function h(){console.log(p.value.$options),p.value.validate(c=>{c&&(u.value=!0,Qe(o.value).then(m=>{Z.success({message:"工单项保存成功"})}).finally(()=>{u.value=!1,I("refresh")}))})}function C(){return console.log(t.orderItem.parameters),console.log(o.value.parameters),!te.isEqual(t.orderItem.parameters,o.value.parameters)}return Y().registerOrderItemChangeDetector(C),(c,m)=>{const v=y("ElButton");return f(),T("div",null,[o.value.parameters?(f(),O(M(R(n)),{key:0,ref_key:"formRef",ref:p,modelValue:o.value.parameters,"onUpdate:modelValue":m[0]||(m[0]=g=>o.value.parameters=g)},null,8,["modelValue"])):A("",!0),S("div",kt,[r(v,{loading:u.value,type:"primary",style:{float:"right","margin-top":"12px"},disabled:s.value,onClick:h,plain:""},{default:l(()=>[V(" 保存工单项 ")]),_:1},8,["loading","disabled"])])])}}},Nt={style:{width:"100%"}},$t=S("span",null,"工单编号:",-1),zt={style:{"font-size":"16px"}},qt={__name:"OrderDetail",props:L({orderId:{required:!0}},{modelValue:{type:Boolean,required:!0,default:!1},modelModifiers:{}}),emits:L(["refresh"],["update:modelValue"]),setup(e,{emit:i}){const t=k(e,"modelValue"),o=e;ut();const a=d();function n(){ae({orderIds:[o.orderId]}).then(I=>{I.content&&I.content.length>0&&(a.value=I.content[0])})}J(n);const s=G(()=>a.value?[a.value]:[]),p=i;function u(){t.value=!1,p("refresh")}return(I,h)=>{const C=y("ElSpace"),b=y("ElCollapseItem"),c=y("ElCollapse");return f(),O(z,{size:1e3,modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=m=>t.value=m),title:"工单详情","custom-footer":""},{footer:l(()=>[r(ie,{"selected-orders":s.value,onRefresh:u},null,8,["selected-orders"])]),default:l(()=>[a.value?(f(),T(U,{key:0},[r(R(ye),{column:3,border:""},{title:l(()=>[S("div",Nt,[r(C,null,{default:l(()=>[$t,r(R(Ie),{type:"primary"},{default:l(()=>[V(w(a.value.orderNo),1)]),_:1}),r(se,{state:a.value.status,"error-message":a.value.errorMessage},null,8,["state","error-message"])]),_:1})])]),default:l(()=>[r(R(q),{label:"标题"},{default:l(()=>[V(w(a.value.orderName),1)]),_:1}),r(R(q),{label:"工作流"},{default:l(()=>[V(w(a.value.workflowName),1)]),_:1}),r(R(q),{label:"创建时间"},{default:l(()=>[V(w(a.value.createdAt),1)]),_:1}),r(R(q),{label:"提交时间"},{default:l(()=>[V(w(a.value.submittedAt),1)]),_:1}),r(R(q),{label:"最近审批时间"},{default:l(()=>[V(w(a.value.lastApprovedAt),1)]),_:1}),r(R(q),{label:"结束时间"},{default:l(()=>[V(w(a.value.endedAt),1)]),_:1}),r(R(q),{label:"当前意见"},{default:l(()=>[V(w(a.value.userMessage),1)]),_:1}),r(R(q),{label:"备注"},{default:l(()=>[V(w(a.value.note),1)]),_:1})]),_:1}),r(c,{style:{"margin-top":"32px"},accordion:""},{default:l(()=>[(f(!0),T(U,null,X(a.value.orderItems,(m,v)=>(f(),O(b,null,{title:l(()=>[S("span",zt,w(`工单项${v+1}: ${m.jobTypeName}`),1)]),default:l(()=>[r(Bt,{style:{"margin-top":"6px"},order:a.value,"order-item":m,onRefresh:n},null,8,["order","order-item"])]),_:2},1024))),256))]),_:1})],64)):A("",!0)]),_:1},8,["modelValue"])}}},Lt={style:{"margin-bottom":"10px",height:"32px"}},Pt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ht=["innerHTML"],Mt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Wt={style:{"max-width":"240px","white-space":"pre-wrap"}},jt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Gt={style:{"max-width":"240px","white-space":"pre-wrap"}},Cr={__name:"Orders",setup(e){const i=H(),o=d({ownerIds:[],possibleHandlerIds:[],historyHandlerIds:[],search:void 0}),a=d(!1);function n(c){const m=c.fullPath;m==="/order/my-orders"?(o.value.ownerIds=[i.userId],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[],a.value=!0):m==="/order/to-do-orders"?(o.value.ownerIds=[],o.value.possibleHandlerIds=[i.userId],o.value.historyHandlerIds=[]):m==="/order/done-orders"?(o.value.ownerIds=[],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[i.userId]):(o.value.ownerIds=[],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[])}Oe(c=>{n(c)}),J(()=>{n(Ce.currentRoute.value)});const s=d([]);function p(c){s.value=c}const u=d();function I(){u.value.fetchData()}const h=d(),C=d();function b(c){C.value=c,h.value=!0}return(c,m)=>{const v=y("ElTableColumn"),g=y("ElLink"),E=y("ElTooltip");return f(),T(U,null,[S("div",Lt,[r(ie,{"show-create":a.value,"selected-orders":s.value,onRefresh:I},null,8,["show-create","selected-orders"]),r(R(be),{style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":m[0]||(m[0]=_=>o.value.search=_),"suffix-icon":"search"},null,8,["modelValue"])]),r(Re,{ref_key:"tableRef",ref:u,"paging-request":o.value,"remote-method":R(ae),onSelectionChange:p},{default:l(()=>[r(v,{type:"selection","reserve-selection":""}),r(v,{"min-width":"100",prop:"orderNo",label:"工单编号",sortable:"custom"},{default:l(_=>[r(g,{type:"primary",onClick:()=>b(_.row.id)},{default:l(()=>[V(w(_.row.orderNo),1)]),_:2},1032,["onClick"])]),_:1}),r(v,{prop:"orderName",label:"工单标题",sortable:"custom"}),r(v,{prop:"workflowName",label:"工作流"}),r(v,{prop:"status",label:"工单状态",sortable:"custom"},{default:l(_=>[r(se,{state:_.row.status,"error-message":_.row.errorMessage},null,8,["state","error-message"])]),_:1}),r(v,{prop:"summary",label:"工单内容","show-overflow-tooltip":!1},{default:l(_=>[r(E,null,{content:l(()=>[S("span",{style:{"white-space":"pre-wrap"},innerHTML:_.row.summary},null,8,Ht)]),default:l(()=>[S("div",Pt,w(_.row.summary),1)]),_:2},1024)]),_:1}),r(v,{label:"当前处理人","show-overflow-tooltip":!1},{default:l(_=>[r(E,null,{content:l(()=>{var x;return[S("div",Wt,w((x=_.row.possibleHandlers)==null?void 0:x.map(B=>B.userName).join()),1)]}),default:l(()=>{var x;return[S("div",Mt,w((x=_.row.possibleHandlers)==null?void 0:x.map(B=>B.userName).join()),1)]}),_:2},1024)]),_:1}),r(v,{prop:"userMessage",label:"当前意见","show-overflow-tooltip":!1},{default:l(_=>[r(E,null,{content:l(()=>[S("div",Gt,w(_.row.userMessage),1)]),default:l(()=>[S("div",jt,w(_.row.userMessage),1)]),_:2},1024)]),_:1}),r(v,{prop:"lastApprovedAt",label:"审批时间",sortable:"custom"}),r(v,{prop:"ownerId",label:"申请人",width:"100",sortable:"custom"},{default:l(_=>[S("span",null,w(_.row.ownerRealName),1)]),_:1}),r(v,{prop:"submittedAt",label:"提交时间",sortable:"custom"}),r(v,{prop:"endedAt",label:"结束时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),h.value?(f(),O(qt,{key:0,modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=_=>h.value=_),"order-id":C.value,onRefresh:I},null,8,["modelValue","order-id"])):A("",!0)],64)}}};export{Cr as default};
