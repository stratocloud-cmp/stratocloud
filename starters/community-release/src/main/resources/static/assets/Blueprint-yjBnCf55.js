import{_ as me}from"./StratoTable-EZs1qWj6.js";import{S as J}from"./StratoButton-BRlR7RNE.js";import{_ as Z}from"./StratoDrawer-i3nJdUbZ.js";import{c as be,u as ye,a as ve,d as xe}from"./blueprint-CmUB0ZvE.js";import{V as le,c as E,d as T,e as Q,f as j,g as $,h as we,P as K,i as Ce,j as q,R as F,n as G,k as ee,l as D,m as V,r as ce,U as te,B as Pe,G as O,o as he,p as ke,M as Te,q as Se,s as ze,T as Ie,S as Ee,a as Me,K as Ne,C as Re,H as Ve,b as Be,E as _e,D as de,u as Oe}from"./SequenceGenerator-BF8TOZ3E.js";import{ag as Fe,ah as De,a7 as Y,r as x,m as H,n as z,o as C,q as I,w as b,e as p,v as A,ab as ne,u as M,Y as Le,a8 as Ae,y as Ue,b as ue,d as N,i as B,F as pe,x as ie,O as We,f as He,P as L}from"./index-CJwSUwqU.js";import{s as Ke,o as je,v as $e,t as qe}from"./resource-gXeeaH_K.js";import{_ as ge}from"./StratoDynamicForm-Bd91LD1B.js";import{b as Ge}from"./ResourceSelector-KiNjKK2p.js";import{_ as Xe}from"./StratoSelector-wBz-O0rL.js";import{l as oe}from"./request-IeLrxslB.js";import"./IpState-C6MgozXE.js";import"./UserSelector-CoJSGQ4A.js";import"./StratoPagingSelector-DNkLqj4O.js";import"./user-Ce1W_vfQ.js";import"./role-DMNZ0gjB.js";import"./job-P3tzUzyD.js";import"./scriptDefinition-YE6MXqAV.js";import"./AccountContext-CM6UEvQ6.js";import"./TagValueSelectorGroup-BLl39_D0.js";import"./tag-BkRjwYLf.js";const Ye={class:"className",contenteditable:"contentEditable",for:"htmlFor",readonly:"readOnly",maxlength:"maxLength",tabindex:"tabIndex",colspan:"colSpan",rowspan:"rowSpan",usemap:"useMap"};function X(s,e,t){if(e){if(typeof e=="string"){if(e=Ye[e]||e,arguments.length<3)return s[e];s[e]=t;return}for(const n in e)X(s,n,e[n])}}var Je=function(s,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(r=s[a])&&(o=(i<3?r(o):i>3?r(e,t,o):r(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o},Ze=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t};class y extends le{get graph(){return this.options.graph}get model(){return this.graph.model}constructor(e){super(),this.padding={left:0,top:0,right:0,bottom:0},this.options=y.getOptions(e),this.onUpdate=Fe(this.onUpdate,200);const t=this.graph.transform.getScale();this.sx=t.sx,this.sy=t.sy;const n=this.options.width||this.graph.options.width,i=this.options.height||this.graph.options.height;this.container=document.createElement("div"),E(this.container,this.prefixClassName(y.containerClass)),T(this.container,{width:n,height:i}),this.options.pageVisible&&E(this.container,this.prefixClassName(y.pagedClass)),this.options.className&&E(this.container,this.options.className);const o=this.graph.container;o.parentNode&&Q(o,this.container),this.content=document.createElement("div"),E(this.content,this.prefixClassName(y.contentClass)),T(this.content,{width:this.graph.options.width,height:this.graph.options.height}),this.background=document.createElement("div"),E(this.background,this.prefixClassName(y.backgroundClass)),j(this.content,this.background),this.options.pageVisible||j(this.content,this.graph.view.grid),j(this.content,o),$(this.content,this.container),this.startListening(),this.options.pageVisible||this.graph.grid.update(),this.backgroundManager=new y.Background(this),this.options.autoResize||this.update()}startListening(){const e=this.graph,t=this.model;e.on("scale",this.onScale,this),e.on("resize",this.onResize,this),e.on("before:print",this.storeScrollPosition,this),e.on("before:export",this.storeScrollPosition,this),e.on("after:print",this.restoreScrollPosition,this),e.on("after:export",this.restoreScrollPosition,this),t.on("reseted",this.onUpdate,this),t.on("cell:added",this.onUpdate,this),t.on("cell:removed",this.onUpdate,this),t.on("cell:changed",this.onUpdate,this),this.delegateBackgroundEvents()}stopListening(){const e=this.graph,t=this.model;e.off("scale",this.onScale,this),e.off("resize",this.onResize,this),e.off("beforeprint",this.storeScrollPosition,this),e.off("beforeexport",this.storeScrollPosition,this),e.off("afterprint",this.restoreScrollPosition,this),e.off("afterexport",this.restoreScrollPosition,this),t.off("reseted",this.onUpdate,this),t.off("cell:added",this.onUpdate,this),t.off("cell:removed",this.onUpdate,this),t.off("cell:changed",this.onUpdate,this),this.undelegateBackgroundEvents()}enableAutoResize(){this.options.autoResize=!0}disableAutoResize(){this.options.autoResize=!1}onUpdate(){this.options.autoResize&&this.update()}delegateBackgroundEvents(e){const t=e||we.events;this.delegatedHandlers=Object.keys(t).reduce((n,i)=>{const o=t[i];if(i.indexOf(" ")===-1)if(typeof o=="function")n[i]=o;else{let r=this.graph.view[o];typeof r=="function"&&(r=r.bind(this.graph.view),n[i]=r)}return n},{}),this.onBackgroundEvent=this.onBackgroundEvent.bind(this),Object.keys(this.delegatedHandlers).forEach(n=>{this.delegateEvent(n,{guarded:!1},this.onBackgroundEvent)})}undelegateBackgroundEvents(){Object.keys(this.delegatedHandlers).forEach(e=>{this.undelegateEvent(e,this.onBackgroundEvent)})}onBackgroundEvent(e){let t=!1;const n=e.target;if(this.options.pageVisible)this.options.background?t=this.background===n:t=this.content===n;else{const i=this.graph.view;t=i.background===n||i.grid===n}if(t){const i=this.delegatedHandlers[e.type];typeof i=="function"&&i.apply(this.graph,arguments)}}onResize(){this.cachedCenterPoint&&(this.centerPoint(this.cachedCenterPoint.x,this.cachedCenterPoint.y),this.updatePageBreak())}onScale({sx:e,sy:t,ox:n,oy:i}){this.updateScale(e,t),(n||i)&&(this.centerPoint(n,i),this.updatePageBreak()),typeof this.options.autoResizeOptions=="function"&&this.update()}storeScrollPosition(){this.cachedScrollLeft=this.container.scrollLeft,this.cachedScrollTop=this.container.scrollTop}restoreScrollPosition(){this.container.scrollLeft=this.cachedScrollLeft,this.container.scrollTop=this.cachedScrollTop,this.cachedScrollLeft=null,this.cachedScrollTop=null}storeClientSize(){this.cachedClientSize={width:this.container.clientWidth,height:this.container.clientHeight}}restoreClientSize(){this.cachedClientSize=null}beforeManipulation(){(K.IS_IE||K.IS_EDGE)&&T(this.container,{visibility:"hidden"})}afterManipulation(){(K.IS_IE||K.IS_EDGE)&&T(this.container,{visibility:"visible"})}updatePageSize(e,t){e!=null&&(this.options.pageWidth=e),t!=null&&(this.options.pageHeight=t),this.updatePageBreak()}updatePageBreak(){if(this.pageBreak&&this.pageBreak.parentNode&&this.pageBreak.parentNode.removeChild(this.pageBreak),this.pageBreak=null,this.options.pageVisible&&this.options.pageBreak){const e=this.graph.options.width,t=this.graph.options.height,n=this.options.pageWidth*this.sx,i=this.options.pageHeight*this.sy;if(n===0||i===0)return;if(e>n||t>i){let o=!1;const r=document.createElement("div");for(let a=1,c=Math.floor(e/n);a<c;a+=1){const h=document.createElement("div");E(h,this.prefixClassName("graph-pagebreak-vertical")),T(h,{left:a*n}),$(h,r),o=!0}for(let a=1,c=Math.floor(t/i);a<c;a+=1){const h=document.createElement("div");E(h,this.prefixClassName("graph-pagebreak-horizontal")),T(h,{top:a*i}),$(h,r),o=!0}o&&(E(r,this.prefixClassName("graph-pagebreak")),Ce(this.graph.view.grid,r),this.pageBreak=r)}}}update(){const e=this.getClientSize();this.cachedCenterPoint=this.clientToLocalPoint(e.width/2,e.height/2);let t=this.options.autoResizeOptions;typeof t=="function"&&(t=q(t,this,this));const n=Object.assign({gridWidth:this.options.pageWidth,gridHeight:this.options.pageHeight,allowNewOrigin:"negative"},t);this.graph.fitToContent(this.getFitToContentOptions(n))}getFitToContentOptions(e){const t=this.sx,n=this.sy;return e.gridWidth&&(e.gridWidth*=t),e.gridHeight&&(e.gridHeight*=n),e.minWidth&&(e.minWidth*=t),e.minHeight&&(e.minHeight*=n),typeof e.padding=="object"?e.padding={left:(e.padding.left||0)*t,right:(e.padding.right||0)*t,top:(e.padding.top||0)*n,bottom:(e.padding.bottom||0)*n}:typeof e.padding=="number"&&(e.padding*=t),this.options.autoResize||(e.contentArea=F.create()),e}updateScale(e,t){const n=this.graph.options,i=e/this.sx,o=t/this.sy;this.sx=e,this.sy=t,this.graph.translate(n.x*i,n.y*o),this.graph.transform.resize(n.width*i,n.height*o)}scrollbarPosition(e,t){if(e==null&&t==null)return{left:this.container.scrollLeft,top:this.container.scrollTop};const n={};return typeof e=="number"&&(n.scrollLeft=e),typeof t=="number"&&(n.scrollTop=t),X(this.container,n),this}scrollToPoint(e,t){const n=this.getClientSize(),i=this.graph.matrix(),o={};return typeof e=="number"&&(o.scrollLeft=e-n.width/2+i.e+(this.padding.left||0)),typeof t=="number"&&(o.scrollTop=t-n.height/2+i.f+(this.padding.top||0)),X(this.container,o),this}scrollToContent(){const e=this.sx,t=this.sy,n=this.graph.getContentArea().getCenter();return this.scrollToPoint(n.x*e,n.y*t)}scrollToCell(e){const t=this.sx,n=this.sy,i=e.getBBox().getCenter();return this.scrollToPoint(i.x*t,i.y*n)}center(e){return this.centerPoint(e)}centerPoint(e,t,n){const i=this.graph.matrix(),o=i.a,r=i.d,a=-i.e,c=-i.f,h=a+this.graph.options.width,f=c+this.graph.options.height;let d;if(this.storeClientSize(),typeof e=="number"||typeof t=="number"){d=n;const v=this.getVisibleArea().getCenter();typeof e=="number"?e*=o:e=v.x,typeof t=="number"?t*=r:t=v.y}else d=e,e=(a+h)/2,t=(c+f)/2;if(d&&d.padding)return this.positionPoint({x:e,y:t},"50%","50%",d);const u=this.getPadding(),S=this.getClientSize(),m=S.width/2,_=S.height/2,P=m-u.left-e+a,k=m-u.right+e-h,U=_-u.top-t+c,l=_-u.bottom+t-f;this.addPadding(Math.max(P,0),Math.max(k,0),Math.max(U,0),Math.max(l,0));const g=this.scrollToPoint(e,t);return this.restoreClientSize(),g}centerContent(e){return this.positionContent("center",e)}centerCell(e,t){return this.positionCell(e,"center",t)}positionContent(e,t){const n=this.graph.getContentArea(t);return this.positionRect(n,e,t)}positionCell(e,t,n){const i=e.getBBox();return this.positionRect(i,t,n)}positionRect(e,t,n){const i=F.create(e);switch(t){case"center":return this.positionPoint(i.getCenter(),"50%","50%",n);case"top":return this.positionPoint(i.getTopCenter(),"50%",0,n);case"top-right":return this.positionPoint(i.getTopRight(),"100%",0,n);case"right":return this.positionPoint(i.getRightMiddle(),"100%","50%",n);case"bottom-right":return this.positionPoint(i.getBottomRight(),"100%","100%",n);case"bottom":return this.positionPoint(i.getBottomCenter(),"50%","100%",n);case"bottom-left":return this.positionPoint(i.getBottomLeft(),0,"100%",n);case"left":return this.positionPoint(i.getLeftMiddle(),0,"50%",n);case"top-left":return this.positionPoint(i.getTopLeft(),0,0,n);default:return this}}positionPoint(e,t,n,i={}){const{padding:o}=i,r=Ze(i,["padding"]),a=G(o),c=F.fromSize(this.getClientSize()),h=c.clone().moveAndExpand({x:a.left,y:a.top,width:-a.right-a.left,height:-a.top-a.bottom});t=ee(t,Math.max(0,h.width)),t<0&&(t=h.width+t),n=ee(n,Math.max(0,h.height)),n<0&&(n=h.height+n);const f=h.getTopLeft().translate(t,n),d=c.getCenter().diff(f),u=this.zoom(),S=d.scale(1/u,1/u),m=D.create(e).translate(S);return this.centerPoint(m.x,m.y,r)}zoom(e,t){if(e==null)return this.sx;t=t||{};let n,i;const o=this.getClientSize(),r=this.clientToLocalPoint(o.width/2,o.height/2);let a=e,c=e;if(t.absolute||(a+=this.sx,c+=this.sy),t.scaleGrid&&(a=Math.round(a/t.scaleGrid)*t.scaleGrid,c=Math.round(c/t.scaleGrid)*t.scaleGrid),t.maxScale&&(a=Math.min(t.maxScale,a),c=Math.min(t.maxScale,c)),t.minScale&&(a=Math.max(t.minScale,a),c=Math.max(t.minScale,c)),a=this.graph.transform.clampScale(a),c=this.graph.transform.clampScale(c),t.center){const h=a/this.sx,f=c/this.sy;n=t.center.x-(t.center.x-r.x)/h,i=t.center.y-(t.center.y-r.y)/f}else n=r.x,i=r.y;return this.beforeManipulation(),this.graph.transform.scale(a,c),this.centerPoint(n,i),this.afterManipulation(),this}zoomToRect(e,t={}){const n=F.create(e),i=this.graph;if(t.contentArea=n,t.viewportArea==null){const r=this.container.getBoundingClientRect();t.viewportArea={x:i.options.x,y:i.options.y,width:r.width,height:r.height}}this.beforeManipulation(),i.transform.scaleContentToFitImpl(t,!1);const o=n.getCenter();return this.centerPoint(o.x,o.y),this.afterManipulation(),this}zoomToFit(e={}){return this.zoomToRect(this.graph.getContentArea(e),e)}transitionToPoint(e,t,n){typeof e=="object"?(n=t,t=e.y,e=e.x):t=t,n==null&&(n={});let i,o;const r=this.sx,a=Math.max(n.scale||r,1e-6),c=this.getClientSize(),h=new D(e,t),f=this.clientToLocalPoint(c.width/2,c.height/2);if(r===a){const u=f.diff(h).scale(r,r).round();i=`translate(${u.x}px,${u.y}px)`}else{const u=a/(r-a)*h.distance(f),S=f.clone().move(h,u),m=this.localToBackgroundPoint(S).round();i=`scale(${a/r})`,o=`${m.x}px ${m.y}px`}const d=n.onTransitionEnd;return E(this.container,y.transitionClassName),V.off(this.content,y.transitionEventName),V.on(this.content,y.transitionEventName,u=>{this.syncTransition(a,{x:e,y:t}),typeof d=="function"&&q(d,this,u.originalEvent)}),T(this.content,{transform:i,transformOrigin:o,transition:"transform",transitionDuration:n.duration||"1s",transitionDelay:n.delay,transitionTimingFunction:n.timing}),this}syncTransition(e,t){return this.beforeManipulation(),this.graph.scale(e),this.removeTransition(),this.centerPoint(t.x,t.y),this.afterManipulation(),this}removeTransition(){return ce(this.container,y.transitionClassName),V.off(this.content,y.transitionEventName),T(this.content,{transform:"",transformOrigin:"",transition:"",transitionDuration:"",transitionDelay:"",transitionTimingFunction:""}),this}transitionToRect(e,t={}){const n=F.create(e),i=t.maxScale||1/0,o=t.minScale||Number.MIN_VALUE,r=t.scaleGrid||null,a=t.visibility||1,c=t.center?D.create(t.center):n.getCenter(),h=this.getClientSize(),f=h.width*a,d=h.height*a;let u=new F(c.x-f/2,c.y-d/2,f,d).getMaxUniformScaleToFit(n,c);return u=Math.min(u,i),r&&(u=Math.floor(u/r)*r),u=Math.max(o,u),this.transitionToPoint(c,Object.assign({scale:u},t))}startPanning(e){const t=this.normalizeEvent(e);this.clientX=t.clientX,this.clientY=t.clientY,this.trigger("pan:start",{e:t}),V.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),V.on(window,"mouseup.panning",this.stopPanning.bind(this))}pan(e){const t=this.normalizeEvent(e),n=t.clientX-this.clientX,i=t.clientY-this.clientY;this.container.scrollTop-=i,this.container.scrollLeft-=n,this.clientX=t.clientX,this.clientY=t.clientY,this.trigger("panning",{e:t})}stopPanning(e){V.off(document.body,".panning"),V.off(window,".panning"),this.trigger("pan:stop",{e})}clientToLocalPoint(e,t){let n=typeof e=="object"?e.x:e,i=typeof e=="object"?e.y:t;const o=this.graph.matrix();return n+=this.container.scrollLeft-this.padding.left-o.e,i+=this.container.scrollTop-this.padding.top-o.f,new D(n/o.a,i/o.d)}localToBackgroundPoint(e,t){const n=typeof e=="object"?D.create(e):new D(e,t),i=this.graph.matrix(),o=this.padding;return te.transformPoint(n,i).translate(o.left,o.top)}resize(e,t){let n=e??this.container.offsetWidth,i=t??this.container.offsetHeight;typeof n=="number"&&(n=Math.round(n)),typeof i=="number"&&(i=Math.round(i)),this.options.width=n,this.options.height=i,T(this.container,{width:n,height:i}),this.update()}getClientSize(){return this.cachedClientSize?this.cachedClientSize:{width:this.container.clientWidth,height:this.container.clientHeight}}autoScroll(e,t){const i=this.container,o=i.getBoundingClientRect();let r=0,a=0;return e<=o.left+10&&(r=-10),t<=o.top+10&&(a=-10),e>=o.right-10&&(r=10),t>=o.bottom-10&&(a=10),r!==0&&(i.scrollLeft+=r),a!==0&&(i.scrollTop+=a),{scrollerX:r,scrollerY:a}}addPadding(e,t,n,i){let o=this.getPadding();this.padding={left:Math.round(o.left+(e||0)),top:Math.round(o.top+(n||0)),bottom:Math.round(o.bottom+(i||0)),right:Math.round(o.right+(t||0))},o=this.padding,T(this.content,{width:o.left+this.graph.options.width+o.right,height:o.top+this.graph.options.height+o.bottom});const r=this.graph.container;return r.style.left=`${this.padding.left}px`,r.style.top=`${this.padding.top}px`,this}getPadding(){const e=this.options.padding;return typeof e=="function"?G(q(e,this,this)):G(e)}getVisibleArea(){const e=this.graph.matrix(),t=this.getClientSize(),n={x:this.container.scrollLeft||0,y:this.container.scrollTop||0,width:t.width,height:t.height},i=te.transformRectangle(n,e.inverse());return i.x-=(this.padding.left||0)/this.sx,i.y-=(this.padding.top||0)/this.sy,i}isCellVisible(e,t={}){const n=e.getBBox(),i=this.getVisibleArea();return t.strict?i.containsRect(n):i.isIntersectWithRect(n)}isPointVisible(e){return this.getVisibleArea().containsPoint(e)}lock(){return T(this.container,{overflow:"hidden"}),this}unlock(){return T(this.container,{overflow:"scroll"}),this}onRemove(){this.stopListening()}dispose(){Q(this.container,this.graph.container),this.remove()}}Je([le.dispose()],y.prototype,"dispose",null);(function(s){class e extends Pe{get elem(){return this.scroller.background}constructor(n){super(n.graph),this.scroller=n,n.options.background&&this.draw(n.options.background)}init(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}updateBackgroundOptions(n){this.scroller.options.background=n}}s.Background=e})(y||(y={}));(function(s){s.containerClass="graph-scroller",s.panningClass=`${s.containerClass}-panning`,s.pannableClass=`${s.containerClass}-pannable`,s.pagedClass=`${s.containerClass}-paged`,s.contentClass=`${s.containerClass}-content`,s.backgroundClass=`${s.containerClass}-background`,s.transitionClassName="transition-in-progress",s.transitionEventName="transitionend.graph-scroller-transition",s.defaultOptions={padding(){const t=this.getClientSize(),n=Math.max(this.options.minVisibleWidth||0,1)||1,i=Math.max(this.options.minVisibleHeight||0,1)||1,o=Math.max(t.width-n,0),r=Math.max(t.height-i,0);return{left:o,top:r,right:o,bottom:r}},minVisibleWidth:50,minVisibleHeight:50,pageVisible:!1,pageBreak:!1,autoResize:!0};function e(t){const n=De({},s.defaultOptions,t);n.pageWidth==null&&(n.pageWidth=t.graph.options.width),n.pageHeight==null&&(n.pageHeight=t.graph.options.height);const i=t.graph.options;return i.background&&n.enabled&&n.background==null&&(n.background=i.background,t.graph.background.clear()),n}s.getOptions=e})(y||(y={}));const Qe=`.x6-graph-scroller {
  position: relative;
  box-sizing: border-box;
  overflow: scroll;
  outline: none;
}
.x6-graph-scroller-content {
  position: relative;
}
.x6-graph-scroller-background {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-scroller .x6-graph {
  position: absolute;
  display: inline-block;
  margin: 0;
  box-shadow: none;
}
.x6-graph-scroller .x6-graph > svg {
  display: block;
}
.x6-graph-scroller.x6-graph-scroller-paged .x6-graph {
  box-shadow: 0 0 4px 0 #eee;
}
.x6-graph-scroller.x6-graph-scroller-pannable[data-panning='false'] {
  cursor: grab;
}
.x6-graph-scroller.x6-graph-scroller-pannable[data-panning='true'] {
  cursor: grabbing;
  user-select: none;
}
.x6-graph-pagebreak {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-pagebreak-vertical {
  position: absolute;
  top: 0;
  bottom: 0;
  box-sizing: border-box;
  width: 1px;
  border-left: 1px dashed #bdbdbd;
}
.x6-graph-pagebreak-horizontal {
  position: absolute;
  right: 0;
  left: 0;
  box-sizing: border-box;
  height: 1px;
  border-top: 1px dashed #bdbdbd;
}
`;O.prototype.lockScroller=function(){const s=this.getPlugin("scroller");return s&&s.lockScroller(),this};O.prototype.unlockScroller=function(){const s=this.getPlugin("scroller");return s&&s.unlockScroller(),this};O.prototype.updateScroller=function(){const s=this.getPlugin("scroller");return s&&s.updateScroller(),this};O.prototype.getScrollbarPosition=function(){const s=this.getPlugin("scroller");return s?s.getScrollbarPosition():{left:0,top:0}};O.prototype.setScrollbarPosition=function(s,e){const t=this.getPlugin("scroller");return t&&t.setScrollbarPosition(s,e),this};var et=function(s,e,t,n){var i=arguments.length,o=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")o=Reflect.decorate(s,e,t,n);else for(var a=s.length-1;a>=0;a--)(r=s[a])&&(o=(i<3?r(o):i>3?r(e,t,o):r(e,t))||o);return i>3&&o&&Object.defineProperty(e,t,o),o};class tt extends he{get pannable(){return this.options?typeof this.options.pannable=="object"?this.options.pannable.enabled:!!this.options.pannable:!1}get container(){return this.scrollerImpl.container}constructor(e={}){super(),this.name="scroller",this.options=e,ke(this.name,Qe)}init(e){this.graph=e;const t=y.getOptions(Object.assign(Object.assign({enabled:!0},this.options),{graph:e}));this.options=t,this.scrollerImpl=new y(t),this.setup(),this.startListening(),this.updateClassName(),this.scrollerImpl.center()}resize(e,t){this.scrollerImpl.resize(e,t)}resizePage(e,t){this.scrollerImpl.updatePageSize(e,t)}zoom(e,t){return typeof e>"u"?this.scrollerImpl.zoom():(this.scrollerImpl.zoom(e,t),this)}zoomTo(e,t={}){return this.scrollerImpl.zoom(e,Object.assign(Object.assign({},t),{absolute:!0})),this}zoomToRect(e,t={}){return this.scrollerImpl.zoomToRect(e,t),this}zoomToFit(e={}){return this.scrollerImpl.zoomToFit(e),this}center(e){return this.centerPoint(e)}centerPoint(e,t,n){return this.scrollerImpl.centerPoint(e,t,n),this}centerContent(e){return this.scrollerImpl.centerContent(e),this}centerCell(e,t){return this.scrollerImpl.centerCell(e,t),this}positionPoint(e,t,n,i={}){return this.scrollerImpl.positionPoint(e,t,n,i),this}positionRect(e,t,n){return this.scrollerImpl.positionRect(e,t,n),this}positionCell(e,t,n){return this.scrollerImpl.positionCell(e,t,n),this}positionContent(e,t){return this.scrollerImpl.positionContent(e,t),this}drawBackground(e,t){return(this.graph.options.background==null||!t)&&this.scrollerImpl.backgroundManager.draw(e),this}clearBackground(e){return(this.graph.options.background==null||!e)&&this.scrollerImpl.backgroundManager.clear(),this}isPannable(){return this.pannable}enablePanning(){this.pannable||(this.options.pannable=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.options.pannable=!1,this.updateClassName())}togglePanning(e){return e==null?this.isPannable()?this.disablePanning():this.enablePanning():e!==this.isPannable()&&(e?this.enablePanning():this.disablePanning()),this}lockScroller(){return this.scrollerImpl.lock(),this}unlockScroller(){return this.scrollerImpl.unlock(),this}updateScroller(){return this.scrollerImpl.update(),this}getScrollbarPosition(){return this.scrollerImpl.scrollbarPosition()}setScrollbarPosition(e,t){return this.scrollerImpl.scrollbarPosition(e,t),this}scrollToPoint(e,t){return this.scrollerImpl.scrollToPoint(e,t),this}scrollToContent(){return this.scrollerImpl.scrollToContent(),this}scrollToCell(e){return this.scrollerImpl.scrollToCell(e),this}transitionToPoint(e,t,n){return this.scrollerImpl.transitionToPoint(e,t,n),this}transitionToRect(e,t={}){return this.scrollerImpl.transitionToRect(e,t),this}enableAutoResize(){this.scrollerImpl.enableAutoResize()}disableAutoResize(){this.scrollerImpl.disableAutoResize()}autoScroll(e,t){return this.scrollerImpl.autoScroll(e,t)}clientToLocalPoint(e,t){return this.scrollerImpl.clientToLocalPoint(e,t)}setup(){this.scrollerImpl.on("*",(e,t)=>{this.trigger(e,t)})}startListening(){let e=[];const t=this.options.pannable;typeof t=="object"?e=t.eventTypes||[]:e=["leftMouseDown"],e.includes("leftMouseDown")&&(this.graph.on("blank:mousedown",this.preparePanning,this),this.graph.on("node:unhandled:mousedown",this.preparePanning,this),this.graph.on("edge:unhandled:mousedown",this.preparePanning,this)),e.includes("rightMouseDown")&&(this.onRightMouseDown=this.onRightMouseDown.bind(this),V.on(this.scrollerImpl.container,"mousedown",this.onRightMouseDown))}stopListening(){let e=[];const t=this.options.pannable;typeof t=="object"?e=t.eventTypes||[]:e=["leftMouseDown"],e.includes("leftMouseDown")&&(this.graph.off("blank:mousedown",this.preparePanning,this),this.graph.off("node:unhandled:mousedown",this.preparePanning,this),this.graph.off("edge:unhandled:mousedown",this.preparePanning,this)),e.includes("rightMouseDown")&&V.off(this.scrollerImpl.container,"mousedown",this.onRightMouseDown)}onRightMouseDown(e){e.button===2&&this.allowPanning(e,!0)&&(this.updateClassName(!0),this.scrollerImpl.startPanning(e),this.scrollerImpl.once("pan:stop",()=>this.updateClassName(!1)))}preparePanning({e}){const t=this.allowPanning(e,!0),n=this.graph.getPlugin("selection"),i=n&&n.allowRubberband(e,!0);(t||this.allowPanning(e)&&!i)&&(this.updateClassName(!0),this.scrollerImpl.startPanning(e),this.scrollerImpl.once("pan:stop",()=>this.updateClassName(!1)))}allowPanning(e,t){return this.pannable&&Te.isMatch(e,this.options.modifiers,t)}updateClassName(e){const t=this.scrollerImpl.container,n=ze.prefix("graph-scroller-pannable");this.pannable?(E(t,n),t.dataset.panning=(!!e).toString()):ce(t,n)}dispose(){this.scrollerImpl.dispose(),this.stopListening(),this.off(),Se(this.name)}}et([he.dispose()],tt.prototype,"dispose",null);function nt(s,e){const t=lt(e);t.use(new Ie({resizing:!0,rotating:!0})).use(new Ee({rubberband:!1,showNodeSelectionBox:!0})).use(new Me).use(new Ne).use(new Re).use(new Ve);const n=at(t,s);st(t);const i=rt(t);return ot(i,t,n),t}function it(s){const e=new de({nodesep:30,ranksep:30}),t=s.toJSON(),n={edges:[],nodes:[]};t.cells.forEach(o=>{o.shape==="edge"?n.edges.push(o):n.nodes.push(o)});const i=e.layout(n);s.fromJSON(i)}function ot(s,e,t){O.registerNode("custom-rect",{inherit:"rect",width:100,height:36,attrs:{body:{strokeWidth:1,stroke:"#5F95FF",fill:"#EFF4FF"},text:{fontSize:10}},ports:{...s}},!0),Ke({}).then(n=>{const i=new Map,o=new Map;for(let a of n.resourceTypes){const c={resourceTypeId:a.spec.resourceTypeId,resourceTypeName:a.spec.resourceTypeName,borrowed:!a.spec.buildable,resourceProperties:{}},h={shape:"custom-rect",label:a.spec.resourceTypeName,data:c,attrs:{body:{rx:4,ry:4}}};i.set(a.spec.providerId,a.spec.providerName),o.has(a.spec.providerId)||o.set(a.spec.providerId,[]),o.get(a.spec.providerId).push(h)}const r=[];for(let a of i.keys()){let c=0;o.has(a)&&(c=o.get(a).length),r.push({title:i.get(a),name:a,collapsable:!0,graphHeight:c/2*42+50,layoutOptions:{columns:2,columnWidth:110,rowHeight:42}})}t.addGroup(r);for(let a of o.keys())t.load(o.get(a),a)})}function st(s){s.bindKey(["meta+c","ctrl+c"],()=>{const e=s.getSelectedCells();return e.length&&s.copy(e),!1}),s.bindKey(["meta+x","ctrl+x"],()=>{const e=s.getSelectedCells();return e.length&&s.cut(e),!1}),s.bindKey(["meta+v","ctrl+v"],()=>{if(!s.isClipboardEmpty()){const e=s.paste({offset:32});s.cleanSelection(),s.select(e)}return!1}),s.bindKey(["meta+z","ctrl+z"],()=>(s.canUndo()&&s.undo(),!1)),s.bindKey(["meta+shift+z","ctrl+shift+z"],()=>(s.canRedo()&&s.redo(),!1)),s.bindKey(["meta+a","ctrl+a"],()=>{const e=s.getNodes();e&&s.select(e)}),s.bindKey("backspace",()=>{const e=s.getSelectedCells();e.length&&s.removeCells(e)})}function rt(s){const e=(t,n)=>{for(let i=0,o=t.length;i<o;i+=1)t[i].style.visibility=n?"visible":"hidden"};return s.on("node:mouseenter",()=>{const n=document.getElementById(s.container.id).querySelectorAll(".x6-port-body");e(n,!0)}),s.on("node:mouseleave",()=>{const n=document.getElementById(s.container.id).querySelectorAll(".x6-port-body");e(n,!1)}),{groups:{top:{position:"top",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},right:{position:"right",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},bottom:{position:"bottom",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}},left:{position:"left",attrs:{circle:{r:4,magnet:!0,stroke:"#5F95FF",strokeWidth:1,fill:"#fff",style:{visibility:"hidden"}}}}},items:[{group:"top"},{group:"right"},{group:"bottom"},{group:"left"}]}}function at(s,e){const t=new Be({title:"资源栈蓝图",target:s,stencilGraphWidth:300,stencilGraphHeight:30,collapsable:!0,groups:[],layoutOptions:{columns:2,columnWidth:110,rowHeight:42}});return document.getElementById(e).appendChild(t.container),t}function lt(s){return new O({container:document.getElementById(s),width:"100%",height:"100%",grid:!0,panning:!0,connecting:{router:"manhattan",connector:{name:"rounded",args:{radius:8}},anchor:"center",connectionPoint:"anchor",allowBlank:!1,snap:{radius:20},createEdge(){return new _e({attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0})},validateConnection({targetMagnet:e}){return!!e}},highlighting:{magnetAdsorbed:{name:"stroke",args:{attrs:{fill:"#5F95FF",stroke:"#5F95FF"}}}}})}const ct={__name:"BlueprintNodeForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const e=Y(s,"modelValue"),t=x(),n=x();function i(){var o,r;(o=e.value)!=null&&o.borrowed||(r=e.value)!=null&&r.resourceTypeId&&je({resourceTypeId:e.value.resourceTypeId,actionId:"BUILD_RESOURCE"}).then(a=>{n.value=a.formMetaData}).catch(()=>{e.value.borrowed=!0})}return H(()=>{var o;return(o=e.value)==null?void 0:o.resourceTypeId},i,{immediate:!0}),H(()=>{var o;return(o=e.value)==null?void 0:o.borrowed},i),(o,r)=>{const a=z("ElInput"),c=z("ElFormItem"),h=z("ElSwitch"),f=z("ElForm");return C(),I(f,{size:"small",ref_key:"formRef",ref:t,model:e.value,"label-position":"top"},{default:b(()=>[p(c,{label:"资源类型"},{default:b(()=>[p(a,{disabled:"",modelValue:e.value.resourceTypeName,"onUpdate:modelValue":r[0]||(r[0]=d=>e.value.resourceTypeName=d)},null,8,["modelValue"])]),_:1}),p(c,{label:"节点标识"},{default:b(()=>[p(a,{disabled:"",modelValue:e.value.nodeKey,"onUpdate:modelValue":r[1]||(r[1]=d=>e.value.nodeKey=d)},null,8,["modelValue"])]),_:1}),p(c,{label:"节点名称"},{default:b(()=>[p(a,{modelValue:e.value.nodeName,"onUpdate:modelValue":r[2]||(r[2]=d=>e.value.nodeName=d)},null,8,["modelValue"])]),_:1}),p(c,{label:"使用已有资源"},{default:b(()=>[p(h,{modelValue:e.value.borrowed,"onUpdate:modelValue":r[3]||(r[3]=d=>e.value.borrowed=d)},null,8,["modelValue"])]),_:1}),e.value.borrowed?(C(),I(c,{key:0,label:"已有资源"},{default:b(()=>[p(Ge,{teleported:"","resource-type-id":e.value.resourceTypeId,modelValue:e.value.borrowedResourceId,"onUpdate:modelValue":r[4]||(r[4]=d=>e.value.borrowedResourceId=d)},null,8,["resource-type-id","modelValue"])]),_:1})):A("",!0),n.value&&!e.value.borrowed?(C(),I(ge,{key:1,size:"small","form-meta-data":n.value,modelValue:e.value.resourceProperties,"onUpdate:modelValue":r[5]||(r[5]=d=>e.value.resourceProperties=d)},null,8,["form-meta-data","modelValue"])):A("",!0)]),_:1},8,["model"])}}},ht={__name:"RelationshipTypeSelector",props:ne({sourceTypeId:{required:!0},targetTypeId:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:ne(["change"],["update:modelValue"]),setup(s,{emit:e}){const t=Y(s,"modelValue"),n=s,i=x({sourceTypeId:n.sourceTypeId,targetTypeId:n.targetTypeId});H(n,()=>{i.value.sourceTypeId=n.sourceTypeId,i.value.targetTypeId=n.targetTypeId});const o=e;function r(a){o("change",a)}return(a,c)=>(C(),I(Xe,{modelValue:t.value,"onUpdate:modelValue":c[0]||(c[0]=h=>t.value=h),placeholder:"请选择关系类型",request:i.value,onChange:r,"remote-method":M($e),"list-getter":h=>h.relationshipSpecs,"label-getter":h=>h.connectActionName,"value-getter":h=>h.relationshipTypeId,teleported:""},null,8,["modelValue","request","remote-method","list-getter","label-getter","value-getter"]))}},dt={__name:"BlueprintRelationshipForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(s){const e=Y(s,"modelValue"),t=x(),n=x();function i(o){o&&(e.value.connectActionName=o.connectActionName,qe({relationshipTypeId:o.relationshipTypeId}).then(r=>{n.value=r.formMetaData}))}return(o,r)=>{const a=z("ElFormItem"),c=z("ElForm");return C(),I(c,{size:"small",ref_key:"formRef",ref:t,model:e.value,"label-position":"top"},{default:b(()=>[p(a,{label:"关系类型"},{default:b(()=>[p(ht,{onChange:i,"source-type-id":e.value.sourceTypeId,"target-type-id":e.value.targetTypeId,modelValue:e.value.relationshipTypeId,"onUpdate:modelValue":r[0]||(r[0]=h=>e.value.relationshipTypeId=h)},null,8,["source-type-id","target-type-id","modelValue"])]),_:1}),n.value?Le((C(),I(ge,{key:0,size:"small","form-meta-data":n.value,modelValue:e.value.relationshipInput,"onUpdate:modelValue":r[1]||(r[1]=h=>e.value.relationshipInput=h)},null,8,["form-meta-data","modelValue"])),[[Ae,!1]]):A("",!0)]),_:1},8,["model"])}}},ut={style:{height:"10%"}},pt=N("div",null,[B(" 从左侧面板拖拽出节点放置到右侧画布上，鼠标悬停于节点上将显示连接桩(节点边缘的小圆圈)， 点击连接桩(按住鼠标左键)拖出线条进行连线，连接完成后松开鼠标左键。"),N("br"),B(" 可点击某个节点或关系以修改其属性。"),N("br"),B(" 快捷键：ctrl+c复制，ctrl+v粘贴，ctrl+x剪切，backspace删除，ctrl+z撤销，ctrl+shift+z重做，ctrl+a全选 ")],-1),gt="blueprint-main-container",se="blueprint-stencil-container",re="blueprint-graph-container",ae={__name:"BlueprintEditor",props:{blueprint:{required:!1}},setup(s,{expose:e}){const t=s,n=Oe();let i;Ue(()=>{i=nt(se,re),i.on("node:added",({node:l})=>c(l)),i.on("edge:connected",({edge:l})=>h(l)),i.on("cell:click",({cell:l})=>S(l)),i.on("cell:mouseenter",({cell:l})=>a(l)),i.on("cell:mouseleave",({cell:l})=>{l.removeTool("button-remove")}),t.blueprint&&o()});async function o(){m.value.name=t.blueprint.name,m.value.description=t.blueprint.description;const l={nodes:[],edges:[]};for(let w of t.blueprint.nodes){n.addSequence(w.nodeKey),n.addSequence(w.nodeName);const R=oe.cloneDeep(w);l.nodes.push({id:R.nodeKey,shape:"custom-rect",label:R.nodeName,data:R,attrs:{body:{rx:10,ry:10}},ports:{items:[{group:"top",id:R.nodeKey+"-top"},{group:"right",id:R.nodeKey+"-right"},{group:"bottom",id:R.nodeKey+"-bottom"},{group:"left",id:R.nodeKey+"-left"}]}})}for(let w of t.blueprint.relationships)l.edges.push({shape:"edge",label:w.connectActionName,data:oe.cloneDeep(w),source:{cell:w.sourceNodeKey,port:w.sourceNodeKey+"-bottom"},target:{cell:w.targetNodeKey,port:w.targetNodeKey+"-top"},attrs:{line:{stroke:"#A2B1C3",strokeWidth:2,targetMarker:{name:"block",width:12,height:8}}},zIndex:0});const v=new de({nodesep:30,ranksep:30}).layout(l);i.fromJSON(v)}function r(){it(i)}function a(l){l.addTools([{name:"button-remove"}])}function c(l){if(l.data.nodeKey!==l.id){const g=n.getSequence(l.getData().resourceTypeName),v=n.getSequence("node");l.label=g,l.updateData({nodeName:g,nodeKey:v})}}function h(l){const g=_(i.getNodes(),l.source.cell),v=_(i.getNodes(),l.target.cell);l.updateData({sourceNodeKey:g==null?void 0:g.data.nodeKey,sourceTypeId:g==null?void 0:g.data.resourceTypeId,targetNodeKey:v==null?void 0:v.data.nodeKey,targetTypeId:v==null?void 0:v.data.resourceTypeId,relationshipTypeId:void 0,connectActionName:void 0,relationshipInput:{}})}const f=x(),d=x(),u=x();function S(l){f.value=l,l.shape==="edge"?u.value=l.data:d.value=l.data}H(()=>{var l;return(l=d.value)==null?void 0:l.nodeName},()=>{var l;(l=d.value)!=null&&l.nodeName&&(f.value.label=d.value.nodeName)}),H(()=>{var l;return(l=u.value)==null?void 0:l.connectActionName},()=>{var l;(l=u.value)!=null&&l.connectActionName&&f.value.setLabels(u.value.connectActionName)});const m=x({});function _(l,g){return l.find(v=>v.id===g)}function P(){const l=i.toJSON();m.value.nodes=[],m.value.relationships=[];for(let g of l.cells)g.shape==="edge"?m.value.relationships.push(g.data):m.value.nodes.push(g.data)}function k(){return P(),be(m.value)}function U(){if(!t.blueprint){console.error("Current blueprint is undefined, cannot update.");return}P();const l={...m.value,blueprintId:t.blueprint.id};return ye(l)}return e({confirmCreate:k,confirmUpdate:U}),(l,g)=>{const v=z("ElInput"),w=z("ElButton"),R=z("ElTooltip"),fe=z("ElCard");return C(),ue(pe,null,[N("div",ut,[p(v,{style:{width:"150px","margin-right":"50px"},modelValue:m.value.name,"onUpdate:modelValue":g[0]||(g[0]=W=>m.value.name=W),placeholder:"请输入蓝图名称"},null,8,["modelValue"]),p(w,{onClick:r},{default:b(()=>[B("自动布局")]),_:1}),p(R,null,{content:b(()=>[pt]),default:b(()=>[p(w,{link:"",icon:"Warning"},{default:b(()=>[B("操作说明")]),_:1})]),_:1}),f.value?(C(),I(fe,{key:f.value.id,style:{position:"absolute",top:"80px",right:"30px",width:"260px","max-height":"650px",overflow:"auto","background-color":"#07070e","z-index":"9999"}},{default:b(()=>[f.value.shape==="edge"?(C(),I(dt,{key:0,modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=W=>u.value=W)},null,8,["modelValue"])):(C(),I(ct,{key:1,modelValue:d.value,"onUpdate:modelValue":g[2]||(g[2]=W=>d.value=W)},null,8,["modelValue"]))]),_:1})):A("",!0)]),N("div",{style:{width:"100%",height:"90%"}},[N("div",{id:gt},[N("div",{style:{height:"600px","overflow-y":"scroll","overflow-x":"hidden"}},[N("div",{id:se})]),N("div",{id:re})])])],64)}}},ft={style:{"margin-bottom":"10px",height:"32px"}},Ft={__name:"Blueprint",setup(s){const e=x(),t=x(!1),n=x(!1),i=x([]),o=x({}),r=x();function a(P){i.value=P}function c(){return i.value.map(P=>P.id)}function h(){t.value=!0}function f(P){r.value=P,n.value=!0}const d=x();function u(){d.value.confirmCreate().then(()=>{t.value=!1,ie.success("蓝图已保存"),e.value.fetchData()})}const S=x();function m(){S.value.confirmUpdate().then(()=>{n.value=!1,ie.success("蓝图已保存"),e.value.fetchData()})}function _(){const k={blueprintIds:c()};ve(k).then(()=>{e.value.fetchData()})}return(P,k)=>{const U=z("ElButton");return C(),ue(pe,null,[N("div",ft,[p(J,{type:"primary",onClick:h},{default:b(()=>[B(" 创建 ")]),_:1}),p(M(We),{title:"确认删除",onConfirm:_},{reference:b(()=>[p(J,{disabled:i.value.length===0,type:"danger",plain:""},{default:b(()=>[B(" 删除 ")]),_:1},8,["disabled"])]),_:1}),p(M(He),{style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":k[0]||(k[0]=l=>o.value.search=l),"suffix-icon":"search"},null,8,["modelValue"])]),p(me,{ref_key:"tableRef",ref:e,"paging-request":o.value,"remote-method":M(xe),onSelectionChange:a},{default:b(()=>[p(M(L),{type:"selection","reserve-selection":""}),p(M(L),{prop:"name",label:"名称",sortable:"custom"}),p(M(L),{prop:"description",label:"描述"}),p(M(L),{prop:"createdAt",label:"创建时间",sortable:"custom"}),p(M(L),{prop:"lastModifiedAt",label:"更新时间",sortable:"custom"}),p(M(L),null,{default:b(l=>[p(U,{link:"",type:"primary",onClick:()=>f(l.row)},{default:b(()=>[B("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),p(Z,{modelValue:t.value,"onUpdate:modelValue":k[1]||(k[1]=l=>t.value=l),title:"创建蓝图",onOnConfirm:u,size:"1000"},{default:b(()=>[t.value?(C(),I(ae,{key:0,ref_key:"createEditorRef",ref:d},null,512)):A("",!0)]),_:1},8,["modelValue"]),p(Z,{modelValue:n.value,"onUpdate:modelValue":k[2]||(k[2]=l=>n.value=l),title:"编辑蓝图",onOnConfirm:m,size:"1000"},{default:b(()=>[n.value?(C(),I(ae,{key:0,ref_key:"updateEditorRef",ref:S,blueprint:r.value},null,8,["blueprint"])):A("",!0)]),_:1},8,["modelValue"])],64)}}};export{Ft as default};
