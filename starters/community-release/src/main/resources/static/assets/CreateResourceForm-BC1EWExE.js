var pe=Object.defineProperty;var me=(e,p,l)=>p in e?pe(e,p,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[p]=l;var j=(e,p,l)=>me(e,typeof p!="symbol"?p+"":p,l);import{_ as fe}from"./TenantTreeSelector-D1-Nh39D.js";import{u as ye,l as ve}from"./request-BLvKnTIl.js";import{_ as ge}from"./UserSelector-D6CrvvR3.js";import{_ as be}from"./AccountSelector-DEw35b-n.js";import{s as Ie,t as qe,o as Re}from"./resource-ChSpNJ4i.js";import{_ as he}from"./StratoSelector-CcCz7NMM.js";import{ab as O,a7 as $,r as y,m as K,o as u,q as V,w as o,d as Y,t as k,u as w,y as M,n as _,e as r,i as D,A as B,v as x,b as E,F as N,B as P,a9 as re,aa as ae,Y as _e,a8 as Ve,E as W,j as Ce}from"./index-CGSAaZ7c.js";import{b as L,d as Te,u as Se,c as Ee}from"./ResourceSelector-CNqWYCf0.js";import{_ as oe}from"./StratoDynamicForm-7WrPYX7O.js";import{v as z}from"./FormUtil-CO0XXxtf.js";import{u as le,a as Ne}from"./AccountContext-CRGbKwzU.js";import{_ as we}from"./TagValueSelectorGroup-ARuF-rHD.js";import{u as H}from"./IpState-DbETxjvx.js";const xe={style:{float:"left"}},ke={style:{float:"right",color:"grey"}},De={__name:"ResourceTypeSelector",props:O({resourceCategory:{required:!1},disabled:{required:!1,type:Boolean,default:!1},disabledOptionPredicate:{required:!1,type:Function,default:()=>!1},multiple:{required:!1,type:Boolean,default:!1}},{modelValue:{},modelModifiers:{},providerId:{},providerIdModifiers:{}}),emits:["update:modelValue","update:providerId"],setup(e){const p=$(e,"modelValue"),l=$(e,"providerId"),t=e,a=y({providerId:l.value,resourceCategoryId:t.resourceCategory,resourceTypeId:t.multiple?void 0:p.value});K(l,()=>{a.value.providerId=l.value});function d(R){R?(l.value=R.spec.providerId,a.value.providerId=l.value):(l.value=void 0,a.value.providerId=void 0)}return(R,v)=>(u(),V(he,{modelValue:p.value,"onUpdate:modelValue":v[0]||(v[0]=c=>p.value=c),placeholder:"请选择资源类型",disabled:t.disabled,request:a.value,onChange:d,"remote-method":w(Ie),"list-getter":c=>c.resourceTypes,"label-getter":c=>c.spec.resourceTypeName,"value-getter":c=>c.spec.resourceTypeId,"disabled-option-predicate":e.disabledOptionPredicate,multiple:e.multiple},{default:o(c=>[Y("span",xe,k(c.row.spec.resourceTypeName),1),Y("span",ke,k(c.row.spec.resourceCategoryName),1)]),_:1},8,["modelValue","disabled","request","remote-method","list-getter","label-getter","value-getter","disabled-option-predicate","multiple"]))}},Fe={__name:"ResourceBasicsSubForm",props:O({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:void 0,description:void 0}},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=e,t=$(e,"modelValue"),a=y(),d=y();function R(h){d.value.validate(h)}p({validate:R});const v=y({externalAccountId:[{required:!0,message:"请选择云账号"}],resourceTypeId:[{required:!0,message:"请选择资源类型"}]}),c=y(!1);return M(()=>{var h;(h=t.value)!=null&&h.externalAccountId&&(c.value=!0)}),(h,m)=>{const T=_("ElCol"),s=_("ElFormItem"),f=_("ElRow"),I=_("ElForm");return u(),V(I,{ref_key:"formRef",ref:d,model:t.value,rules:v.value},{default:o(()=>[r(f,{gutter:12},{default:o(()=>[r(T,{span:4},{default:o(()=>[D(" 资源类型 ")]),_:1}),r(T,{span:10},{default:o(()=>[r(s,{prop:"externalAccountId"},{default:o(()=>[r(be,{disabled:c.value,modelValue:t.value.externalAccountId,"onUpdate:modelValue":m[0]||(m[0]=i=>t.value.externalAccountId=i),"provider-id":a.value,"onUpdate:providerId":m[1]||(m[1]=i=>a.value=i),"resource-category":l.resourceCategory},null,8,["disabled","modelValue","provider-id","resource-category"])]),_:1})]),_:1}),r(T,{span:10},{default:o(()=>[r(s,{prop:"resourceTypeId"},{default:o(()=>[r(De,{disabled:t.value.resourceTypeId!==void 0&&t.value.resourceTypeId.length!==0,modelValue:t.value.resourceTypeId,"onUpdate:modelValue":m[2]||(m[2]=i=>t.value.resourceTypeId=i),"provider-id":a.value,"onUpdate:providerId":m[3]||(m[3]=i=>a.value=i),"resource-category":l.resourceCategory,"disabled-option-predicate":i=>!i.spec.buildable},null,8,["disabled","modelValue","provider-id","resource-category","disabled-option-predicate"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}},Ue={__name:"SharedTargetEssentialsSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0},isNested:{required:!1,default:!1,type:Boolean}},emits:["addNewRequirement"],setup(e,{expose:p,emit:l}){const t=e,a=l;function d(){if(t.newRequirements.length===0){let m={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",m)}}M(()=>{d()});const R=y();function v(m){R.value.validate(m)}p({validate:v});const c=B(()=>t.requirementDef.targetSpec.resourceCategoryName);function h(m){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(m.state)||m.recycled}return(m,T)=>{const s=_("ElCol"),f=_("ElFormItem"),I=_("ElRow"),i=_("ElForm");return u(),V(i,{ref_key:"formRef",ref:R,model:e.newRequirements,"hide-required-asterisk":"","label-position":"top"},{default:o(()=>[r(I,{gutter:12},{default:o(()=>[e.isNested?x("",!0):(u(),V(s,{key:0,span:4},{default:o(()=>[D(k(t.requirementDef.relationshipSpec.requirementName),1)]),_:1})),r(s,{span:e.isNested?24:20},{default:o(()=>[(u(!0),E(N,null,P(t.newRequirements,(n,g)=>(u(),V(f,{label:e.isNested?e.requirementDef.relationshipSpec.requirementName:void 0,prop:g+".targetResourceId",rules:[{required:!0,message:"请选择"+c.value}]},{default:o(()=>[r(L,{modelValue:n.targetResourceId,"onUpdate:modelValue":C=>n.targetResourceId=C,"context-consumer":w(Te),placeholder:"请选择"+c.value,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":h},null,8,["modelValue","onUpdate:modelValue","context-consumer","placeholder","resource-type-id"])]),_:2},1032,["label","prop","rules"]))),256))]),_:1},8,["span"])]),_:1})]),_:1},8,["model"])}}},Ae={__name:"NotSharedButEssentialSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0},isNested:{required:!1,default:!1,type:Boolean}},emits:["addNewRequirement"],setup(e,{expose:p,emit:l}){const t=e,a=l;function d(){if(t.newRequirements.length===0){let m={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",m)}}M(()=>{d()});function R(m){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(m.state)||m.recycled}const v=B(()=>t.requirementDef.targetSpec.resourceCategoryName),c=y();function h(m){c.value.validate(m)}return p({validate:h}),(m,T)=>{const s=_("ElCol"),f=_("ElFormItem"),I=_("ElRow"),i=_("ElForm");return u(),V(i,{ref_key:"formRef",ref:c,model:e.newRequirements,"hide-required-asterisk":"","label-position":"top"},{default:o(()=>[r(I,{gutter:12},{default:o(()=>[e.isNested?x("",!0):(u(),V(s,{key:0,span:4},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.requirementName),1)]),_:1})),r(s,{span:e.isNested?24:20},{default:o(()=>[(u(!0),E(N,null,P(t.newRequirements,(n,g)=>(u(),V(f,{label:e.isNested?e.requirementDef.relationshipSpec.requirementName:void 0,prop:g+".targetResourceId",rules:[{required:!0,message:"请选择"+v.value}],required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:n.targetResourceId,"onUpdate:modelValue":C=>n.targetResourceId=C,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":R,placeholder:"请选择"+v.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["label","prop","rules"]))),256))]),_:1},8,["span"])]),_:1})]),_:1},8,["model"])}}},J={__name:"RelationshipPropertiesForm",props:O({relationshipTypeId:{required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=$(e,"modelValue"),t=e,a=y(),d=y();M(()=>{qe({relationshipTypeId:t.relationshipTypeId}).then(v=>{d.value=v.formMetaData})});function R(v){a.value.validate(v)}return p({validate:R}),(v,c)=>d.value?(u(),V(oe,{key:0,ref_key:"formRef",ref:a,"form-meta-data":d.value,modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=h=>l.value=h)},null,8,["form-meta-data","modelValue"])):x("",!0)}},Pe={__name:"ExclusiveButNotEssentialSubform",props:{newRequirements:{required:!0},requirementDef:{required:!0}},emits:["addNewRequirement","removeRequirements"],setup(e,{expose:p,emit:l}){const t=e,a=l,d=y(!1);function R(){if(t.newRequirements.length===0){let f={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",f)}}function v(f){f?R():a("removeRequirements",t.requirementDef)}M(()=>{t.newRequirements.length>0&&(d.value=!0)});function c(f){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(f.state)||f.recycled}const h=B(()=>t.requirementDef.targetSpec.resourceCategoryName),m=y();function T(f){z([m.value,...s.value],f)}p({validate:T});const s=y([]);return(f,I)=>{const i=_("ElCol"),n=_("ElCheckbox"),g=_("ElFormItem"),C=_("ElRow"),S=_("ElForm");return u(),V(S,{ref_key:"formRef",ref:m,model:e.newRequirements,"label-position":"top"},{default:o(()=>[r(C,{gutter:12},{default:o(()=>[r(i,{span:4},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.requirementName),1)]),_:1}),r(i,{span:4},{default:o(()=>[r(g,null,{default:o(()=>[r(n,{modelValue:d.value,"onUpdate:modelValue":I[0]||(I[0]=q=>d.value=q),onChange:v},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.connectActionName),1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(i,{span:16},{default:o(()=>[d.value?(u(!0),E(N,{key:0},P(e.newRequirements,(q,F)=>(u(),E(N,null,[r(g,{prop:F+".targetResourceId",required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:q.targetResourceId,"onUpdate:modelValue":G=>q.targetResourceId=G,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":c,placeholder:"请选择"+h.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["prop"]),r(J,{ref_for:!0,ref_key:"propertiesFormRefs",ref:s,"relationship-type-id":q.relationshipTypeId,modelValue:q.relationshipInputs,"onUpdate:modelValue":G=>q.relationshipInputs=G},null,8,["relationship-type-id","modelValue","onUpdate:modelValue"])],64))),256)):x("",!0)]),_:1})]),_:1})]),_:1},8,["model"])}}},Be={__name:"NotExclusiveSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0}},emits:["addNewRequirement","removeRequirement"],setup(e,{expose:p,emit:l}){const t=e,a=l;function d(){let s={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",s)}function R(s){a("removeRequirement",s)}function v(s){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(s.state)||s.recycled}const c=B(()=>t.requirementDef.targetSpec.resourceCategoryName),h=y();function m(s){z([h.value,...T.value],s)}p({validate:m});const T=y([]);return(s,f)=>{const I=_("ElCol"),i=_("ElButton"),n=_("ElFormItem"),g=_("ElRow"),C=_("ElForm");return u(),V(C,{model:e.newRequirements,ref_key:"formRef",ref:h,"label-position":"top"},{default:o(()=>[r(g,{gutter:12},{default:o(()=>[r(I,{span:4},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.requirementName),1)]),_:1}),r(I,{span:20},{default:o(()=>[r(i,{type:"primary",link:"",icon:"Plus",onClick:d,style:{"margin-top":"2px","margin-bottom":"18px","margin-left":"2px"}},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.connectActionName),1)]),_:1}),(u(!0),E(N,null,P(e.newRequirements,(S,q)=>(u(),V(g,null,{default:o(()=>[r(I,{span:4,style:{"font-size":"14px"}},{default:o(()=>[r(i,{circle:"",link:"",size:"small",icon:"Close",type:"danger",onClick:()=>R(S)},null,8,["onClick"]),D(" "+k(e.requirementDef.relationshipSpec.requirementName+(q+1)),1)]),_:2},1024),r(I,{span:20},{default:o(()=>[r(n,{prop:q+".targetResourceId",required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:S.targetResourceId,"onUpdate:modelValue":F=>S.targetResourceId=F,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":v,placeholder:"请选择"+c.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["prop"]),r(J,{ref_for:!0,ref_key:"propertiesFormRefs",ref:T,"relationship-type-id":S.relationshipTypeId,modelValue:S.relationshipInputs,"onUpdate:modelValue":F=>S.relationshipInputs=F},null,8,["relationship-type-id","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["model"])}}};class ie{constructor(){j(this,"ignoredTargetTypeIds",[]);j(this,"ignoredCapabilityTypeIds",[])}addIgnoredTargetTypeId(p){this.ignoredTargetTypeIds.push(p)}isIgnoredTargetType(p){return this.ignoredTargetTypeIds.includes(p)}addIgnoredCapabilityTypeId(p){this.ignoredCapabilityTypeIds.push(p)}isIgnoredCapabilityType(p){return this.ignoredCapabilityTypeIds.includes(p)}}function at(){const e=new ie;return re("resourceStackNodeContext",e),e}function ne(){return ae("resourceStackNodeContext",new ie)}const Q={__name:"RequirementsSubForm",props:O({requirementDefs:{required:!0,type:Array},showSharedTargets:{required:!1,default:!0},isNested:{required:!1,default:!1,type:Boolean}},{modelValue:{required:!0,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=$(e,"modelValue"),t=e;function a(b){return b.relationshipSpec.essentialRequirement===!0}function d(b){return b.targetSpec.sharedRequirementTarget===!0}function R(b){return b.relationshipSpec.exclusiveRequirement===!0}function v(b){return b.relationshipSpec.primaryCapability===!0}function c(b){return a(b)&&d(b)&&!v(b)}function h(b){return a(b)&&!d(b)&&!v(b)}function m(b){return R(b)&&!a(b)&&!v(b)}function T(b){return!R(b)&&!v(b)}const s=ne(),f=B(()=>t.requirementDefs.filter(c).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),I=B(()=>t.requirementDefs.filter(h).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),i=B(()=>t.requirementDefs.filter(m).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),n=B(()=>t.requirementDefs.filter(T));function g(b){return l.value===void 0?[]:l.value.filter(A=>A.relationshipTypeId===b.relationshipSpec.relationshipTypeId)}function C(b){l.value.push(b)}function S(b){for(let A=l.value.length-1;A>=0;A--)l.value[A].relationshipTypeId===b.relationshipSpec.relationshipTypeId&&l.value.splice(A,1)}function q(b){for(let A=l.value.length-1;A>=0;A--)if(l.value[A]===b){l.value.splice(A,1);break}}const F=y([]),G=y([]),Z=y([]),ee=y([]);function ce(b){z([...F.value,...G.value,...Z.value,...ee.value],b)}return p({validate:ce}),(b,A)=>(u(),E(N,null,[(u(!0),E(N,null,P(f.value,U=>_e((u(),V(Ue,{ref_for:!0,ref_key:"formRefs1",ref:F,onAddNewRequirement:C,"new-requirements":g(U),"requirement-def":U,"is-nested":e.isNested},null,8,["new-requirements","requirement-def","is-nested"])),[[Ve,e.showSharedTargets]])),256)),(u(!0),E(N,null,P(I.value,U=>(u(),V(Ae,{ref_for:!0,ref_key:"formRefs2",ref:G,onAddNewRequirement:C,"new-requirements":g(U),"requirement-def":U,"is-nested":e.isNested},null,8,["new-requirements","requirement-def","is-nested"]))),256)),(u(!0),E(N,null,P(i.value,U=>(u(),V(Pe,{ref_for:!0,ref_key:"formRefs3",ref:Z,onAddNewRequirement:C,onRemoveRequirements:S,"new-requirements":g(U),"requirement-def":U},null,8,["new-requirements","requirement-def"]))),256)),(u(!0),E(N,null,P(n.value,U=>(u(),V(Be,{ref_for:!0,ref_key:"formRefs4",ref:ee,onAddNewRequirement:C,onRemoveRequirement:q,"new-requirements":g(U),"requirement-def":U},null,8,["new-requirements","requirement-def"]))),256))],64))}};class ue{constructor(){j(this,"tags",y())}}function ot(){const e=new ue;return re("resourceStackContext",e),e}function $e(){return ae("resourceStackContext",new ue)}const se={__name:"ResourcePropertiesSubForm",props:O({resourceTypeSpec:{required:!0},enableDescription:{required:!1,default:!1,type:Boolean},enableTags:{required:!1,default:!1,type:Boolean},isPrimaryCapability:{required:!1,default:!1,type:Boolean}},{modelValue:{required:!0,default:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0}},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=e,t=$(e,"modelValue"),a=y(),d=y();p({validate:R});function R(s){a.value.validate(f=>{f&&d.value.validate(s)})}const v=y();M(()=>{Re({resourceTypeId:l.resourceTypeSpec.resourceTypeId,actionId:"BUILD_RESOURCE"}).then(s=>{v.value=s.formMetaData})});const c=y(),h=y({tags:[{validator:(s,f,I)=>{var i;return(i=c.value)==null?void 0:i.validate(s,f,I)},trigger:"change"}]}),m=y({isPrimaryCapability:l.isPrimaryCapability}),T=$e();return K(()=>T.tags.value,()=>{const s=T.tags.value;if(s){for(let f of s)if(t.value.tags)for(let I of t.value.tags)f.tagKey===I.tagKey&&!I.tagValue&&(I.tagValue=f.tagValue,I.tagValueName=f.tagValueName)}},{deep:!0,immediate:!0}),(s,f)=>{const I=_("ElInput"),i=_("ElForm");return u(),V(i,{ref_key:"formRef",ref:a,model:t.value,rules:h.value,"label-position":"top"},{default:o(()=>[v.value?(u(),V(oe,{key:0,ref_key:"dynamicFormRef",ref:d,"form-meta-data":v.value,modelValue:t.value.properties,"onUpdate:modelValue":f[0]||(f[0]=n=>t.value.properties=n),args:m.value},null,8,["form-meta-data","modelValue","args"])):x("",!0),r(w(W),{prop:"resourceName",label:`${e.resourceTypeSpec.resourceCategoryName}名称`},{default:o(()=>[r(I,{placeholder:"留空将按命名规则自动生成",modelValue:t.value.resourceName,"onUpdate:modelValue":f[1]||(f[1]=n=>t.value.resourceName=n)},null,8,["modelValue"])]),_:1},8,["label"]),e.enableTags?(u(),V(w(W),{key:1,label:"标签",prop:"tags"},{default:o(()=>[t.value.tags?(u(),V(we,{key:0,ref_key:"tagRef",ref:c,modelValue:t.value.tags,"onUpdate:modelValue":f[2]||(f[2]=n=>t.value.tags=n),"entry-paging-request":{requiredWhenCreating:!0,resourceCategories:[e.resourceTypeSpec.resourceCategoryId]},"default-add-all-entries":!0},null,8,["modelValue","entry-paging-request"])):x("",!0)]),_:1})):x("",!0),e.enableDescription?(u(),V(w(W),{key:2,prop:"description",label:"描述"},{default:o(()=>[r(I,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":f[3]||(f[3]=n=>t.value.description=n)},null,8,["modelValue"])]),_:1})):x("",!0)]),_:1},8,["model","rules"])}}},de={__name:"CapabilityPropertiesForm",props:O({resourceSpec:{required:!0},relationshipTypeId:{required:!0},isPrimaryCapability:{required:!1,default:!1,type:Boolean}},{resource:{required:!0},resourceModifiers:{},relationshipProperties:{required:!0},relationshipPropertiesModifiers:{}}),emits:["update:resource","update:relationshipProperties"],setup(e,{expose:p}){const l=$(e,"resource"),t=$(e,"relationshipProperties"),a=y([]),d=y([]);function R(v){z([a.value,d.value],v)}return p({validate:R}),(v,c)=>(u(),E(N,null,[r(se,{ref_key:"formRef1",ref:a,modelValue:l.value,"onUpdate:modelValue":c[0]||(c[0]=h=>l.value=h),"resource-type-spec":e.resourceSpec,"is-primary-capability":e.isPrimaryCapability},null,8,["modelValue","resource-type-spec","is-primary-capability"]),r(J,{ref_key:"formRef2",ref:d,modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=h=>t.value=h),"relationship-type-id":e.relationshipTypeId},null,8,["modelValue","relationship-type-id"])],64))}},Me={style:{"margin-top":"4px"}},Oe={__name:"PrimaryCapabilitySubForm",props:{newCapabilities:{required:!0,type:Array,default:[]},capabilityDef:{required:!0}},emits:["addNewCapability","removeCapabilities"],setup(e,{expose:p,emit:l}){const t=e,a=t.capabilityDef.relationshipSpec.essentialPrimaryCapability,d=l,R=le();H(),K(R.accountId,()=>{t.newCapabilities.forEach(i=>i.resource.externalAccountId=R.accountId.value)},{immediate:!0});const v=y(!1);function c(){d("addNewCapability",{resource:{resourceTypeId:t.capabilityDef.sourceSpec.resourceTypeId,externalAccountId:R.accountId.value,properties:{},tags:[]},relationshipTypeId:t.capabilityDef.relationshipSpec.relationshipTypeId,relationshipProperties:{},requirements:[],capabilities:[]})}function h(){d("removeCapabilities",t.capabilityDef)}M(()=>{a&&t.newCapabilities.length===0&&c()});function m(i){i?t.newCapabilities.length===0&&c():h()}const T=y([]),s=y([]),f=y([]);function I(i){z([...T.value,...s.value,...f.value],i)}return p({validate:I}),(i,n)=>{const g=_("ElCol"),C=_("ElCheckbox"),S=_("ElRow");return u(),V(S,null,{default:o(()=>[r(g,{span:4},{default:o(()=>[Y("div",Me,k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),r(g,{span:20},{default:o(()=>[w(a)?x("",!0):(u(),V(C,{key:0,modelValue:v.value,"onUpdate:modelValue":n[0]||(n[0]=q=>v.value=q),onChange:m,style:{"margin-bottom":"18px"}},{default:o(()=>[D(k(e.capabilityDef.relationshipSpec.connectActionName),1)]),_:1},8,["modelValue"])),(u(!0),E(N,null,P(e.newCapabilities,q=>(u(),E(N,null,[r(Q,{ref_for:!0,ref_key:"formRefs1",ref:T,"requirement-defs":e.capabilityDef.sourceRequirements,modelValue:q.requirements,"onUpdate:modelValue":F=>q.requirements=F,"is-nested":""},null,8,["requirement-defs","modelValue","onUpdate:modelValue"]),r(de,{ref_for:!0,ref_key:"formRefs2",ref:s,resource:q.resource,"onUpdate:resource":F=>q.resource=F,"resource-spec":e.capabilityDef.sourceSpec,"relationship-properties":q.relationshipProperties,"relationship-type-id":q.relationshipTypeId,"is-primary-capability":""},null,8,["resource","onUpdate:resource","resource-spec","relationship-properties","relationship-type-id"]),r(X,{ref_for:!0,ref_key:"formRefs3",ref:f,"capability-defs":e.capabilityDef.sourceCapabilities,modelValue:q.capabilities,"onUpdate:modelValue":F=>q.capabilities=F},null,8,["capability-defs","modelValue","onUpdate:modelValue"])],64))),256))]),_:1})]),_:1})}}},ze={__name:"NotPrimaryCapabilitySubForm",props:{newCapabilities:{required:!0,type:Array,default:[]},capabilityDef:{required:!0}},emits:["addNewCapability","removeCapability"],setup(e,{expose:p,emit:l}){const t=e,a=l,d=le();H(),K(d.accountId,()=>{t.newCapabilities.forEach(s=>s.resource.externalAccountId=d.accountId.value)},{immediate:!0});function R(){a("addNewCapability",{resource:{resourceTypeId:t.capabilityDef.sourceSpec.resourceTypeId,externalAccountId:d.accountId.value,properties:{},tags:[]},relationshipTypeId:t.capabilityDef.relationshipSpec.relationshipTypeId,relationshipProperties:{},requirements:[],capabilities:[]})}function v(s){a("removeCapability",s)}M(()=>{});const c=y([]),h=y([]),m=y([]);function T(s){z([...c.value,...h.value,...m.value],s)}return p({validate:T}),(s,f)=>{const I=_("ElCol"),i=_("ElButton"),n=_("ElRow");return u(),V(n,null,{default:o(()=>[r(I,{span:4},{default:o(()=>[D(k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),r(I,{span:20},{default:o(()=>[r(i,{type:"primary",link:"",icon:"Plus",onClick:R,style:{"margin-top":"2px","margin-bottom":"18px","margin-left":"2px"}},{default:o(()=>[D(" 添加"+k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),(u(!0),E(N,null,P(e.newCapabilities,(g,C)=>(u(),V(n,null,{default:o(()=>[r(I,{span:4,style:{"font-size":"14px"}},{default:o(()=>[r(i,{circle:"",link:"",size:"small",icon:"Close",type:"danger",onClick:()=>v(g)},null,8,["onClick"]),D(" "+k(e.capabilityDef.relationshipSpec.capabilityName+(C+1)),1)]),_:2},1024),r(I,{span:20},{default:o(()=>[r(Q,{ref_for:!0,ref_key:"formRefs1",ref:c,"requirement-defs":e.capabilityDef.sourceRequirements,modelValue:g.requirements,"onUpdate:modelValue":S=>g.requirements=S,"is-nested":""},null,8,["requirement-defs","modelValue","onUpdate:modelValue"]),r(de,{ref_for:!0,ref_key:"formRefs2",ref:h,resource:g.resource,"onUpdate:resource":S=>g.resource=S,"resource-spec":e.capabilityDef.sourceSpec,"relationship-properties":g.relationshipProperties,"relationship-type-id":g.relationshipTypeId},null,8,["resource","onUpdate:resource","resource-spec","relationship-properties","relationship-type-id"]),r(X,{ref_for:!0,ref_key:"formRefs3",ref:m,"capability-defs":e.capabilityDef.sourceCapabilities,modelValue:g.capabilities,"onUpdate:modelValue":S=>g.capabilities=S},null,8,["capability-defs","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})}}},X={__name:"CapabilitiesSubForm",props:O({capabilityDefs:{required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=$(e,"modelValue"),t=e;function a(n){return n.relationshipSpec.primaryCapability===!0}function d(n){return n.relationshipSpec.visibleInTarget===!0}function R(n){return l.value===void 0?[]:l.value.filter(g=>g.relationshipTypeId===n.relationshipSpec.relationshipTypeId)}function v(n){l.value.push(n)}function c(n){l.value.splice(l.value.indexOf(n),1)}function h(n){for(let g=l.value.length-1;g>=0;g--)l.value[g].relationshipTypeId===n.relationshipSpec.relationshipTypeId&&l.value.splice(g,1)}const m=ne(),T=B(()=>t.capabilityDefs.filter(d).filter(a).filter(n=>!m.isIgnoredCapabilityType(n.relationshipSpec.relationshipTypeId))),s=B(()=>t.capabilityDefs.filter(d).filter(n=>!a(n)).filter(n=>!m.isIgnoredCapabilityType(n.relationshipSpec.relationshipTypeId))),f=y([]),I=y([]);function i(n){z([...f.value,...I.value],n)}return p({validate:i}),(n,g)=>(u(),E(N,null,[(u(!0),E(N,null,P(T.value,C=>(u(),E(N,null,[C.sourceSpec.buildable?(u(),V(Oe,{key:0,ref_for:!0,ref_key:"formRefs1",ref:f,"new-capabilities":R(C),"capability-def":C,onAddNewCapability:v,onRemoveCapabilities:h},null,8,["new-capabilities","capability-def"])):x("",!0)],64))),256)),(u(!0),E(N,null,P(s.value,C=>(u(),E(N,null,[C.sourceSpec.buildable?(u(),V(ze,{key:0,ref_for:!0,ref_key:"formRefs2",ref:I,"new-capabilities":R(C),"capability-def":C,onAddNewCapability:v,onRemoveCapability:c},null,8,["new-capabilities","capability-def"])):x("",!0)],64))),256))],64))}},te={tenantId:void 0,ownerId:void 0,resource:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0},requirements:[],capabilities:[],number:1},lt={sourceResourceId:void 0,targetResourceId:void 0,relationshipTypeId:void 0,relationshipInputs:{}},it={sourceId:void 0,newTargetId:void 0,relationshipTypeId:void 0,relationshipInputs:{}},nt={__name:"CreateResourceForm",props:O({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:te},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:p}){const l=ye(),t=e,a=$(e,"modelValue"),d=Se(()=>a.value.resource.resourceTypeId);Ee(),Ne(),H(),M(()=>{a.value.tenantId||(a.value.tenantId=l.tenantId),a.value.ownerId||(a.value.ownerId=l.userId)});function R(){return ve.cloneDeep(te)}p({validate:v,getDefaultFormData:R});function v(I){z([c.value,h.value,m.value,T.value,s.value],I)}const c=y(),h=y(),m=y(),T=y(),s=y(),f=y({tenantId:[{required:!0,message:"请选择租户",trigger:"blur"}],ownerId:[{required:!0,message:"请选择所有者",trigger:"blur"}]});return(I,i)=>{const n=_("ElCol"),g=_("ElFormItem"),C=_("ElRow"),S=_("ElInputNumber");return u(),V(w(Ce),{ref_key:"formRef",ref:c,model:a.value,"label-position":"top",rules:f.value},{default:o(()=>[r(C,{gutter:12},{default:o(()=>[r(n,{span:4},{default:o(()=>[D(" 资源归属 ")]),_:1}),r(n,{span:10},{default:o(()=>[r(g,{prop:"tenantId"},{default:o(()=>[r(fe,{modelValue:a.value.tenantId,"onUpdate:modelValue":i[0]||(i[0]=q=>a.value.tenantId=q)},null,8,["modelValue"])]),_:1})]),_:1}),r(n,{span:10},{default:o(()=>[r(g,{prop:"ownerId"},{default:o(()=>[r(ge,{placeholder:"请选择所有者",modelValue:a.value.ownerId,"onUpdate:modelValue":i[1]||(i[1]=q=>a.value.ownerId=q)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(Fe,{ref_key:"basicsSubFormRef",ref:h,"resource-category":t.resourceCategory,modelValue:a.value.resource,"onUpdate:modelValue":i[2]||(i[2]=q=>a.value.resource=q)},null,8,["resource-category","modelValue"]),w(d)?(u(),V(C,{key:0,gutter:12},{default:o(()=>[r(n,{span:4},{default:o(()=>[D(" 数量 ")]),_:1}),r(n,{span:10},{default:o(()=>[r(g,{prop:"number"},{default:o(()=>[r(S,{style:{width:"100%"},modelValue:a.value.number,"onUpdate:modelValue":i[3]||(i[3]=q=>a.value.number=q),min:1,max:200,"value-on-clear":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):x("",!0),w(d)&&a.value.requirements?(u(),V(Q,{key:1,ref_key:"requirementsSubFormRef",ref:m,modelValue:a.value.requirements,"onUpdate:modelValue":i[4]||(i[4]=q=>a.value.requirements=q),"requirement-defs":w(d).requirements},null,8,["modelValue","requirement-defs"])):x("",!0),w(d)&&a.value.capabilities?(u(),V(X,{key:2,ref_key:"capabilitiesSubFormRef",ref:T,modelValue:a.value.capabilities,"onUpdate:modelValue":i[5]||(i[5]=q=>a.value.capabilities=q),"capability-defs":w(d).capabilities},null,8,["modelValue","capability-defs"])):x("",!0),w(d)?(u(),V(C,{key:3,gutter:12,style:{"margin-top":"12px"}},{default:o(()=>[r(n,{span:4},{default:o(()=>[D(k(w(d).spec.resourceCategoryName)+"属性 ",1)]),_:1}),r(n,{span:20},{default:o(()=>[r(se,{ref_key:"propertiesSubFormRef",ref:s,"resource-type-spec":w(d).spec,"enable-description":"","enable-tags":"",modelValue:a.value.resource,"onUpdate:modelValue":i[6]||(i[6]=q=>a.value.resource=q)},null,8,["resource-type-spec","modelValue"])]),_:1})]),_:1})):x("",!0)]),_:1},8,["model","rules"])}}};export{nt as _,J as a,it as b,lt as c,ot as d,at as u};
