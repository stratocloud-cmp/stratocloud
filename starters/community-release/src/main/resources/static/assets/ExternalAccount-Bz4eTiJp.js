import{_ as H}from"./StratoTable--zpPaOW_.js";import{d as w,c as Q,u as W,e as X,a as Y,b as Z}from"./account-DxeVqvnD.js";import{S as k}from"./StratoButton-D7m4JR2l.js";import{r as G}from"./asyncJob-ClCdQ0iF.js";import{u as K}from"./activeJob-H4xjMLbI.js";import{_ as U}from"./StratoDrawer-BQ9z9CYD.js";import{_ as N}from"./ProviderSelector-DfzK_R5I.js";import{_ as T}from"./StratoDynamicForm-BeoKTVDl.js";import{a8 as q,r as n,n as F,o as E,q as A,w as o,e,v as S,y as ee,A as ae,u as R,a2 as te,a3 as le,I as oe,d as O,t as $,a4 as ne,b as re,F as ue,i as x,O as de,f as se}from"./index-C_jnbPMf.js";import"./request-BV6gXtmx.js";import"./StratoSelector-Csy36wxr.js";import"./resource-DdTtSOFP.js";import"./IpState-yQwbBpiP.js";import"./UserSelector-Bks_jgjv.js";import"./StratoPagingSelector-BY9rDrJk.js";import"./user-BKxh-AQB.js";import"./role-DAS94606.js";import"./job-B1agJq36.js";import"./scriptDefinition-BwQHe3UI.js";const ie={__name:"CreateAccountForm",props:{modelValue:{required:!0,default:{providerId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(D,{expose:g}){const t=q(D,"modelValue"),a=n(),r=n();g({validate:V});function V(f){r.value.validate((l,u)=>{l&&a.value.validate(f)})}const y=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),p=n();function c(f){p.value=f}return(f,l)=>{const u=F("ElFormItem"),v=F("ElInput"),h=F("ElForm");return E(),A(h,{ref_key:"formRef",ref:a,model:t.value,"label-position":"top",rules:y.value},{default:o(()=>{var _;return[e(u,{label:"云平台",prop:"providerId"},{default:o(()=>[e(N,{onChange:c,modelValue:t.value.providerId,"onUpdate:modelValue":l[0]||(l[0]=s=>t.value.providerId=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"云账号名称",prop:"name"},{default:o(()=>[e(v,{modelValue:t.value.name,"onUpdate:modelValue":l[1]||(l[1]=s=>t.value.name=s)},null,8,["modelValue"])]),_:1}),p.value?(E(),A(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(_=p.value)==null?void 0:_.accountFormMetaData,modelValue:t.value.properties,"onUpdate:modelValue":l[2]||(l[2]=s=>t.value.properties=s)},null,8,["form-meta-data","modelValue"])):S("",!0),e(u,{label:"云账号描述",prop:"description"},{default:o(()=>[e(v,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":l[3]||(l[3]=s=>t.value.description=s)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},me={__name:"UpdateAccountForm",props:{modelValue:{required:!0,default:{externalAccountId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(D,{expose:g}){const t=q(D,"modelValue"),a=n(),r=n();g({validate:V});function V(l){r.value.validate((u,v)=>{u&&a.value.validate(l)})}const y=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),p=n(),c=n();function f(l){c.value=l}return ee(()=>{t.value.externalAccountId&&w({accountIds:[t.value.externalAccountId]}).then(l=>{l.content&&l.content.length>0&&(p.value=l.content[0])})}),(l,u)=>{const v=F("ElFormItem"),h=F("ElInput"),_=F("ElForm");return E(),A(_,{ref_key:"formRef",ref:a,model:t.value,"label-position":"top",rules:y.value},{default:o(()=>{var s;return[e(v,{label:"云平台"},{default:o(()=>[p.value?(E(),A(N,{key:0,disabled:"",onChange:f,"model-value":p.value.providerId},null,8,["model-value"])):S("",!0)]),_:1}),e(v,{label:"云账号名称",prop:"name"},{default:o(()=>[e(h,{modelValue:t.value.name,"onUpdate:modelValue":u[0]||(u[0]=b=>t.value.name=b)},null,8,["modelValue"])]),_:1}),c.value?(E(),A(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(s=c.value)==null?void 0:s.accountFormMetaData,modelValue:t.value.properties,"onUpdate:modelValue":u[1]||(u[1]=b=>t.value.properties=b)},null,8,["form-meta-data","modelValue"])):S("",!0),e(v,{label:"云账号描述",prop:"description"},{default:o(()=>[e(h,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":u[2]||(u[2]=b=>t.value.description=b)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},ce={style:{"margin-left":"2px"}},pe={__name:"AccountState",props:{state:{required:!0}},setup(D){const g=D,t={CONNECTED:{name:"已连接",icon:"Check",type:"success"},CONNECTION_LOST:{name:"失去连接",icon:"Warning",type:"warning"},CREDENTIAL_EXPIRED:{name:"凭证失效",icon:"Close",type:"danger"}},a=ae(()=>{let r=t[g.state];return r===void 0&&(r={name:g.state,icon:"QuestionFilled",type:"warning"}),r});return(r,V)=>(E(),A(R(ne),{size:"small",type:a.value.type,style:{"font-size":"12px"}},{default:o(()=>[e(R(te),{class:le(a.value.icon==="Loading"?"is-loading":"")},{default:o(()=>[(E(),A(oe(a.value.icon)))]),_:1},8,["class"]),O("span",ce,$(a.value.name),1)]),_:1},8,["type"]))}},fe={style:{"margin-bottom":"10px"}},qe={__name:"ExternalAccount",setup(D){const g=K(),t=n({}),a=n([]),r=n(),V=n(!1);function y(){return a.value.map(i=>i.id)}function p(i){a.value=i}const c=n(!1),f=n(),l=n(!1),u=n({providerId:void 0,name:void 0,description:void 0,properties:{}});function v(){c.value=!0}function h(){f.value.validate((i,m)=>{i&&(l.value=!0,Q(u.value).then(()=>{c.value=!1,r.value.fetchData()}).finally(()=>{l.value=!1}))})}const _=n(),s=n(),b=n(!1),C=n({externalAccountId:void 0,name:void 0,description:void 0,properties:{}});function P(){a.value.length!==0&&(C.value.externalAccountId=a.value[0].id,C.value.name=a.value[0].name,C.value.description=a.value[0].description,C.value.properties=a.value[0].properties,_.value=!0)}function B(){s.value.validate(i=>{i&&(b.value=!0,W(C.value).then(m=>{_.value=!1,r.value.fetchData()}).finally(()=>{b.value=!1}))})}function L(){a.value.length!==0&&(V.value=!0,G({jobType:"SYNCHRONIZE_ACCOUNTS",jobParameters:{accountIds:y()}}).then(i=>{g.setActiveJobId(i.jobId),r.value.fetchData()}).finally(()=>{V.value=!1}))}function M(){a.value.length!==0&&X({accountIds:y()}).then(i=>{r.value.fetchData()})}function J(){a.value.length!==0&&Y({accountIds:y()}).then(i=>{r.value.fetchData()})}function j(){a.value.length!==0&&Z({externalAccountIds:y()}).then(i=>{r.value.fetchData()})}return(i,m)=>{const I=F("ElTableColumn");return E(),re(ue,null,[O("div",fe,[e(k,{type:"primary",onClick:v},{default:o(()=>[x("创建")]),_:1}),e(k,{disabled:a.value.length!==1,"disabled-message":"请选择且只选择一项",plain:"",onClick:P},{default:o(()=>[x("编辑")]),_:1},8,["disabled"]),e(k,{disabled:a.value.length===0,plain:"",loading:V.value,onClick:L},{default:o(()=>[x("同步")]),_:1},8,["disabled","loading"]),e(k,{disabled:a.value.length===0,type:"success",plain:"",onClick:M},{default:o(()=>[x("启用")]),_:1},8,["disabled"]),e(k,{disabled:a.value.length===0,type:"danger",plain:"",onClick:J},{default:o(()=>[x("禁用")]),_:1},8,["disabled"]),e(R(de),{title:"确认删除",onConfirm:j},{reference:o(()=>[e(k,{disabled:a.value.length===0,type:"danger",plain:""},{default:o(()=>[x("删除")]),_:1},8,["disabled"])]),_:1}),e(R(se),{style:{float:"right",width:"20%"},modelValue:t.value.search,"onUpdate:modelValue":m[0]||(m[0]=d=>t.value.search=d),"suffix-icon":"search"},null,8,["modelValue"])]),e(H,{ref_key:"accountTableRef",ref:r,"paging-request":t.value,"remote-method":R(w),onSelectionChange:p},{default:o(()=>[e(I,{type:"selection","reserve-selection":""}),e(I,{prop:"name",label:"名称",sortable:"custom"}),e(I,{prop:"providerId",label:"云平台",sortable:"custom"},{default:o(d=>[x($(d.row.providerName),1)]),_:1}),e(I,{prop:"state",label:"状态",sortable:"custom"},{default:o(d=>[e(pe,{state:d.row.state},null,8,["state"])]),_:1}),e(I,{prop:"balance",label:"余额",sortable:"custom"}),e(I,{prop:"description",label:"描述"}),e(I,{prop:"disabled",label:"是否禁用",formatter:(d,ve,z,_e)=>z?"是":"否"},null,8,["formatter"]),e(I,{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e(U,{loading:l.value,modelValue:c.value,"onUpdate:modelValue":m[2]||(m[2]=d=>c.value=d),title:"创建云账号",onOnConfirm:h},{default:o(()=>[e(ie,{ref_key:"createFormRef",ref:f,modelValue:u.value,"onUpdate:modelValue":m[1]||(m[1]=d=>u.value=d)},null,8,["modelValue"])]),_:1},8,["loading","modelValue"]),e(U,{loading:b.value,modelValue:_.value,"onUpdate:modelValue":m[4]||(m[4]=d=>_.value=d),title:"编辑云账号",onOnConfirm:B},{default:o(()=>[e(me,{ref_key:"updateFormRef",ref:s,modelValue:C.value,"onUpdate:modelValue":m[3]||(m[3]=d=>C.value=d)},null,8,["modelValue"])]),_:1},8,["loading","modelValue"])],64)}}};export{qe as default};
