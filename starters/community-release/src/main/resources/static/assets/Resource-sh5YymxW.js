import{_ as be}from"./StratoTable--zpPaOW_.js";import{a as Pe,p as Le,b as Fe,c as Me,e as He,f as Je,r as Ye,g as Ge,h as Te,i as Qe,j as Ke}from"./resource-DdTtSOFP.js";import{r as c,n as D,o as a,b as g,q as m,w as t,d as C,t as T,u as r,v as h,e as l,F as I,A as re,O as we,f as _e,P as O,m as K,i as B,x as Ae,Q as le,B as F,S as Se,T as Ze,U as M,V as Ie,W as We,X as L,Y as ie,Z as Xe,_ as et,$ as tt,a0 as at,y as Re,z as lt,a1 as pe,a2 as ke,a3 as rt,I as ot,a4 as st,a5 as nt,l as ut,a6 as it}from"./index-C_jnbPMf.js";import{S as P,_ as ct}from"./StratoButton-D7m4JR2l.js";import{_ as ce,u as dt,R as ye,a as Ee}from"./ResourceSelector-D-bu7cxQ.js";import{_ as De,a as qe,b as mt,c as ft,d as pt,e as yt,f as gt,g as vt}from"./ClaimResourcesForm-B1EPLqtI.js";import{_ as H}from"./StratoDrawer-BQ9z9CYD.js";import{_ as xe}from"./CreateResourceForm-CPnav3GR.js";import{r as W}from"./asyncJob-ClCdQ0iF.js";import{u as X}from"./activeJob-H4xjMLbI.js";import{R as de,a as me}from"./ResourceTags-JwFrBl_C.js";import{_ as Ve}from"./ResourceLink-B4i0l-gs.js";import{c as bt}from"./cartItem-Pm_BcKjw.js";import{u as _t,a as Rt}from"./AccountContext-Bp4LXd0C.js";import{l as ge,u as he}from"./request-BV6gXtmx.js";import{c as Oe}from"./job-B1agJq36.js";import{d as ht}from"./account-DxeVqvnD.js";import{_ as Ct}from"./UserSelector-Bks_jgjv.js";import{_ as St}from"./TagValueSelectorGroup-kSkYehu4.js";import"./StratoPagingSelector-BY9rDrJk.js";import"./IpState-yQwbBpiP.js";import"./StratoDynamicForm-BeoKTVDl.js";import"./role-DAS94606.js";import"./scriptDefinition-BwQHe3UI.js";import"./StratoSelector-Csy36wxr.js";import"./TenantTreeSelector-DrVO4R-0.js";import"./AccountSelector-yRinDs2o.js";import"./FormUtil-BL1Y36f_.js";import"./user-BKxh-AQB.js";import"./tag-CWCUpvbv.js";const Et={style:{"font-size":"12px"}},Tt={__name:"CreateCapabilityButton",props:{resource:{required:!0},capability:{required:!0}},setup(e){const o=e,n=c("CREATE"),u=X(),s=o.capability.relationshipSpec,d=c(!1),i=c(!1),f=c(),E=c({tenantId:o.resource.tenantId,ownerId:o.resource.ownerId,resource:{resourceTypeId:o.capability.sourceSpec.resourceTypeId,externalAccountId:o.resource.accountId,properties:{},tags:[]},number:1,requirements:[{targetResourceId:o.resource.id,relationshipTypeId:s.relationshipTypeId,relationshipInputs:{}}],capabilities:[]}),v=c(),b=c({targetResourceId:o.resource.id,relationshipTypeId:s.relationshipTypeId,relationshipInputs:{}});function _(){i.value=!0}function R(){let y,p;if(n.value==="CREATE")y={jobType:"BATCH_CREATE_RESOURCES",jobParameters:{resources:[E.value]}},p=f;else if(n.value==="CONNECT")y={jobType:"BATCH_CONNECT_RESOURCES",jobParameters:{connections:[b.value]}},p=v;else return;p.value.validate(S=>{S&&(d.value=!0,W(y).then($=>{u.setActiveJobId($.jobId),i.value=!1}).finally(()=>{d.value=!1}))})}return(y,p)=>{const S=D("ElRadioButton"),$=D("ElRadioGroup");return a(),g(I,null,[o.capability.sourceSpec.buildable?(a(),m(P,{key:0,size:"small",plain:"",type:"success",onClick:_},{default:t(()=>[C("span",Et,T(r(s).connectActionName),1)]),_:1})):h("",!0),l(H,{modelValue:i.value,"onUpdate:modelValue":p[3]||(p[3]=U=>i.value=U),title:r(s).capabilityName,size:"800",loading:d.value,onOnConfirm:R},{default:t(()=>[l($,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=U=>n.value=U),style:{"margin-bottom":"20px"}},{default:t(()=>[l(S,{label:`新建${o.capability.sourceSpec.resourceCategoryName}`,value:"CREATE"},null,8,["label"]),l(S,{label:`使用已有${o.capability.sourceSpec.resourceCategoryName}`,disabled:r(s).essentialRequirement||r(s).primaryCapability,value:"CONNECT"},null,8,["label","disabled"])]),_:1},8,["modelValue"]),n.value==="CREATE"?(a(),m(xe,{key:0,ref_key:"createCapabilityFormRef",ref:f,"resource-category":o.capability.sourceSpec.resourceCategoryId,modelValue:E.value,"onUpdate:modelValue":p[1]||(p[1]=U=>E.value=U)},null,8,["resource-category","modelValue"])):h("",!0),n.value==="CONNECT"?(a(),m(De,{key:1,ref_key:"connectFormRef",ref:v,modelValue:b.value,"onUpdate:modelValue":p[2]||(p[2]=U=>b.value=U)},null,8,["modelValue"])):h("",!0)]),_:1},8,["modelValue","title","loading"])],64)}}},wt={style:{"margin-bottom":"10px",height:"20px"}},At={style:{"font-size":"12px"}},It={__name:"CapabilityTab",props:{resource:{required:!0},capability:{required:!0}},setup(e){const o=e,n=o.capability.relationshipSpec,u=c({targetId:o.resource.id,relationshipType:n.relationshipTypeId}),s=c([]);function d(_){s.value=_}function i(){}const f=c(),E=re(()=>!(n.primaryCapability&&f.value&&f.value.getTotal())),v=X();function b(){s.value.length!==0&&W({jobType:"BATCH_DISCONNECT_RESOURCES",jobParameters:{relationshipIds:s.value.map(_=>_.id)}}).then(_=>{v.setActiveJobId(_.jobId),f.value.fetchData()})}return(_,R)=>{const y=D("ElSpace");return a(),g(I,null,[C("div",wt,[l(y,{alignment:"normal"},{default:t(()=>[E.value?(a(),m(Tt,{key:0,resource:o.resource,capability:o.capability},null,8,["resource","capability"])):h("",!0),!r(n).essentialRequirement&&!r(n).primaryCapability&&o.capability.sourceSpec.destroyable?(a(),m(r(we),{key:1,title:`确认${r(n).disconnectActionName}`,onConfirm:b},{reference:t(()=>[l(P,{size:"small",disabled:s.value.length===0,type:"danger",plain:""},{default:t(()=>[C("span",At,T(r(n).disconnectActionName),1)]),_:1},8,["disabled"])]),_:1},8,["title"])):h("",!0)]),_:1}),l(r(_e),{size:"small",style:{float:"right",width:"20%"},modelValue:u.value.search,"onUpdate:modelValue":R[0]||(R[0]=p=>u.value.search=p),"suffix-icon":"search"},null,8,["modelValue"])]),l(be,{ref_key:"capabilityTableRef",ref:f,"paging-request":u.value,"remote-method":r(Pe),onSelectionChange:d,onFilterChange:i,"default-page-size":5,size:"small"},{default:t(()=>[l(r(O),{type:"selection","reserve-selection":""}),l(r(O),{prop:"sourceName",label:"资源名称"},{default:t(p=>[l(Ve,{"resource-category":p.row.source.category,"resource-id":p.row.source.id,"resource-name":p.row.source.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),l(r(O),{prop:"sourceType",label:"类型"},{default:t(p=>[C("span",null,T(p.row.source.typeName),1)]),_:1}),l(r(O),{prop:"sourceState",label:"资源状态"},{default:t(p=>[l(ce,{state:p.row.source.state},null,8,["state"])]),_:1}),l(r(O),{prop:"relationshipState",label:"关联状态"},{default:t(p=>[l(qe,{state:p.row.state},null,8,["state"])]),_:1}),l(r(O),{label:"标签"},{default:t(p=>[l(de,{"in-list":"",resource:p.row.source},null,8,["resource"])]),_:1}),l(r(O),{label:"属性",width:"200"},{default:t(p=>[l(me,{"in-list":"",resource:p.row.source},null,8,["resource"])]),_:1})]),_:1},8,["paging-request","remote-method"])],64)}}},kt={key:0},Dt={key:1},qt={__name:"ChangeEssentialTargetPriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const o=e,n=c(),u=c(!1);return K(o,()=>{u.value=!0,Le({changes:[o.formData]}).then(s=>{n.value=s.totalMonthlyCostDescription}).finally(()=>{u.value=!1})},{immediate:!0,deep:!0}),(s,d)=>{const i=D("ElText");return a(),m(i,{type:"warning"},{default:t(()=>[u.value?(a(),g("span",kt,"费用查询中...")):(a(),g("span",Dt,"费用："+T(n.value?n.value:"无"),1))]),_:1})}}},ue={__name:"AddToCartButton",props:{jobParameters:{required:!0,type:Object},jobType:{required:!0,type:String},formRef:{required:!0}},emits:["confirm"],setup(e,{emit:o}){const n=e,u=o;function s(){n.formRef.validate(i=>{i&&(d.value=!0,bt({jobType:n.jobType,jobParameters:n.jobParameters}).then(()=>{u("confirm"),Ae.success("已加入待办队列")}).finally(()=>{d.value=!1}))})}const d=c(!1);return(i,f)=>{const E=D("ElButton");return a(),m(E,{type:"primary",plain:"",loading:d.value,icon:"ShoppingCart",onClick:s},{default:t(()=>[B("加入待办队列")]),_:1},8,["loading"])}}},xt={style:{"margin-bottom":"10px",height:"20px"}},Vt={style:{"font-size":"12px"}},Ot={style:{"font-size":"12px"}},Bt={style:{"font-size":"12px"}},Ut={__name:"RequirementTab",props:{resource:{required:!0},requirement:{required:!0}},setup(e){const o=e,n=X(),u=o.requirement.relationshipSpec,s=c({sourceId:o.resource.id,relationshipType:u.relationshipTypeId}),d=c([]);function i(k){d.value=k}function f(){}const E=re(()=>{var q,G;const k=u.exclusiveRequirement&&((q=J.value)==null?void 0:q.getTotal())>0,j=!((G=u.allowedSourceStates)!=null&&G.includes(o.resource.state));return k||j}),v=c(!1),b=c(),_=c(!1),R=c({sourceResourceId:o.resource.id,relationshipTypeId:u.relationshipTypeId,relationshipInputs:{}});function y(){v.value=!0}function p(){b.value.validate(k=>{k&&(_.value=!0,W({jobType:"BATCH_CONNECT_RESOURCES",jobParameters:{connections:[R.value]}}).then(j=>{n.setActiveJobId(j.jobId),J.value.fetchData(),v.value=!1}).finally(()=>{_.value=!1}))})}const S=c(!1),$=c(),U=c(!1),A=c({sourceId:o.resource.id,relationshipTypeId:u.relationshipTypeId,newTargetId:void 0,relationshipInputs:{}});function z(){S.value=!0}function N(){$.value.validate(k=>{k&&(U.value=!0,W({jobType:"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS",jobParameters:{changes:[A.value]}}).then(j=>{n.setActiveJobId(j.jobId),J.value.fetchData(),S.value=!1}).finally(()=>{U.value=!1}))})}function Y(){d.value.length!==0&&W({jobType:"BATCH_DISCONNECT_RESOURCES",jobParameters:{relationshipIds:d.value.map(k=>k.id)}}).then(k=>{n.setActiveJobId(k.jobId),J.value.fetchData()})}const J=c();function Z(){S.value=!1}function ee(){v.value=!1}return(k,j)=>(a(),g(I,null,[C("div",xt,[r(u).changeableEssential?(a(),m(P,{key:0,size:"small",plain:"",type:"success",onClick:z,disabled:d.value.length===0},{default:t(()=>[C("span",Vt," 变更"+T(o.requirement.targetSpec.resourceCategoryName),1)]),_:1},8,["disabled"])):h("",!0),!r(u).essentialRequirement&&!r(u).essentialPrimaryCapability?(a(),m(P,{key:1,size:"small",plain:"",type:"success",disabled:E.value,"disabled-message":"该资源当前无法挂载到此目标",onClick:y},{default:t(()=>[C("span",Ot,T(r(u).connectActionName),1)]),_:1},8,["disabled"])):h("",!0),!r(u).essentialRequirement&&!r(u).essentialPrimaryCapability?(a(),m(r(we),{key:2,title:`确认${r(u).disconnectActionName}`,onConfirm:Y},{reference:t(()=>[l(P,{size:"small",disabled:d.value.length===0,type:"danger",plain:""},{default:t(()=>[C("span",Bt,T(r(u).disconnectActionName),1)]),_:1},8,["disabled"])]),_:1},8,["title"])):h("",!0),l(r(_e),{size:"small",style:{float:"right",width:"20%"},modelValue:s.value.search,"onUpdate:modelValue":j[0]||(j[0]=q=>s.value.search=q),"suffix-icon":"search"},null,8,["modelValue"])]),l(be,{ref_key:"requirementTableRef",ref:J,"paging-request":s.value,"remote-method":r(Fe),onSelectionChange:i,onFilterChange:f,"default-page-size":5,size:"small"},{default:t(()=>[l(r(O),{type:"selection","reserve-selection":"",selectable:q=>q.state!=="DISCONNECTED"},null,8,["selectable"]),l(r(O),{prop:"targetName",label:"资源名称"},{default:t(q=>[l(Ve,{"resource-category":q.row.target.category,"resource-id":q.row.target.id,"resource-name":q.row.target.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),l(r(O),{prop:"targetType",label:"类型"},{default:t(q=>[C("span",null,T(q.row.target.typeName),1)]),_:1}),l(r(O),{prop:"targetState",label:"资源状态"},{default:t(q=>[l(ce,{state:q.row.target.state},null,8,["state"])]),_:1}),l(r(O),{prop:"relationshipState",label:"关联状态"},{default:t(q=>[l(qe,{state:q.row.state},null,8,["state"])]),_:1}),l(r(O),{label:"标签"},{default:t(q=>[l(de,{"in-list":"",resource:q.row.target},null,8,["resource"])]),_:1}),l(r(O),{label:"属性",width:"200"},{default:t(q=>[l(me,{"in-list":"",resource:q.row.target},null,8,["resource"])]),_:1})]),_:1},8,["paging-request","remote-method"]),l(H,{modelValue:v.value,"onUpdate:modelValue":j[2]||(j[2]=q=>v.value=q),size:"800",title:r(u).requirementName,onOnConfirm:p,loading:_.value},le({default:t(()=>[l(De,{ref_key:"connectFormRef",ref:b,modelValue:R.value,"onUpdate:modelValue":j[1]||(j[1]=q=>R.value=q)},null,8,["modelValue"])]),_:2},[v.value?{name:"footer",fn:t(()=>[l(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CONNECT_RESOURCES","job-parameters":{connections:[R.value]},"form-ref":b.value,onConfirm:ee},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","loading"]),l(H,{modelValue:S.value,"onUpdate:modelValue":j[4]||(j[4]=q=>S.value=q),size:"800",title:`变更${o.requirement.targetSpec.resourceCategoryName}`,onOnConfirm:N,loading:U.value},le({default:t(()=>[l(mt,{ref_key:"changeFormRef",ref:$,modelValue:A.value,"onUpdate:modelValue":j[3]||(j[3]=q=>A.value=q)},null,8,["modelValue"])]),_:2},[S.value?{name:"footer",fn:t(()=>[l(qt,{"form-data":A.value},null,8,["form-data"]),l(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS","job-parameters":{changes:[A.value]},"form-ref":$.value,onConfirm:Z},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","loading"])],64))}},Nt={__name:"RelationshipTabs",props:{resource:{required:!0},resourceTypeDef:{required:!0}},setup(e){const o=e;return _t(()=>o.resource.accountId),(n,u)=>(a(),m(r(Ze),null,{default:t(()=>[e.resourceTypeDef.requirements&&e.resourceTypeDef.requirements.length>0?(a(!0),g(I,{key:0},F(e.resourceTypeDef.requirements,s=>(a(),m(r(Se),{lazy:"",label:s.relationshipSpec.requirementName},{default:t(()=>[l(Ut,{resource:o.resource,requirement:s},null,8,["resource","requirement"])]),_:2},1032,["label"]))),256)):h("",!0),e.resourceTypeDef.capabilities&&e.resourceTypeDef.capabilities.length>0?(a(!0),g(I,{key:1},F(e.resourceTypeDef.capabilities.filter(s=>s.relationshipSpec.visibleInTarget),s=>(a(),m(r(Se),{lazy:"",label:s.relationshipSpec.capabilityName},{default:t(()=>[l(It,{resource:o.resource,capability:s},null,8,["resource","capability"])]),_:2},1032,["label"]))),256)):h("",!0)]),_:1}))}},$t={__name:"ResourceUsages",props:{resource:{required:!0,type:Object}},setup(e){const o=e;return(n,u)=>(a(),m(r(Ie),{column:1,border:!1},{default:t(()=>[o.resource.allocatedUsages&&o.resource.allocatedUsages.length>0?(a(),m(r(M),{key:0,label:"已分配:","class-name":"allocated-content","label-class-name":"allocated-label"},{default:t(()=>[(a(!0),g(I,null,F(o.resource.allocatedUsages,s=>(a(),g("span",null,T(s.usageTypeName)+": "+T(s.usageValue)+"  ",1))),256))]),_:1})):h("",!0),o.resource.preAllocatedUsages&&o.resource.preAllocatedUsages.length>0?(a(),m(r(M),{key:1,label:"预分配:","class-name":"pre-allocated-content","label-class-name":"pre-allocated-label"},{default:t(()=>[(a(!0),g(I,null,F(o.resource.preAllocatedUsages,s=>(a(),g("span",null,T(s.usageTypeName)+": "+T(s.usageValue)+"  ",1))),256))]),_:1})):h("",!0)]),_:1}))}},zt=ct($t,[["__scopeId","data-v-bb51c904"]]);function oe(e,o){const n=X(),u=c(!1),s=c(!1),d=c();function i(){u.value=!0}function f(){d.value.validate(E=>{E&&(s.value=!0,W(We(e)).then(v=>{n.setActiveJobId(v.jobId),o(),u.value=!1}).finally(()=>{s.value=!1}))})}return{drawerFlag:u,buttonLoading:s,formRef:d,openDrawer:i,confirm:f}}const jt={key:0},Pt={key:1},Lt={__name:"CreateResourcePriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const o=e,n=c(),u=c(!1);return K(o,()=>{u.value=!0,Me({createCommand:o.formData}).then(s=>{n.value=s.totalMonthlyCostDescription}).finally(()=>{u.value=!1})},{immediate:!0,deep:!0}),(s,d)=>{const i=D("ElText");return a(),m(i,{type:"warning"},{default:t(()=>[u.value?(a(),g("span",jt,"费用查询中...")):(a(),g("span",Pt,"参考价格："+T(n.value?n.value:"无"),1))]),_:1})}}},Ft={__name:"CreateResourceButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:o}){const n={tenantId:void 0,ownerId:void 0,resource:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0},requirements:[],capabilities:[],number:1},u=c(ge.cloneDeep(n)),s=o;function d(){s("actionSubmitted")}const{drawerFlag:i,buttonLoading:f,formRef:E,openDrawer:v,confirm:b}=oe(_,d);function _(){return{jobType:"BATCH_CREATE_RESOURCES",jobParameters:{resources:[u.value]}}}function R(){u.value=ge.cloneDeep(n),v()}function y(){i.value=!1}return(p,S)=>(a(),g(I,null,[l(P,{size:e.small?"small":"default",type:"primary",onClick:R,loading:r(f)},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"创建",4)]),_:1},8,["size","loading"]),l(H,{size:1e3,modelValue:r(i),"onUpdate:modelValue":S[1]||(S[1]=$=>ie(i)?i.value=$:null),title:"创建资源",onOnConfirm:r(b),loading:r(f)},le({default:t(()=>[r(i)?(a(),m(xe,{key:0,ref_key:"formRef",ref:E,modelValue:u.value,"onUpdate:modelValue":S[0]||(S[0]=$=>u.value=$),"resource-category":e.category},null,8,["modelValue","resource-category"])):h("",!0)]),_:2},[r(i)?{name:"footer",fn:t(()=>[l(Lt,{"form-data":u.value},null,8,["form-data"]),l(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CREATE_RESOURCES","job-parameters":{resources:[u.value]},"form-ref":r(E),onConfirm:y},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","onOnConfirm","loading"])],64))}},Mt={key:0},Ht={key:1},Jt={__name:"DestroyResourcesRefundInquiry",props:{formData:{required:!0,default:{}}},setup(e){const o=e,n=c(),u=c(!1);return K(o,()=>{u.value=!0,He({resources:o.formData}).then(s=>{n.value=s.refundDescription}).finally(()=>{u.value=!1})},{immediate:!0,deep:!0}),(s,d)=>{const i=D("ElText");return a(),m(i,{type:"warning"},{default:t(()=>[u.value?(a(),g("span",Mt,"费用查询中...")):(a(),g("span",Ht,T(n.value?n.value:"退费：无"),1))]),_:1})}}},ve={__name:"RecycleResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},destroyable:{required:!1,type:Boolean,default:!1},recycleBinMode:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=e,u=o;function s(){u("actionSubmitted")}const d=c([]),{drawerFlag:i,buttonLoading:f,formRef:E,openDrawer:v,confirm:b}=oe(_,s);function _(){return{jobType:"BATCH_RECYCLE_RESOURCES",jobParameters:{resources:d.value}}}function R(){d.value=[];for(let y of n.selectedResources)d.value.push({resourceId:y.id,recyclingCapabilities:!0,executingDestruction:!0,destroyParameters:{}});v()}return(y,p)=>(a(),g(I,null,[l(P,{size:e.small?"small":"default",loading:r(f),onClick:R,disabled:e.selectedResources.length===0,type:"warning",plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.recycleBinMode?"销毁":"回收"),5)]),_:1},8,["size","loading","disabled"]),l(H,{modelValue:r(i),"onUpdate:modelValue":p[1]||(p[1]=S=>ie(i)?i.value=S:null),size:800,title:"回收资源",onOnConfirm:r(b),loading:r(f)},le({default:t(()=>[r(i)?(a(),m(ft,{key:0,ref_key:"formRef",ref:E,modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=S=>d.value=S),destroyable:e.destroyable,"resource-category":e.category},null,8,["modelValue","destroyable","resource-category"])):h("",!0)]),_:2},[r(i)?{name:"footer",fn:t(()=>[l(Jt,{"form-data":d.value},null,8,["form-data"])]),key:"0"}:void 0]),1032,["modelValue","onOnConfirm","loading"])],64))}},Yt={key:0},Gt={key:1},Qt={__name:"RunActionsPriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const o=e,n=c(),u=c(!1);return K(o,()=>{u.value=!0,Je({actions:o.formData}).then(s=>{n.value=s.totalMonthlyCostDescription}).finally(()=>{u.value=!1})},{immediate:!0,deep:!0}),(s,d)=>{const i=D("ElText");return a(),m(i,{type:"warning"},{default:t(()=>[u.value?(a(),g("span",Yt,"费用查询中...")):(a(),g("span",Gt,"参考价格："+T(n.value?n.value:"无"),1))]),_:1})}}},fe={__name:"ResourcesActionButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},action:{required:!0},disabled:{required:!1,default:!1,type:Boolean},disabledMessage:{required:!1},showButton:{required:!1,default:!0}},emits:["actionSubmitted"],setup(e,{expose:o,emit:n}){const u=e,s=n;function d(){s("actionSubmitted")}const i=c([]),{drawerFlag:f,buttonLoading:E,formRef:v,openDrawer:b,confirm:_}=oe(R,d);function R(){return{jobType:"BATCH_RUN_RESOURCE_ACTIONS",jobParameters:{actions:i.value}}}function y(){i.value=[];for(let A of u.selectedResources)i.value.push({resourceId:A.id,actionId:u.action.id,parameters:{}});b()}o({openActionDrawer:y});const p=["STOP","DESTROY_RESOURCE"],S=["START"];function $(A){if(p.includes(A))return"danger";if(S.includes(A))return"success"}function U(){f.value=!1}return(A,z)=>(a(),g(I,null,[e.showButton?(a(),m(P,{key:0,size:e.small?"small":"default",loading:r(E),onClick:y,disabled:e.disabled,"disabled-message":e.disabledMessage?e.disabledMessage:void 0,type:$(e.action.id),plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.action.name),5)]),_:1},8,["size","loading","disabled","disabled-message","type"])):h("",!0),l(H,{modelValue:r(f),"onUpdate:modelValue":z[1]||(z[1]=N=>ie(f)?f.value=N:null),size:800,title:e.action.name,onOnConfirm:r(_),loading:r(E)},le({default:t(()=>[r(f)?(a(),m(pt,{key:0,ref_key:"formRef",ref:v,modelValue:i.value,"onUpdate:modelValue":z[0]||(z[0]=N=>i.value=N),"resource-category":e.category},null,8,["modelValue","resource-category"])):h("",!0)]),_:2},[r(f)?{name:"footer",fn:t(()=>[l(Qt,{"form-data":i.value},null,8,["form-data"]),l(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_RUN_RESOURCE_ACTIONS","job-parameters":{actions:i.value},"form-ref":r(v),onConfirm:U},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","onOnConfirm","loading"])],64))}},Be={__name:"SyncResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=e,u=o;function s(){u("actionSubmitted")}const d=c({}),{drawerFlag:i,buttonLoading:f,formRef:E,openDrawer:v,confirm:b}=oe(_,s);function _(){return{jobType:"SYNCHRONIZE_RESOURCES",jobParameters:d.value}}function R(){d.value.resourceIds=n.selectedResources.map(y=>y.id),d.value.synchronizeAll=!1,v()}return(y,p)=>(a(),g(I,null,[l(P,{size:e.small?"small":"default",loading:r(f),onClick:R,disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"同步",4)]),_:1},8,["size","loading","disabled"]),l(H,{modelValue:r(i),"onUpdate:modelValue":p[1]||(p[1]=S=>ie(i)?i.value=S:null),size:800,title:"同步资源",onOnConfirm:r(b),loading:r(f)},{default:t(()=>[r(i)?(a(),m(yt,{key:0,ref_key:"formRef",ref:E,modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=S=>d.value=S)},null,8,["modelValue"])):h("",!0)]),_:1},8,["modelValue","onOnConfirm","loading"])],64))}},Kt={__name:"TransferResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=e,u=o;function s(){u("actionSubmitted")}const d=c([]),i=c(!1),f=c(!1),E=c(),v=X();function b(){d.value=n.selectedResources.map(R=>({resourceId:R.id,newOwnerId:R.ownerId,newTenantId:R.tenantId,enableCascadedTransfer:!0})),i.value=!0}function _(){E.value.validate(R=>{R&&(f.value=!0,Oe({jobType:"TRANSFER_RESOURCES",jobParameters:{transfers:d.value}}).then(y=>{i.value=!1,v.setActiveJobId(y.jobId),s()}).finally(()=>{f.value=!1}))})}return(R,y)=>(a(),g(I,null,[l(P,{size:e.small?"small":"default",loading:f.value,onClick:b,disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"移交",4)]),_:1},8,["size","loading","disabled"]),l(H,{modelValue:i.value,"onUpdate:modelValue":y[1]||(y[1]=p=>i.value=p),size:800,title:"移交资源",onOnConfirm:_,loading:f.value},{default:t(()=>[i.value?(a(),m(gt,{key:0,ref_key:"formRef",ref:E,modelValue:d.value,"onUpdate:modelValue":y[0]||(y[0]=p=>d.value=p),"resource-category":e.category},null,8,["modelValue","resource-category"])):h("",!0)]),_:1},8,["modelValue","loading"])],64))}},Zt={style:{width:"100%"}},Wt={style:{"max-width":"400px","overflow-wrap":"break-word"}},Xt={key:1},ea={__name:"ResourcesReadActionButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},action:{required:!0},disabled:{required:!1,default:!1,type:Boolean},disabledMessage:{required:!1},showButton:{required:!1,default:!0}},setup(e,{expose:o}){const n=e,u=c(!1),s=c(!1),d=re(()=>n.selectedResources.map(b=>b.id)),i=c([]);function f(){u.value=!0,s.value=!0,Ye({resourceIds:d.value,actionId:n.action.id}).then(b=>{i.value=b.responseList}).finally(()=>{s.value=!1})}o({openResultDrawer:f});function E(b){navigator.clipboard.writeText(b),Ae.success("文本已复制")}function v(b){window.open(b,"_blank")}return(b,_)=>{const R=D("ElLink"),y=D("ElDescriptionsItem"),p=D("ElDescriptions"),S=D("ElCard"),$=Xe("loading");return a(),g(I,null,[e.showButton?(a(),m(P,{key:0,size:e.small?"small":"default",onClick:f,disabled:e.disabled,"disabled-message":e.disabledMessage?e.disabledMessage:void 0,plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.action.name),5)]),_:1},8,["size","disabled","disabled-message"])):h("",!0),l(H,{modelValue:u.value,"onUpdate:modelValue":_[0]||(_[0]=U=>u.value=U),size:800,title:e.action.name,"no-confirm":""},{default:t(()=>[et((a(),g("div",Zt,[(a(!0),g(I,null,F(i.value,U=>(a(),m(S,null,{header:t(()=>[B(T(U.resourceName),1)]),default:t(()=>[U.resultList&&U.resultList.length>0?(a(),m(p,{key:0,border:"",direction:"vertical"},{default:t(()=>[(a(!0),g(I,null,F(U.resultList,A=>(a(),m(y,{span:3,label:A.name},{label:t(()=>[C("span",null,T(A.name),1),A.isUrl?(a(),m(R,{key:0,style:{float:"right"},onClick:()=>v(A.value)},{default:t(()=>[B(" 前往 ")]),_:2},1032,["onClick"])):(a(),m(R,{key:1,style:{float:"right"},onClick:()=>E(A.value)},{default:t(()=>[B(" 复制 ")]),_:2},1032,["onClick"]))]),default:t(()=>[C("div",Wt,T(A.value),1)]),_:2},1032,["label"]))),256))]),_:2},1024)):(a(),g("div",Xt," 无数据 "))]),_:2},1024))),256))])),[[$,s.value]])]),_:1},8,["modelValue","title"])],64)}}},ta={__name:"DropResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=e,u=o;function s(){if(n.selectedResources.length===0)return;const i={resourceIds:n.selectedResources.map(f=>f.id)};Ge(i).then(()=>{u("actionSubmitted")})}return(d,i)=>{const f=D("ElPopconfirm");return a(),m(f,{title:"解除纳管",onConfirm:s},{reference:t(()=>[l(P,{size:e.small?"small":"default",disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[B(" 解除纳管 ")]),_:1},8,["size","disabled"])]),_:1})}}},Ue={__name:"ResourceActionButtonsGroup",props:{selectedResources:{type:Array,required:!0},category:{required:!0},small:{required:!1,type:Boolean,default:!1},buildActionHidden:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{expose:o,emit:n}){const u=e,s=c([]),d=c([]),i=c([]),f=c([]);function E(){return u.selectedResources.map(A=>A.id)}K(u,()=>{_()},{immediate:!0});function v(A){return i.value.some(z=>z.id===A)}const b=c(!1);function _(){Te({category:u.category,resourceIds:E()}).then(A=>{if(s.value=[],d.value=[],A.allActions)for(let z=0;z<A.allActions.length;z++){let N=A.allActions[z];N.id==="DESTROY_RESOURCE"&&(b.value=!0),z<3?s.value.push(N):N.id==="BUILD_RESOURCE"?s.value.unshift(N):N.id==="DESTROY_RESOURCE"?s.value.push(N):d.value.push(N)}b.value=s.value.filter(z=>z.id==="DESTROY_RESOURCE").length!==0,i.value=A.availableActions,f.value=A.readActions})}o({fetchActions:_});const R=n;function y(){R("actionSubmitted")}const p=he(),{proxy:S}=at();function $(A){A&&S.$refs[A][0].openActionDrawer()}function U(A){A&&S.$refs[A][0].openResultDrawer()}return(A,z)=>{const N=D("ElIcon"),Y=D("ElDropdownItem"),J=D("ElDropdownMenu"),Z=D("ElDropdown"),ee=D("ElSpace");return a(),m(ee,{alignment:"normal"},{default:t(()=>[(a(!0),g(I,null,F(s.value,k=>(a(),g(I,null,[k.id==="BUILD_RESOURCE"?(a(),g(I,{key:0},[e.buildActionHidden?h("",!0):(a(),m(Ft,{key:0,category:e.category,small:e.small,onActionSubmitted:y},null,8,["category","small"]))],64)):k.id==="DESTROY_RESOURCE"?(a(),g(I,{key:1},[r(p).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(a(),m(ve,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:y,destroyable:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"回收",4)]),_:1},8,["small","category","selected-resources"])):h("",!0)],64)):e.selectedResources.length===0?(a(),m(fe,{key:2,small:e.small,action:k,"selected-resources":e.selectedResources,category:e.category,onActionSubmitted:y,disabled:""},null,8,["small","action","selected-resources","category"])):(a(),m(fe,{key:3,small:e.small,action:k,"selected-resources":e.selectedResources,category:e.category,disabled:!v(k.id),onActionSubmitted:y,"disabled-message":"所选资源无法执行此操作"},null,8,["small","action","selected-resources","category","disabled"]))],64))),256)),!b.value&&r(p).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(a(),m(ve,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:y,destroyable:!1},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"回收",4)]),_:1},8,["small","category","selected-resources"])):h("",!0),r(p).hasPermission("Resource","SYNCHRONIZE_RESOURCES")?(a(),m(Be,{key:1,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:y},null,8,["small","selected-resources"])):h("",!0),r(p).hasPermission("Resource","TRANSFER")?(a(),m(Kt,{key:2,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:y,category:e.category},null,8,["small","selected-resources","category"])):h("",!0),r(p).hasPermission("Resource","DELETE")?(a(),m(ta,{key:3,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:y},null,8,["small","selected-resources"])):h("",!0),d.value.length>0||f.value.length>0?(a(),g(I,{key:4},[l(Z,{trigger:"click",size:e.small?"small":"default",onCommand:$},{dropdown:t(()=>[l(J,{style:{width:"120px"}},{default:t(()=>[(a(!0),g(I,null,F(d.value,k=>(a(),m(Y,{disabled:!v(k.id),command:k.id},{default:t(()=>[B(T(k.name),1)]),_:2},1032,["disabled","command"]))),256)),(a(!0),g(I,null,F(f.value,k=>(a(),m(Y,{onClick:()=>U(k.id),command:""},{default:t(()=>[B(T(k.name),1)]),_:2},1032,["onClick"]))),256))]),_:1})]),default:t(()=>[l(P,{size:e.small?"small":"default",disabled:e.selectedResources.length===0},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},[B(" 更多操作"),l(N,{class:"el-icon--right"},{default:t(()=>[l(r(tt))]),_:1})],4)]),_:1},8,["size","disabled"])]),_:1},8,["size"]),C("div",null,[(a(!0),g(I,null,F(d.value,k=>(a(),m(fe,{ref_for:!0,ref:k.id,action:k,"selected-resources":e.selectedResources,category:e.category,onActionSubmitted:y,"show-button":!1},null,8,["action","selected-resources","category"]))),256)),(a(!0),g(I,null,F(f.value,k=>(a(),m(ea,{ref_for:!0,ref:k.id,action:k,"selected-resources":e.selectedResources,category:e.category,"show-button":!1},null,8,["action","selected-resources","category"]))),256))])],64)):h("",!0)]),_:1})}}},aa={key:0},la={key:0},ra={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ne={__name:"ResourceQuickStats",props:{resourceId:{required:!0},hideAfter:{required:!1,default:void 0},span:{required:!1,default:24},showLabel:{required:!1,default:!1,type:Boolean}},setup(e){const o=e,n=c();function u(){d.value=!0,Qe({resourceId:o.resourceId}).then(f=>{n.value=f.quickStats,i.value=!1}).catch(f=>{console.log(f),i.value=!0}).finally(()=>{d.value=!1})}const s=c();Re(()=>{u(),s.value=setInterval(u,1e4)}),lt(()=>{clearInterval(s.value)});const d=c(!1),i=c(!1);return(f,E)=>{const v=D("ElProgress"),b=D("ElCol"),_=D("ElRow"),R=D("Loading"),y=D("ElIcon"),p=D("ElText");return a(),g("div",null,[n.value&&n.value.items&&n.value.items.length>0?(a(),m(_,{key:0,gutter:4},{default:t(()=>[(a(!0),g(I,null,F(n.value.items,(S,$)=>(a(),g(I,null,[!e.hideAfter||$<e.hideAfter?(a(),m(b,{key:0,span:e.span},{default:t(()=>[S.isPercentage?(a(),g(I,{key:0},[e.showLabel?(a(),g("div",aa,T(S.label),1)):h("",!0),l(v,{"stroke-width":16,"text-inside":"",percentage:S.value,color:S.value>80?"#8c7b28":"#02610c"},{default:t(()=>[B(T(S.name),1)]),_:2},1032,["percentage","color"])],64)):(a(),g(I,{key:1},[e.showLabel?(a(),g("div",la,T(S.label),1)):h("",!0),C("div",ra,T((e.showLabel?"":S.name+":")+S.valueStr+S.unit),1)],64))]),_:2},1032,["span"])):h("",!0)],64))),256))]),_:1})):d.value?(a(),m(y,{key:1,class:"is-loading"},{default:t(()=>[l(R)]),_:1})):i.value?(a(),m(p,{key:2,type:"danger"},{default:t(()=>[B("获取失败")]),_:1})):(a(),g(I,{key:3},[B(" 无 ")],64))])}}},oa={style:{float:"right"}},sa={style:{width:"100%"}},na=C("div",{style:{width:"100px"}},"类型",-1),ua=C("div",{style:{width:"100px"}},"云账号",-1),ia=C("div",{style:{width:"100px"}},"回收状态",-1),ca=C("div",{style:{width:"100px"}},"ID",-1),da=C("div",{style:{width:"100px"}},"估计费用",-1),ma=C("div",{style:{width:"100px"}},"监控",-1),fa={style:{"min-width":"180px"}},pa=C("div",{style:{width:"100px"}},"属性",-1),ya=C("div",{style:{width:"100px"}},"标签",-1),ga=C("div",{style:{width:"100px"}},"资源使用",-1),va=C("div",{style:{width:"100px"}},"描述",-1),ba={__name:"ResourceDetail",props:{resource:{required:!0}},setup(e){const o=e,n=dt(()=>o.resource.type);Rt();const u=c();return Re(()=>{ht({accountIds:[o.resource.accountId]}).then(s=>{s.content&&(u.value=s.content[0].name)})}),(s,d)=>{const i=D("ElCol"),f=D("ElRow");return a(),g(I,null,[C("span",oa,[l(Ue,{"build-action-hidden":"",small:"","selected-resources":[o.resource],category:o.resource.category},null,8,["selected-resources","category"])]),l(r(Ie),{column:3,border:""},{title:t(()=>[C("div",sa,[C("span",null,T(o.resource.categoryName)+":",1),l(r(pe),{style:{"margin-left":"10px"}},{default:t(()=>[B(T(o.resource.name),1)]),_:1}),l(ce,{style:{"margin-left":"20px"},state:o.resource.state},null,8,["state"])])]),default:t(()=>[l(r(M),{label:"类型"},{label:t(()=>[na]),default:t(()=>[B(" "+T(o.resource.typeName),1)]),_:1}),l(r(M),{label:"云账号",span:2},{label:t(()=>[ua]),default:t(()=>[B(" "+T(o.resource.providerName)+"-> ",1),l(r(pe),{type:"primary"},{default:t(()=>[B(T(u.value),1)]),_:1})]),_:1}),l(r(M),{label:"回收状态"},{label:t(()=>[ia]),default:t(()=>[B(" "+T(o.resource.recycled?`已于${o.resource.recycledTime}回收`:"未回收"),1)]),_:1}),l(r(M),{label:"ID",span:2},{label:t(()=>[ca]),default:t(()=>[B(" "+T(o.resource.externalId),1)]),_:1}),l(r(M),{label:"估计费用",span:1},{label:t(()=>[da]),default:t(()=>[B(" "+T(e.resource.monthlyCostDescription),1)]),_:1}),l(r(M),{label:"监控",span:2},{label:t(()=>[ma]),default:t(()=>[C("div",fa,[l(Ne,{"resource-id":e.resource.id,span:6,"hide-after":4},null,8,["resource-id"])])]),_:1}),l(r(M),{label:"属性",span:3},{label:t(()=>[pa]),default:t(()=>[l(me,{resource:o.resource},null,8,["resource"])]),_:1}),l(r(M),{label:"标签",span:3},{label:t(()=>[ya]),default:t(()=>[l(de,{resource:o.resource},null,8,["resource"])]),_:1}),l(r(M),{label:"资源使用",span:3},{label:t(()=>[ga]),default:t(()=>[l(zt,{resource:o.resource},null,8,["resource"])]),_:1}),l(r(M),{label:"描述",span:3},{label:t(()=>[va]),default:t(()=>[B(" "+T(o.resource.description),1)]),_:1})]),_:1}),l(f,{style:{width:"100%"}},{default:t(()=>[l(i,{span:20}),l(i,{span:4})]),_:1}),r(n)?(a(),m(Nt,{key:0,resource:o.resource,"resource-type-def":r(n)},null,8,["resource","resource-type-def"])):h("",!0)],64)}}},_a={style:{"margin-left":"2px"}},Ra={__name:"ResourceSyncState",props:{state:{required:!0}},setup(e){const o=e,n=ye,u=re(()=>{let s=n[o.state];return s===void 0&&(s={name:o.state,icon:"QuestionFilled",type:"warning"}),s});return(s,d)=>(a(),m(r(st),{type:u.value.type,style:{"font-size":"12px"}},{default:t(()=>[l(r(ke),{class:rt(u.value.icon==="Loading"?"is-loading":"")},{default:t(()=>[(a(),m(ot(u.value.icon)))]),_:1},8,["class"]),C("span",_a,T(u.value.name),1)]),_:1},8,["type"]))}},ha={__name:"ClaimResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=o;function u(){n("actionSubmitted")}const s=c([]),d=c(!1),i=c(!1),f=c(),E=X();function v(){s.value.push({resourceId:void 0,enableCascadedClaim:!0}),d.value=!0}function b(){f.value.validate(_=>{_&&(i.value=!0,Oe({jobType:"CLAIM_RESOURCES",jobParameters:{claims:s.value}}).then(R=>{d.value=!1,E.setActiveJobId(R.jobId),u()}).finally(()=>{i.value=!1}))})}return(_,R)=>(a(),g(I,null,[l(P,{style:L(_.$attrs.style),size:e.small?"small":"default",loading:i.value,onClick:v,plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"认领",4)]),_:1},8,["style","size","loading"]),l(H,{modelValue:d.value,"onUpdate:modelValue":R[1]||(R[1]=y=>d.value=y),size:800,title:"认领资源",onOnConfirm:b,loading:i.value},{default:t(()=>[d.value?(a(),m(vt,{key:0,ref_key:"formRef",ref:f,modelValue:s.value,"onUpdate:modelValue":R[0]||(R[0]=y=>s.value=y),"resource-category":e.category},null,8,["modelValue","resource-category"])):h("",!0)]),_:1},8,["modelValue","loading"])],64))}},Ca={__name:"RestoreResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:o}){const n=e,u=o;function s(){u("actionSubmitted")}const{buttonLoading:d,confirm:i,formRef:f}=oe(E,s);f.value={validate(v){v(!0)}};function E(){return{jobType:"BATCH_RESTORE_RESOURCES",jobParameters:{resourceIds:n.selectedResources.map(v=>v.id)}}}return(v,b)=>(a(),m(P,{size:e.small?"small":"default",loading:r(d),onClick:r(i),disabled:e.selectedResources.filter(_=>_.state!=="DESTROYED").length===0,"disabled-message":"请选择回收站中未销毁的资源",type:"success",plain:""},{default:t(()=>[C("span",{style:L(e.small?{fontSize:"12px"}:{})},"还原",4)]),_:1},8,["size","loading","onClick","disabled"]))}},Sa={__name:"RecycleBinButtonsGroup",props:{selectedResources:{type:Array,required:!0},category:{required:!0},small:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{expose:o,emit:n}){const u=e,s=c([]);function d(){return u.selectedResources.map(_=>_.id)}K(u,()=>{f()},{immediate:!0});const i=c(!1);function f(){Te({category:u.category,resourceIds:d()}).then(_=>{if(s.value=[],_.allActions)for(let R=0;R<_.allActions.length;R++){let y=_.allActions[R];y.id==="DESTROY_RESOURCE"&&(i.value=!0),s.value.push(y)}i.value=s.value.filter(R=>R.id==="DESTROY_RESOURCE").length!==0})}o({fetchActions:f});const E=n;function v(){E("actionSubmitted")}const b=he();return(_,R)=>{const y=D("ElSpace");return a(),m(y,{alignment:"normal"},{default:t(()=>[r(b).hasPermission("Resource","BATCH_RESTORE_RESOURCES")?(a(),m(Ca,{key:0,"selected-resources":e.selectedResources,onActionSubmitted:v},null,8,["selected-resources"])):h("",!0),(a(!0),g(I,null,F(s.value,p=>(a(),g(I,null,[p.id==="DESTROY_RESOURCE"?(a(),g(I,{key:0},[r(b).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(a(),m(ve,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:v,destroyable:"","recycle-bin-mode":""},null,8,["small","category","selected-resources"])):h("",!0)],64)):h("",!0)],64))),256)),r(b).hasPermission("Resource","SYNCHRONIZE_RESOURCES")?(a(),m(Be,{key:1,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:v},null,8,["small","selected-resources"])):h("",!0)]),_:1})}}},Ea={style:{"margin-bottom":"10px",height:"32px"}},tl={__name:"Resource",props:{recycled:{required:!1,default:!1},simpleMode:{required:!1,default:!1}},setup(e){const n=c({recycled:e.recycled,ownerIds:[],tagsMap:{}}),u=ut(),s=he(),d=c(),i=c(),f=c(),E=c([]),v=c(!1),b=c(),_=c(!1);function R(w){E.value=w}function y(w){var ne,te,ae;const x=(ne=w==null?void 0:w.params)==null?void 0:ne.category,Q=(te=w==null?void 0:w.query)==null?void 0:te.id,se=(ae=w==null?void 0:w.query)==null?void 0:ae.name;x&&(n.value.resourceCategories=[x],N.value=x,Ce.value.resourceCategories=[x]),Q&&se&&(i.value=Q,f.value=se,n.value.resourceIds=[Q],v.value=!1)}function p(){i.value=void 0,f.value=void 0,n.value.resourceIds=void 0,u.push(`/resource/list/${u.currentRoute.value.params.category}`)}function S(w){b.value=w,v.value=!0}function $(){_.value=!0}const U=c();nt(w=>{y(w)}),Re(()=>{y(u.currentRoute.value),ee(),j()});function A(){d.value.fetchData()}function z(w){!w||w.length===0||(E.value.length>0&&(E.value=w.filter(x=>E.value.findIndex(Q=>Q.id===x.id)!==-1)),b.value&&(b.value=w.find(x=>x.id===b.value.id),b.value||(v.value=!1)))}const N=c(),Y=c(!1);function J(w){w?(Y.value=!0,n.value.states=["DESTROYED"]):(Y.value=!1,n.value.states=void 0)}const Z=c([]);function ee(){for(let w in Ee)Z.value.push({text:Ee[w].name,value:w})}const k=c([]);function j(){for(let w in ye)k.value.push({text:ye[w].name,value:w})}function q(w){"state"in w&&(n.value.states=w.state),"syncState"in w&&(n.value.syncStates=w.syncState)}const G=c([]),Ce=c({requiredWhenFiltering:!0});K(G,()=>{const w={};for(let x of G.value)!x.tagKey||!x.tagValue||(w[x.tagKey]||(w[x.tagKey]=[]),w[x.tagKey].push(x.tagValue));ge.isEqual(n.value.tagsMap,w)||(n.value.tagsMap=w)},{deep:!0});function $e(){return["COMPUTE_INSTANCE","CONTAINER","ELASTIC_IP","DISK","CLUSTER","HOST","LOAD_BALANCER","DATASTORE","SOFTWARE"].includes(N.value)}const ze=re($e);return(w,x)=>{const Q=D("ElTag"),se=D("ElCheckbox"),ne=D("ElSpace"),te=D("ElButton"),ae=D("ElPopover"),je=D("Resource",!0);return a(),g(I,null,[C("div",Ea,[e.simpleMode?h("",!0):(a(),g(I,{key:0},[N.value?(a(),m(Ue,{key:0,ref_key:"buttonsGroup",ref:U,onActionSubmitted:A,"selected-resources":E.value,category:N.value},null,8,["selected-resources","category"])):h("",!0),l(P,{style:{"margin-left":"10px"},onClick:$,plain:""},{default:t(()=>[l(r(ke),null,{default:t(()=>[l(r(it))]),_:1}),B(" 回收站 ")]),_:1}),r(s).hasPermission("Resource","CLAIM")?(a(),m(ha,{key:1,style:{"margin-left":"10px"},category:N.value,onActionSubmitted:A},null,8,["category"])):h("",!0),i.value?(a(),m(Q,{key:2,style:{"margin-left":"30px"},closable:"",onClose:p},{default:t(()=>[B(" 资源: "+T(f.value),1)]),_:1})):h("",!0)],64)),e.recycled?(a(),m(ne,{key:1,alignment:"normal"},{default:t(()=>[N.value&&!Y.value?(a(),m(Sa,{key:0,ref:"recycleBinButtonsGroup",onActionSubmitted:A,"selected-resources":E.value,category:N.value},null,8,["selected-resources","category"])):h("",!0),l(se,{onChange:J},{default:t(()=>[B("查看已销毁")]),_:1})]),_:1})):h("",!0),l(r(_e),{style:{float:"right",width:"15%"},modelValue:n.value.search,"onUpdate:modelValue":x[0]||(x[0]=V=>n.value.search=V),"suffix-icon":"search"},null,8,["modelValue"])]),n.value.resourceCategories?(a(),m(be,{key:0,size:e.recycled?"small":"default",ref_key:"resourceTableRef",ref:d,"paging-request":n.value,"remote-method":r(Ke),onSelectionChange:R,onFilterChange:q,onListChange:z},{default:t(()=>[l(r(O),{type:"selection","reserve-selection":""}),l(r(O),{prop:"name",label:"资源名称",sortable:"custom","min-width":"100"},{default:t(V=>[l(r(pe),{onClick:()=>S(V.row),type:"primary"},{default:t(()=>[B(T(V.row.name),1)]),_:2},1032,["onClick"])]),_:1}),l(r(O),{prop:"type",label:"类型",sortable:"custom"},{default:t(V=>[C("span",null,T(V.row.typeName),1)]),_:1}),l(r(O),{prop:"state",label:"资源状态","column-key":"state",filters:Z.value,sortable:"custom","min-width":90},{default:t(V=>[l(ce,{state:V.row.state},null,8,["state"])]),_:1},8,["filters"]),e.simpleMode?h("",!0):(a(),m(r(O),{key:0,prop:"syncState",label:"同步状态","column-key":"syncState",filters:k.value,sortable:"custom","min-width":90},{default:t(V=>[l(Ra,{state:V.row.syncState},null,8,["state"])]),_:1},8,["filters"])),l(r(O),{label:"标签"},{default:t(V=>[l(de,{"in-list":"",resource:V.row},null,8,["resource"])]),header:t(()=>[C("span",null,[B(" 标签 "),l(ae,{trigger:"click",width:"260"},{reference:t(()=>[l(te,{icon:"Search",style:L({color:G.value.length>0?"#409eff":void 0}),link:""},null,8,["style"])]),default:t(()=>[l(St,{modelValue:G.value,"onUpdate:modelValue":x[1]||(x[1]=V=>G.value=V),"default-add-all-entries":!1,"entry-paging-request":Ce.value},null,8,["modelValue","entry-paging-request"])]),_:1})])]),_:1}),l(r(O),{label:"属性",width:"200"},{default:t(V=>[l(me,{"in-list":"",resource:V.row},null,8,["resource"])]),_:1}),ze.value&&!e.recycled?(a(),m(r(O),{key:1,label:"监控",width:"180","show-overflow-tooltip":!1},{default:t(V=>[l(Ne,{"hide-after":2,span:12,"resource-id":V.row.id},null,8,["resource-id"])]),_:1})):h("",!0),l(r(O),{prop:"ownerId",label:"所有者"},{default:t(V=>[C("span",null,T(V.row.ownerRealName),1)]),header:t(()=>[C("span",null,[B(" 所有者 "),l(ae,{trigger:"click",width:"260"},{reference:t(()=>[l(te,{icon:"Search",style:L({color:n.value.ownerIds.length>0?"#409eff":void 0}),link:""},null,8,["style"])]),default:t(()=>[l(Ct,{modelValue:n.value.ownerIds,"onUpdate:modelValue":x[2]||(x[2]=V=>n.value.ownerIds=V),multiple:""},null,8,["modelValue"])]),_:1})])]),_:1}),l(r(O),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e.recycled?(a(),m(r(O),{key:2,prop:"recycledTime",label:"回收时间",sortable:"custom"})):h("",!0)]),_:1},8,["size","paging-request","remote-method"])):h("",!0),l(H,{size:1e3,modelValue:v.value,"onUpdate:modelValue":x[3]||(x[3]=V=>v.value=V),title:"资源详情","no-confirm":""},{default:t(()=>[v.value?(a(),m(ba,{key:0,resource:b.value},null,8,["resource"])):h("",!0)]),_:1},8,["modelValue"]),l(H,{size:1050,modelValue:_.value,"onUpdate:modelValue":x[4]||(x[4]=V=>_.value=V),title:"回收站","no-confirm":""},{default:t(()=>[_.value?(a(),m(je,{key:0,"simple-mode":!0,recycled:!0})):h("",!0)]),_:1},8,["modelValue"])],64)}}};export{tl as default};
