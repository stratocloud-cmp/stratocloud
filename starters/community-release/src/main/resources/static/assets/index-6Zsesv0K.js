var ax=Object.defineProperty;var cx=(n,t,e)=>t in n?ax(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var yd=(n,t,e)=>cx(n,typeof t!="symbol"?t+"":t,e);import{ar as lx,as as lc,at as Rl,au as ux,av as Mu,aw as Pu,ax as uc,ay as tu,az as hx,aA as fx,aB as wi,aC as hg,aD as dx,aE as px,aF as gx,aG as mx,aH as bx,aI as Ed,aJ as fg,aK as vx,aL as yx,aM as Ex,aN as xx,aO as wx,aP as Ax,aQ as Sx,aR as Tx,aS as Cx,aT as _x,aU as Ox,aV as us,aW as Ru,aX as Nl,aY as Mx,aZ as Px,a_ as Rx,a$ as Nx,aa as Lx,c as co,b0 as Rr,b1 as De,ap as an,b2 as xd,b3 as mr,b4 as eu,b5 as Ix,ao as Dx,a as kx,b6 as wd}from"./index-C_jnbPMf.js";function Bx(n,t,e){var r=n.length;return e=e===void 0?r:e,!t&&e>=r?n:lx(n,t,e)}var jx="\\ud800-\\udfff",Fx="\\u0300-\\u036f",Gx="\\ufe20-\\ufe2f",zx="\\u20d0-\\u20ff",Ux=Fx+Gx+zx,Vx="\\ufe0e\\ufe0f",$x="\\u200d",Hx=RegExp("["+$x+jx+Ux+Vx+"]");function dg(n){return Hx.test(n)}function Xx(n){return n.split("")}var pg="\\ud800-\\udfff",Wx="\\u0300-\\u036f",qx="\\ufe20-\\ufe2f",Yx="\\u20d0-\\u20ff",Jx=Wx+qx+Yx,Kx="\\ufe0e\\ufe0f",Zx="["+pg+"]",nu="["+Jx+"]",ru="\\ud83c[\\udffb-\\udfff]",Qx="(?:"+nu+"|"+ru+")",gg="[^"+pg+"]",mg="(?:\\ud83c[\\udde6-\\uddff]){2}",bg="[\\ud800-\\udbff][\\udc00-\\udfff]",tw="\\u200d",vg=Qx+"?",yg="["+Kx+"]?",ew="(?:"+tw+"(?:"+[gg,mg,bg].join("|")+")"+yg+vg+")*",nw=yg+vg+ew,rw="(?:"+[gg+nu+"?",nu,mg,bg,Zx].join("|")+")",iw=RegExp(ru+"(?="+ru+")|"+rw+nw,"g");function sw(n){return n.match(iw)||[]}function ow(n){return dg(n)?sw(n):Xx(n)}function Eg(n){return function(t){t=lc(t);var e=dg(t)?ow(t):void 0,r=e?e[0]:t.charAt(0),i=e?Bx(e,1).join(""):t.slice(1);return r[n]()+i}}var Fa=Eg("toUpperCase");function aw(n){return Fa(lc(n).toLowerCase())}function cw(n,t,e,r){for(var i=-1,s=n==null?0:n.length;++i<s;)e=t(e,n[i],i,n);return e}function lw(n){return function(t){return n==null?void 0:n[t]}}var uw={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},hw=lw(uw),fw=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,dw="\\u0300-\\u036f",pw="\\ufe20-\\ufe2f",gw="\\u20d0-\\u20ff",mw=dw+pw+gw,bw="["+mw+"]",vw=RegExp(bw,"g");function yw(n){return n=lc(n),n&&n.replace(fw,hw).replace(vw,"")}var Ew=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function xw(n){return n.match(Ew)||[]}var ww=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function Aw(n){return ww.test(n)}var xg="\\ud800-\\udfff",Sw="\\u0300-\\u036f",Tw="\\ufe20-\\ufe2f",Cw="\\u20d0-\\u20ff",_w=Sw+Tw+Cw,wg="\\u2700-\\u27bf",Ag="a-z\\xdf-\\xf6\\xf8-\\xff",Ow="\\xac\\xb1\\xd7\\xf7",Mw="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Pw="\\u2000-\\u206f",Rw=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Sg="A-Z\\xc0-\\xd6\\xd8-\\xde",Nw="\\ufe0e\\ufe0f",Tg=Ow+Mw+Pw+Rw,Cg="['’]",Ad="["+Tg+"]",Lw="["+_w+"]",_g="\\d+",Iw="["+wg+"]",Og="["+Ag+"]",Mg="[^"+xg+Tg+_g+wg+Ag+Sg+"]",Dw="\\ud83c[\\udffb-\\udfff]",kw="(?:"+Lw+"|"+Dw+")",Bw="[^"+xg+"]",Pg="(?:\\ud83c[\\udde6-\\uddff]){2}",Rg="[\\ud800-\\udbff][\\udc00-\\udfff]",es="["+Sg+"]",jw="\\u200d",Sd="(?:"+Og+"|"+Mg+")",Fw="(?:"+es+"|"+Mg+")",Td="(?:"+Cg+"(?:d|ll|m|re|s|t|ve))?",Cd="(?:"+Cg+"(?:D|LL|M|RE|S|T|VE))?",Ng=kw+"?",Lg="["+Nw+"]?",Gw="(?:"+jw+"(?:"+[Bw,Pg,Rg].join("|")+")"+Lg+Ng+")*",zw="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Uw="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Vw=Lg+Ng+Gw,$w="(?:"+[Iw,Pg,Rg].join("|")+")"+Vw,Hw=RegExp([es+"?"+Og+"+"+Td+"(?="+[Ad,es,"$"].join("|")+")",Fw+"+"+Cd+"(?="+[Ad,es+Sd,"$"].join("|")+")",es+"?"+Sd+"+"+Td,es+"+"+Cd,Uw,zw,_g,$w].join("|"),"g");function Xw(n){return n.match(Hw)||[]}function Ww(n,t,e){return n=lc(n),t=t,t===void 0?Aw(n)?Xw(n):xw(n):n.match(t)||[]}var qw="['’]",Yw=RegExp(qw,"g");function Ig(n){return function(t){return cw(Ww(yw(t).replace(Yw,"")),n,"")}}var hc=Ig(function(n,t,e){return t=t.toLowerCase(),n+(e?aw(t):t)});function Jw(n,t,e){return n===n&&(e!==void 0&&(n=n<=e?n:e),t!==void 0&&(n=n>=t?n:t)),n}function Bn(n,t,e){return e===void 0&&(e=t,t=void 0),e!==void 0&&(e=Rl(e),e=e===e?e:0),t!==void 0&&(t=Rl(t),t=t===t?t:0),Jw(Rl(n),t,e)}function Kw(n,t,e,r){for(var i=-1,s=n==null?0:n.length;++i<s;){var o=n[i];t(r,o,e(o),n)}return r}function Zw(n,t,e,r){return ux(n,function(i,s,o){t(r,i,e(i),o)}),r}function Qw(n,t){return function(e,r){var i=Pu(e)?Kw:Zw,s=t?t():{};return i(e,n,Mu(r),s)}}var Dg=Object.prototype,tA=Dg.hasOwnProperty,eA=uc(function(n,t){n=Object(n);var e=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&tu(t[0],t[1],i)&&(r=1);++e<r;)for(var s=t[e],o=hx(s),a=-1,c=o.length;++a<c;){var l=o[a],u=n[l];(u===void 0||fx(u,Dg[l])&&!tA.call(n,l))&&(n[l]=s[l])}return n});function kg(n,t,e,r,i,s){return wi(n)&&wi(t)&&(s.set(t,n),hg(n,t,void 0,kg,s),s.delete(t)),n}var nA=dx(function(n,t,e,r){hg(n,t,e,r)}),Bg=uc(function(n){return n.push(void 0,kg),px(nA,void 0,n)}),rA=200;function iA(n,t,e,r){var i=-1,s=mx,o=!0,a=n.length,c=[],l=t.length;if(!a)return c;t.length>=rA&&(s=bx,o=!1,t=new gx(t));t:for(;++i<a;){var u=n[i],f=u;if(u=u!==0?u:0,o&&f===f){for(var h=l;h--;)if(t[h]===f)continue t;c.push(u)}else s(t,f,r)||c.push(u)}return c}var sA=uc(function(n,t){return Ed(n)?iA(n,fg(t,1,Ed,!0)):[]}),oA=Object.prototype,aA=oA.hasOwnProperty,_d=Qw(function(n,t,e){aA.call(n,e)?n[e].push(t):vx(n,e,[t])});function cA(n,t){return n>t}var lA=Object.prototype,uA=lA.hasOwnProperty;function hA(n,t){return n!=null&&uA.call(n,t)}function Ta(n,t){return n!=null&&yx(n,t,hA)}var fA="[object Map]",dA="[object Set]",pA=Object.prototype,gA=pA.hasOwnProperty;function jg(n){if(n==null)return!0;if(Ex(n)&&(Pu(n)||typeof n=="string"||typeof n.splice=="function"||xx(n)||wx(n)||Ax(n)))return!n.length;var t=Sx(n);if(t==fA||t==dA)return!n.size;if(Tx(n))return!Cx(n).length;for(var e in n)if(gA.call(n,e))return!1;return!0}var mA="[object Number]";function Od(n){return typeof n=="number"||_x(n)&&Ox(n)==mA}var bA=Eg("toLowerCase");function vA(n,t,e){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=t(s);if(o!=null&&(a===void 0?o===o&&!us(o):e(o,a)))var a=o,c=s}return c}function yA(n){return n&&n.length?vA(n,Ru,cA):void 0}function EA(n,t){var e=n.length;for(n.sort(t);e--;)n[e]=n[e].value;return n}function xA(n,t){if(n!==t){var e=n!==void 0,r=n===null,i=n===n,s=us(n),o=t!==void 0,a=t===null,c=t===t,l=us(t);if(!a&&!l&&!s&&n>t||s&&o&&c&&!a&&!l||r&&o&&c||!e&&c||!i)return 1;if(!r&&!s&&!l&&n<t||l&&e&&i&&!r&&!s||a&&e&&i||!o&&i||!c)return-1}return 0}function wA(n,t,e){for(var r=-1,i=n.criteria,s=t.criteria,o=i.length,a=e.length;++r<o;){var c=xA(i[r],s[r]);if(c){if(r>=a)return c;var l=e[r];return c*(l=="desc"?-1:1)}}return n.index-t.index}function AA(n,t,e){t.length?t=Nl(t,function(s){return Pu(s)?function(o){return Px(o,s.length===1?s[0]:s)}:s}):t=[Ru];var r=-1;t=Nl(t,Rx(Mu));var i=Mx(n,function(s,o,a){var c=Nl(t,function(l){return l(s)});return{criteria:c,index:++r,value:s}});return EA(i,function(s,o){return wA(s,o,e)})}var Nu=uc(function(n,t){if(n==null)return[];var e=t.length;return e>1&&tu(n,t[0],t[1])?t=[]:e>2&&tu(t[0],t[1],t[2])&&(t=[t[0]]),AA(n,fg(t,1),[])}),SA=4294967295,TA=SA-1,CA=Math.floor,_A=Math.min;function Fg(n,t,e,r){var i=0,s=n==null?0:n.length;if(s===0)return 0;t=e(t);for(var o=t!==t,a=t===null,c=us(t),l=t===void 0;i<s;){var u=CA((i+s)/2),f=e(n[u]),h=f!==void 0,d=f===null,p=f===f,m=us(f);if(o)var b=p;else l?b=p&&h:a?b=p&&h&&!d:c?b=p&&h&&!d&&!m:d||m?b=!1:b=f<t;b?i=u+1:s=u}return _A(s,TA)}var OA=4294967295,MA=OA>>>1;function PA(n,t,e){var r=0,i=n==null?r:n.length;if(typeof t=="number"&&t===t&&i<=MA){for(;r<i;){var s=r+i>>>1,o=n[s];o!==null&&!us(o)&&o<t?r=s+1:i=s}return i}return Fg(n,t,Ru)}function RA(n,t){return PA(n,t)}function NA(n,t,e){return Fg(n,t,Mu(e))}var LA=Ig(function(n,t,e){return n+(e?" ":"")+Fa(t)});function Gg(n){return n&&n.length?Nx(n):[]}class IA{constructor(){yd(this,"sequenceSet",new Set)}getSequence(t){for(let e=1;e<=1e3;e++){let r=t+e;if(!this.sequenceSet.has(r))return this.sequenceSet.add(r),r}return console.error("Failed to generate sequence, tried 1000 but all conflicted, fallback to "+t),t}addSequence(t){this.sequenceSet.add(t)}}function VI(){const n=new IA;return Lx("sequenceGenerator",n),n}let DA=class{constructor(){this.nodes=[],this.edges=[],this.combos=[],this.comboEdges=[],this.hiddenNodes=[],this.hiddenEdges=[],this.hiddenCombos=[],this.vedges=[],this.positions=[],this.destroyed=!1,this.onLayoutEnd=()=>{}}layout(t){return this.init(t),this.execute(!0)}init(t){this.nodes=t.nodes||[],this.edges=t.edges||[],this.combos=t.combos||[],this.comboEdges=t.comboEdges||[],this.hiddenNodes=t.hiddenNodes||[],this.hiddenEdges=t.hiddenEdges||[],this.hiddenCombos=t.hiddenCombos||[],this.vedges=t.vedges||[]}execute(t){}executeWithWorker(){}getDefaultCfg(){return{}}updateCfg(t){t&&Object.assign(this,t)}getType(){return"base"}destroy(){this.nodes=null,this.edges=null,this.combos=null,this.positions=null,this.destroyed=!0}};const kA=n=>typeof n=="string",Md=Array.isArray,Ga=n=>typeof n=="number",zg=n=>n!==null&&typeof n=="object",za=n=>{if(n===null)return n;if(n instanceof Date)return new Date(n.getTime());if(n instanceof Array){const t=[];return n.forEach(e=>{t.push(e)}),t.map(e=>za(e))}if(typeof n=="object"&&Object.keys(n).length){const t=Object.assign({},n);return Object.keys(t).forEach(e=>{t[e]=za(t[e])}),t}return n},Qi=(n,t)=>{const e=n[t];return zg(e)?e.cell:e},Pd=(n,t,e)=>{let r;return e?r=e:Ga(n)?r=()=>n:r=()=>t,r},BA=(n,t)=>{if(n!=="next"&&n!=="prev")return t},Rd=n=>{n.prev.next=n.next,n.next.prev=n.prev,delete n.next,delete n.prev};let jA=class{constructor(){const t={};t.prev=t,t.next=t.prev,this.shortcut=t}dequeue(){const t=this.shortcut,e=t.prev;if(e&&e!==t)return Rd(e),e}enqueue(t){const e=this.shortcut;t.prev&&t.next&&Rd(t),t.next=e.next,e.next.prev=t,e.next=t,t.prev=e}toString(){const t=[],e=this.shortcut;let r=e.prev;for(;r!==e;)t.push(JSON.stringify(r,BA)),r=r==null?void 0:r.prev;return`[${t.join(", ")}]`}};var os;(function(n){n.DEFAULT_EDGE_NAME="\0",n.GRAPH_NODE="\0",n.EDGE_KEY_DELIM=""})(os||(os={}));function Nd(n,t){var e=n.get(t)||0;n.set(t,e+1)}function Ld(n,t){var e=n.get(t);e!==void 0&&(e=e-1,e>0?n.set(t,e):n.delete(t))}function Ug(n,t,e,r){var i=String(t),s=String(e);if(!n&&i>s){var o=i;i=s,s=o}return i+os.EDGE_KEY_DELIM+s+os.EDGE_KEY_DELIM+(r===void 0?os.DEFAULT_EDGE_NAME:r)}function Id(n,t,e,r){var i=String(t),s=String(e),o={v:t,w:e};if(!n&&i>s){var a=o.v;o.v=o.w,o.w=a}return r!==void 0&&(o.name=r),o}function Ll(n,t){return Ug(n,t.v,t.w,t.name)}function Dd(n){return typeof n=="function"}var FA=function(t){return t.nodes().map(function(e){var r=t.node(e),i=t.parent(e),s={id:e,value:r,parent:i};return s.value===void 0&&delete s.value,s.parent===void 0&&delete s.parent,s})},GA=function(t){return t.edges().map(function(e){var r=t.edge(e),i={v:e.v,w:e.w,value:r,name:e.name};return i.name===void 0&&delete i.name,i.value===void 0&&delete i.value,i})},zA=function(t){var e={options:{directed:t.isDirected(),multigraph:t.isMultigraph(),compound:t.isCompound()},nodes:FA(t),edges:GA(t),value:t.graph()};return e.value===void 0&&delete e.value,e},UA=function(t){var e=new Rs(t.options);return t.value!==void 0&&e.setGraph(t.value),t.nodes.forEach(function(r){e.setNode(r.id,r.value),r.parent&&e.setParent(r.id,r.parent)}),t.edges.forEach(function(r){e.setEdge(r.v,r.w,r.value,r.name)}),e};function kd(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),e.push.apply(e,r)}return e}function Bd(n){for(var t=1;t<arguments.length;t++){var e=arguments[t]!=null?arguments[t]:{};t%2?kd(Object(e),!0).forEach(function(r){VA(n,r,e[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):kd(Object(e)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(e,r))})}return n}function VA(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function $A(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function HA(n,t){for(var e=0;e<t.length;e++){var r=t[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}function XA(n,t,e){return t&&HA(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),n}var WA={compound:!1,multigraph:!1,directed:!0},Rs=function(){function n(){var t=this,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};$A(this,n),this.directed=!0,this.multigraph=!1,this.compound=!1,this.GRAPH_NODE=os.GRAPH_NODE,this.label=void 0,this.nodeCountNum=0,this.edgeCountNum=0,this.defaultNodeLabelFn=function(){},this.defaultEdgeLabelFn=function(){},this.parentMap=void 0,this.childrenMap=void 0,this.nodesLabelMap=new Map,this.inEdgesMap=new Map,this.outEdgesMap=new Map,this.predecessorsMap=new Map,this.successorsMap=new Map,this.edgesMap=new Map,this.edgesLabelsMap=new Map,this.isDirected=function(){return t.directed},this.isMultigraph=function(){return t.multigraph},this.isCompound=function(){return t.compound},this.setGraph=function(i){return t.label=i,t},this.graph=function(){return t.label},this.setDefaultNodeLabel=function(i){return Dd(i)?t.defaultNodeLabelFn=i:t.defaultNodeLabelFn=function(){return i},t},this.nodeCount=function(){return t.nodeCountNum},this.node=function(i){return t.nodesLabelMap.get(i)},this.nodes=function(){return Array.from(t.nodesLabelMap.keys())},this.sources=function(){return t.nodes().filter(function(i){var s;return!(!((s=t.inEdgesMap.get(i))===null||s===void 0)&&s.size)})},this.sinks=function(){return t.nodes().filter(function(i){var s;return!(!((s=t.outEdgesMap.get(i))===null||s===void 0)&&s.size)})},this.setNodes=function(i,s){return i.map(function(o){return t.setNode(o,s)}),t},this.hasNode=function(i){return t.nodesLabelMap.has(i)},this.checkCompound=function(){if(!t.isCompound())throw new Error("Cannot construct parent-children relations in a non-compound graph")},this.parent=function(i){if(t.isCompound()){var s,o=(s=t.parentMap)===null||s===void 0?void 0:s.get(i);if(o!==t.GRAPH_NODE)return o}},this.removeFromParentsChildList=function(i){var s=t.parentMap.get(i);t.childrenMap.get(s).delete(i)},this.setParent=function(i,s){var o,a;t.checkCompound();for(var c=s===void 0?t.GRAPH_NODE:s,l=t.parent(c);l;){if(i===l)throw new Error("Setting "+s+" as parent of "+i+" would create a cycle");l=t.parent(l)}s&&t.setNode(s),t.setNode(i),t.removeFromParentsChildList(i),(o=t.parentMap)===null||o===void 0||o.set(i,c);var u=t.childrenMap.get(c);return u.set(i,!0),(a=t.childrenMap)===null||a===void 0||a.set(c,u),t},this.children=function(i){var s=i===void 0?t.GRAPH_NODE:i;if(t.isCompound()){var o,a=(o=t.childrenMap)===null||o===void 0?void 0:o.get(s);return a?Array.from(a.keys()):void 0}if(s===t.GRAPH_NODE)return t.nodes();if(i&&t.hasNode(i))return[]},this.predecessors=function(i){var s=t.predecessorsMap.get(i);return s?Array.from(s.keys()):void 0},this.successors=function(i){var s=t.successorsMap.get(i);return s?Array.from(s.keys()):void 0},this.neighbors=function(i){var s;if(t.hasNode(i))return Array.from(new Set((s=t.predecessors(i))===null||s===void 0?void 0:s.concat(t.successors(i))))},this.isLeaf=function(i){var s;if(t.isDirected()){var o;return!(!((o=t.successors(i))===null||o===void 0)&&o.length)}return!(!((s=t.neighbors(i))===null||s===void 0)&&s.length)},this.filterNodes=function(i){var s=t.directed,o=t.multigraph,a=t.compound,c=new n({directed:s,multigraph:o,compound:a});if(c.setGraph(t.graph()),t.nodes().forEach(function(u){i(u)&&c.setNode(u,t.node(u))}),t.edges().forEach(function(u){c.hasNode(u.v)&&c.hasNode(u.w)&&c.setEdgeObj(u,t.edge(u))}),a){var l=function(f){for(var h=t.parent(f);h!==void 0&&!c.hasNode(h);)h=t.parent(h);return h};c.nodes().forEach(function(u){c.setParent(u,l(u))})}return c},this.setDefaultEdgeLabel=function(i){return Dd(i)?t.defaultEdgeLabelFn=i:t.defaultEdgeLabelFn=function(){return i},t},this.edgeCount=function(){return t.edgeCountNum},this.setEdgeObj=function(i,s){return t.setEdge(i.v,i.w,s,i.name)},this.setPath=function(i,s){return i.reduce(function(o,a){return t.setEdge(o,a,s),a}),t},this.edgeFromArgs=function(i,s,o){return t.edge({v:i,w:s,name:o})},this.edge=function(i){return t.edgesLabelsMap.get(Ll(t.isDirected(),i))},this.hasEdge=function(i,s,o){return t.edgesLabelsMap.has(Ll(t.isDirected(),{v:i,w:s,name:o}))},this.removeEdgeObj=function(i){var s=i.v,o=i.w,a=i.name;return t.removeEdge(s,o,a)},this.edges=function(){return Array.from(t.edgesMap.values())},this.inEdges=function(i,s){var o=t.inEdgesMap.get(i);if(o)return Array.from(o.values()).filter(function(a){return!s||a.v===s})},this.outEdges=function(i,s){var o=t.outEdgesMap.get(i);if(o)return Array.from(o.values()).filter(function(a){return!s||a.w===s})},this.nodeEdges=function(i,s){var o;if(t.hasNode(i))return(o=t.inEdges(i,s))===null||o===void 0?void 0:o.concat(t.outEdges(i,s))},this.toJSON=function(){return zA(t)},this.nodeInDegree=function(i){var s=t.inEdgesMap.get(i);return s?s.size:0},this.nodeOutDegree=function(i){var s=t.outEdgesMap.get(i);return s?s.size:0},this.nodeDegree=function(i){return t.nodeInDegree(i)+t.nodeOutDegree(i)},this.source=function(i){return i.v},this.target=function(i){return i.w};var r=Bd(Bd({},WA),e);this.compound=r.compound,this.directed=r.directed,this.multigraph=r.multigraph,this.compound&&(this.parentMap=new Map,this.childrenMap=new Map)}return XA(n,[{key:"setNode",value:function(e,r){var i=this.nodesLabelMap,s=this.defaultNodeLabelFn,o=this.isCompound,a=this.parentMap,c=this.childrenMap,l=this.inEdgesMap,u=this.outEdgesMap,f=this.predecessorsMap,h=this.successorsMap;if(i.has(e))return r!==void 0&&i.set(e,r),this;if(i.set(e,r||s(e)),o()){var d;a==null||a.set(e,this.GRAPH_NODE),c==null||c.set(e,new Map),c!=null&&c.has(this.GRAPH_NODE)||c==null||c.set(this.GRAPH_NODE,new Map),c==null||(d=c.get(this.GRAPH_NODE))===null||d===void 0||d.set(e,!0)}return[l,u,f,h].forEach(function(p){return p.set(e,new Map)}),this.nodeCountNum+=1,this}},{key:"removeNode",value:function(e){var r=this;if(this.hasNode(e)){var i=function(b){r.removeEdge(b.v,b.w,b.name)},s=this.inEdgesMap,o=this.outEdgesMap,a=this.predecessorsMap,c=this.successorsMap,l=this.nodesLabelMap;if(this.isCompound()){var u,f,h;this.removeFromParentsChildList(e),(u=this.parentMap)===null||u===void 0||u.delete(e),(f=this.children(e))===null||f===void 0||f.forEach(function(m){return r.setParent(m)}),(h=this.childrenMap)===null||h===void 0||h.delete(e)}var d=s.get(e),p=o.get(e);Array.from(d.values()).forEach(function(m){return i(m)}),Array.from(p.values()).forEach(function(m){return i(m)}),l.delete(e),s.delete(e),o.delete(e),a.delete(e),c.delete(e),this.nodeCountNum-=1}return this}},{key:"setEdge",value:function(e,r,i,s){var o,a,c=Id(this.isDirected(),e,r,s),l=Ll(this.isDirected(),c),u=c.v,f=c.w;if(this.edgesLabelsMap.has(l))return this.edgesLabelsMap.set(l,i),this;if(s!==void 0&&!this.isMultigraph())throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(u),this.setNode(f),this.edgesLabelsMap.set(l,i||this.defaultEdgeLabelFn(u,f,s)),Object.freeze(c),this.edgesMap.set(l,c);var h=this.predecessorsMap.get(f),d=this.successorsMap.get(u);return Nd(h,u),Nd(d,f),(o=this.inEdgesMap.get(f))===null||o===void 0||o.set(l,c),(a=this.outEdgesMap.get(u))===null||a===void 0||a.set(l,c),this.edgeCountNum+=1,this}},{key:"removeEdge",value:function(e,r,i){var s=Ug(this.isDirected(),e,r,i),o=this.edgesMap.get(s);if(o){var a=Id(this.isDirected(),e,r,i),c=a.v,l=a.w;this.edgesLabelsMap.delete(s),this.edgesMap.delete(s);var u=this.predecessorsMap.get(l),f=this.successorsMap.get(c);Ld(u,c),Ld(f,l),this.inEdgesMap.get(l).delete(s),this.outEdgesMap.get(c).delete(s),this.edgeCountNum-=1}return this}}]),n}();Rs.fromJSON=UA;function qA(n,t,e){return Object.defineProperty(n,"prototype",{writable:!1}),n}function YA(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}var Vg=qA(function n(){var t=this;YA(this,n),this.arr=[],this.keyIndice=new Map,this.size=function(){return t.arr.length},this.keys=function(){return t.arr.map(function(e){return e.key})},this.has=function(e){return t.keyIndice.has(e)},this.priority=function(e){var r=t.keyIndice.get(e);if(r!==void 0)return t.arr[r].priority},this.swap=function(e,r){var i=t.arr,s=t.keyIndice,o=[i[e],i[r]],a=o[0],c=o[1];i[e]=c,i[r]=a,s.set(a.key,r),s.set(c.key,e)},this.innerDecrease=function(e){for(var r=t.arr,i=r[e].priority,s,o=e;o!==0;){var a;if(s=o>>1,((a=r[s])===null||a===void 0?void 0:a.priority)<i)break;t.swap(o,s),o=s}},this.heapify=function(e){var r=t.arr,i=e<<1,s=i+1,o=e;i<r.length&&(o=r[i].priority<r[o].priority?i:o,s<r.length&&(o=r[s].priority<r[o].priority?s:o),o!==e&&(t.swap(e,o),t.heapify(o)))},this.min=function(){if(t.size()===0)throw new Error("Queue underflow");return t.arr[0].key},this.add=function(e,r){var i=t.keyIndice,s=t.arr;if(!i.has(e)){var o=s.length;return i.set(e,o),s.push({key:e,priority:r}),t.innerDecrease(o),!0}return!1},this.removeMin=function(){t.swap(0,t.arr.length-1);var e=t.arr.pop();return t.keyIndice.delete(e.key),t.heapify(0),e.key},this.decrease=function(e,r){if(!t.has(e))throw new Error("There's no key named ".concat(e));var i=t.keyIndice.get(e);if(r>t.arr[i].priority)throw new Error("New priority is greater than current priority.Key: ".concat(e," Old: + ").concat(t.arr[i].priority," New: ").concat(r));t.arr[i].priority=r,t.innerDecrease(i)}}),JA=function(t,e){var r=new Rs,i=new Map,s=new Vg,o;function a(u){var f=u.v===o?u.w:u.v,h=s.priority(f);if(h!==void 0){var d=e(u);d<h&&(i.set(f,o),s.decrease(f,d))}}if(t.nodeCount()===0)return r;t.nodes().forEach(function(u){s.add(u,Number.POSITIVE_INFINITY),r.setNode(u)}),s.decrease(t.nodes()[0],0);for(var c=!1;s.size()>0;){var l;if(o=s.removeMin(),i.has(o))r.setEdge(o,i.get(o));else{if(c)throw new Error("Input graph is not connected: "+t.graph());c=!0}(l=t.nodeEdges(o))===null||l===void 0||l.forEach(a)}return r},KA=function(t){var e=new Set,r=[],i=t.nodes();return i.forEach(function(s){for(var o=[],a=[s];a.length>0;){var c=a.pop();if(!e.has(c)){var l,u;e.add(c),o.push(c),(l=t.successors(c))===null||l===void 0||l.forEach(function(f){return a.push(f)}),(u=t.predecessors(c))===null||u===void 0||u.forEach(function(f){return a.push(f)})}}o.length&&r.push(o)}),r},ZA=function n(t,e,r,i,s,o){i.includes(e)||(i.push(e),r||o.push(e),s(e).forEach(function(a){return n(t,a,r,i,s,o)}),r&&o.push(e))},Lu=function(t,e,r){var i=Array.isArray(e)?e:[e],s=function(l){return t.isDirected()?t.successors(l):t.neighbors(l)},o=[],a=[];return i.forEach(function(c){if(t.hasNode(c))ZA(t,c,r==="post",a,s,o);else throw new Error("Graph does not have node: "+c)}),o};function QA(n,t){return rS(n)||nS(n,t)||eS(n,t)||tS()}function tS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eS(n,t){if(n){if(typeof n=="string")return jd(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if(e==="Object"&&n.constructor&&(e=n.constructor.name),e==="Map"||e==="Set")return Array.from(n);if(e==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return jd(n,t)}}function jd(n,t){(t==null||t>n.length)&&(t=n.length);for(var e=0,r=new Array(t);e<t;e++)r[e]=n[e];return r}function nS(n,t){var e=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(e!=null){var r=[],i=!0,s=!1,o,a;try{for(e=e.call(n);!(i=(o=e.next()).done)&&(r.push(o.value),!(t&&r.length===t));i=!0);}catch(c){s=!0,a=c}finally{try{!i&&e.return!=null&&e.return()}finally{if(s)throw a}}return r}}function rS(n){if(Array.isArray(n))return n}var iS=function(){return 1},$g=function(t,e,r,i){return sS(t,e,r||iS,i||function(s){return t.outEdges(s)})},sS=function(t,e,r,i){var s=new Map,o=new Vg,a,c,l=function(h){var d=h.v!==a?h.v:h.w,p=s.get(d),m=r(h),b=c.distance+m;if(m<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+h+" Weight: "+m);b<p.distance&&(p.distance=b,p.predecessor=a,o.decrease(d,b))};for(t.nodes().forEach(function(f){var h=f===e?0:Number.POSITIVE_INFINITY;s.set(f,{distance:h}),o.add(f,h)});o.size()>0&&(a=o.removeMin(),c=s.get(a),!(c&&c.distance===Number.POSITIVE_INFINITY));)i(a).forEach(l);var u={};return Array.from(s.entries()).forEach(function(f){var h=QA(f,2),d=h[0],p=h[1];return u[String(d)]=p,u}),u},oS=function(t,e,r){var i={};return t.nodes().forEach(function(s){return i[String(s)]=$g(t,s,e,r),i}),i},Hg=function(t){var e=0,r=[],i=new Map,s=[];function o(a){var c,l={onStack:!0,lowlink:e,index:e};if(i.set(a,l),e+=1,r.push(a),(c=t.successors(a))===null||c===void 0||c.forEach(function(d){var p;if(i.has(d)){if(!((p=i.get(d))===null||p===void 0)&&p.onStack){var b=i.get(d);l.lowlink=Math.min(l.lowlink,b.index)}}else{o(d);var m=i.get(d);l.lowlink=Math.min(l.lowlink,m.lowlink)}}),l.lowlink===l.index){var u=[],f;do{f=r.pop();var h=i.get(f);h.onStack=!1,u.push(f)}while(a!==f);s.push(u)}}return t.nodes().forEach(function(a){i.has(a)||o(a)}),s},aS=function(t){return Hg(t).filter(function(e){return e.length>1||e.length===1&&t.hasEdge(e[0],e[0])})};function iu(n){"@babel/helpers - typeof";return iu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iu(n)}function cS(n,t,e){return Object.defineProperty(n,"prototype",{writable:!1}),n}function lS(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}function uS(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),t&&Eo(n,t)}function hS(n){var t=Xg();return function(){var r=xo(n),i;if(t){var s=xo(this).constructor;i=Reflect.construct(r,arguments,s)}else i=r.apply(this,arguments);return fS(this,i)}}function fS(n,t){if(t&&(iu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return dS(n)}function dS(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function su(n){var t=typeof Map=="function"?new Map:void 0;return su=function(r){if(r===null||!pS(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(r))return t.get(r);t.set(r,i)}function i(){return Da(r,arguments,xo(this).constructor)}return i.prototype=Object.create(r.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),Eo(i,r)},su(n)}function Da(n,t,e){return Xg()?Da=Reflect.construct:Da=function(i,s,o){var a=[null];a.push.apply(a,s);var c=Function.bind.apply(i,a),l=new c;return o&&Eo(l,o.prototype),l},Da.apply(null,arguments)}function Xg(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function pS(n){return Function.toString.call(n).indexOf("[native code]")!==-1}function Eo(n,t){return Eo=Object.setPrototypeOf||function(r,i){return r.__proto__=i,r},Eo(n,t)}function xo(n){return xo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},xo(n)}var ou=function(n){uS(e,n);var t=hS(e);function e(){return lS(this,e),t.apply(this,arguments)}return cS(e)}(su(Error));function Wg(n){var t=new Set,e=new Set,r=[];function i(s){if(e.has(s))throw new ou;if(!t.has(s)){var o;e.add(s),t.add(s),(o=n.predecessors(s))===null||o===void 0||o.forEach(i),e.delete(s),r.push(s)}}if(n.sinks().forEach(i),t.size!==n.nodeCount())throw new ou;return r}var gS=function(t){try{Wg(t)}catch(e){if(e instanceof ou)return!1;throw e}return!0},mS=function(t,e){return Lu(t,e,"post")},bS=function(t,e){return Lu(t,e,"pre")},vS=function(){return 1};function yS(n,t,e){return ES(n,t||vS,e||function(r){return n.outEdges(r)})}function ES(n,t,e){var r={},i=n.nodes();return i.forEach(function(s){var o=String(s);r[o]={},r[o][o]={distance:0},i.forEach(function(a){s!==a&&(r[o][String(a)]={distance:Number.POSITIVE_INFINITY})}),e(s).forEach(function(a){var c=a.v===s?a.w:a.v,l=t(a);r[o][String(c)]={distance:l,predecessor:s}})}),i.forEach(function(s){var o=String(s),a=r[o];i.forEach(function(c){var l=String(c),u=r[l];i.forEach(function(f){var h=String(f),d=u[o],p=a[h],m=u[h],b=d.distance+p.distance;b<m.distance&&(m.distance=b,m.predecessor=p.predecessor)})})}),r}const xS=Object.freeze(Object.defineProperty({__proto__:null,components:KA,dfs:Lu,dijkstra:$g,dijkstraAll:oS,findCycles:aS,floydWarshall:yS,isAcyclic:gS,postorder:mS,preorder:bS,prim:JA,tarjan:Hg,topsort:Wg},Symbol.toStringTag,{value:"Module"}));class wS extends jA{}class AS extends Rs{}const SS=()=>1,TS=(n,t)=>{var e;if(n.nodeCount()<=1)return[];const r=_S(n,t||SS);return(e=CS(r.graph,r.buckets,r.zeroIdx).map(s=>n.outEdges(s.v,s.w)))===null||e===void 0?void 0:e.flat()},CS=(n,t,e)=>{let r=[];const i=t[t.length-1],s=t[0];let o;for(;n.nodeCount();){for(;o=s.dequeue();)Il(n,t,e,o);for(;o=i.dequeue();)Il(n,t,e,o);if(n.nodeCount()){for(let a=t.length-2;a>0;--a)if(o=t[a].dequeue(),o){r=r.concat(Il(n,t,e,o,!0));break}}}return r},Il=(n,t,e,r,i)=>{var s,o;const a=[];return(s=n.inEdges(r.v))===null||s===void 0||s.forEach(c=>{const l=n.edge(c),u=n.node(c.v);i&&a.push({v:c.v,w:c.w,in:0,out:0}),u.out===void 0&&(u.out=0),u.out-=l,au(t,e,u)}),(o=n.outEdges(r.v))===null||o===void 0||o.forEach(c=>{const l=n.edge(c),u=c.w,f=n.node(u);f.in===void 0&&(f.in=0),f.in-=l,au(t,e,f)}),n.removeNode(r.v),i?a:void 0},_S=(n,t)=>{const e=new AS;let r=0,i=0;n.nodes().forEach(c=>{e.setNode(c,{v:c,in:0,out:0})}),n.edges().forEach(c=>{const l=e.edge(c)||0,u=(t==null?void 0:t(c))||1,f=l+u;e.setEdge(c.v,c.w,f),i=Math.max(i,e.node(c.v).out+=u),r=Math.max(r,e.node(c.w).in+=u)});const s=[],o=i+r+3;for(let c=0;c<o;c++)s.push(new wS);const a=r+1;return e.nodes().forEach(c=>{au(s,a,e.node(c))}),{buckets:s,zeroIdx:a,graph:e}},au=(n,t,e)=>{e.out?e.in?n[e.out-e.in+t].enqueue(e):n[n.length-1].enqueue(e):n[0].enqueue(e)},OS=n=>{const t=r=>i=>{var s;return((s=r.edge(i))===null||s===void 0?void 0:s.weight)||1},e=n.graph().acyclicer==="greedy"?TS(n,t(n)):MS(n);e==null||e.forEach(r=>{const i=n.edge(r);n.removeEdgeObj(r),i.forwardName=r.name,i.reversed=!0,n.setEdge(r.w,r.v,i,`rev-${Math.random()}`)})},MS=n=>{const t=[],e={},r={},i=s=>{var o;r[s]||(r[s]=!0,e[s]=!0,(o=n.outEdges(s))===null||o===void 0||o.forEach(a=>{e[a.w]?t.push(a):i(a.w)}),delete e[s])};return n.nodes().forEach(i),t},PS=n=>{n.edges().forEach(t=>{const e=n.edge(t);if(e.reversed){n.removeEdgeObj(t);const r=e.forwardName;delete e.reversed,delete e.forwardName,n.setEdge(t.w,t.v,e,r)}})},Fd={run:OS,undo:PS};let Or=class extends Rs{};const RS=(n,t)=>Number(n)-Number(t),Ns=(n,t,e,r)=>{let i;do i=`${r}${Math.random()}`;while(n.hasNode(i));return e.dummy=t,n.setNode(i,e),i},NS=n=>{const t=new Or().setGraph(n.graph());return n.nodes().forEach(e=>{t.setNode(e,n.node(e))}),n.edges().forEach(e=>{const r=t.edgeFromArgs(e.v,e.w)||{weight:0,minlen:1},i=n.edge(e);t.setEdge(e.v,e.w,{weight:r.weight+i.weight,minlen:Math.max(r.minlen,i.minlen)})}),t},qg=n=>{const t=new Or({multigraph:n.isMultigraph()}).setGraph(n.graph());return n.nodes().forEach(e=>{var r;!((r=n.children(e))===null||r===void 0)&&r.length||t.setNode(e,n.node(e))}),n.edges().forEach(e=>{t.setEdgeObj(e,n.edge(e))}),t},LS=(n,t)=>n==null?void 0:n.reduce((e,r,i)=>(e[r]=t[i],e),{}),Gd=(n,t)=>{const e=Number(n.x),r=Number(n.y),i=Number(t.x)-e,s=Number(t.y)-r;let o=Number(n.width)/2,a=Number(n.height)/2;if(!i&&!s)return{x:0,y:0};let c,l;return Math.abs(s)*o>Math.abs(i)*a?(s<0&&(a=-a),c=a*i/s,l=a):(i<0&&(o=-o),c=o,l=o*s/i),{x:e+c,y:r+l}},wo=n=>{const t=[],e=Yg(n)+1;for(let r=0;r<e;r++)t.push([]);n.nodes().forEach(r=>{const i=n.node(r);if(!i)return;const s=i.rank;s!==void 0&&t[s]&&t[s].push(r)});for(let r=0;r<e;r++)t[r]=t[r].sort((i,s)=>{var o,a;return RS((o=n.node(i))===null||o===void 0?void 0:o.order,(a=n.node(s))===null||a===void 0?void 0:a.order)});return t},IS=n=>{const t=n.nodes().filter(r=>{var i;return((i=n.node(r))===null||i===void 0?void 0:i.rank)!==void 0}).map(r=>n.node(r).rank),e=Math.min(...t);n.nodes().forEach(r=>{const i=n.node(r);i.hasOwnProperty("rank")&&e!==1/0&&(i.rank-=e)})},DS=n=>{const t=n.nodes(),e=t.filter(a=>{var c;return((c=n.node(a))===null||c===void 0?void 0:c.rank)!==void 0}).map(a=>n.node(a).rank),r=Math.min(...e),i=[];t.forEach(a=>{var c;const l=(((c=n.node(a))===null||c===void 0?void 0:c.rank)||0)-r;i[l]||(i[l]=[]),i[l].push(a)});let s=0;const o=n.graph().nodeRankFactor||0;for(let a=0;a<i.length;a++){const c=i[a];c===void 0?a%o!==0&&(s-=1):s&&(c==null||c.forEach(l=>{const u=n.node(l);u&&(u.rank=u.rank||0,u.rank+=s)}))}},zd=(n,t,e,r)=>{const i={width:0,height:0};return Ga(e)&&Ga(r)&&(i.rank=e,i.order=r),Ns(n,"border",i,t)},Yg=n=>{let t;return n.nodes().forEach(e=>{var r;const i=(r=n.node(e))===null||r===void 0?void 0:r.rank;i!==void 0&&(t===void 0||i>t)&&(t=i)}),t||(t=0),t},kS=(n,t)=>{const e={lhs:[],rhs:[]};return n==null||n.forEach(r=>{t(r)?e.lhs.push(r):e.rhs.push(r)}),e},Jg=(n,t)=>{const e=Date.now();try{return t()}finally{console.log(`${n} time: ${Date.now()-e}ms`)}},Kg=(n,t)=>t(),Iu=(n,t)=>n.reduce((e,r)=>{const i=t(e),s=t(r);return i>s?r:e}),BS=n=>{n.graph().dummyChains=[],n.edges().forEach(t=>jS(n,t))},jS=(n,t)=>{let e=t.v,r=n.node(e).rank;const i=t.w,s=n.node(i).rank,o=t.name,a=n.edge(t),c=a.labelRank;if(s===r+1)return;n.removeEdgeObj(t);const l=n.graph();let u,f,h;for(h=0,++r;r<s;++h,++r)a.points=[],f={edgeLabel:a,width:0,height:0,edgeObj:t,rank:r},u=Ns(n,"edge",f,"_d"),r===c&&(f.width=a.width,f.height=a.height,f.dummy="edge-label",f.labelpos=a.labelpos),n.setEdge(e,u,{weight:a.weight},o),h===0&&(l.dummyChains||(l.dummyChains=[]),l.dummyChains.push(u)),e=u;n.setEdge(e,i,{weight:a.weight},o)},FS=n=>{var t;(t=n.graph().dummyChains)===null||t===void 0||t.forEach(e=>{let r=n.node(e);const i=r.edgeLabel;let s;r.edgeObj&&n.setEdgeObj(r.edgeObj,i);let o=e;for(;r.dummy;)s=n.successors(o)[0],n.removeNode(o),i.points.push({x:r.x,y:r.y}),r.dummy==="edge-label"&&(i.x=r.x,i.y=r.y,i.width=r.width,i.height=r.height),o=s,r=n.node(o)})},Ud={run:BS,undo:FS},Zg=n=>{var t;const e={},r=i=>{var s;const o=n.node(i);if(!o)return 0;if(e[i])return o.rank;e[i]=!0;let a;return(s=n.outEdges(i))===null||s===void 0||s.forEach(c=>{const l=r(c.w),u=n.edge(c).minlen,f=l-u;f&&(a===void 0||f<a)&&(a=f)}),a||(a=0),o.rank=a,a};(t=n.sources())===null||t===void 0||t.forEach(i=>r(i))},GS=n=>{var t;const e={};let r;const i=a=>{var c;const l=n.node(a);if(!l)return 0;if(e[a])return l.rank;e[a]=!0;let u;return(c=n.outEdges(a))===null||c===void 0||c.forEach(f=>{const h=i(f.w),d=n.edge(f).minlen,p=h-d;p&&(u===void 0||p<u)&&(u=p)}),u||(u=0),(r===void 0||u<r)&&(r=u),l.rank=u,u};(t=n.sources())===null||t===void 0||t.forEach(a=>{n.node(a)&&i(a)}),r===void 0&&(r=0);const s={},o=(a,c)=>{var l;const u=n.node(a),f=isNaN(u.layer)?c:u.layer;(u.rank===void 0||u.rank<f)&&(u.rank=f),!s[a]&&(s[a]=!0,(l=n.outEdges(a))===null||l===void 0||l.map(h=>{o(h.w,f+n.edge(h).minlen)}))};n.nodes().forEach(a=>{const c=n.node(a);c&&(isNaN(c.layer)?c.rank-=r:o(a,c.layer))})},Xr=(n,t)=>n.node(t.w).rank-n.node(t.v).rank-n.edge(t).minlen,zS=n=>{const t=new Or({directed:!1}),e=n.nodes()[0],r=n.nodeCount();t.setNode(e,{});let i,s;for(;US(t,n)<r;)i=Qg(t,n),s=t.hasNode(i.v)?Xr(n,i):-Xr(n,i),tm(t,n,s);return t},US=(n,t)=>{const e=r=>{t.nodeEdges(r).forEach(i=>{const s=i.v,o=r===s?i.w:s;!n.hasNode(o)&&!Xr(t,i)&&(n.setNode(o,{}),n.setEdge(r,o,{}),e(o))})};return n.nodes().forEach(e),n.nodeCount()},VS=n=>{const t=new Or({directed:!1}),e=n.nodes()[0],r=n.nodes().filter(o=>!!n.node(o)).length;t.setNode(e,{});let i,s;for(;$S(t,n)<r;)i=Qg(t,n),s=t.hasNode(i.v)?Xr(n,i):-Xr(n,i),tm(t,n,s);return t},$S=(n,t)=>{const e=r=>{var i;(i=t.nodeEdges(r))===null||i===void 0||i.forEach(s=>{const o=s.v,a=r===o?s.w:o;!n.hasNode(a)&&(t.node(a).layer!==void 0||!Xr(t,s))&&(n.setNode(a,{}),n.setEdge(r,a,{}),e(a))})};return n.nodes().forEach(e),n.nodeCount()},Qg=(n,t)=>Iu(t.edges(),e=>n.hasNode(e.v)!==n.hasNode(e.w)?Xr(t,e):1/0),tm=(n,t,e)=>{n.nodes().forEach(r=>{t.node(r).rank||(t.node(r).rank=0),t.node(r).rank+=e})},{preorder:HS,postorder:XS}=xS,WS=n=>{const t=NS(n);Zg(t);const e=zS(t);nm(e),em(e,t);let r,i;for(;r=JS(e);)i=KS(e,t,r),ZS(e,t,r,i)},em=(n,t)=>{let e=XS(n,n.nodes());e=e==null?void 0:e.slice(0,(e==null?void 0:e.length)-1),e==null||e.forEach(r=>{qS(n,t,r)})},qS=(n,t,e)=>{const i=n.node(e).parent;n.edgeFromArgs(e,i).cutvalue=YS(n,t,e)},YS=(n,t,e)=>{var r;const s=n.node(e).parent;let o=!0,a=t.edgeFromArgs(e,s),c=0;return a||(o=!1,a=t.edgeFromArgs(s,e)),c=a.weight,(r=t.nodeEdges(e))===null||r===void 0||r.forEach(l=>{const u=l.v===e,f=u?l.w:l.v;if(f!==s){const h=u===o,d=t.edge(l).weight;if(c+=h?d:-d,t1(n,e,f)){const p=n.edgeFromArgs(e,f).cutvalue;c+=h?-p:p}}}),c},nm=(n,t=n.nodes()[0])=>{rm(n,{},1,t)},rm=(n,t,e,r,i)=>{var s;const o=e;let a=e;const c=n.node(r);return t[r]=!0,(s=n.neighbors(r))===null||s===void 0||s.forEach(l=>{t[l]||(a=rm(n,t,a,l,r))}),c.low=o,c.lim=a++,i?c.parent=i:delete c.parent,a},JS=n=>n.edges().find(t=>n.edge(t).cutvalue<0),KS=(n,t,e)=>{let r=e.v,i=e.w;t.hasEdge(r,i)||(r=e.w,i=e.v);const s=n.node(r),o=n.node(i);let a=s,c=!1;s.lim>o.lim&&(a=o,c=!0);const l=t.edges().filter(u=>c===Vd(n,n.node(u.v),a)&&c!==Vd(n,n.node(u.w),a));return Iu(l,u=>Xr(t,u))},ZS=(n,t,e,r)=>{const i=e.v,s=e.w;n.removeEdge(i,s),n.setEdge(r.v,r.w,{}),nm(n),em(n,t),QS(n,t)},QS=(n,t)=>{const e=n.nodes().find(i=>{var s;return!(!((s=t.node(i))===null||s===void 0)&&s.parent)});let r=HS(n,e);r=r==null?void 0:r.slice(1),r==null||r.forEach(i=>{const s=n.node(i).parent;let o=t.edgeFromArgs(i,s),a=!1;o||(o=t.edgeFromArgs(s,i),a=!0),t.node(i).rank=t.node(s).rank+(a?o.minlen:-o.minlen)})},t1=(n,t,e)=>n.hasEdge(t,e),Vd=(n,t,e)=>e.low<=t.lim&&t.lim<=e.lim,e1=n=>{switch(n.graph().ranker){case"network-simplex":r1(n);break;case"tight-tree":$d(n);break;case"longest-path":n1(n);break;default:$d(n)}},n1=Zg,$d=n=>{GS(n),VS(n)},r1=n=>{WS(n)},i1=n=>{var t;const e={};let r=0;const i=s=>{var o;const a=r;(o=n.children(s))===null||o===void 0||o.forEach(i),e[s]={low:a,lim:r++}};return(t=n.children())===null||t===void 0||t.forEach(i),e},s1=(n,t,e,r)=>{const i=[],s=[],o=Math.min(t[e].low,t[r].low),a=Math.max(t[e].lim,t[r].lim);let c,l;c=e;do c=n.parent(c),i.push(c);while(c&&(t[c].low>o||a>t[c].lim));for(l=c,c=r;c&&c!==l;)s.push(c),c=n.parent(c);return{lca:l,path:i.concat(s.reverse())}},o1=n=>{var t;const e=i1(n);(t=n.graph().dummyChains)===null||t===void 0||t.forEach(r=>{var i,s;let o=r,a=n.node(o);const c=a.edgeObj;if(!c)return;const l=s1(n,e,c.v,c.w),u=l.path,f=l.lca;let h=0,d=u[h],p=!0;for(;o!==c.w;){if(a=n.node(o),p){for(;d!==f&&((i=n.node(d))===null||i===void 0?void 0:i.maxRank)<a.rank;)h++,d=u[h];d===f&&(p=!1)}if(!p){for(;h<u.length-1&&((s=n.node(u[h+1]))===null||s===void 0?void 0:s.minRank)<=a.rank;)h++;d=u[h]}n.setParent(o,d),o=n.successors(o)[0]}})},a1=n=>{var t;const e=Ns(n,"root",{},"_root"),r=c1(n);let i=Math.max(...Object.values(r));Math.abs(i)===1/0&&(i=1);const s=i-1,o=2*s+1;n.graph().nestingRoot=e,n.edges().forEach(c=>{n.edge(c).minlen*=o});const a=l1(n)+1;(t=n.children())===null||t===void 0||t.forEach(c=>{im(n,e,o,a,s,r,c)}),n.graph().nodeRankFactor=o},im=(n,t,e,r,i,s,o)=>{const a=n.children(o);if(!(a!=null&&a.length)){o!==t&&n.setEdge(t,o,{weight:0,minlen:e});return}const c=zd(n,"_bt"),l=zd(n,"_bb"),u=n.node(o);n.setParent(c,o),u.borderTop=c,n.setParent(l,o),u.borderBottom=l,a==null||a.forEach(f=>{im(n,t,e,r,i,s,f);const h=n.node(f),d=h.borderTop?h.borderTop:f,p=h.borderBottom?h.borderBottom:f,m=h.borderTop?r:2*r,b=d!==p?1:i-s[o]+1;n.setEdge(c,d,{minlen:b,weight:m,nestingEdge:!0}),n.setEdge(p,l,{minlen:b,weight:m,nestingEdge:!0})}),n.parent(o)||n.setEdge(t,c,{weight:0,minlen:i+s[o]})},c1=n=>{var t;const e={},r=(i,s)=>{const o=n.children(i);o==null||o.forEach(a=>r(a,s+1)),e[i]=s};return(t=n.children())===null||t===void 0||t.forEach(i=>r(i,1)),e},l1=n=>{let t=0;return n.edges().forEach(e=>{t+=n.edge(e).weight}),t},u1=n=>{const t=n.graph();t.nestingRoot&&n.removeNode(t.nestingRoot),delete t.nestingRoot,n.edges().forEach(e=>{n.edge(e).nestingEdge&&n.removeEdgeObj(e)})},Hd={run:a1,cleanup:u1},h1=n=>{var t;const e=r=>{const i=n.children(r),s=n.node(r);if(i!=null&&i.length&&i.forEach(o=>e(o)),s.hasOwnProperty("minRank")){s.borderLeft=[],s.borderRight=[];for(let o=s.minRank,a=s.maxRank+1;o<a;o+=1)Xd(n,"borderLeft","_bl",r,s,o),Xd(n,"borderRight","_br",r,s,o)}};(t=n.children())===null||t===void 0||t.forEach(r=>e(r))},Xd=(n,t,e,r,i,s)=>{const o={rank:s,borderType:t,width:0,height:0},a=i[t][s-1],c=Ns(n,"border",o,e);i[t][s]=c,n.setParent(c,r),a&&n.setEdge(a,c,{weight:1})},f1=n=>{var t;const e=(t=n.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(e==="lr"||e==="rl")&&sm(n)},d1=n=>{var t;const e=(t=n.graph().rankdir)===null||t===void 0?void 0:t.toLowerCase();(e==="bt"||e==="rl")&&p1(n),(e==="lr"||e==="rl")&&(g1(n),sm(n))},sm=n=>{n.nodes().forEach(t=>{Wd(n.node(t))}),n.edges().forEach(t=>{Wd(n.edge(t))})},Wd=n=>{const t=n.width;n.width=n.height,n.height=t},p1=n=>{n.nodes().forEach(t=>{Dl(n.node(t))}),n.edges().forEach(t=>{var e;const r=n.edge(t);(e=r.points)===null||e===void 0||e.forEach(i=>Dl(i)),r.hasOwnProperty("y")&&Dl(r)})},Dl=n=>{n!=null&&n.y&&(n.y=-n.y)},g1=n=>{n.nodes().forEach(t=>{kl(n.node(t))}),n.edges().forEach(t=>{var e;const r=n.edge(t);(e=r.points)===null||e===void 0||e.forEach(i=>kl(i)),r.hasOwnProperty("x")&&kl(r)})},kl=n=>{const t=n.x;n.x=n.y,n.y=t},qd={adjust:f1,undo:d1};var m1={}.toString,b1=function(n,t){return m1.call(n)==="[object "+t+"]"};const om=function(n){return Array.isArray?Array.isArray(n):b1(n,"Array")},cu=function(n){if(om(n))return n.reduce(function(t,e){return Math.max(t,e)},n[0])},Yd=function(n){if(om(n))return n.reduce(function(t,e){return Math.min(t,e)},n[0])},Jd=n=>{const t={},e=n.nodes().filter(u=>{var f;return!(!((f=n.children(u))===null||f===void 0)&&f.length)}),r=e.map(u=>n.node(u).rank),i=cu(r),s=[];for(let u=0;u<i+1;u++)s.push([]);const o=u=>{var f;if(t.hasOwnProperty(u))return;t[u]=!0;const h=n.node(u);isNaN(h.rank)||s[h.rank].push(u),(f=n.successors(u))===null||f===void 0||f.forEach(d=>o(d))},a=e.sort((u,f)=>n.node(u).rank-n.node(f).rank),l=a.filter(u=>n.node(u).fixorder!==void 0).sort((u,f)=>n.node(u).fixorder-n.node(f).fixorder);return l==null||l.forEach(u=>{isNaN(n.node(u).rank)||s[n.node(u).rank].push(u),t[u]=!0}),a==null||a.forEach(o),s},v1=(n,t,e)=>{const r=LS(e,e.map((u,f)=>f)),s=t.map(u=>{var f;const h=(f=n.outEdges(u))===null||f===void 0?void 0:f.map(d=>({pos:r[d.w]||0,weight:n.edge(d).weight}));return h==null?void 0:h.sort((d,p)=>d.pos-p.pos)}).flat().filter(u=>u!==void 0);let o=1;for(;o<e.length;)o<<=1;const a=2*o-1;o-=1;const c=Array(a).fill(0,0,a);let l=0;return s==null||s.forEach(u=>{if(u){let f=u.pos+o;c[f]+=u.weight;let h=0;for(;f>0;)f%2&&(h+=c[f+1]),f=f-1>>1,c[f]+=u.weight;l+=u.weight*h}}),l},Kd=(n,t)=>{let e=0;for(let r=1;r<(t==null?void 0:t.length);r+=1)e+=v1(n,t[r-1],t[r]);return e},y1=(n,t,e)=>{const r=E1(n),i=new Or({compound:!0}).setGraph({root:r}).setDefaultNodeLabel(s=>n.node(s));return n.nodes().forEach(s=>{var o;const a=n.node(s),c=n.parent(s);(a.rank===t||a.minRank<=t&&t<=a.maxRank)&&(i.setNode(s),i.setParent(s,c||r),(o=n[e](s))===null||o===void 0||o.forEach(l=>{const u=l.v===s?l.w:l.v,f=i.edgeFromArgs(u,s),h=f!==void 0?f.weight:0;i.setEdge(u,s,{weight:n.edge(l).weight+h})}),a.hasOwnProperty("minRank")&&i.setNode(s,{borderLeft:a.borderLeft[t],borderRight:a.borderRight[t]}))}),i},E1=n=>{let t;for(;n.hasNode(t=`_root${Math.random()}`););return t},x1=(n,t,e)=>{const r={};let i;e==null||e.forEach(s=>{let o=n.parent(s),a,c;for(;o;){if(a=n.parent(o),a?(c=r[a],r[a]=o):(c=i,i=o),c&&c!==o){t.setEdge(c,o);return}o=a}})},w1=(n,t)=>t.map(e=>{const r=n.inEdges(e);if(!(r!=null&&r.length))return{v:e};{const i={sum:0,weight:0};return r==null||r.forEach(s=>{const o=n.edge(s),a=n.node(s.v);i.sum+=o.weight*a.order,i.weight+=o.weight}),{v:e,barycenter:i.sum/i.weight,weight:i.weight}}}),A1=(n,t)=>{var e,r,i;const s={};n==null||n.forEach((a,c)=>{s[a.v]={i:c,indegree:0,in:[],out:[],vs:[a.v]};const l=s[a.v];a.barycenter!==void 0&&(l.barycenter=a.barycenter,l.weight=a.weight)}),(e=t.edges())===null||e===void 0||e.forEach(a=>{const c=s[a.v],l=s[a.w];c!==void 0&&l!==void 0&&(l.indegree++,c.out.push(s[a.w]))});const o=(i=(r=Object.values(s)).filter)===null||i===void 0?void 0:i.call(r,a=>!a.indegree);return S1(o)},S1=n=>{var t,e;const r=[],i=c=>l=>{l.merged||(l.barycenter===void 0||c.barycenter===void 0||l.barycenter>=c.barycenter)&&T1(c,l)},s=c=>l=>{l.in.push(c),--l.indegree===0&&n.push(l)};for(;n!=null&&n.length;){const c=n.pop();r.push(c),(t=c.in.reverse())===null||t===void 0||t.forEach(l=>i(c)(l)),(e=c.out)===null||e===void 0||e.forEach(l=>s(c)(l))}const o=r.filter(c=>!c.merged),a=["vs","i","barycenter","weight"];return o.map(c=>{const l={};return a==null||a.forEach(u=>{c[u]!==void 0&&(l[u]=c[u])}),l})},T1=(n,t)=>{var e;let r=0,i=0;n.weight&&(r+=n.barycenter*n.weight,i+=n.weight),t.weight&&(r+=t.barycenter*t.weight,i+=t.weight),n.vs=(e=t.vs)===null||e===void 0?void 0:e.concat(n.vs),n.barycenter=r/i,n.weight=i,n.i=Math.min(t.i,n.i),t.merged=!0},C1=(n,t,e,r)=>{const i=kS(n,h=>{const d=h.hasOwnProperty("fixorder")&&!isNaN(h.fixorder);return r?!d&&h.hasOwnProperty("barycenter"):d||h.hasOwnProperty("barycenter")}),s=i.lhs,o=i.rhs.sort((h,d)=>-h.i- -d.i),a=[];let c=0,l=0,u=0;s==null||s.sort(_1(!!t,!!e)),u=Zd(a,o,u),s==null||s.forEach(h=>{var d;u+=(d=h.vs)===null||d===void 0?void 0:d.length,a.push(h.vs),c+=h.barycenter*h.weight,l+=h.weight,u=Zd(a,o,u)});const f={vs:a.flat()};return l&&(f.barycenter=c/l,f.weight=l),f},Zd=(n,t,e)=>{let r=e,i;for(;t.length&&(i=t[t.length-1]).i<=r;)t.pop(),n==null||n.push(i.vs),r++;return r},_1=(n,t)=>(e,r)=>{if(e.fixorder!==void 0&&r.fixorder!==void 0)return e.fixorder-r.fixorder;if(e.barycenter<r.barycenter)return-1;if(e.barycenter>r.barycenter)return 1;if(t&&e.order!==void 0&&r.order!==void 0){if(e.order<r.order)return-1;if(e.order>r.order)return 1}return n?r.i-e.i:e.i-r.i},am=(n,t,e,r,i,s)=>{var o,a,c,l;let u=n.children(t);const f=n.node(t),h=f?f.borderLeft:void 0,d=f?f.borderRight:void 0,p={};h&&(u=u==null?void 0:u.filter(E=>E!==h&&E!==d));const m=w1(n,u||[]);m==null||m.forEach(E=>{var y;if(!((y=n.children(E.v))===null||y===void 0)&&y.length){const O=am(n,E.v,e,r,s);p[E.v]=O,O.hasOwnProperty("barycenter")&&M1(E,O)}});const b=A1(m,e);O1(b,p),(o=b.filter(E=>E.vs.length>0))===null||o===void 0||o.forEach(E=>{const y=n.node(E.vs[0]);y&&(E.fixorder=y.fixorder,E.order=y.order)});const v=C1(b,r,i,s);if(h&&(v.vs=[h,v.vs,d].flat(),!((a=n.predecessors(h))===null||a===void 0)&&a.length)){const E=n.node(((c=n.predecessors(h))===null||c===void 0?void 0:c[0])||""),y=n.node(((l=n.predecessors(d))===null||l===void 0?void 0:l[0])||"");v.hasOwnProperty("barycenter")||(v.barycenter=0,v.weight=0),v.barycenter=(v.barycenter*v.weight+E.order+y.order)/(v.weight+2),v.weight+=2}return v},O1=(n,t)=>{n==null||n.forEach(e=>{var r;const i=(r=e.vs)===null||r===void 0?void 0:r.map(s=>t[s]?t[s].vs:s);e.vs=i.flat()})},M1=(n,t)=>{n.barycenter!==void 0?(n.barycenter=(n.barycenter*n.weight+t.barycenter*t.weight)/(n.weight+t.weight),n.weight+=t.weight):(n.barycenter=t.barycenter,n.weight=t.weight)},P1=(n,t)=>{const e=Yg(n),r=[],i=[];for(let u=1;u<e+1;u++)r.push(u);for(let u=e-1;u>-1;u--)i.push(u);const s=Qd(n,r,"inEdges"),o=Qd(n,i,"outEdges");let a=Jd(n);Bl(n,a);let c=Number.POSITIVE_INFINITY,l;for(let u=0,f=0;f<4;++u,++f){tp(u%2?s:o,u%4>=2,!1,t),a=wo(n);const h=Kd(n,a);h<c&&(f=0,l=za(a),c=h)}a=Jd(n),Bl(n,a);for(let u=0,f=0;f<4;++u,++f){tp(u%2?s:o,u%4>=2,!0,t),a=wo(n);const h=Kd(n,a);h<c&&(f=0,l=za(a),c=h)}Bl(n,l)},Qd=(n,t,e)=>t.map(r=>y1(n,r,e)),tp=(n,t,e,r)=>{const i=new Or;n==null||n.forEach(s=>{var o;const a=s.graph().root,c=am(s,a,i,t,e,r);for(let l=0;l<((o=c.vs)===null||o===void 0?void 0:o.length);l++){const u=s.node(c.vs[l]);u&&(u.order=l)}x1(s,i,c.vs)})},Bl=(n,t)=>{t==null||t.forEach(e=>{e==null||e.forEach((r,i)=>{n.node(r).order=i})})};class R1 extends Rs{}const N1=(n,t)=>{const e={},r=(i,s)=>{let o=0,a=0;const c=i.length,l=s==null?void 0:s[(s==null?void 0:s.length)-1];return s==null||s.forEach((u,f)=>{var h;const d=I1(n,u),p=d?n.node(d).order:c;(d||u===l)&&((h=s.slice(a,f+1))===null||h===void 0||h.forEach(m=>{var b;(b=n.predecessors(m))===null||b===void 0||b.forEach(v=>{var E;const y=n.node(v),O=y.order;(O<o||p<O)&&!(y.dummy&&(!((E=n.node(m))===null||E===void 0)&&E.dummy))&&cm(e,v,m)})}),a=f+1,o=p)}),s};return t!=null&&t.length&&t.reduce(r),e},L1=(n,t)=>{const e={};function r(a,c,l,u,f){var h,d;let p;for(let m=c;m<l;m++)p=a[m],!((h=n.node(p))===null||h===void 0)&&h.dummy&&((d=n.predecessors(p))===null||d===void 0||d.forEach(b=>{const v=n.node(b);v.dummy&&(v.order<u||v.order>f)&&cm(e,b,p)}))}function i(a){return JSON.stringify(a.slice(1))}function s(a,c){const l=i(a);c.get(l)||(r(...a),c.set(l,!0))}const o=(a,c)=>{let l=-1,u,f=0;const h=new Map;return c==null||c.forEach((d,p)=>{var m;if(((m=n.node(d))===null||m===void 0?void 0:m.dummy)==="border"){const b=n.predecessors(d)||[];b.length&&(u=n.node(b[0]).order,s([c,f,p,l,u],h),f=p,l=u)}s([c,f,c.length,u,a.length],h)}),c};return t!=null&&t.length&&t.reduce(o),e},I1=(n,t)=>{var e,r;if(!((e=n.node(t))===null||e===void 0)&&e.dummy)return(r=n.predecessors(t))===null||r===void 0?void 0:r.find(i=>n.node(i).dummy)},cm=(n,t,e)=>{let r=t,i=e;if(r>i){const o=r;r=i,i=o}let s=n[r];s||(n[r]=s={}),s[i]=!0},D1=(n,t,e)=>{let r=t,i=e;if(r>i){const s=t;r=i,i=s}return!!n[r]},k1=(n,t,e,r)=>{const i={},s={},o={};return t==null||t.forEach(a=>{a==null||a.forEach((c,l)=>{i[c]=c,s[c]=c,o[c]=l})}),t==null||t.forEach(a=>{let c=-1;a==null||a.forEach(l=>{let u=r(l);if(u.length){u=u.sort((h,d)=>o[h]-o[d]);const f=(u.length-1)/2;for(let h=Math.floor(f),d=Math.ceil(f);h<=d;++h){const p=u[h];s[l]===l&&c<o[p]&&!D1(e,l,p)&&(s[p]=l,s[l]=i[l]=i[p],c=o[p])}}})}),{root:i,align:s}},B1=(n,t,e,r,i)=>{var s;const o={},a=j1(n,t,e,i),c=i?"borderLeft":"borderRight",l=(h,d)=>{let p=a.nodes(),m=p.pop();const b={};for(;m;)b[m]?h(m):(b[m]=!0,p.push(m),p=p.concat(d(m))),m=p.pop()},u=h=>{o[h]=(a.inEdges(h)||[]).reduce((d,p)=>Math.max(d,(o[p.v]||0)+a.edge(p)),0)},f=h=>{const d=(a.outEdges(h)||[]).reduce((m,b)=>Math.min(m,(o[b.w]||0)-a.edge(b)),Number.POSITIVE_INFINITY),p=n.node(h);d!==Number.POSITIVE_INFINITY&&p.borderType!==c&&(o[h]=Math.max(o[h],d))};return l(u,a.predecessors.bind(a)),l(f,a.successors.bind(a)),(s=Object.values(r))===null||s===void 0||s.forEach(h=>{o[h]=o[e[h]]}),o},j1=(n,t,e,r)=>{const i=new R1,s=n.graph(),o=U1(s.nodesep,s.edgesep,r);return t==null||t.forEach(a=>{let c;a==null||a.forEach(l=>{const u=e[l];if(i.setNode(u),c){const f=e[c],h=i.edgeFromArgs(f,u);i.setEdge(f,u,Math.max(o(n,l,c),h||0))}c=l})}),i},F1=(n,t)=>Iu(Object.values(t),e=>{var r;let i=Number.NEGATIVE_INFINITY,s=Number.POSITIVE_INFINITY;return(r=Object.keys(e))===null||r===void 0||r.forEach(o=>{const a=e[o],c=V1(n,o)/2;i=Math.max(a+c,i),s=Math.min(a-c,s)}),i-s});function G1(n,t){const e=Object.values(t),r=Yd(e),i=cu(e);["u","d"].forEach(s=>{["l","r"].forEach(o=>{const a=s+o,c=n[a];let l;if(c===t)return;const u=Object.values(c);l=o==="l"?r-Yd(u):i-cu(u),l&&(n[a]={},Object.keys(c).forEach(f=>{n[a][f]=c[f]+l}))})})}const z1=(n,t)=>{const e={};return Object.keys(n.ul).forEach(r=>{if(t)e[r]=n[t.toLowerCase()][r];else{const i=Object.values(n).map(s=>s[r]);e[r]=(i[0]+i[1])/2}}),e},U1=(n,t,e)=>(r,i,s)=>{const o=r.node(i),a=r.node(s);let c=0,l;if(c+=o.width/2,o.hasOwnProperty("labelpos"))switch((o.labelpos||"").toLowerCase()){case"l":l=-o.width/2;break;case"r":l=o.width/2;break}if(l&&(c+=e?l:-l),l=0,c+=(o.dummy?t:n)/2,c+=(a.dummy?t:n)/2,c+=a.width/2,a.labelpos)switch((a.labelpos||"").toLowerCase()){case"l":l=a.width/2;break;case"r":l=-a.width/2;break}return l&&(c+=e?l:-l),l=0,c},V1=(n,t)=>n.node(t).width||0,$1=n=>{const t=wo(n),e=n.graph().ranksep;let r=0;t==null||t.forEach(i=>{const s=i.map(a=>n.node(a).height),o=Math.max(...s,0);i==null||i.forEach(a=>{n.node(a).y=r+o/2}),r+=o+e})},H1=n=>{const t=wo(n),e=Object.assign(N1(n,t),L1(n,t)),r={};let i=[];["u","d"].forEach(o=>{i=o==="u"?t:Object.values(t).reverse(),["l","r"].forEach(a=>{a==="r"&&(i=i.map(f=>Object.values(f).reverse()));const c=(o==="u"?n.predecessors:n.successors).bind(n),l=k1(n,i,e,c),u=B1(n,i,l.root,l.align,a==="r");a==="r"&&Object.keys(u).forEach(f=>u[f]=-u[f]),r[o+a]=u})});const s=F1(n,r);return s&&G1(r,s),z1(r,n.graph().align)},X1=n=>{var t;const e=qg(n);$1(e);const r=H1(e);(t=Object.keys(r))===null||t===void 0||t.forEach(i=>{e.node(i).x=r[i]})},W1=(n,t)=>{const r=n.nodes().filter(o=>{var a;return!(!((a=n.children(o))===null||a===void 0)&&a.length)}).map(o=>n.node(o).rank),i=Math.max(...r),s=[];for(let o=0;o<i+1;o++)s[o]=[];t==null||t.forEach(o=>{const a=n.node(o);!a||a!=null&&a.dummy||isNaN(a.rank)||(a.fixorder=s[a.rank].length,s[a.rank].push(o))})},q1=(n,t)=>{const e=t&&t.debugTiming?Jg:Kg;e("layout",()=>{t&&!t.keepNodeOrder&&t.prevGraph&&e("  inheritOrder",()=>{J1(n,t.prevGraph)});const r=e("  buildLayoutGraph",()=>iT(n));t&&t.edgeLabelSpace===!1||e("  makeSpaceForEdgeLabels",()=>{sT(r)});try{e("  runLayout",()=>{Y1(r,e,t)})}catch(i){if(i.message==="Not possible to find intersection inside of the rectangle"){console.error(`The following error may be caused by improper layer setting, please make sure your manual layer setting does not violate the graph's structure:
`,i);return}throw i}e("  updateInputGraph",()=>{K1(n,r)})})},Y1=(n,t,e)=>{t("    removeSelfEdges",()=>{pT(n)}),t("    acyclic",()=>{Fd.run(n)}),t("    nestingGraph.run",()=>{Hd.run(n)}),t("    rank",()=>{e1(qg(n))}),t("    injectEdgeLabelProxies",()=>{oT(n)}),t("    removeEmptyRanks",()=>{DS(n)}),t("    nestingGraph.cleanup",()=>{Hd.cleanup(n)}),t("    normalizeRanks",()=>{IS(n)}),t("    assignRankMinMax",()=>{aT(n)}),t("    removeEdgeLabelProxies",()=>{cT(n)}),t("    normalize.run",()=>{Ud.run(n)}),t("    parentDummyChains",()=>{o1(n)}),t("    addBorderSegments",()=>{h1(n)}),e&&e.keepNodeOrder&&t("    initDataOrder",()=>{W1(n,e.nodeOrder)}),t("    order",()=>{P1(n,e==null?void 0:e.keepNodeOrder)}),t("    insertSelfEdges",()=>{gT(n)}),t("    adjustCoordinateSystem",()=>{qd.adjust(n)}),t("    position",()=>{X1(n)}),t("    positionSelfEdges",()=>{mT(n)}),t("    removeBorderNodes",()=>{dT(n)}),t("    normalize.undo",()=>{Ud.undo(n)}),t("    fixupEdgeLabelCoords",()=>{hT(n)}),t("    undoCoordinateSystem",()=>{qd.undo(n)}),t("    translateGraph",()=>{lT(n)}),t("    assignNodeIntersects",()=>{uT(n)}),t("    reversePoints",()=>{fT(n)}),t("    acyclic.undo",()=>{Fd.undo(n)})},J1=(n,t)=>{n.nodes().forEach(e=>{const r=n.node(e),i=t.node(e);i!==void 0?(r.fixorder=i._order,delete i._order):delete r.fixorder})},K1=(n,t)=>{n.nodes().forEach(e=>{var r;const i=n.node(e);if(i){const s=t.node(e);i.x=s.x,i.y=s.y,i._order=s.order,i._rank=s.rank,!((r=t.children(e))===null||r===void 0)&&r.length&&(i.width=s.width,i.height=s.height)}}),n.edges().forEach(e=>{const r=n.edge(e),i=t.edge(e);r.points=i?i.points:[],i&&i.hasOwnProperty("x")&&(r.x=i.x,r.y=i.y)}),n.graph().width=t.graph().width,n.graph().height=t.graph().height},Z1=["nodesep","edgesep","ranksep","marginx","marginy"],Q1={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},jl=["acyclicer","ranker","rankdir","align"],tT=["width","height","layer","fixorder"],eT={width:0,height:0},nT=["minlen","weight","width","height","labeloffset"],rT={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Fl=["labelpos"],iT=n=>{const t=new Or({multigraph:!0,compound:!0}),e=zl(n.graph()),r={};return jl==null||jl.forEach(i=>{e[i]!==void 0&&(r[i]=e[i])}),t.setGraph(Object.assign({},Q1,Gl(e,Z1),r)),n.nodes().forEach(i=>{const s=zl(n.node(i)),o=Object.assign(Object.assign({},eT),s),a=Gl(o,tT);t.setNode(i,a),t.setParent(i,n.parent(i))}),n.edges().forEach(i=>{const s=zl(n.edge(i)),o={};Fl==null||Fl.forEach(a=>{s[a]!==void 0&&(o[a]=s[a])}),t.setEdgeObj(i,Object.assign({},rT,Gl(s,nT),o))}),t},sT=n=>{const t=n.graph();t.ranksep||(t.ranksep=0),t.ranksep/=2,n.nodes().forEach(e=>{const r=n.node(e);isNaN(r.layer)||r.layer||(r.layer=0)}),n.edges().forEach(e=>{var r;const i=n.edge(e);i.minlen*=2,((r=i.labelpos)===null||r===void 0?void 0:r.toLowerCase())!=="c"&&(t.rankdir==="TB"||t.rankdir==="BT"?i.width+=i.labeloffset:i.height+=i.labeloffset)})},oT=n=>{n.edges().forEach(t=>{const e=n.edge(t);if(e.width&&e.height){const r=n.node(t.v),i=n.node(t.w),s={e:t,rank:(i.rank-r.rank)/2+r.rank};Ns(n,"edge-proxy",s,"_ep")}})},aT=n=>{let t=0;n.nodes().forEach(e=>{var r,i;const s=n.node(e);s.borderTop&&(s.minRank=(r=n.node(s.borderTop))===null||r===void 0?void 0:r.rank,s.maxRank=(i=n.node(s.borderBottom))===null||i===void 0?void 0:i.rank,t=Math.max(t,s.maxRank||-1/0))}),n.graph().maxRank=t},cT=n=>{n.nodes().forEach(t=>{const e=n.node(t);e.dummy==="edge-proxy"&&(n.edge(e.e).labelRank=e.rank,n.removeNode(t))})},lT=n=>{let t,e=0,r,i=0;const s=n.graph(),o=s.marginx||0,a=s.marginy||0,c=l=>{if(!l)return;const u=l.x,f=l.y,h=l.width,d=l.height;!isNaN(u)&&!isNaN(h)&&(t===void 0&&(t=u-h/2),t=Math.min(t,u-h/2),e=Math.max(e,u+h/2)),!isNaN(f)&&!isNaN(d)&&(r===void 0&&(r=f-d/2),r=Math.min(r,f-d/2),i=Math.max(i,f+d/2))};n.nodes().forEach(l=>{c(n.node(l))}),n.edges().forEach(l=>{const u=n.edge(l);u!=null&&u.hasOwnProperty("x")&&c(u)}),t-=o,r-=a,n.nodes().forEach(l=>{const u=n.node(l);u&&(u.x-=t,u.y-=r)}),n.edges().forEach(l=>{var u;const f=n.edge(l);(u=f.points)===null||u===void 0||u.forEach(h=>{h.x-=t,h.y-=r}),f.hasOwnProperty("x")&&(f.x-=t),f.hasOwnProperty("y")&&(f.y-=r)}),s.width=e-t+o,s.height=i-r+a},uT=n=>{n.edges().forEach(t=>{const e=n.edge(t),r=n.node(t.v),i=n.node(t.w);let s,o;e.points?(s=e.points[0],o=e.points[e.points.length-1]):(e.points=[],s=i,o=r),e.points.unshift(Gd(r,s)),e.points.push(Gd(i,o))})},hT=n=>{n.edges().forEach(t=>{const e=n.edge(t);if(e!=null&&e.hasOwnProperty("x"))switch((e.labelpos==="l"||e.labelpos==="r")&&(e.width-=e.labeloffset),e.labelpos){case"l":e.x-=e.width/2+e.labeloffset;break;case"r":e.x+=e.width/2+e.labeloffset;break}})},fT=n=>{n.edges().forEach(t=>{var e;const r=n.edge(t);r.reversed&&((e=r.points)===null||e===void 0||e.reverse())})},dT=n=>{n.nodes().forEach(t=>{var e,r,i;if(!((e=n.children(t))===null||e===void 0)&&e.length){const s=n.node(t),o=n.node(s.borderTop),a=n.node(s.borderBottom),c=n.node(s.borderLeft[((r=s.borderLeft)===null||r===void 0?void 0:r.length)-1]),l=n.node(s.borderRight[((i=s.borderRight)===null||i===void 0?void 0:i.length)-1]);s.width=Math.abs((l==null?void 0:l.x)-(c==null?void 0:c.x))||10,s.height=Math.abs((a==null?void 0:a.y)-(o==null?void 0:o.y))||10,s.x=((c==null?void 0:c.x)||0)+s.width/2,s.y=((o==null?void 0:o.y)||0)+s.height/2}}),n.nodes().forEach(t=>{var e;((e=n.node(t))===null||e===void 0?void 0:e.dummy)==="border"&&n.removeNode(t)})},pT=n=>{n.edges().forEach(t=>{if(t.v===t.w){const e=n.node(t.v);e.selfEdges||(e.selfEdges=[]),e.selfEdges.push({e:t,label:n.edge(t)}),n.removeEdgeObj(t)}})},gT=n=>{const t=wo(n);t==null||t.forEach(e=>{let r=0;e==null||e.forEach((i,s)=>{var o;const a=n.node(i);a.order=s+r,(o=a.selfEdges)===null||o===void 0||o.forEach(c=>{Ns(n,"selfedge",{width:c.label.width,height:c.label.height,rank:a.rank,order:s+ ++r,e:c.e,label:c.label},"_se")}),delete a.selfEdges})})},mT=n=>{n.nodes().forEach(t=>{const e=n.node(t);if(e.dummy==="selfedge"){const r=n.node(e.e.v),i=r.x+r.width/2,s=r.y,o=e.x-i,a=r.height/2;n.setEdgeObj(e.e,e.label),n.removeNode(t),e.label.points=[{x:i+2*o/3,y:s-a},{x:i+5*o/6,y:s-a},{y:s,x:i+o},{x:i+5*o/6,y:s+a},{x:i+2*o/3,y:s+a}],e.label.x=e.x,e.label.y=e.y}})},Gl=(n,t)=>{const e={};return t==null||t.forEach(r=>{n[r]!==void 0&&(e[r]=+n[r])}),e},zl=(n={})=>{const t={};return Object.keys(n).forEach(e=>{t[e.toLowerCase()]=n[e]}),t},bT={layout:q1,util:{time:Jg,notime:Kg}};class WI extends DA{constructor(t){super(),this.rankdir="TB",this.nodesep=50,this.ranksep=50,this.controlPoints=!1,this.sortByCombo=!1,this.edgeLabelSpace=!0,this.radial=!1,this.nodes=[],this.edges=[],this.onLayoutEnd=()=>{},this.layoutNode=e=>{const r=this,{nodes:i}=r,s=i.find(o=>o.id===e);return s?s.layout!==!1:!0},this.updateCfg(t)}getDefaultCfg(){return{rankdir:"TB",align:void 0,nodeSize:void 0,nodesepFunc:void 0,ranksepFunc:void 0,nodesep:50,ranksep:50,controlPoints:!1,radial:!1,focusNode:null}}execute(){var t,e,r,i;const s=this,{nodes:o,nodeSize:a,rankdir:c,combos:l,begin:u,radial:f,comboEdges:h=[],vedges:d=[]}=s;if(!o)return;const p=s.edges||[],m=new Or({multigraph:!0,compound:!0});s.nodeMap={};const b={};o.forEach(H=>{s.nodeMap[H.id]=H,H.comboId&&(b[H.comboId]=b[H.comboId]||[],b[H.comboId].push(H.id))});let v=[];const E={};!((t=s.nodeOrder)===null||t===void 0)&&t.length?(s.nodeOrder.forEach(H=>{E[H]=!0,v.push(s.nodeMap[H])}),o.forEach(H=>{E[H.id]||v.push(H)})):v=o;let y;a?Md(a)?y=()=>a:y=()=>[a,a]:y=H=>H.size?Md(H.size)?H.size:zg(H.size)?[H.size.width||40,H.size.height||40]:[H.size,H.size]:[40,40];const O=Pd(s.ranksep,50,s.ranksepFunc),I=Pd(s.nodesep,50,s.nodesepFunc);let G=I,k=O;(c==="LR"||c==="RL")&&(G=O,k=I),m.setDefaultEdgeLabel(()=>({})),m.setGraph(s);const X={};this.sortByCombo&&l&&l.forEach(H=>{if(X[H.id]=H,H.collapsed){const Ut=y(H),zt=k(H),W=G(H),lt=Ut[0]+2*W,Rt=Ut[1]+2*zt;m.setNode(H.id,{width:lt,height:Rt})}H.parentId&&(X[H.parentId]||m.setNode(H.parentId,{}),m.setParent(H.id,H.parentId))}),v.filter(H=>H.layout!==!1).forEach(H=>{const Ut=y(H),zt=k(H),W=G(H),lt=Ut[0]+2*W,Rt=Ut[1]+2*zt,Xt=H.layer;Ga(Xt)?m.setNode(H.id,{width:lt,height:Rt,layer:Xt}):m.setNode(H.id,{width:lt,height:Rt}),this.sortByCombo&&H.comboId&&(X[H.comboId]||(X[H.comboId]={id:H.comboId},m.setNode(H.comboId,{})),m.setParent(H.id,H.comboId))}),p.forEach(H=>{const Ut=Qi(H,"source"),zt=Qi(H,"target");this.layoutNode(Ut)&&this.layoutNode(zt)&&m.setEdge(Ut,zt,{weight:H.weight||1})}),(e=h==null?void 0:h.concat(d||[]))===null||e===void 0||e.forEach(H=>{var Ut,zt;const{source:W,target:lt}=H,Rt=!((Ut=X[W])===null||Ut===void 0)&&Ut.collapsed?[W]:b[W]||[W],Xt=!((zt=X[lt])===null||zt===void 0)&&zt.collapsed?[lt]:b[lt]||[lt];Rt.forEach(ot=>{Xt.forEach(et=>{m.setEdge(ot,et,{weight:H.weight||1})})})});let Z;!((r=s.preset)===null||r===void 0)&&r.nodes&&(Z=new Or({multigraph:!0,compound:!0}),s.preset.nodes.forEach(H=>{Z==null||Z.setNode(H.id,H)})),bT.layout(m,{prevGraph:Z,edgeLabelSpace:s.edgeLabelSpace,keepNodeOrder:!!s.nodeOrder,nodeOrder:s.nodeOrder});const at=[0,0];if(u){let H=1/0,Ut=1/0;m.nodes().forEach(zt=>{const W=m.node(zt);H>W.x&&(H=W.x),Ut>W.y&&(Ut=W.y)}),m.edges().forEach(zt=>{var W;(W=m.edge(zt).points)===null||W===void 0||W.forEach(Rt=>{H>Rt.x&&(H=Rt.x),Ut>Rt.y&&(Ut=Rt.y)})}),at[0]=u[0]-H,at[1]=u[1]-Ut}const ft=c==="LR"||c==="RL";if(f){const{focusNode:H,ranksep:Ut,getRadialPos:zt}=this,W=kA(H)?H:H==null?void 0:H.id,lt=W?(i=m.node(W))===null||i===void 0?void 0:i._rank:0,Rt=[],Xt=ft?"y":"x",ot=ft?"height":"width";let et=1/0,K=-1/0;m.nodes().forEach(Zt=>{const Yt=m.node(Zt);if(!s.nodeMap[Zt])return;const ln=I(s.nodeMap[Zt]);if(lt===0)Rt[Yt._rank]||(Rt[Yt._rank]={nodes:[],totalWidth:0,maxSize:-1/0}),Rt[Yt._rank].nodes.push(Zt),Rt[Yt._rank].totalWidth+=ln*2+Yt[ot],Rt[Yt._rank].maxSize<Math.max(Yt.width,Yt.height)&&(Rt[Yt._rank].maxSize=Math.max(Yt.width,Yt.height));else{const Pe=Yt._rank-lt;if(Pe===0)Rt[Pe]||(Rt[Pe]={nodes:[],totalWidth:0,maxSize:-1/0}),Rt[Pe].nodes.push(Zt),Rt[Pe].totalWidth+=ln*2+Yt[ot],Rt[Pe].maxSize<Math.max(Yt.width,Yt.height)&&(Rt[Pe].maxSize=Math.max(Yt.width,Yt.height));else{const Be=Math.abs(Pe);Rt[Be]||(Rt[Be]={left:[],right:[],totalWidth:0,maxSize:-1/0}),Rt[Be].totalWidth+=ln*2+Yt[ot],Rt[Be].maxSize<Math.max(Yt.width,Yt.height)&&(Rt[Be].maxSize=Math.max(Yt.width,Yt.height)),Pe<0?Rt[Be].left.push(Zt):Rt[Be].right.push(Zt)}}const An=Yt[Xt]-Yt[ot]/2-ln,gn=Yt[Xt]+Yt[ot]/2+ln;An<et&&(et=An),gn>K&&(K=gn)});let Ct=Ut||50;const Lt={},Ot=(K-et)/.9,re=[(et+K-Ot)*.5,(et+K+Ot)*.5],be=(Zt,Yt,ln=-1/0,An=[0,1])=>{let gn=ln;return Zt.forEach(Pe=>{const Be=m.node(Pe);Lt[Pe]=Yt;const{x:Nn,y:_n}=zt(Be[Xt],re,Ot,Yt,An);if(!s.nodeMap[Pe])return;s.nodeMap[Pe].x=Nn+at[0],s.nodeMap[Pe].y=_n+at[1],s.nodeMap[Pe]._order=Be._order;const Ne=O(s.nodeMap[Pe]);gn<Ne&&(gn=Ne)}),gn};let ee=!0;const Oe=0;Rt.forEach(Zt=>{var Yt,ln,An,gn,Pe,Be,Nn;if(!(!((Yt=Zt==null?void 0:Zt.nodes)===null||Yt===void 0)&&Yt.length)&&!(!((ln=Zt==null?void 0:Zt.left)===null||ln===void 0)&&ln.length)&&!(!((An=Zt==null?void 0:Zt.right)===null||An===void 0)&&An.length))return;if(ee&&Zt.nodes.length===1){const Ne=Zt.nodes[0];if(!s.nodeMap[Ne])return;s.nodeMap[Ne].x=at[0],s.nodeMap[Ne].y=at[1],Lt[Zt.nodes[0]]=0,Ct=O(s.nodeMap[Ne]),ee=!1;return}Ct=Math.max(Ct,Zt.totalWidth/(2*Math.PI));let _n=-1/0;if(lt===0||!((gn=Zt.nodes)===null||gn===void 0)&&gn.length)_n=be(Zt.nodes,Ct,_n,[0,1]);else{const Ne=((Pe=Zt.left)===null||Pe===void 0?void 0:Pe.length)/(((Be=Zt.left)===null||Be===void 0?void 0:Be.length)+((Nn=Zt.right)===null||Nn===void 0?void 0:Nn.length));_n=be(Zt.left,Ct,_n,[0,Ne]),_n=be(Zt.right,Ct,_n,[Ne+.05,1])}Ct+=_n,ee=!1,Oe-Zt.maxSize}),m.edges().forEach(Zt=>{var Yt,ln,An;const gn=m.edge(Zt),Pe=p.findIndex(Be=>{const Nn=Qi(Be,"source"),_n=Qi(Be,"target");return Nn===Zt.v&&_n===Zt.w});if(!(Pe<=-1)&&s.edgeLabelSpace&&s.controlPoints&&p[Pe].type!=="loop"){const Be=Xt==="x"?"y":"x",Nn=(Yt=gn==null?void 0:gn.points)===null||Yt===void 0?void 0:Yt.slice(1,gn.points.length-1),_n=[],Ne=(ln=m.node(Zt.v))===null||ln===void 0?void 0:ln[Be],Wo=Ne-((An=m.node(Zt.w))===null||An===void 0?void 0:An[Be]),oi=Lt[Zt.v],Ic=oi-Lt[Zt.w];Nn==null||Nn.forEach(qo=>{const S=(qo[Be]-Ne)/Wo*Ic+oi,Yo=zt(qo[Xt],re,Ot,S);_n.push({x:Yo.x+at[0],y:Yo.y+at[1]})}),p[Pe].controlPoints=_n}})}else{const H=new Set,zt=c==="BT"||c==="RL"?(Xt,ot)=>ot-Xt:(Xt,ot)=>Xt-ot;m.nodes().forEach(Xt=>{const ot=m.node(Xt);if(!ot)return;let et=this.nodeMap[Xt];et||(et=l==null?void 0:l.find(K=>K.id===Xt)),et&&(et.x=ot.x+at[0],et.y=ot.y+at[1],et._order=ot._order,H.add(ft?et.x:et.y))});const W=Array.from(H).sort(zt),lt=ft?(Xt,ot)=>Xt.x!==ot.x:(Xt,ot)=>Xt.y!==ot.y,Rt=ft?(Xt,ot,et)=>{const K=Math.max(ot.y,et.y),Ct=Math.min(ot.y,et.y);return Xt.filter(Lt=>Lt.y<=K&&Lt.y>=Ct)}:(Xt,ot,et)=>{const K=Math.max(ot.x,et.x),Ct=Math.min(ot.x,et.x);return Xt.filter(Lt=>Lt.x<=K&&Lt.x>=Ct)};m.edges().forEach(Xt=>{var ot;const et=m.edge(Xt),K=p.findIndex(Ct=>{const Lt=Qi(Ct,"source"),Ot=Qi(Ct,"target");return Lt===Xt.v&&Ot===Xt.w});if(!(K<=-1)&&s.edgeLabelSpace&&s.controlPoints&&p[K].type!=="loop"){(ot=et==null?void 0:et.points)===null||ot===void 0||ot.forEach(Ot=>{Ot.x+=at[0],Ot.y+=at[1]});const Ct=s.nodeMap[Xt.v],Lt=s.nodeMap[Xt.w];p[K].controlPoints=vT(et==null?void 0:et.points,Ct,Lt,W,ft,lt,Rt)}})}return s.onLayoutEnd&&s.onLayoutEnd(),{nodes:o,edges:p}}getRadialPos(t,e,r,i,s=[0,1]){let o=(t-e[0])/r;o=o*(s[1]-s[0])+s[0];const a=o*2*Math.PI;return{x:Math.cos(a)*i,y:Math.sin(a)*i}}getType(){return"dagre"}}const vT=(n,t,e,r,i,s,o)=>{let a=(n==null?void 0:n.slice(1,n.length-1))||[];if(t&&e){let{x:c,y:l}=t,{x:u,y:f}=e;if(i&&(c=t.y,l=t.x,u=e.y,f=e.x),f!==l&&c!==u){const h=r.indexOf(l),d=r[h+1];if(d){const b=a[0],v=i?{x:(l+d)/2,y:(b==null?void 0:b.y)||u}:{x:(b==null?void 0:b.x)||u,y:(l+d)/2};(!b||s(b,v))&&a.unshift(v)}const p=r.indexOf(f),m=Math.abs(p-h);if(m===1)a=o(a,t,e),a.length||a.push(i?{x:(l+f)/2,y:c}:{x:c,y:(l+f)/2});else if(m>1){const b=r[p-1];if(b){const v=a[a.length-1],E=i?{x:(f+b)/2,y:(v==null?void 0:v.y)||u}:{x:(v==null?void 0:v.x)||c,y:(f+b)/2};(!v||s(v,E))&&a.push(E)}}}}return a};var ep,np,rp,ip;(function(n){n[n.META=0]="META",n[n.NODE=1]="NODE",n[n.BRIDGE=2]="BRIDGE"})(ep||(ep={})),function(n){n[n.INCLUDE=0]="INCLUDE",n[n.EXCLUDE=1]="EXCLUDE",n[n.UNSPECIFIED=2]="UNSPECIFIED"}(np||(np={})),function(n){n[n.META=0]="META",n[n.CORE=1]="CORE",n[n.BRIDGE=2]="BRIDGE"}(rp||(rp={})),function(n){n[n.META=0]="META",n[n.OP=1]="OP",n[n.SERIES=2]="SERIES"}(ip||(ip={}));var Ca=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Du(n,t){return n(t={exports:{}},t.exports),t.exports}var yT=function(){this.__data__=[],this.size=0},Ls=function(n,t){return n===t||n!=n&&t!=t},fc=function(n,t){for(var e=n.length;e--;)if(Ls(n[e][0],t))return e;return-1},ET=Array.prototype.splice,xT=function(n){var t=this.__data__,e=fc(t,n);return!(e<0)&&(e==t.length-1?t.pop():ET.call(t,e,1),--this.size,!0)},wT=function(n){var t=this.__data__,e=fc(t,n);return e<0?void 0:t[e][1]},AT=function(n){return fc(this.__data__,n)>-1},ST=function(n,t){var e=this.__data__,r=fc(e,n);return r<0?(++this.size,e.push([n,t])):e[r][1]=t,this};function ns(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}ns.prototype.clear=yT,ns.prototype.delete=xT,ns.prototype.get=wT,ns.prototype.has=AT,ns.prototype.set=ST;var dc=ns,TT=function(){this.__data__=new dc,this.size=0},CT=function(n){var t=this.__data__,e=t.delete(n);return this.size=t.size,e},_T=function(n){return this.__data__.get(n)},OT=function(n){return this.__data__.has(n)},lm=typeof Ca=="object"&&Ca&&Ca.Object===Object&&Ca,MT=typeof self=="object"&&self&&self.Object===Object&&self,or=lm||MT||Function("return this")(),Jn=or.Symbol,um=Object.prototype,PT=um.hasOwnProperty,RT=um.toString,io=Jn?Jn.toStringTag:void 0,NT=function(n){var t=PT.call(n,io),e=n[io];try{n[io]=void 0;var r=!0}catch{}var i=RT.call(n);return r&&(t?n[io]=e:delete n[io]),i},LT=Object.prototype.toString,IT=function(n){return LT.call(n)},sp=Jn?Jn.toStringTag:void 0,ei=function(n){return n==null?n===void 0?"[object Undefined]":"[object Null]":sp&&sp in Object(n)?NT(n):IT(n)},jn=function(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")},op,Go=function(n){if(!jn(n))return!1;var t=ei(n);return t=="[object Function]"||t=="[object GeneratorFunction]"||t=="[object AsyncFunction]"||t=="[object Proxy]"},Ul=or["__core-js_shared__"],ap=(op=/[^.]+$/.exec(Ul&&Ul.keys&&Ul.keys.IE_PROTO||""))?"Symbol(src)_1."+op:"",DT=function(n){return!!ap&&ap in n},kT=Function.prototype.toString,Li=function(n){if(n!=null){try{return kT.call(n)}catch{}try{return n+""}catch{}}return""},BT=/^\[object .+?Constructor\]$/,jT=Function.prototype,FT=Object.prototype,GT=jT.toString,zT=FT.hasOwnProperty,UT=RegExp("^"+GT.call(zT).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),VT=function(n){return!(!jn(n)||DT(n))&&(Go(n)?UT:BT).test(Li(n))},$T=function(n,t){return n==null?void 0:n[t]},Ii=function(n,t){var e=$T(n,t);return VT(e)?e:void 0},Ao=Ii(or,"Map"),So=Ii(Object,"create"),HT=function(){this.__data__=So?So(null):{},this.size=0},XT=function(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t},WT=Object.prototype.hasOwnProperty,qT=function(n){var t=this.__data__;if(So){var e=t[n];return e==="__lodash_hash_undefined__"?void 0:e}return WT.call(t,n)?t[n]:void 0},YT=Object.prototype.hasOwnProperty,JT=function(n){var t=this.__data__;return So?t[n]!==void 0:YT.call(t,n)},KT=function(n,t){var e=this.__data__;return this.size+=this.has(n)?0:1,e[n]=So&&t===void 0?"__lodash_hash_undefined__":t,this};function rs(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}rs.prototype.clear=HT,rs.prototype.delete=XT,rs.prototype.get=qT,rs.prototype.has=JT,rs.prototype.set=KT;var cp=rs,ZT=function(){this.size=0,this.__data__={hash:new cp,map:new(Ao||dc),string:new cp}},QT=function(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null},pc=function(n,t){var e=n.__data__;return QT(t)?e[typeof t=="string"?"string":"hash"]:e.map},tC=function(n){var t=pc(this,n).delete(n);return this.size-=t?1:0,t},eC=function(n){return pc(this,n).get(n)},nC=function(n){return pc(this,n).has(n)},rC=function(n,t){var e=pc(this,n),r=e.size;return e.set(n,t),this.size+=e.size==r?0:1,this};function is(n){var t=-1,e=n==null?0:n.length;for(this.clear();++t<e;){var r=n[t];this.set(r[0],r[1])}}is.prototype.clear=ZT,is.prototype.delete=tC,is.prototype.get=eC,is.prototype.has=nC,is.prototype.set=rC;var gc=is,iC=function(n,t){var e=this.__data__;if(e instanceof dc){var r=e.__data__;if(!Ao||r.length<199)return r.push([n,t]),this.size=++e.size,this;e=this.__data__=new gc(r)}return e.set(n,t),this.size=e.size,this};function ss(n){var t=this.__data__=new dc(n);this.size=t.size}ss.prototype.clear=TT,ss.prototype.delete=CT,ss.prototype.get=_T,ss.prototype.has=OT,ss.prototype.set=iC;var as=ss,ku=function(n,t){for(var e=-1,r=n==null?0:n.length;++e<r&&t(n[e],e,n)!==!1;);return n},Ua=function(){try{var n=Ii(Object,"defineProperty");return n({},"",{}),n}catch{}}(),mc=function(n,t,e){t=="__proto__"&&Ua?Ua(n,t,{configurable:!0,enumerable:!0,value:e,writable:!0}):n[t]=e},sC=Object.prototype.hasOwnProperty,bc=function(n,t,e){var r=n[t];sC.call(n,t)&&Ls(r,e)&&(e!==void 0||t in n)||mc(n,t,e)},zo=function(n,t,e,r){var i=!e;e||(e={});for(var s=-1,o=t.length;++s<o;){var a=t[s],c=void 0;c===void 0&&(c=n[a]),i?mc(e,a,c):bc(e,a,c)}return e},oC=function(n,t){for(var e=-1,r=Array(n);++e<n;)r[e]=t(e);return r},rr=function(n){return n!=null&&typeof n=="object"},lp=function(n){return rr(n)&&ei(n)=="[object Arguments]"},hm=Object.prototype,aC=hm.hasOwnProperty,cC=hm.propertyIsEnumerable,hs=lp(function(){return arguments}())?lp:function(n){return rr(n)&&aC.call(n,"callee")&&!cC.call(n,"callee")},Je=Array.isArray,lC=function(){return!1},_i=Du(function(n,t){var e=t&&!t.nodeType&&t,r=e&&n&&!n.nodeType&&n,i=r&&r.exports===e?or.Buffer:void 0,s=(i?i.isBuffer:void 0)||lC;n.exports=s}),uC=/^(?:0|[1-9]\d*)$/,vc=function(n,t){var e=typeof n;return!!(t=t??9007199254740991)&&(e=="number"||e!="symbol"&&uC.test(n))&&n>-1&&n%1==0&&n<t},Bu=function(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=9007199254740991},Ie={};Ie["[object Float32Array]"]=Ie["[object Float64Array]"]=Ie["[object Int8Array]"]=Ie["[object Int16Array]"]=Ie["[object Int32Array]"]=Ie["[object Uint8Array]"]=Ie["[object Uint8ClampedArray]"]=Ie["[object Uint16Array]"]=Ie["[object Uint32Array]"]=!0,Ie["[object Arguments]"]=Ie["[object Array]"]=Ie["[object ArrayBuffer]"]=Ie["[object Boolean]"]=Ie["[object DataView]"]=Ie["[object Date]"]=Ie["[object Error]"]=Ie["[object Function]"]=Ie["[object Map]"]=Ie["[object Number]"]=Ie["[object Object]"]=Ie["[object RegExp]"]=Ie["[object Set]"]=Ie["[object String]"]=Ie["[object WeakMap]"]=!1;var hC=function(n){return rr(n)&&Bu(n.length)&&!!Ie[ei(n)]},yc=function(n){return function(t){return n(t)}},fs=Du(function(n,t){var e=t&&!t.nodeType&&t,r=e&&n&&!n.nodeType&&n,i=r&&r.exports===e&&lm.process,s=function(){try{var o=r&&r.require&&r.require("util").types;return o||i&&i.binding&&i.binding("util")}catch{}}();n.exports=s}),up=fs&&fs.isTypedArray,Uo=up?yc(up):hC,fC=Object.prototype.hasOwnProperty,fm=function(n,t){var e=Je(n),r=!e&&hs(n),i=!e&&!r&&_i(n),s=!e&&!r&&!i&&Uo(n),o=e||r||i||s,a=o?oC(n.length,String):[],c=a.length;for(var l in n)!t&&!fC.call(n,l)||o&&(l=="length"||i&&(l=="offset"||l=="parent")||s&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||vc(l,c))||a.push(l);return a},dC=Object.prototype,Ec=function(n){var t=n&&n.constructor;return n===(typeof t=="function"&&t.prototype||dC)},dm=function(n,t){return function(e){return n(t(e))}},pC=dm(Object.keys,Object),gC=Object.prototype.hasOwnProperty,ju=function(n){if(!Ec(n))return pC(n);var t=[];for(var e in Object(n))gC.call(n,e)&&e!="constructor"&&t.push(e);return t},Nr=function(n){return n!=null&&Bu(n.length)&&!Go(n)},ni=function(n){return Nr(n)?fm(n):ju(n)},mC=function(n,t){return n&&zo(t,ni(t),n)},bC=function(n){var t=[];if(n!=null)for(var e in Object(n))t.push(e);return t},vC=Object.prototype.hasOwnProperty,yC=function(n){if(!jn(n))return bC(n);var t=Ec(n),e=[];for(var r in n)(r!="constructor"||!t&&vC.call(n,r))&&e.push(r);return e},Di=function(n){return Nr(n)?fm(n,!0):yC(n)},EC=function(n,t){return n&&zo(t,Di(t),n)},pm=Du(function(n,t){var e=t&&!t.nodeType&&t,r=e&&n&&!n.nodeType&&n,i=r&&r.exports===e?or.Buffer:void 0,s=i?i.allocUnsafe:void 0;n.exports=function(o,a){if(a)return o.slice();var c=o.length,l=s?s(c):new o.constructor(c);return o.copy(l),l}}),gm=function(n,t){var e=-1,r=n.length;for(t||(t=Array(r));++e<r;)t[e]=n[e];return t},mm=function(n,t){for(var e=-1,r=n==null?0:n.length,i=0,s=[];++e<r;){var o=n[e];t(o,e,n)&&(s[i++]=o)}return s},bm=function(){return[]},xC=Object.prototype.propertyIsEnumerable,hp=Object.getOwnPropertySymbols,Fu=hp?function(n){return n==null?[]:(n=Object(n),mm(hp(n),function(t){return xC.call(n,t)}))}:bm,wC=function(n,t){return zo(n,Fu(n),t)},Gu=function(n,t){for(var e=-1,r=t.length,i=n.length;++e<r;)n[i+e]=t[e];return n},xc=dm(Object.getPrototypeOf,Object),vm=Object.getOwnPropertySymbols?function(n){for(var t=[];n;)Gu(t,Fu(n)),n=xc(n);return t}:bm,AC=function(n,t){return zo(n,vm(n),t)},ym=function(n,t,e){var r=t(n);return Je(n)?r:Gu(r,e(n))},lu=function(n){return ym(n,ni,Fu)},SC=function(n){return ym(n,Di,vm)},uu=Ii(or,"DataView"),hu=Ii(or,"Promise"),cs=Ii(or,"Set"),fu=Ii(or,"WeakMap"),TC=Li(uu),CC=Li(Ao),_C=Li(hu),OC=Li(cs),MC=Li(fu),Ei=ei;(uu&&Ei(new uu(new ArrayBuffer(1)))!="[object DataView]"||Ao&&Ei(new Ao)!="[object Map]"||hu&&Ei(hu.resolve())!="[object Promise]"||cs&&Ei(new cs)!="[object Set]"||fu&&Ei(new fu)!="[object WeakMap]")&&(Ei=function(n){var t=ei(n),e=t=="[object Object]"?n.constructor:void 0,r=e?Li(e):"";if(r)switch(r){case TC:return"[object DataView]";case CC:return"[object Map]";case _C:return"[object Promise]";case OC:return"[object Set]";case MC:return"[object WeakMap]"}return t});var Oi=Ei,PC=Object.prototype.hasOwnProperty,RC=function(n){var t=n.length,e=new n.constructor(t);return t&&typeof n[0]=="string"&&PC.call(n,"index")&&(e.index=n.index,e.input=n.input),e},Va=or.Uint8Array,zu=function(n){var t=new n.constructor(n.byteLength);return new Va(t).set(new Va(n)),t},NC=function(n,t){var e=t?zu(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.byteLength)},LC=/\w*$/,IC=function(n){var t=new n.constructor(n.source,LC.exec(n));return t.lastIndex=n.lastIndex,t},fp=Jn?Jn.prototype:void 0,dp=fp?fp.valueOf:void 0,DC=function(n){return dp?Object(dp.call(n)):{}},Em=function(n,t){var e=t?zu(n.buffer):n.buffer;return new n.constructor(e,n.byteOffset,n.length)},kC=function(n,t,e){var r=n.constructor;switch(t){case"[object ArrayBuffer]":return zu(n);case"[object Boolean]":case"[object Date]":return new r(+n);case"[object DataView]":return NC(n,e);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return Em(n,e);case"[object Map]":return new r;case"[object Number]":case"[object String]":return new r(n);case"[object RegExp]":return IC(n);case"[object Set]":return new r;case"[object Symbol]":return DC(n)}},pp=Object.create,xm=function(){function n(){}return function(t){if(!jn(t))return{};if(pp)return pp(t);n.prototype=t;var e=new n;return n.prototype=void 0,e}}(),wm=function(n){return typeof n.constructor!="function"||Ec(n)?{}:xm(xc(n))},BC=function(n){return rr(n)&&Oi(n)=="[object Map]"},gp=fs&&fs.isMap,jC=gp?yc(gp):BC,FC=function(n){return rr(n)&&Oi(n)=="[object Set]"},mp=fs&&fs.isSet,GC=mp?yc(mp):FC,Le={};Le["[object Arguments]"]=Le["[object Array]"]=Le["[object ArrayBuffer]"]=Le["[object DataView]"]=Le["[object Boolean]"]=Le["[object Date]"]=Le["[object Float32Array]"]=Le["[object Float64Array]"]=Le["[object Int8Array]"]=Le["[object Int16Array]"]=Le["[object Int32Array]"]=Le["[object Map]"]=Le["[object Number]"]=Le["[object Object]"]=Le["[object RegExp]"]=Le["[object Set]"]=Le["[object String]"]=Le["[object Symbol]"]=Le["[object Uint8Array]"]=Le["[object Uint8ClampedArray]"]=Le["[object Uint16Array]"]=Le["[object Uint32Array]"]=!0,Le["[object Error]"]=Le["[object Function]"]=Le["[object WeakMap]"]=!1;var Am=function n(t,e,r,i,s,o){var a,c=1&e,l=2&e,u=4&e;if(a!==void 0)return a;if(!jn(t))return t;var f=Je(t);if(f){if(a=RC(t),!c)return gm(t,a)}else{var h=Oi(t),d=h=="[object Function]"||h=="[object GeneratorFunction]";if(_i(t))return pm(t,c);if(h=="[object Object]"||h=="[object Arguments]"||d&&!s){if(a=l||d?{}:wm(t),!c)return l?AC(t,EC(a,t)):wC(t,mC(a,t))}else{if(!Le[h])return s?t:{};a=kC(t,h,c)}}o||(o=new as);var p=o.get(t);if(p)return p;o.set(t,a),GC(t)?t.forEach(function(b){a.add(n(b,e,r,b,t,o))}):jC(t)&&t.forEach(function(b,v){a.set(v,n(b,e,r,v,t,o))});var m=f?void 0:(u?l?SC:lu:l?Di:ni)(t);return ku(m||t,function(b,v){m&&(b=t[v=b]),bc(a,v,n(b,e,r,v,t,o))}),a},zC=function(n){return Am(n,4)},Uu=function(n){return function(){return n}},Vu=function(n){return function(t,e,r){for(var i=-1,s=Object(t),o=r(t),a=o.length;a--;){var c=o[++i];if(e(s[c],c,s)===!1)break}return t}}(),$u=function(n,t){return n&&Vu(n,t,ni)},wc=function(n,t){return function(e,r){if(e==null)return e;if(!Nr(e))return n(e,r);for(var i=e.length,s=-1,o=Object(e);++s<i&&r(o[s],s,o)!==!1;);return e}}($u),ki=function(n){return n},Sm=function(n){return typeof n=="function"?n:ki},Tm=function(n,t){return(Je(n)?ku:wc)(n,Sm(t))},Cm=Tm,UC=function(n,t){var e=[];return wc(n,function(r,i,s){t(r,i,s)&&e.push(r)}),e},VC=function(n){return this.__data__.set(n,"__lodash_hash_undefined__"),this},$C=function(n){return this.__data__.has(n)};function ka(n){var t=-1,e=n==null?0:n.length;for(this.__data__=new gc;++t<e;)this.add(n[t])}ka.prototype.add=ka.prototype.push=VC,ka.prototype.has=$C;var _m=ka,HC=function(n,t){for(var e=-1,r=n==null?0:n.length;++e<r;)if(t(n[e],e,n))return!0;return!1},Om=function(n,t){return n.has(t)},Mm=function(n,t,e,r,i,s){var o=1&e,a=n.length,c=t.length;if(a!=c&&!(o&&c>a))return!1;var l=s.get(n),u=s.get(t);if(l&&u)return l==t&&u==n;var f=-1,h=!0,d=2&e?new _m:void 0;for(s.set(n,t),s.set(t,n);++f<a;){var p=n[f],m=t[f];if(r)var b=o?r(m,p,f,t,n,s):r(p,m,f,n,t,s);if(b!==void 0){if(b)continue;h=!1;break}if(d){if(!HC(t,function(v,E){if(!Om(d,E)&&(p===v||i(p,v,e,r,s)))return d.push(E)})){h=!1;break}}else if(p!==m&&!i(p,m,e,r,s)){h=!1;break}}return s.delete(n),s.delete(t),h},XC=function(n){var t=-1,e=Array(n.size);return n.forEach(function(r,i){e[++t]=[i,r]}),e},Hu=function(n){var t=-1,e=Array(n.size);return n.forEach(function(r){e[++t]=r}),e},bp=Jn?Jn.prototype:void 0,Vl=bp?bp.valueOf:void 0,WC=function(n,t,e,r,i,s,o){switch(e){case"[object DataView]":if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(n.byteLength!=t.byteLength||!s(new Va(n),new Va(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Ls(+n,+t);case"[object Error]":return n.name==t.name&&n.message==t.message;case"[object RegExp]":case"[object String]":return n==t+"";case"[object Map]":var a=XC;case"[object Set]":var c=1&r;if(a||(a=Hu),n.size!=t.size&&!c)return!1;var l=o.get(n);if(l)return l==t;r|=2,o.set(n,t);var u=Mm(a(n),a(t),r,i,s,o);return o.delete(n),u;case"[object Symbol]":if(Vl)return Vl.call(n)==Vl.call(t)}return!1},qC=Object.prototype.hasOwnProperty,YC=function(n,t,e,r,i,s){var o=1&e,a=lu(n),c=a.length;if(c!=lu(t).length&&!o)return!1;for(var l=c;l--;){var u=a[l];if(!(o?u in t:qC.call(t,u)))return!1}var f=s.get(n),h=s.get(t);if(f&&h)return f==t&&h==n;var d=!0;s.set(n,t),s.set(t,n);for(var p=o;++l<c;){var m=n[u=a[l]],b=t[u];if(r)var v=o?r(b,m,u,t,n,s):r(m,b,u,n,t,s);if(!(v===void 0?m===b||i(m,b,e,r,s):v)){d=!1;break}p||(p=u=="constructor")}if(d&&!p){var E=n.constructor,y=t.constructor;E==y||!("constructor"in n)||!("constructor"in t)||typeof E=="function"&&E instanceof E&&typeof y=="function"&&y instanceof y||(d=!1)}return s.delete(n),s.delete(t),d},vp=Object.prototype.hasOwnProperty,JC=function(n,t,e,r,i,s){var o=Je(n),a=Je(t),c=o?"[object Array]":Oi(n),l=a?"[object Array]":Oi(t),u=(c=c=="[object Arguments]"?"[object Object]":c)=="[object Object]",f=(l=l=="[object Arguments]"?"[object Object]":l)=="[object Object]",h=c==l;if(h&&_i(n)){if(!_i(t))return!1;o=!0,u=!1}if(h&&!u)return s||(s=new as),o||Uo(n)?Mm(n,t,e,r,i,s):WC(n,t,c,e,r,i,s);if(!(1&e)){var d=u&&vp.call(n,"__wrapped__"),p=f&&vp.call(t,"__wrapped__");if(d||p){var m=d?n.value():n,b=p?t.value():t;return s||(s=new as),i(m,b,e,r,s)}}return!!h&&(s||(s=new as),YC(n,t,e,r,i,s))},Pm=function n(t,e,r,i,s){return t===e||(t==null||e==null||!rr(t)&&!rr(e)?t!=t&&e!=e:JC(t,e,r,i,n,s))},KC=function(n,t,e,r){var i=e.length,s=i;if(n==null)return!s;for(n=Object(n);i--;){var o=e[i];if(o[2]?o[1]!==n[o[0]]:!(o[0]in n))return!1}for(;++i<s;){var a=(o=e[i])[0],c=n[a],l=o[1];if(o[2]){if(c===void 0&&!(a in n))return!1}else{var u=new as,f;if(!(f===void 0?Pm(l,c,3,r,u):f))return!1}}return!0},Rm=function(n){return n==n&&!jn(n)},ZC=function(n){for(var t=ni(n),e=t.length;e--;){var r=t[e],i=n[r];t[e]=[r,i,Rm(i)]}return t},Nm=function(n,t){return function(e){return e!=null&&e[n]===t&&(t!==void 0||n in Object(e))}},QC=function(n){var t=ZC(n);return t.length==1&&t[0][2]?Nm(t[0][0],t[0][1]):function(e){return e===n||KC(e,n,t)}},Mi=function(n){return typeof n=="symbol"||rr(n)&&ei(n)=="[object Symbol]"},t_=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,e_=/^\w*$/,Xu=function(n,t){if(Je(n))return!1;var e=typeof n;return!(e!="number"&&e!="symbol"&&e!="boolean"&&n!=null&&!Mi(n))||e_.test(n)||!t_.test(n)||t!=null&&n in Object(t)};function Wu(n,t){if(typeof n!="function"||t!=null&&typeof t!="function")throw new TypeError("Expected a function");var e=function(){var r=arguments,i=t?t.apply(this,r):r[0],s=e.cache;if(s.has(i))return s.get(i);var o=n.apply(this,r);return e.cache=s.set(i,o)||s,o};return e.cache=new(Wu.Cache||gc),e}Wu.Cache=gc;var n_=Wu,r_=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i_=/\\(\\)?/g,s_=function(n){var t=n_(n,function(r){return e.size===500&&e.clear(),r}),e=t.cache;return t}(function(n){var t=[];return n.charCodeAt(0)===46&&t.push(""),n.replace(r_,function(e,r,i,s){t.push(i?s.replace(i_,"$1"):r||e)}),t}),ls=function(n,t){for(var e=-1,r=n==null?0:n.length,i=Array(r);++e<r;)i[e]=t(n[e],e,n);return i},yp=Jn?Jn.prototype:void 0,Ep=yp?yp.toString:void 0,o_=function n(t){if(typeof t=="string")return t;if(Je(t))return ls(t,n)+"";if(Mi(t))return Ep?Ep.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e},Lm=function(n){return n==null?"":o_(n)},Ac=function(n,t){return Je(n)?n:Xu(n,t)?[n]:s_(Lm(n))},Vo=function(n){if(typeof n=="string"||Mi(n))return n;var t=n+"";return t=="0"&&1/n==-1/0?"-0":t},Sc=function(n,t){for(var e=0,r=(t=Ac(t,n)).length;n!=null&&e<r;)n=n[Vo(t[e++])];return e&&e==r?n:void 0},a_=function(n,t,e){var r=n==null?void 0:Sc(n,t);return r===void 0?e:r},c_=function(n,t){return n!=null&&t in Object(n)},Im=function(n,t,e){for(var r=-1,i=(t=Ac(t,n)).length,s=!1;++r<i;){var o=Vo(t[r]);if(!(s=n!=null&&e(n,o)))break;n=n[o]}return s||++r!=i?s:!!(i=n==null?0:n.length)&&Bu(i)&&vc(o,i)&&(Je(n)||hs(n))},Dm=function(n,t){return n!=null&&Im(n,t,c_)},l_=function(n,t){return Xu(n)&&Rm(t)?Nm(Vo(n),t):function(e){var r=a_(e,n);return r===void 0&&r===t?Dm(e,n):Pm(t,r,3)}},km=function(n){return function(t){return t==null?void 0:t[n]}},u_=function(n){return function(t){return Sc(t,n)}},h_=function(n){return Xu(n)?km(Vo(n)):u_(n)},Lr=function(n){return typeof n=="function"?n:n==null?ki:typeof n=="object"?Je(n)?l_(n[0],n[1]):QC(n):h_(n)},Bm=function(n,t){return(Je(n)?mm:UC)(n,Lr(t))},f_=Object.prototype.hasOwnProperty,d_=function(n,t){return n!=null&&f_.call(n,t)},jm=function(n,t){return n!=null&&Im(n,t,d_)},p_=Object.prototype.hasOwnProperty,g_=function(n){if(n==null)return!0;if(Nr(n)&&(Je(n)||typeof n=="string"||typeof n.splice=="function"||_i(n)||Uo(n)||hs(n)))return!n.length;var t=Oi(n);if(t=="[object Map]"||t=="[object Set]")return!n.size;if(Ec(n))return!ju(n).length;for(var e in n)if(p_.call(n,e))return!1;return!0},Fm=function(n){return n===void 0},Gm=function(n,t){var e=-1,r=Nr(n)?Array(n.length):[];return wc(n,function(i,s,o){r[++e]=t(i,s,o)}),r},zm=function(n,t){return(Je(n)?ls:Gm)(n,Lr(t))},m_=function(n,t,e,r){var i=-1,s=n==null?0:n.length;for(r&&s&&(e=n[++i]);++i<s;)e=t(e,n[i],i,n);return e},b_=function(n,t,e,r,i){return i(n,function(s,o,a){e=r?(r=!1,s):t(e,s,o,a)}),e},Um=function(n,t,e){var r=Je(n)?m_:b_,i=arguments.length<3;return r(n,Lr(t),e,i,wc)},v_=function(n){return typeof n=="string"||!Je(n)&&rr(n)&&ei(n)=="[object String]"},y_=km("length"),E_=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]"),x_=function(n){return E_.test(n)},w_="[\\ud800-\\udfff]",du="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",pu="\\ud83c[\\udffb-\\udfff]",Vm="[^\\ud800-\\udfff]",$m="(?:\\ud83c[\\udde6-\\uddff]){2}",Hm="[\\ud800-\\udbff][\\udc00-\\udfff]",xp="(?:"+du+"|"+pu+")?",A_="[\\ufe0e\\ufe0f]?"+xp+("(?:\\u200d(?:"+[Vm,$m,Hm].join("|")+")[\\ufe0e\\ufe0f]?"+xp+")*"),S_="(?:"+[Vm+du+"?",du,$m,Hm,w_].join("|")+")",wp=RegExp(pu+"(?="+pu+")|"+S_+A_,"g"),T_=function(n){for(var t=wp.lastIndex=0;wp.test(n);)++t;return t},C_=function(n){return x_(n)?T_(n):y_(n)},__=function(n){if(n==null)return 0;if(Nr(n))return v_(n)?C_(n):n.length;var t=Oi(n);return t=="[object Map]"||t=="[object Set]"?n.size:ju(n).length},O_=function(n,t,e){var r=Je(n),i=r||_i(n)||Uo(n);if(t=Lr(t),e==null){var s=n&&n.constructor;e=i?r?new s:[]:jn(n)&&Go(s)?xm(xc(n)):{}}return(i?ku:$u)(n,function(o,a,c){return t(e,o,a,c)}),e},Ap=Jn?Jn.isConcatSpreadable:void 0,M_=function(n){return Je(n)||hs(n)||!!(Ap&&n&&n[Ap])},qu=function(t,e,r,i,s){var o=-1,a=t.length;for(r||(r=M_),s||(s=[]);++o<a;){var c=t[o];r(c)?Gu(s,c):i||(s[s.length]=c)}return s},P_=function(n,t,e){switch(e.length){case 0:return n.call(t);case 1:return n.call(t,e[0]);case 2:return n.call(t,e[0],e[1]);case 3:return n.call(t,e[0],e[1],e[2])}return n.apply(t,e)},Sp=Math.max,Xm=function(n,t,e){return t=Sp(t===void 0?n.length-1:t,0),function(){for(var r=arguments,i=-1,s=Sp(r.length-t,0),o=Array(s);++i<s;)o[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=e(o),P_(n,this,a)}},R_=Ua?function(n,t){return Ua(n,"toString",{configurable:!0,enumerable:!1,value:Uu(t),writable:!0})}:ki,N_=Date.now,Wm=function(n){var t=0,e=0;return function(){var r=N_(),i=16-(r-e);if(e=r,i>0){if(++t>=800)return arguments[0]}else t=0;return n.apply(void 0,arguments)}}(R_),Tc=function(n,t){return Wm(Xm(n,t,ki),n+"")},qm=function(n,t,e,r){for(var i=n.length,s=e+-1;++s<i;)if(t(n[s],s,n))return s;return-1},L_=function(n){return n!=n},I_=function(n,t,e){for(var r=e-1,i=n.length;++r<i;)if(n[r]===t)return r;return-1},D_=function(n,t,e){return t==t?I_(n,t,e):qm(n,L_,e)},k_=function(n,t){return!!(n!=null&&n.length)&&D_(n,t,0)>-1},B_=function(){},j_=cs&&1/Hu(new cs([,-0]))[1]==1/0?function(n){return new cs(n)}:B_,F_=function(n,t,e){var r=-1,i=k_,s=n.length,o=!0,a=[],c=a;if(s>=200){var l=j_(n);if(l)return Hu(l);o=!1,i=Om,c=new _m}else c=a;t:for(;++r<s;){var u=n[r],f=u;if(u=u!==0?u:0,o&&f==f){for(var h=c.length;h--;)if(c[h]===f)continue t;a.push(u)}else i(c,f,e)||(c!==a&&c.push(f),a.push(u))}return a},Ym=function(n){return rr(n)&&Nr(n)},G_=Tc(function(n){return F_(qu(n,1,Ym,!0))}),z_=function(n,t){return ls(t,function(e){return n[e]})},$a,Jm=function(n){return n==null?[]:z_(n,ni(n))};try{$a={clone:zC,constant:Uu,each:Cm,filter:Bm,has:jm,isArray:Je,isEmpty:g_,isFunction:Go,isUndefined:Fm,keys:ni,map:zm,reduce:Um,size:__,transform:O_,union:G_,values:Jm}}catch{}$a||($a=window._);var Vt=$a,Yu=we;function we(n){this._isDirected=!Vt.has(n,"directed")||n.directed,this._isMultigraph=!!Vt.has(n,"multigraph")&&n.multigraph,this._isCompound=!!Vt.has(n,"compound")&&n.compound,this._label=void 0,this._defaultNodeLabelFn=Vt.constant(void 0),this._defaultEdgeLabelFn=Vt.constant(void 0),this._nodes={},this._isCompound&&(this._parent={},this._children={},this._children["\0"]={}),this._in={},this._preds={},this._out={},this._sucs={},this._edgeObjs={},this._edgeLabels={}}function Tp(n,t){n[t]?n[t]++:n[t]=1}function Cp(n,t){--n[t]||delete n[t]}function lo(n,t,e,r){var i=""+t,s=""+e;if(!n&&i>s){var o=i;i=s,s=o}return i+""+s+""+(Vt.isUndefined(r)?"\0":r)}function U_(n,t,e,r){var i=""+t,s=""+e;if(!n&&i>s){var o=i;i=s,s=o}var a={v:i,w:s};return r&&(a.name=r),a}function $l(n,t){return lo(n,t.v,t.w,t.name)}we.prototype._nodeCount=0,we.prototype._edgeCount=0,we.prototype.isDirected=function(){return this._isDirected},we.prototype.isMultigraph=function(){return this._isMultigraph},we.prototype.isCompound=function(){return this._isCompound},we.prototype.setGraph=function(n){return this._label=n,this},we.prototype.graph=function(){return this._label},we.prototype.setDefaultNodeLabel=function(n){return Vt.isFunction(n)||(n=Vt.constant(n)),this._defaultNodeLabelFn=n,this},we.prototype.nodeCount=function(){return this._nodeCount},we.prototype.nodes=function(){return Vt.keys(this._nodes)},we.prototype.sources=function(){var n=this;return Vt.filter(this.nodes(),function(t){return Vt.isEmpty(n._in[t])})},we.prototype.sinks=function(){var n=this;return Vt.filter(this.nodes(),function(t){return Vt.isEmpty(n._out[t])})},we.prototype.setNodes=function(n,t){var e=arguments,r=this;return Vt.each(n,function(i){e.length>1?r.setNode(i,t):r.setNode(i)}),this},we.prototype.setNode=function(n,t){return Vt.has(this._nodes,n)?(arguments.length>1&&(this._nodes[n]=t),this):(this._nodes[n]=arguments.length>1?t:this._defaultNodeLabelFn(n),this._isCompound&&(this._parent[n]="\0",this._children[n]={},this._children["\0"][n]=!0),this._in[n]={},this._preds[n]={},this._out[n]={},this._sucs[n]={},++this._nodeCount,this)},we.prototype.node=function(n){return this._nodes[n]},we.prototype.hasNode=function(n){return Vt.has(this._nodes,n)},we.prototype.removeNode=function(n){var t=this;if(Vt.has(this._nodes,n)){var e=function(r){t.removeEdge(t._edgeObjs[r])};delete this._nodes[n],this._isCompound&&(this._removeFromParentsChildList(n),delete this._parent[n],Vt.each(this.children(n),function(r){t.setParent(r)}),delete this._children[n]),Vt.each(Vt.keys(this._in[n]),e),delete this._in[n],delete this._preds[n],Vt.each(Vt.keys(this._out[n]),e),delete this._out[n],delete this._sucs[n],--this._nodeCount}return this},we.prototype.setParent=function(n,t){if(!this._isCompound)throw new Error("Cannot set parent in a non-compound graph");if(Vt.isUndefined(t))t="\0";else{for(var e=t+="";!Vt.isUndefined(e);e=this.parent(e))if(e===n)throw new Error("Setting "+t+" as parent of "+n+" would create a cycle");this.setNode(t)}return this.setNode(n),this._removeFromParentsChildList(n),this._parent[n]=t,this._children[t][n]=!0,this},we.prototype._removeFromParentsChildList=function(n){delete this._children[this._parent[n]][n]},we.prototype.parent=function(n){if(this._isCompound){var t=this._parent[n];if(t!=="\0")return t}},we.prototype.children=function(n){if(Vt.isUndefined(n)&&(n="\0"),this._isCompound){var t=this._children[n];if(t)return Vt.keys(t)}else{if(n==="\0")return this.nodes();if(this.hasNode(n))return[]}},we.prototype.predecessors=function(n){var t=this._preds[n];if(t)return Vt.keys(t)},we.prototype.successors=function(n){var t=this._sucs[n];if(t)return Vt.keys(t)},we.prototype.neighbors=function(n){var t=this.predecessors(n);if(t)return Vt.union(t,this.successors(n))},we.prototype.isLeaf=function(n){return(this.isDirected()?this.successors(n):this.neighbors(n)).length===0},we.prototype.filterNodes=function(n){var t=new this.constructor({directed:this._isDirected,multigraph:this._isMultigraph,compound:this._isCompound});t.setGraph(this.graph());var e=this;Vt.each(this._nodes,function(s,o){n(o)&&t.setNode(o,s)}),Vt.each(this._edgeObjs,function(s){t.hasNode(s.v)&&t.hasNode(s.w)&&t.setEdge(s,e.edge(s))});var r={};function i(s){var o=e.parent(s);return o===void 0||t.hasNode(o)?(r[s]=o,o):o in r?r[o]:i(o)}return this._isCompound&&Vt.each(t.nodes(),function(s){t.setParent(s,i(s))}),t},we.prototype.setDefaultEdgeLabel=function(n){return Vt.isFunction(n)||(n=Vt.constant(n)),this._defaultEdgeLabelFn=n,this},we.prototype.edgeCount=function(){return this._edgeCount},we.prototype.edges=function(){return Vt.values(this._edgeObjs)},we.prototype.setPath=function(n,t){var e=this,r=arguments;return Vt.reduce(n,function(i,s){return r.length>1?e.setEdge(i,s,t):e.setEdge(i,s),s}),this},we.prototype.setEdge=function(){var n,t,e,r,i=!1,s=arguments[0];typeof s=="object"&&s!==null&&"v"in s?(n=s.v,t=s.w,e=s.name,arguments.length===2&&(r=arguments[1],i=!0)):(n=s,t=arguments[1],e=arguments[3],arguments.length>2&&(r=arguments[2],i=!0)),n=""+n,t=""+t,Vt.isUndefined(e)||(e=""+e);var o=lo(this._isDirected,n,t,e);if(Vt.has(this._edgeLabels,o))return i&&(this._edgeLabels[o]=r),this;if(!Vt.isUndefined(e)&&!this._isMultigraph)throw new Error("Cannot set a named edge when isMultigraph = false");this.setNode(n),this.setNode(t),this._edgeLabels[o]=i?r:this._defaultEdgeLabelFn(n,t,e);var a=U_(this._isDirected,n,t,e);return n=a.v,t=a.w,Object.freeze(a),this._edgeObjs[o]=a,Tp(this._preds[t],n),Tp(this._sucs[n],t),this._in[t][o]=a,this._out[n][o]=a,this._edgeCount++,this},we.prototype.edge=function(n,t,e){var r=arguments.length===1?$l(this._isDirected,arguments[0]):lo(this._isDirected,n,t,e);return this._edgeLabels[r]},we.prototype.hasEdge=function(n,t,e){var r=arguments.length===1?$l(this._isDirected,arguments[0]):lo(this._isDirected,n,t,e);return Vt.has(this._edgeLabels,r)},we.prototype.removeEdge=function(n,t,e){var r=arguments.length===1?$l(this._isDirected,arguments[0]):lo(this._isDirected,n,t,e),i=this._edgeObjs[r];return i&&(n=i.v,t=i.w,delete this._edgeLabels[r],delete this._edgeObjs[r],Cp(this._preds[t],n),Cp(this._sucs[n],t),delete this._in[t][r],delete this._out[n][r],this._edgeCount--),this},we.prototype.inEdges=function(n,t){var e=this._in[n];if(e){var r=Vt.values(e);return t?Vt.filter(r,function(i){return i.v===t}):r}},we.prototype.outEdges=function(n,t){var e=this._out[n];if(e){var r=Vt.values(e);return t?Vt.filter(r,function(i){return i.w===t}):r}},we.prototype.nodeEdges=function(n,t){var e=this.inEdges(n,t);if(e)return e.concat(this.outEdges(n,t))};var _p={Graph:Yu,version:"2.1.8"},V_={write:function(n){var t={options:{directed:n.isDirected(),multigraph:n.isMultigraph(),compound:n.isCompound()},nodes:$_(n),edges:H_(n)};return Vt.isUndefined(n.graph())||(t.value=Vt.clone(n.graph())),t},read:function(n){var t=new Yu(n.options).setGraph(n.value);return Vt.each(n.nodes,function(e){t.setNode(e.v,e.value),e.parent&&t.setParent(e.v,e.parent)}),Vt.each(n.edges,function(e){t.setEdge({v:e.v,w:e.w,name:e.name},e.value)}),t}};function $_(n){return Vt.map(n.nodes(),function(t){var e=n.node(t),r=n.parent(t),i={v:t};return Vt.isUndefined(e)||(i.value=e),Vt.isUndefined(r)||(i.parent=r),i})}function H_(n){return Vt.map(n.edges(),function(t){var e=n.edge(t),r={v:t.v,w:t.w};return Vt.isUndefined(t.name)||(r.name=t.name),Vt.isUndefined(e)||(r.value=e),r})}var X_=function(n){var t,e={},r=[];function i(s){Vt.has(e,s)||(e[s]=!0,t.push(s),Vt.each(n.successors(s),i),Vt.each(n.predecessors(s),i))}return Vt.each(n.nodes(),function(s){t=[],i(s),t.length&&r.push(t)}),r},Km=Hn;function Hn(){this._arr=[],this._keyIndices={}}Hn.prototype.size=function(){return this._arr.length},Hn.prototype.keys=function(){return this._arr.map(function(n){return n.key})},Hn.prototype.has=function(n){return Vt.has(this._keyIndices,n)},Hn.prototype.priority=function(n){var t=this._keyIndices[n];if(t!==void 0)return this._arr[t].priority},Hn.prototype.min=function(){if(this.size()===0)throw new Error("Queue underflow");return this._arr[0].key},Hn.prototype.add=function(n,t){var e=this._keyIndices;if(n=String(n),!Vt.has(e,n)){var r=this._arr,i=r.length;return e[n]=i,r.push({key:n,priority:t}),this._decrease(i),!0}return!1},Hn.prototype.removeMin=function(){this._swap(0,this._arr.length-1);var n=this._arr.pop();return delete this._keyIndices[n.key],this._heapify(0),n.key},Hn.prototype.decrease=function(n,t){var e=this._keyIndices[n];if(t>this._arr[e].priority)throw new Error("New priority is greater than current priority. Key: "+n+" Old: "+this._arr[e].priority+" New: "+t);this._arr[e].priority=t,this._decrease(e)},Hn.prototype._heapify=function(n){var t=this._arr,e=2*n,r=e+1,i=n;e<t.length&&(i=t[e].priority<t[i].priority?e:i,r<t.length&&(i=t[r].priority<t[i].priority?r:i),i!==n&&(this._swap(n,i),this._heapify(i)))},Hn.prototype._decrease=function(n){for(var t,e=this._arr,r=e[n].priority;n!==0&&!(e[t=n>>1].priority<r);)this._swap(n,t),n=t},Hn.prototype._swap=function(n,t){var e=this._arr,r=this._keyIndices,i=e[n],s=e[t];e[n]=s,e[t]=i,r[s.key]=n,r[i.key]=t};var Zm=function(n,t,e,r){return function(i,s,o,a){var c,l,u={},f=new Km,h=function(d){var p=d.v!==c?d.v:d.w,m=u[p],b=o(d),v=l.distance+b;if(b<0)throw new Error("dijkstra does not allow negative edge weights. Bad edge: "+d+" Weight: "+b);v<m.distance&&(m.distance=v,m.predecessor=c,f.decrease(p,v))};for(i.nodes().forEach(function(d){var p=d===s?0:Number.POSITIVE_INFINITY;u[d]={distance:p},f.add(d,p)});f.size()>0&&(c=f.removeMin(),(l=u[c]).distance!==Number.POSITIVE_INFINITY);)a(c).forEach(h);return u}(n,String(t),e||W_,r||function(i){return n.outEdges(i)})},W_=Vt.constant(1),q_=function(n,t,e){return Vt.transform(n.nodes(),function(r,i){r[i]=Zm(n,i,t,e)},{})},Qm=function(n){var t=0,e=[],r={},i=[];function s(o){var a=r[o]={onStack:!0,lowlink:t,index:t++};if(e.push(o),n.successors(o).forEach(function(u){Vt.has(r,u)?r[u].onStack&&(a.lowlink=Math.min(a.lowlink,r[u].index)):(s(u),a.lowlink=Math.min(a.lowlink,r[u].lowlink))}),a.lowlink===a.index){var c,l=[];do c=e.pop(),r[c].onStack=!1,l.push(c);while(o!==c);i.push(l)}}return n.nodes().forEach(function(o){Vt.has(r,o)||s(o)}),i},Y_=function(n){return Vt.filter(Qm(n),function(t){return t.length>1||t.length===1&&n.hasEdge(t[0],t[0])})},J_=function(n,t,e){return function(r,i,s){var o={},a=r.nodes();return a.forEach(function(c){o[c]={},o[c][c]={distance:0},a.forEach(function(l){c!==l&&(o[c][l]={distance:Number.POSITIVE_INFINITY})}),s(c).forEach(function(l){var u=l.v===c?l.w:l.v,f=i(l);o[c][u]={distance:f,predecessor:c}})}),a.forEach(function(c){var l=o[c];a.forEach(function(u){var f=o[u];a.forEach(function(h){var d=f[c],p=l[h],m=f[h],b=d.distance+p.distance;b<m.distance&&(m.distance=b,m.predecessor=p.predecessor)})})}),o}(n,t||K_,e||function(r){return n.outEdges(r)})},K_=Vt.constant(1),Hl=tb;function tb(n){var t={},e={},r=[];if(Vt.each(n.sinks(),function i(s){if(Vt.has(e,s))throw new Ha;Vt.has(t,s)||(e[s]=!0,t[s]=!0,Vt.each(n.predecessors(s),i),delete e[s],r.push(s))}),Vt.size(t)!==n.nodeCount())throw new Ha;return r}function Ha(){}tb.CycleException=Ha,Ha.prototype=new Error;var Op=function(n,t,e){Vt.isArray(t)||(t=[t]);var r=(n.isDirected()?n.successors:n.neighbors).bind(n),i=[],s={};return Vt.each(t,function(o){if(!n.hasNode(o))throw new Error("Graph does not have node: "+o);eb(n,o,e==="post",s,r,i)}),i};function eb(n,t,e,r,i,s){Vt.has(r,t)||(r[t]=!0,e||s.push(t),Vt.each(i(t),function(o){eb(n,o,e,r,i,s)}),e&&s.push(t))}var Xa,Z_={Graph:_p.Graph,json:V_,alg:{components:X_,dijkstra:Zm,dijkstraAll:q_,findCycles:Y_,floydWarshall:J_,isAcyclic:function(n){try{Hl(n)}catch(t){if(t instanceof Hl.CycleException)return!1;throw t}return!0},postorder:function(n,t){return Op(n,t,"post")},preorder:function(n,t){return Op(n,t,"pre")},prim:function(n,t){var e,r=new Yu,i={},s=new Km;function o(c){var l=c.v===e?c.w:c.v,u=s.priority(l);if(u!==void 0){var f=t(c);f<u&&(i[l]=e,s.decrease(l,f))}}if(n.nodeCount()===0)return r;Vt.each(n.nodes(),function(c){s.add(c,Number.POSITIVE_INFINITY),r.setNode(c)}),s.decrease(n.nodes()[0],0);for(var a=!1;s.size()>0;){if(e=s.removeMin(),Vt.has(i,e))r.setEdge(e,i[e]);else{if(a)throw new Error("Input graph is not connected: "+n);a=!0}n.nodeEdges(e).forEach(o)}return r},tarjan:Qm,topsort:Hl},version:_p.version};try{Xa=Z_}catch{}Xa||(Xa=window.graphlib);var Er=Xa,Q_=function(n){return Am(n,5)},To=function(n,t,e){if(!jn(e))return!1;var r=typeof t;return!!(r=="number"?Nr(e)&&vc(t,e.length):r=="string"&&t in e)&&Ls(e[t],n)},nb=Object.prototype,tO=nb.hasOwnProperty,eO=Tc(function(n,t){n=Object(n);var e=-1,r=t.length,i=r>2?t[2]:void 0;for(i&&To(t[0],t[1],i)&&(r=1);++e<r;)for(var s=t[e],o=Di(s),a=-1,c=o.length;++a<c;){var l=o[a],u=n[l];(u===void 0||Ls(u,nb[l])&&!tO.call(n,l))&&(n[l]=s[l])}return n}),nO=function(n){return function(t,e,r){var i=Object(t);if(!Nr(t)){var s=Lr(e);t=ni(t),e=function(a){return s(i[a],a,i)}}var o=n(t,e,r);return o>-1?i[s?t[o]:o]:void 0}},rO=/^\s+|\s+$/g,iO=/^[-+]0x[0-9a-f]+$/i,sO=/^0b[01]+$/i,oO=/^0o[0-7]+$/i,aO=parseInt,cO=function(n){if(typeof n=="number")return n;if(Mi(n))return NaN;if(jn(n)){var t=typeof n.valueOf=="function"?n.valueOf():n;n=jn(t)?t+"":t}if(typeof n!="string")return n===0?n:+n;n=n.replace(rO,"");var e=sO.test(n);return e||oO.test(n)?aO(n.slice(2),e?2:8):iO.test(n)?NaN:+n},Ba=function(n){return n?(n=cO(n))===1/0||n===-1/0?17976931348623157e292*(n<0?-1:1):n==n?n:0:n===0?n:0},lO=function(n){var t=Ba(n),e=t%1;return t==t?e?t-e:t:0},uO=Math.max,hO=nO(function(n,t,e){var r=n==null?0:n.length;if(!r)return-1;var i=e==null?0:lO(e);return i<0&&(i=uO(r+i,0)),qm(n,Lr(t),i)}),rb=function(n){return n!=null&&n.length?qu(n):[]},fO=function(n,t){return n==null?n:Vu(n,Sm(t),Di)},dO=function(n){var t=n==null?0:n.length;return t?n[t-1]:void 0},pO=function(n,t){var e={};return t=Lr(t),$u(n,function(r,i,s){mc(e,i,t(r,i,s))}),e},Ju=function(n,t,e){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=t(s);if(o!=null&&(a===void 0?o==o&&!Mi(o):e(o,a)))var a=o,c=s}return c},gO=function(n,t){return n>t},mO=function(n){return n&&n.length?Ju(n,ki,gO):void 0},gu=function(n,t,e){(e!==void 0&&!Ls(n[t],e)||e===void 0&&!(t in n))&&mc(n,t,e)},bO=Function.prototype,vO=Object.prototype,ib=bO.toString,yO=vO.hasOwnProperty,EO=ib.call(Object),xO=function(n){if(!rr(n)||ei(n)!="[object Object]")return!1;var t=xc(n);if(t===null)return!0;var e=yO.call(t,"constructor")&&t.constructor;return typeof e=="function"&&e instanceof e&&ib.call(e)==EO},Mp=function(n,t){if((t!=="constructor"||typeof n[t]!="function")&&t!="__proto__")return n[t]},wO=function(n){return zo(n,Di(n))},AO=function(n,t,e,r,i,s,o){var a=Mp(n,e),c=Mp(t,e),l=o.get(c);if(l)gu(n,e,l);else{var u=void 0,f=u===void 0;if(f){var h=Je(c),d=!h&&_i(c),p=!h&&!d&&Uo(c);u=c,h||d||p?Je(a)?u=a:Ym(a)?u=gm(a):d?(f=!1,u=pm(c,!0)):p?(f=!1,u=Em(c,!0)):u=[]:xO(c)||hs(c)?(u=a,hs(a)?u=wO(a):jn(a)&&!Go(a)||(u=wm(c))):f=!1}f&&(o.set(c,u),i(u,c,r,s,o),o.delete(c)),gu(n,e,u)}},SO=function n(t,e,r,i,s){t!==e&&Vu(e,function(o,a){if(s||(s=new as),jn(o))AO(t,e,a,r,n,i,s);else{var c=void 0;c===void 0&&(c=o),gu(t,a,c)}},Di)},TO=function(n){return Tc(function(t,e){var r=-1,i=e.length,s=i>1?e[i-1]:void 0,o=i>2?e[2]:void 0;for(s=n.length>3&&typeof s=="function"?(i--,s):void 0,o&&To(e[0],e[1],o)&&(s=i<3?void 0:s,i=1),t=Object(t);++r<i;){var a=e[r];a&&n(t,a,r,s)}return t})}(function(n,t,e){SO(n,t,e)}),sb=function(n,t){return n<t},CO=function(n){return n&&n.length?Ju(n,ki,sb):void 0},_O=function(n,t){return n&&n.length?Ju(n,Lr(t),sb):void 0},OO=function(){return or.Date.now()},MO=function(n,t,e,r){if(!jn(n))return n;for(var i=-1,s=(t=Ac(t,n)).length,o=s-1,a=n;a!=null&&++i<s;){var c=Vo(t[i]),l=e;if(c==="__proto__"||c==="constructor"||c==="prototype")return n;if(i!=o){var u=a[c];(l=void 0)==void 0&&(l=jn(u)?u:vc(t[i+1])?[]:{})}bc(a,c,l),a=a[c]}return n},PO=function(n,t,e){for(var r=-1,i=t.length,s={};++r<i;){var o=t[r],a=Sc(n,o);e(a,o)&&MO(s,Ac(o,n),a)}return s},RO=function(n,t){return PO(n,t,function(e,r){return Dm(n,r)})},NO=function(n){return Wm(Xm(n,void 0,rb),n+"")}(function(n,t){return n==null?{}:RO(n,t)}),LO=Math.ceil,IO=Math.max,DO=function(n,t,e,r){for(var i=-1,s=IO(LO((t-n)/(e||1)),0),o=Array(s);s--;)o[++i]=n,n+=e;return o},kO=function(n){return function(t,e,r){return r&&typeof r!="number"&&To(t,e,r)&&(e=r=void 0),t=Ba(t),e===void 0?(e=t,t=0):e=Ba(e),r=r===void 0?t<e?1:-1:Ba(r),DO(t,e,r)}}(),BO=function(n,t){var e=n.length;for(n.sort(t);e--;)n[e]=n[e].value;return n},jO=function(n,t){if(n!==t){var e=n!==void 0,r=n===null,i=n==n,s=Mi(n),o=t!==void 0,a=t===null,c=t==t,l=Mi(t);if(!a&&!l&&!s&&n>t||s&&o&&c&&!a&&!l||r&&o&&c||!e&&c||!i)return 1;if(!r&&!s&&!l&&n<t||l&&e&&i&&!r&&!s||a&&e&&i||!o&&i||!c)return-1}return 0},FO=function(n,t,e){for(var r=-1,i=n.criteria,s=t.criteria,o=i.length,a=e.length;++r<o;){var c=jO(i[r],s[r]);if(c)return r>=a?c:c*(e[r]=="desc"?-1:1)}return n.index-t.index},GO=function(n,t,e){t=t.length?ls(t,function(s){return Je(s)?function(o){return Sc(o,s.length===1?s[0]:s)}:s}):[ki];var r=-1;t=ls(t,yc(Lr));var i=Gm(n,function(s,o,a){return{criteria:ls(t,function(c){return c(s)}),index:++r,value:s}});return BO(i,function(s,o){return FO(s,o,e)})},zO=Tc(function(n,t){if(n==null)return[];var e=t.length;return e>1&&To(n,t[0],t[1])?t=[]:e>2&&To(t[0],t[1],t[2])&&(t=[t[0]]),GO(n,qu(t),[])}),UO=0,VO=function(n){var t=++UO;return Lm(n)+t},$O=function(n,t,e){for(var r=-1,i=n.length,s=t.length,o={};++r<i;){var a=r<s?t[r]:void 0;e(o,n[r],a)}return o},Wa,HO=function(n,t){return $O(n||[],t||[],bc)};try{Wa={cloneDeep:Q_,constant:Uu,defaults:eO,each:Cm,filter:Bm,find:hO,flatten:rb,forEach:Tm,forIn:fO,has:jm,isUndefined:Fm,last:dO,map:zm,mapValues:pO,max:mO,merge:TO,min:CO,minBy:_O,now:OO,pick:NO,range:kO,reduce:Um,sortBy:zO,uniqueId:VO,values:Jm,zipObject:HO}}catch{}Wa||(Wa=window._);var XO=Wa;Er.Graph;XO.constant(1);Er.Graph;Er.Graph;Er.alg.preorder;Er.alg.postorder;Er.Graph;Er.Graph;Er.Graph;Er.Graph;Er.Graph;function Co(n){"@babel/helpers - typeof";return Co=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Co(n)}function WO(n,t){if(Co(n)!="object"||!n)return n;var e=n[Symbol.toPrimitive];if(e!==void 0){var r=e.call(n,t||"default");if(Co(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(n)}function qO(n){var t=WO(n,"string");return Co(t)=="symbol"?t:t+""}function kt(n,t,e){return(t=qO(t))in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}var YO=typeof co=="object"&&co&&co.Object===Object&&co,ob=YO,JO=ob,KO=typeof self=="object"&&self&&self.Object===Object&&self,ZO=JO||KO||Function("return this")(),QO=ZO,tM=QO,eM=tM.Symbol,ab=eM,Pp=ab;Pp&&Pp.toStringTag;var Rp=ab;Rp&&Rp.toStringTag;var qa={exports:{}};qa.exports;(function(n,t){var e=ob,r=t&&!t.nodeType&&t,i=r&&!0&&n&&!n.nodeType&&n,s=i&&i.exports===r,o=s&&e.process,a=function(){try{var c=i&&i.require&&i.require("util").types;return c||o&&o.binding&&o.binding("util")}catch{}}();n.exports=a})(qa,qa.exports);var nM=qa.exports,Np=nM;Np&&Np.isTypedArray;var cb={exports:{}},lb={exports:{}};(function(n){function t(e){"@babel/helpers - typeof";return n.exports=t=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},n.exports.__esModule=!0,n.exports.default=n.exports,t(e)}n.exports=t,n.exports.__esModule=!0,n.exports.default=n.exports})(lb);var rM=lb.exports;(function(n){var t=rM.default;function e(){n.exports=e=function(){return i},n.exports.__esModule=!0,n.exports.default=n.exports;var r,i={},s=Object.prototype,o=s.hasOwnProperty,a=Object.defineProperty||function(ot,et,K){ot[et]=K.value},c=typeof Symbol=="function"?Symbol:{},l=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",f=c.toStringTag||"@@toStringTag";function h(ot,et,K){return Object.defineProperty(ot,et,{value:K,enumerable:!0,configurable:!0,writable:!0}),ot[et]}try{h({},"")}catch{h=function(K,Ct,Lt){return K[Ct]=Lt}}function d(ot,et,K,Ct){var Lt=et&&et.prototype instanceof O?et:O,Ot=Object.create(Lt.prototype),re=new Rt(Ct||[]);return a(Ot,"_invoke",{value:Ut(ot,K,re)}),Ot}function p(ot,et,K){try{return{type:"normal",arg:ot.call(et,K)}}catch(Ct){return{type:"throw",arg:Ct}}}i.wrap=d;var m="suspendedStart",b="suspendedYield",v="executing",E="completed",y={};function O(){}function I(){}function G(){}var k={};h(k,l,function(){return this});var X=Object.getPrototypeOf,Z=X&&X(X(Xt([])));Z&&Z!==s&&o.call(Z,l)&&(k=Z);var at=G.prototype=O.prototype=Object.create(k);function ft(ot){["next","throw","return"].forEach(function(et){h(ot,et,function(K){return this._invoke(et,K)})})}function H(ot,et){function K(Lt,Ot,re,be){var ee=p(ot[Lt],ot,Ot);if(ee.type!=="throw"){var Oe=ee.arg,Zt=Oe.value;return Zt&&t(Zt)=="object"&&o.call(Zt,"__await")?et.resolve(Zt.__await).then(function(Yt){K("next",Yt,re,be)},function(Yt){K("throw",Yt,re,be)}):et.resolve(Zt).then(function(Yt){Oe.value=Yt,re(Oe)},function(Yt){return K("throw",Yt,re,be)})}be(ee.arg)}var Ct;a(this,"_invoke",{value:function(Ot,re){function be(){return new et(function(ee,Oe){K(Ot,re,ee,Oe)})}return Ct=Ct?Ct.then(be,be):be()}})}function Ut(ot,et,K){var Ct=m;return function(Lt,Ot){if(Ct===v)throw Error("Generator is already running");if(Ct===E){if(Lt==="throw")throw Ot;return{value:r,done:!0}}for(K.method=Lt,K.arg=Ot;;){var re=K.delegate;if(re){var be=zt(re,K);if(be){if(be===y)continue;return be}}if(K.method==="next")K.sent=K._sent=K.arg;else if(K.method==="throw"){if(Ct===m)throw Ct=E,K.arg;K.dispatchException(K.arg)}else K.method==="return"&&K.abrupt("return",K.arg);Ct=v;var ee=p(ot,et,K);if(ee.type==="normal"){if(Ct=K.done?E:b,ee.arg===y)continue;return{value:ee.arg,done:K.done}}ee.type==="throw"&&(Ct=E,K.method="throw",K.arg=ee.arg)}}}function zt(ot,et){var K=et.method,Ct=ot.iterator[K];if(Ct===r)return et.delegate=null,K==="throw"&&ot.iterator.return&&(et.method="return",et.arg=r,zt(ot,et),et.method==="throw")||K!=="return"&&(et.method="throw",et.arg=new TypeError("The iterator does not provide a '"+K+"' method")),y;var Lt=p(Ct,ot.iterator,et.arg);if(Lt.type==="throw")return et.method="throw",et.arg=Lt.arg,et.delegate=null,y;var Ot=Lt.arg;return Ot?Ot.done?(et[ot.resultName]=Ot.value,et.next=ot.nextLoc,et.method!=="return"&&(et.method="next",et.arg=r),et.delegate=null,y):Ot:(et.method="throw",et.arg=new TypeError("iterator result is not an object"),et.delegate=null,y)}function W(ot){var et={tryLoc:ot[0]};1 in ot&&(et.catchLoc=ot[1]),2 in ot&&(et.finallyLoc=ot[2],et.afterLoc=ot[3]),this.tryEntries.push(et)}function lt(ot){var et=ot.completion||{};et.type="normal",delete et.arg,ot.completion=et}function Rt(ot){this.tryEntries=[{tryLoc:"root"}],ot.forEach(W,this),this.reset(!0)}function Xt(ot){if(ot||ot===""){var et=ot[l];if(et)return et.call(ot);if(typeof ot.next=="function")return ot;if(!isNaN(ot.length)){var K=-1,Ct=function Lt(){for(;++K<ot.length;)if(o.call(ot,K))return Lt.value=ot[K],Lt.done=!1,Lt;return Lt.value=r,Lt.done=!0,Lt};return Ct.next=Ct}}throw new TypeError(t(ot)+" is not iterable")}return I.prototype=G,a(at,"constructor",{value:G,configurable:!0}),a(G,"constructor",{value:I,configurable:!0}),I.displayName=h(G,f,"GeneratorFunction"),i.isGeneratorFunction=function(ot){var et=typeof ot=="function"&&ot.constructor;return!!et&&(et===I||(et.displayName||et.name)==="GeneratorFunction")},i.mark=function(ot){return Object.setPrototypeOf?Object.setPrototypeOf(ot,G):(ot.__proto__=G,h(ot,f,"GeneratorFunction")),ot.prototype=Object.create(at),ot},i.awrap=function(ot){return{__await:ot}},ft(H.prototype),h(H.prototype,u,function(){return this}),i.AsyncIterator=H,i.async=function(ot,et,K,Ct,Lt){Lt===void 0&&(Lt=Promise);var Ot=new H(d(ot,et,K,Ct),Lt);return i.isGeneratorFunction(et)?Ot:Ot.next().then(function(re){return re.done?re.value:Ot.next()})},ft(at),h(at,f,"Generator"),h(at,l,function(){return this}),h(at,"toString",function(){return"[object Generator]"}),i.keys=function(ot){var et=Object(ot),K=[];for(var Ct in et)K.push(Ct);return K.reverse(),function Lt(){for(;K.length;){var Ot=K.pop();if(Ot in et)return Lt.value=Ot,Lt.done=!1,Lt}return Lt.done=!0,Lt}},i.values=Xt,Rt.prototype={constructor:Rt,reset:function(et){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(lt),!et)for(var K in this)K.charAt(0)==="t"&&o.call(this,K)&&!isNaN(+K.slice(1))&&(this[K]=r)},stop:function(){this.done=!0;var et=this.tryEntries[0].completion;if(et.type==="throw")throw et.arg;return this.rval},dispatchException:function(et){if(this.done)throw et;var K=this;function Ct(Oe,Zt){return re.type="throw",re.arg=et,K.next=Oe,Zt&&(K.method="next",K.arg=r),!!Zt}for(var Lt=this.tryEntries.length-1;Lt>=0;--Lt){var Ot=this.tryEntries[Lt],re=Ot.completion;if(Ot.tryLoc==="root")return Ct("end");if(Ot.tryLoc<=this.prev){var be=o.call(Ot,"catchLoc"),ee=o.call(Ot,"finallyLoc");if(be&&ee){if(this.prev<Ot.catchLoc)return Ct(Ot.catchLoc,!0);if(this.prev<Ot.finallyLoc)return Ct(Ot.finallyLoc)}else if(be){if(this.prev<Ot.catchLoc)return Ct(Ot.catchLoc,!0)}else{if(!ee)throw Error("try statement without catch or finally");if(this.prev<Ot.finallyLoc)return Ct(Ot.finallyLoc)}}}},abrupt:function(et,K){for(var Ct=this.tryEntries.length-1;Ct>=0;--Ct){var Lt=this.tryEntries[Ct];if(Lt.tryLoc<=this.prev&&o.call(Lt,"finallyLoc")&&this.prev<Lt.finallyLoc){var Ot=Lt;break}}Ot&&(et==="break"||et==="continue")&&Ot.tryLoc<=K&&K<=Ot.finallyLoc&&(Ot=null);var re=Ot?Ot.completion:{};return re.type=et,re.arg=K,Ot?(this.method="next",this.next=Ot.finallyLoc,y):this.complete(re)},complete:function(et,K){if(et.type==="throw")throw et.arg;return et.type==="break"||et.type==="continue"?this.next=et.arg:et.type==="return"?(this.rval=this.arg=et.arg,this.method="return",this.next="end"):et.type==="normal"&&K&&(this.next=K),y},finish:function(et){for(var K=this.tryEntries.length-1;K>=0;--K){var Ct=this.tryEntries[K];if(Ct.finallyLoc===et)return this.complete(Ct.completion,Ct.afterLoc),lt(Ct),y}},catch:function(et){for(var K=this.tryEntries.length-1;K>=0;--K){var Ct=this.tryEntries[K];if(Ct.tryLoc===et){var Lt=Ct.completion;if(Lt.type==="throw"){var Ot=Lt.arg;lt(Ct)}return Ot}}throw Error("illegal catch attempt")},delegateYield:function(et,K,Ct){return this.delegate={iterator:Xt(et),resultName:K,nextLoc:Ct},this.method==="next"&&(this.arg=r),y}},i}n.exports=e,n.exports.__esModule=!0,n.exports.default=n.exports})(cb);var iM=cb.exports,Xl=iM();try{regeneratorRuntime=Xl}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=Xl:Function("r","regeneratorRuntime = r")(Xl)}var It;(function(n){n[n.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",n[n.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",n[n.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",n[n.POINTS=0]="POINTS",n[n.LINES=1]="LINES",n[n.LINE_LOOP=2]="LINE_LOOP",n[n.LINE_STRIP=3]="LINE_STRIP",n[n.TRIANGLES=4]="TRIANGLES",n[n.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",n[n.TRIANGLE_FAN=6]="TRIANGLE_FAN",n[n.ZERO=0]="ZERO",n[n.ONE=1]="ONE",n[n.SRC_COLOR=768]="SRC_COLOR",n[n.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",n[n.SRC_ALPHA=770]="SRC_ALPHA",n[n.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",n[n.DST_ALPHA=772]="DST_ALPHA",n[n.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",n[n.DST_COLOR=774]="DST_COLOR",n[n.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",n[n.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",n[n.FUNC_ADD=32774]="FUNC_ADD",n[n.BLEND_EQUATION=32777]="BLEND_EQUATION",n[n.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",n[n.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",n[n.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",n[n.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",n[n.MAX_EXT=32776]="MAX_EXT",n[n.MIN_EXT=32775]="MIN_EXT",n[n.BLEND_DST_RGB=32968]="BLEND_DST_RGB",n[n.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",n[n.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",n[n.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",n[n.CONSTANT_COLOR=32769]="CONSTANT_COLOR",n[n.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",n[n.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",n[n.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",n[n.BLEND_COLOR=32773]="BLEND_COLOR",n[n.ARRAY_BUFFER=34962]="ARRAY_BUFFER",n[n.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",n[n.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",n[n.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",n[n.STREAM_DRAW=35040]="STREAM_DRAW",n[n.STATIC_DRAW=35044]="STATIC_DRAW",n[n.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",n[n.BUFFER_SIZE=34660]="BUFFER_SIZE",n[n.BUFFER_USAGE=34661]="BUFFER_USAGE",n[n.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",n[n.FRONT=1028]="FRONT",n[n.BACK=1029]="BACK",n[n.FRONT_AND_BACK=1032]="FRONT_AND_BACK",n[n.CULL_FACE=2884]="CULL_FACE",n[n.BLEND=3042]="BLEND",n[n.DITHER=3024]="DITHER",n[n.STENCIL_TEST=2960]="STENCIL_TEST",n[n.DEPTH_TEST=2929]="DEPTH_TEST",n[n.SCISSOR_TEST=3089]="SCISSOR_TEST",n[n.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",n[n.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",n[n.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",n[n.NO_ERROR=0]="NO_ERROR",n[n.INVALID_ENUM=1280]="INVALID_ENUM",n[n.INVALID_VALUE=1281]="INVALID_VALUE",n[n.INVALID_OPERATION=1282]="INVALID_OPERATION",n[n.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",n[n.CW=2304]="CW",n[n.CCW=2305]="CCW",n[n.LINE_WIDTH=2849]="LINE_WIDTH",n[n.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",n[n.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",n[n.CULL_FACE_MODE=2885]="CULL_FACE_MODE",n[n.FRONT_FACE=2886]="FRONT_FACE",n[n.DEPTH_RANGE=2928]="DEPTH_RANGE",n[n.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",n[n.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",n[n.DEPTH_FUNC=2932]="DEPTH_FUNC",n[n.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",n[n.STENCIL_FUNC=2962]="STENCIL_FUNC",n[n.STENCIL_FAIL=2964]="STENCIL_FAIL",n[n.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",n[n.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",n[n.STENCIL_REF=2967]="STENCIL_REF",n[n.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",n[n.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",n[n.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",n[n.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",n[n.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",n[n.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",n[n.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",n[n.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",n[n.VIEWPORT=2978]="VIEWPORT",n[n.SCISSOR_BOX=3088]="SCISSOR_BOX",n[n.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",n[n.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",n[n.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",n[n.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",n[n.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",n[n.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",n[n.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",n[n.RED_BITS=3410]="RED_BITS",n[n.GREEN_BITS=3411]="GREEN_BITS",n[n.BLUE_BITS=3412]="BLUE_BITS",n[n.ALPHA_BITS=3413]="ALPHA_BITS",n[n.DEPTH_BITS=3414]="DEPTH_BITS",n[n.STENCIL_BITS=3415]="STENCIL_BITS",n[n.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",n[n.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",n[n.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",n[n.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",n[n.SAMPLES=32937]="SAMPLES",n[n.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",n[n.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",n[n.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",n[n.DONT_CARE=4352]="DONT_CARE",n[n.FASTEST=4353]="FASTEST",n[n.NICEST=4354]="NICEST",n[n.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",n[n.BYTE=5120]="BYTE",n[n.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",n[n.SHORT=5122]="SHORT",n[n.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",n[n.INT=5124]="INT",n[n.UNSIGNED_INT=5125]="UNSIGNED_INT",n[n.FLOAT=5126]="FLOAT",n[n.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",n[n.ALPHA=6406]="ALPHA",n[n.RGB=6407]="RGB",n[n.RGBA=6408]="RGBA",n[n.LUMINANCE=6409]="LUMINANCE",n[n.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",n[n.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",n[n.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",n[n.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",n[n.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",n[n.VERTEX_SHADER=35633]="VERTEX_SHADER",n[n.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",n[n.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",n[n.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",n[n.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",n[n.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",n[n.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",n[n.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",n[n.SHADER_TYPE=35663]="SHADER_TYPE",n[n.DELETE_STATUS=35712]="DELETE_STATUS",n[n.LINK_STATUS=35714]="LINK_STATUS",n[n.VALIDATE_STATUS=35715]="VALIDATE_STATUS",n[n.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",n[n.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",n[n.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",n[n.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",n[n.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",n[n.NEVER=512]="NEVER",n[n.LESS=513]="LESS",n[n.EQUAL=514]="EQUAL",n[n.LEQUAL=515]="LEQUAL",n[n.GREATER=516]="GREATER",n[n.NOTEQUAL=517]="NOTEQUAL",n[n.GEQUAL=518]="GEQUAL",n[n.ALWAYS=519]="ALWAYS",n[n.KEEP=7680]="KEEP",n[n.REPLACE=7681]="REPLACE",n[n.INCR=7682]="INCR",n[n.DECR=7683]="DECR",n[n.INVERT=5386]="INVERT",n[n.INCR_WRAP=34055]="INCR_WRAP",n[n.DECR_WRAP=34056]="DECR_WRAP",n[n.VENDOR=7936]="VENDOR",n[n.RENDERER=7937]="RENDERER",n[n.VERSION=7938]="VERSION",n[n.NEAREST=9728]="NEAREST",n[n.LINEAR=9729]="LINEAR",n[n.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",n[n.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",n[n.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",n[n.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",n[n.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",n[n.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",n[n.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",n[n.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",n[n.TEXTURE_2D=3553]="TEXTURE_2D",n[n.TEXTURE=5890]="TEXTURE",n[n.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",n[n.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",n[n.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",n[n.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",n[n.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",n[n.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",n[n.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",n[n.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",n[n.TEXTURE0=33984]="TEXTURE0",n[n.TEXTURE1=33985]="TEXTURE1",n[n.TEXTURE2=33986]="TEXTURE2",n[n.TEXTURE3=33987]="TEXTURE3",n[n.TEXTURE4=33988]="TEXTURE4",n[n.TEXTURE5=33989]="TEXTURE5",n[n.TEXTURE6=33990]="TEXTURE6",n[n.TEXTURE7=33991]="TEXTURE7",n[n.TEXTURE8=33992]="TEXTURE8",n[n.TEXTURE9=33993]="TEXTURE9",n[n.TEXTURE10=33994]="TEXTURE10",n[n.TEXTURE11=33995]="TEXTURE11",n[n.TEXTURE12=33996]="TEXTURE12",n[n.TEXTURE13=33997]="TEXTURE13",n[n.TEXTURE14=33998]="TEXTURE14",n[n.TEXTURE15=33999]="TEXTURE15",n[n.TEXTURE16=34e3]="TEXTURE16",n[n.TEXTURE17=34001]="TEXTURE17",n[n.TEXTURE18=34002]="TEXTURE18",n[n.TEXTURE19=34003]="TEXTURE19",n[n.TEXTURE20=34004]="TEXTURE20",n[n.TEXTURE21=34005]="TEXTURE21",n[n.TEXTURE22=34006]="TEXTURE22",n[n.TEXTURE23=34007]="TEXTURE23",n[n.TEXTURE24=34008]="TEXTURE24",n[n.TEXTURE25=34009]="TEXTURE25",n[n.TEXTURE26=34010]="TEXTURE26",n[n.TEXTURE27=34011]="TEXTURE27",n[n.TEXTURE28=34012]="TEXTURE28",n[n.TEXTURE29=34013]="TEXTURE29",n[n.TEXTURE30=34014]="TEXTURE30",n[n.TEXTURE31=34015]="TEXTURE31",n[n.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",n[n.REPEAT=10497]="REPEAT",n[n.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",n[n.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",n[n.FLOAT_VEC2=35664]="FLOAT_VEC2",n[n.FLOAT_VEC3=35665]="FLOAT_VEC3",n[n.FLOAT_VEC4=35666]="FLOAT_VEC4",n[n.INT_VEC2=35667]="INT_VEC2",n[n.INT_VEC3=35668]="INT_VEC3",n[n.INT_VEC4=35669]="INT_VEC4",n[n.BOOL=35670]="BOOL",n[n.BOOL_VEC2=35671]="BOOL_VEC2",n[n.BOOL_VEC3=35672]="BOOL_VEC3",n[n.BOOL_VEC4=35673]="BOOL_VEC4",n[n.FLOAT_MAT2=35674]="FLOAT_MAT2",n[n.FLOAT_MAT3=35675]="FLOAT_MAT3",n[n.FLOAT_MAT4=35676]="FLOAT_MAT4",n[n.SAMPLER_2D=35678]="SAMPLER_2D",n[n.SAMPLER_CUBE=35680]="SAMPLER_CUBE",n[n.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",n[n.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",n[n.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",n[n.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",n[n.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",n[n.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",n[n.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",n[n.COMPILE_STATUS=35713]="COMPILE_STATUS",n[n.LOW_FLOAT=36336]="LOW_FLOAT",n[n.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",n[n.HIGH_FLOAT=36338]="HIGH_FLOAT",n[n.LOW_INT=36339]="LOW_INT",n[n.MEDIUM_INT=36340]="MEDIUM_INT",n[n.HIGH_INT=36341]="HIGH_INT",n[n.FRAMEBUFFER=36160]="FRAMEBUFFER",n[n.RENDERBUFFER=36161]="RENDERBUFFER",n[n.RGBA4=32854]="RGBA4",n[n.RGB5_A1=32855]="RGB5_A1",n[n.RGB565=36194]="RGB565",n[n.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",n[n.STENCIL_INDEX=6401]="STENCIL_INDEX",n[n.STENCIL_INDEX8=36168]="STENCIL_INDEX8",n[n.DEPTH_STENCIL=34041]="DEPTH_STENCIL",n[n.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",n[n.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",n[n.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",n[n.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",n[n.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",n[n.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",n[n.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",n[n.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",n[n.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",n[n.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",n[n.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",n[n.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",n[n.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",n[n.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",n[n.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",n[n.NONE=0]="NONE",n[n.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",n[n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",n[n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",n[n.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",n[n.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",n[n.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",n[n.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",n[n.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",n[n.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",n[n.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",n[n.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",n[n.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",n[n.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",n[n.COPY_SRC=1]="COPY_SRC",n[n.COPY_DST=2]="COPY_DST",n[n.SAMPLED=4]="SAMPLED",n[n.STORAGE=8]="STORAGE",n[n.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})(It||(It={}));var Lp;(function(n){n.Void="Void",n.Boolean="Boolean",n.Float="Float",n.Uint32="Uint32",n.Int32="Int32",n.Vector="Vector",n.Vector2Float="vec2<f32>",n.Vector3Float="vec3<f32>",n.Vector4Float="vec4<f32>",n.Vector2Boolean="vec2<bool>",n.Vector3Boolean="vec3<bool>",n.Vector4Boolean="vec4<bool>",n.Vector2Uint="vec2<u32>",n.Vector3Uint="vec3<u32>",n.Vector4Uint="vec4<u32>",n.Vector2Int="vec2<i32>",n.Vector3Int="vec3<i32>",n.Vector4Int="vec4<i32>",n.Matrix="Matrix",n.Matrix3x3Float="mat3x3<f32>",n.Matrix4x4Float="mat4x4<i32>",n.Struct="Struct",n.FloatArray="Float[]",n.Vector4FloatArray="vec4<f32>[]"})(Lp||(Lp={}));var Ip;(function(n){n.Program="Program",n.Identifier="Identifier",n.VariableDeclaration="VariableDeclaration",n.BlockStatement="BlockStatement",n.ReturnStatement="ReturnStatement",n.FunctionDeclaration="FunctionDeclaration",n.VariableDeclarator="VariableDeclarator",n.AssignmentExpression="AssignmentExpression",n.LogicalExpression="LogicalExpression",n.BinaryExpression="BinaryExpression",n.ArrayExpression="ArrayExpression",n.UnaryExpression="UnaryExpression",n.UpdateExpression="UpdateExpression",n.FunctionExpression="FunctionExpression",n.MemberExpression="MemberExpression",n.ConditionalExpression="ConditionalExpression",n.ExpressionStatement="ExpressionStatement",n.CallExpression="CallExpression",n.NumThreadStatement="NumThreadStatement",n.StorageStatement="StorageStatement",n.DoWhileStatement="DoWhileStatement",n.WhileStatement="WhileStatement",n.ForStatement="ForStatement",n.BreakStatement="BreakStatement",n.ContinueStatement="ContinueStatement",n.IfStatement="IfStatement",n.ImportedFunctionStatement="ImportedFunctionStatement"})(Ip||(Ip={}));var Dp;(function(n){n.Input="Input",n.Output="Output",n.Uniform="Uniform",n.Workgroup="Workgroup",n.UniformConstant="UniformConstant",n.Image="Image",n.StorageBuffer="StorageBuffer",n.Private="Private",n.Function="Function"})(Dp||(Dp={}));var kp;(function(n){n.GLSL100="GLSL100",n.GLSL450="GLSL450",n.WGSL="WGSL"})(kp||(kp={}));var sM={exports:{}};(function(n,t){(function(e,r){n.exports=r()})(co,function(){var e=function(g){return g instanceof Uint8Array||g instanceof Uint16Array||g instanceof Uint32Array||g instanceof Int8Array||g instanceof Int16Array||g instanceof Int32Array||g instanceof Float32Array||g instanceof Float64Array||g instanceof Uint8ClampedArray},r=function(g,w){for(var M=Object.keys(w),Y=0;Y<M.length;++Y)g[M[Y]]=w[M[Y]];return g},i=`
`;function s(g){return typeof atob<"u"?atob(g):"base64:"+g}function o(g){var w=new Error("(regl) "+g);throw console.error(w),w}function a(g,w){g||o(w)}function c(g){return g?": "+g:""}function l(g,w,M){g in w||o("unknown parameter ("+g+")"+c(M)+". possible values: "+Object.keys(w).join())}function u(g,w){e(g)||o("invalid parameter type"+c(w)+". must be a typed array")}function f(g,w){switch(w){case"number":return typeof g=="number";case"object":return typeof g=="object";case"string":return typeof g=="string";case"boolean":return typeof g=="boolean";case"function":return typeof g=="function";case"undefined":return typeof g>"u";case"symbol":return typeof g=="symbol"}}function h(g,w,M){f(g,w)||o("invalid parameter type"+c(M)+". expected "+w+", got "+typeof g)}function d(g,w){g>=0&&(g|0)===g||o("invalid parameter type, ("+g+")"+c(w)+". must be a nonnegative integer")}function p(g,w,M){w.indexOf(g)<0&&o("invalid value"+c(M)+". must be one of: "+w)}var m=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function b(g){Object.keys(g).forEach(function(w){m.indexOf(w)<0&&o('invalid regl constructor argument "'+w+'". must be one of '+m)})}function v(g,w){for(g=g+"";g.length<w;)g=" "+g;return g}function E(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function y(g,w){this.number=g,this.line=w,this.errors=[]}function O(g,w,M){this.file=g,this.line=w,this.message=M}function I(){var g=new Error,w=(g.stack||g).toString(),M=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(w);if(M)return M[1];var Y=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(w);return Y?Y[1]:"unknown"}function G(){var g=new Error,w=(g.stack||g).toString(),M=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(w);if(M)return M[1];var Y=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(w);return Y?Y[1]:"unknown"}function k(g,w){var M=g.split(`
`),Y=1,it=0,q={unknown:new E,0:new E};q.unknown.name=q[0].name=w||I(),q.unknown.lines.push(new y(0,""));for(var Q=0;Q<M.length;++Q){var pt=M[Q],mt=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(pt);if(mt)switch(mt[1]){case"line":var Et=/(\d+)(\s+\d+)?/.exec(mt[2]);Et&&(Y=Et[1]|0,Et[2]&&(it=Et[2]|0,it in q||(q[it]=new E)));break;case"define":var bt=/SHADER_NAME(_B64)?\s+(.*)$/.exec(mt[2]);bt&&(q[it].name=bt[1]?s(bt[2]):bt[2]);break}q[it].lines.push(new y(Y++,pt))}return Object.keys(q).forEach(function(wt){var Mt=q[wt];Mt.lines.forEach(function(gt){Mt.index[gt.number]=gt})}),q}function X(g){var w=[];return g.split(`
`).forEach(function(M){if(!(M.length<5)){var Y=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(M);Y?w.push(new O(Y[1]|0,Y[2]|0,Y[3].trim())):M.length>0&&w.push(new O("unknown",0,M))}}),w}function Z(g,w){w.forEach(function(M){var Y=g[M.file];if(Y){var it=Y.index[M.line];if(it){it.errors.push(M),Y.hasErrors=!0;return}}g.unknown.hasErrors=!0,g.unknown.lines[0].errors.push(M)})}function at(g,w,M,Y,it){if(!g.getShaderParameter(w,g.COMPILE_STATUS)){var q=g.getShaderInfoLog(w),Q=Y===g.FRAGMENT_SHADER?"fragment":"vertex";Rt(M,"string",Q+" shader source must be a string",it);var pt=k(M,it),mt=X(q);Z(pt,mt),Object.keys(pt).forEach(function(Et){var bt=pt[Et];if(!bt.hasErrors)return;var wt=[""],Mt=[""];function gt(At,z){wt.push(At),Mt.push(z||"")}gt("file number "+Et+": "+bt.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),bt.lines.forEach(function(At){if(At.errors.length>0){gt(v(At.number,4)+"|  ","background-color:yellow; font-weight:bold"),gt(At.line+i,"color:red; background-color:yellow; font-weight:bold");var z=0;At.errors.forEach(function(tt){var yt=tt.message,Nt=/^\s*'(.*)'\s*:\s*(.*)$/.exec(yt);if(Nt){var ut=Nt[1];switch(yt=Nt[2],ut){case"assign":ut="=";break}z=Math.max(At.line.indexOf(ut,z),0)}else z=0;gt(v("| ",6)),gt(v("^^^",z+3)+i,"font-weight:bold"),gt(v("| ",6)),gt(yt+i,"font-weight:bold")}),gt(v("| ",6)+i)}else gt(v(At.number,4)+"|  "),gt(At.line+i,"color:red")}),typeof document<"u"&&!window.chrome?(Mt[0]=wt.join("%c"),console.log.apply(console,Mt)):console.log(wt.join(""))}),a.raise("Error compiling "+Q+" shader, "+pt[0].name)}}function ft(g,w,M,Y,it){if(!g.getProgramParameter(w,g.LINK_STATUS)){var q=g.getProgramInfoLog(w),Q=k(M,it),pt=k(Y,it),mt='Error linking program with vertex shader, "'+pt[0].name+'", and fragment shader "'+Q[0].name+'"';typeof document<"u"?console.log("%c"+mt+i+"%c"+q,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(mt+i+q),a.raise(mt)}}function H(g){g._commandRef=I()}function Ut(g,w,M,Y){H(g);function it(mt){return mt?Y.id(mt):0}g._fragId=it(g.static.frag),g._vertId=it(g.static.vert);function q(mt,Et){Object.keys(Et).forEach(function(bt){mt[Y.id(bt)]=!0})}var Q=g._uniformSet={};q(Q,w.static),q(Q,w.dynamic);var pt=g._attributeSet={};q(pt,M.static),q(pt,M.dynamic),g._hasCount="count"in g.static||"count"in g.dynamic||"elements"in g.static||"elements"in g.dynamic}function zt(g,w){var M=G();o(g+" in command "+(w||I())+(M==="unknown"?"":" called from "+M))}function W(g,w,M){g||zt(w,M||I())}function lt(g,w,M,Y){g in w||zt("unknown parameter ("+g+")"+c(M)+". possible values: "+Object.keys(w).join(),Y||I())}function Rt(g,w,M,Y){f(g,w)||zt("invalid parameter type"+c(M)+". expected "+w+", got "+typeof g,Y||I())}function Xt(g){g()}function ot(g,w,M){g.texture?p(g.texture._texture.internalformat,w,"unsupported texture format for attachment"):p(g.renderbuffer._renderbuffer.format,M,"unsupported renderbuffer format for attachment")}var et=33071,K=9728,Ct=9984,Lt=9985,Ot=9986,re=9987,be=5120,ee=5121,Oe=5122,Zt=5123,Yt=5124,ln=5125,An=5126,gn=32819,Pe=32820,Be=33635,Nn=34042,_n=36193,Ne={};Ne[be]=Ne[ee]=1,Ne[Oe]=Ne[Zt]=Ne[_n]=Ne[Be]=Ne[gn]=Ne[Pe]=2,Ne[Yt]=Ne[ln]=Ne[An]=Ne[Nn]=4;function Wo(g,w){return g===Pe||g===gn||g===Be?2:g===Nn?4:Ne[g]*w}function oi(g){return!(g&g-1)&&!!g}function Ic(g,w,M){var Y,it=w.width,q=w.height,Q=w.channels;a(it>0&&it<=M.maxTextureSize&&q>0&&q<=M.maxTextureSize,"invalid texture shape"),(g.wrapS!==et||g.wrapT!==et)&&a(oi(it)&&oi(q),"incompatible wrap mode for texture, both width and height must be power of 2"),w.mipmask===1?it!==1&&q!==1&&a(g.minFilter!==Ct&&g.minFilter!==Ot&&g.minFilter!==Lt&&g.minFilter!==re,"min filter requires mipmap"):(a(oi(it)&&oi(q),"texture must be a square power of 2 to support mipmapping"),a(w.mipmask===(it<<1)-1,"missing or incomplete mipmap data")),w.type===An&&(M.extensions.indexOf("oes_texture_float_linear")<0&&a(g.minFilter===K&&g.magFilter===K,"filter not supported, must enable oes_texture_float_linear"),a(!g.genMipmaps,"mipmap generation not supported with float textures"));var pt=w.images;for(Y=0;Y<16;++Y)if(pt[Y]){var mt=it>>Y,Et=q>>Y;a(w.mipmask&1<<Y,"missing mipmap data");var bt=pt[Y];if(a(bt.width===mt&&bt.height===Et,"invalid shape for mip images"),a(bt.format===w.format&&bt.internalformat===w.internalformat&&bt.type===w.type,"incompatible type for mip image"),!bt.compressed)if(bt.data){var wt=Math.ceil(Wo(bt.type,Q)*mt/bt.unpackAlignment)*bt.unpackAlignment;a(bt.data.byteLength===wt*Et,"invalid data for image, buffer size is inconsistent with image format")}else bt.element||bt.copy}else g.genMipmaps||a((w.mipmask&1<<Y)===0,"extra mipmap data");w.compressed&&a(!g.genMipmaps,"mipmap generation for compressed images not supported")}function qo(g,w,M,Y){var it=g.width,q=g.height,Q=g.channels;a(it>0&&it<=Y.maxTextureSize&&q>0&&q<=Y.maxTextureSize,"invalid texture shape"),a(it===q,"cube map must be square"),a(w.wrapS===et&&w.wrapT===et,"wrap mode not supported by cube map");for(var pt=0;pt<M.length;++pt){var mt=M[pt];a(mt.width===it&&mt.height===q,"inconsistent cube map face shape"),w.genMipmaps&&(a(!mt.compressed,"can not generate mipmap for compressed textures"),a(mt.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Et=mt.images,bt=0;bt<16;++bt){var wt=Et[bt];if(wt){var Mt=it>>bt,gt=q>>bt;a(mt.mipmask&1<<bt,"missing mipmap data"),a(wt.width===Mt&&wt.height===gt,"invalid shape for mip images"),a(wt.format===g.format&&wt.internalformat===g.internalformat&&wt.type===g.type,"incompatible type for mip image"),wt.compressed||(wt.data?a(wt.data.byteLength===Mt*gt*Math.max(Wo(wt.type,Q),wt.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):wt.element||wt.copy)}}}}var S=r(a,{optional:Xt,raise:o,commandRaise:zt,command:W,parameter:l,commandParameter:lt,constructor:b,type:h,commandType:Rt,isTypedArray:u,nni:d,oneOf:p,shaderError:at,linkError:ft,callSite:G,saveCommandRef:H,saveDrawInfo:Ut,framebufferFormat:ot,guessCommand:I,texture2D:Ic,textureCube:qo}),Yo=0,Wv=0,qv=5,Yv=6;function ai(g,w){this.id=Yo++,this.type=g,this.data=w}function Eh(g){return g.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Gs(g){if(g.length===0)return[];var w=g.charAt(0),M=g.charAt(g.length-1);if(g.length>1&&w===M&&(w==='"'||w==="'"))return['"'+Eh(g.substr(1,g.length-2))+'"'];var Y=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(g);if(Y)return Gs(g.substr(0,Y.index)).concat(Gs(Y[1])).concat(Gs(g.substr(Y.index+Y[0].length)));var it=g.split(".");if(it.length===1)return['"'+Eh(g)+'"'];for(var q=[],Q=0;Q<it.length;++Q)q=q.concat(Gs(it[Q]));return q}function xh(g){return"["+Gs(g).join("][")+"]"}function Jv(g,w){return new ai(g,xh(w+""))}function Kv(g){return typeof g=="function"&&!g._reglType||g instanceof ai}function wh(g,w){if(typeof g=="function")return new ai(Wv,g);if(typeof g=="number"||typeof g=="boolean")return new ai(qv,g);if(Array.isArray(g))return new ai(Yv,g.map((M,Y)=>wh(M,w+"["+Y+"]")));if(g instanceof ai)return g;S(!1,"invalid option type in uniform "+w)}var Fn={DynamicVariable:ai,define:Jv,isDynamic:Kv,unbox:wh,accessor:xh},Dc={next:typeof requestAnimationFrame=="function"?function(g){return requestAnimationFrame(g)}:function(g){return setTimeout(g,16)},cancel:typeof cancelAnimationFrame=="function"?function(g){return cancelAnimationFrame(g)}:clearTimeout},Ah=typeof performance<"u"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Zv(){var g={"":0},w=[""];return{id:function(M){var Y=g[M];return Y||(Y=g[M]=w.length,w.push(M),Y)},str:function(M){return w[M]}}}function Qv(g,w,M){var Y=document.createElement("canvas");r(Y.style,{border:0,margin:0,padding:0,top:0,left:0}),g.appendChild(Y),g===document.body&&(Y.style.position="absolute",r(g.style,{margin:0,padding:0}));function it(){var pt=window.innerWidth,mt=window.innerHeight;if(g!==document.body){var Et=g.getBoundingClientRect();pt=Et.right-Et.left,mt=Et.bottom-Et.top}Y.width=M*pt,Y.height=M*mt,r(Y.style,{width:pt+"px",height:mt+"px"})}var q;g!==document.body&&typeof ResizeObserver=="function"?(q=new ResizeObserver(function(){setTimeout(it)}),q.observe(g)):window.addEventListener("resize",it,!1);function Q(){q?q.disconnect():window.removeEventListener("resize",it),g.removeChild(Y)}return it(),{canvas:Y,onDestroy:Q}}function ty(g,w){function M(Y){try{return g.getContext(Y,w)}catch{return null}}return M("webgl")||M("experimental-webgl")||M("webgl-experimental")}function ey(g){return typeof g.nodeName=="string"&&typeof g.appendChild=="function"&&typeof g.getBoundingClientRect=="function"}function ny(g){return typeof g.drawArrays=="function"||typeof g.drawElements=="function"}function Sh(g){return typeof g=="string"?g.split():(S(Array.isArray(g),"invalid extension array"),g)}function Th(g){return typeof g=="string"?(S(typeof document<"u","not supported outside of DOM"),document.querySelector(g)):g}function ry(g){var w=g||{},M,Y,it,q,Q={},pt=[],mt=[],Et=typeof window>"u"?1:window.devicePixelRatio,bt=!1,wt=function(At){At&&S.raise(At)},Mt=function(){};if(typeof w=="string"?(S(typeof document<"u","selector queries only supported in DOM enviroments"),M=document.querySelector(w),S(M,"invalid query string for element")):typeof w=="object"?ey(w)?M=w:ny(w)?(q=w,it=q.canvas):(S.constructor(w),"gl"in w?q=w.gl:"canvas"in w?it=Th(w.canvas):"container"in w&&(Y=Th(w.container)),"attributes"in w&&(Q=w.attributes,S.type(Q,"object","invalid context attributes")),"extensions"in w&&(pt=Sh(w.extensions)),"optionalExtensions"in w&&(mt=Sh(w.optionalExtensions)),"onDone"in w&&(S.type(w.onDone,"function","invalid or missing onDone callback"),wt=w.onDone),"profile"in w&&(bt=!!w.profile),"pixelRatio"in w&&(Et=+w.pixelRatio,S(Et>0,"invalid pixel ratio"))):S.raise("invalid arguments to regl"),M&&(M.nodeName.toLowerCase()==="canvas"?it=M:Y=M),!q){if(!it){S(typeof document<"u","must manually specify webgl context outside of DOM environments");var gt=Qv(Y||document.body,wt,Et);if(!gt)return null;it=gt.canvas,Mt=gt.onDestroy}Q.premultipliedAlpha===void 0&&(Q.premultipliedAlpha=!0),q=ty(it,Q)}return q?{gl:q,canvas:it,container:Y,extensions:pt,optionalExtensions:mt,pixelRatio:Et,profile:bt,onDone:wt,onDestroy:Mt}:(Mt(),wt("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function iy(g,w){var M={};function Y(Q){S.type(Q,"string","extension name must be string");var pt=Q.toLowerCase(),mt;try{mt=M[pt]=g.getExtension(pt)}catch{}return!!mt}for(var it=0;it<w.extensions.length;++it){var q=w.extensions[it];if(!Y(q))return w.onDestroy(),w.onDone('"'+q+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return w.optionalExtensions.forEach(Y),{extensions:M,restore:function(){Object.keys(M).forEach(function(Q){if(M[Q]&&!Y(Q))throw new Error("(regl): error restoring extension "+Q)})}}}function Ln(g,w){for(var M=Array(g),Y=0;Y<g;++Y)M[Y]=w(Y);return M}var sy=5120,oy=5121,ay=5122,cy=5123,ly=5124,uy=5125,hy=5126;function fy(g){for(var w=16;w<=1<<28;w*=16)if(g<=w)return w;return 0}function Ch(g){var w,M;return w=(g>65535)<<4,g>>>=w,M=(g>255)<<3,g>>>=M,w|=M,M=(g>15)<<2,g>>>=M,w|=M,M=(g>3)<<1,g>>>=M,w|=M,w|g>>1}function _h(){var g=Ln(8,function(){return[]});function w(q){var Q=fy(q),pt=g[Ch(Q)>>2];return pt.length>0?pt.pop():new ArrayBuffer(Q)}function M(q){g[Ch(q.byteLength)>>2].push(q)}function Y(q,Q){var pt=null;switch(q){case sy:pt=new Int8Array(w(Q),0,Q);break;case oy:pt=new Uint8Array(w(Q),0,Q);break;case ay:pt=new Int16Array(w(2*Q),0,Q);break;case cy:pt=new Uint16Array(w(2*Q),0,Q);break;case ly:pt=new Int32Array(w(4*Q),0,Q);break;case uy:pt=new Uint32Array(w(4*Q),0,Q);break;case hy:pt=new Float32Array(w(4*Q),0,Q);break;default:return null}return pt.length!==Q?pt.subarray(0,Q):pt}function it(q){M(q.buffer)}return{alloc:w,free:M,allocType:Y,freeType:it}}var He=_h();He.zero=_h();var dy=3408,py=3410,gy=3411,my=3412,by=3413,vy=3414,yy=3415,Ey=33901,xy=33902,wy=3379,Ay=3386,Sy=34921,Ty=36347,Cy=36348,_y=35661,Oy=35660,My=34930,Py=36349,Ry=34076,Ny=34024,Ly=7936,Iy=7937,Dy=7938,ky=35724,By=34047,jy=36063,Fy=34852,Jo=3553,Oh=34067,Gy=34069,zy=33984,zs=6408,kc=5126,Mh=5121,Bc=36160,Uy=36053,Vy=36064,$y=16384,Hy=function(g,w){var M=1;w.ext_texture_filter_anisotropic&&(M=g.getParameter(By));var Y=1,it=1;w.webgl_draw_buffers&&(Y=g.getParameter(Fy),it=g.getParameter(jy));var q=!!w.oes_texture_float;if(q){var Q=g.createTexture();g.bindTexture(Jo,Q),g.texImage2D(Jo,0,zs,1,1,0,zs,kc,null);var pt=g.createFramebuffer();if(g.bindFramebuffer(Bc,pt),g.framebufferTexture2D(Bc,Vy,Jo,Q,0),g.bindTexture(Jo,null),g.checkFramebufferStatus(Bc)!==Uy)q=!1;else{g.viewport(0,0,1,1),g.clearColor(1,0,0,1),g.clear($y);var mt=He.allocType(kc,4);g.readPixels(0,0,1,1,zs,kc,mt),g.getError()?q=!1:(g.deleteFramebuffer(pt),g.deleteTexture(Q),q=mt[0]===1),He.freeType(mt)}}var Et=typeof navigator<"u"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),bt=!0;if(!Et){var wt=g.createTexture(),Mt=He.allocType(Mh,36);g.activeTexture(zy),g.bindTexture(Oh,wt),g.texImage2D(Gy,0,zs,3,3,0,zs,Mh,Mt),He.freeType(Mt),g.bindTexture(Oh,null),g.deleteTexture(wt),bt=!g.getError()}return{colorBits:[g.getParameter(py),g.getParameter(gy),g.getParameter(my),g.getParameter(by)],depthBits:g.getParameter(vy),stencilBits:g.getParameter(yy),subpixelBits:g.getParameter(dy),extensions:Object.keys(w).filter(function(gt){return!!w[gt]}),maxAnisotropic:M,maxDrawbuffers:Y,maxColorAttachments:it,pointSizeDims:g.getParameter(Ey),lineWidthDims:g.getParameter(xy),maxViewportDims:g.getParameter(Ay),maxCombinedTextureUnits:g.getParameter(_y),maxCubeMapSize:g.getParameter(Ry),maxRenderbufferSize:g.getParameter(Ny),maxTextureUnits:g.getParameter(My),maxTextureSize:g.getParameter(wy),maxAttributes:g.getParameter(Sy),maxVertexUniforms:g.getParameter(Ty),maxVertexTextureUnits:g.getParameter(Oy),maxVaryingVectors:g.getParameter(Cy),maxFragmentUniforms:g.getParameter(Py),glsl:g.getParameter(ky),renderer:g.getParameter(Iy),vendor:g.getParameter(Ly),version:g.getParameter(Dy),readFloat:q,npotTextureCube:bt}};function Zn(g){return!!g&&typeof g=="object"&&Array.isArray(g.shape)&&Array.isArray(g.stride)&&typeof g.offset=="number"&&g.shape.length===g.stride.length&&(Array.isArray(g.data)||e(g.data))}var Gn=function(g){return Object.keys(g).map(function(w){return g[w]})},Ko={shape:Yy,flatten:qy};function Xy(g,w,M){for(var Y=0;Y<w;++Y)M[Y]=g[Y]}function Wy(g,w,M,Y){for(var it=0,q=0;q<w;++q)for(var Q=g[q],pt=0;pt<M;++pt)Y[it++]=Q[pt]}function Ph(g,w,M,Y,it,q){for(var Q=q,pt=0;pt<w;++pt)for(var mt=g[pt],Et=0;Et<M;++Et)for(var bt=mt[Et],wt=0;wt<Y;++wt)it[Q++]=bt[wt]}function Rh(g,w,M,Y,it){for(var q=1,Q=M+1;Q<w.length;++Q)q*=w[Q];var pt=w[M];if(w.length-M===4){var mt=w[M+1],Et=w[M+2],bt=w[M+3];for(Q=0;Q<pt;++Q)Ph(g[Q],mt,Et,bt,Y,it),it+=q}else for(Q=0;Q<pt;++Q)Rh(g[Q],w,M+1,Y,it),it+=q}function qy(g,w,M,Y){var it=1;if(w.length)for(var q=0;q<w.length;++q)it*=w[q];else it=0;var Q=Y||He.allocType(M,it);switch(w.length){case 0:break;case 1:Xy(g,w[0],Q);break;case 2:Wy(g,w[0],w[1],Q);break;case 3:Ph(g,w[0],w[1],w[2],Q,0);break;default:Rh(g,w,0,Q,0)}return Q}function Yy(g){for(var w=[],M=g;M.length;M=M[0])w.push(M.length);return w}var jc={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Jy=5120,Ky=5122,Zy=5124,Qy=5121,t0=5123,e0=5125,n0=5126,r0=5126,ci={int8:Jy,int16:Ky,int32:Zy,uint8:Qy,uint16:t0,uint32:e0,float:n0,float32:r0},i0=35048,s0=35040,Zo={dynamic:i0,stream:s0,static:35044},Fc=Ko.flatten,Nh=Ko.shape,Lh=35044,o0=35040,Gc=5121,zc=5126,Dr=[];Dr[5120]=1,Dr[5122]=2,Dr[5124]=4,Dr[5121]=1,Dr[5123]=2,Dr[5125]=4,Dr[5126]=4;function Qo(g){return jc[Object.prototype.toString.call(g)]|0}function Ih(g,w){for(var M=0;M<w.length;++M)g[M]=w[M]}function Dh(g,w,M,Y,it,q,Q){for(var pt=0,mt=0;mt<M;++mt)for(var Et=0;Et<Y;++Et)g[pt++]=w[it*mt+q*Et+Q]}function a0(g,w,M,Y){var it=0,q={};function Q(z){this.id=it++,this.buffer=g.createBuffer(),this.type=z,this.usage=Lh,this.byteLength=0,this.dimension=1,this.dtype=Gc,this.persistentData=null,M.profile&&(this.stats={size:0})}Q.prototype.bind=function(){g.bindBuffer(this.type,this.buffer)},Q.prototype.destroy=function(){Mt(this)};var pt=[];function mt(z,tt){var yt=pt.pop();return yt||(yt=new Q(z)),yt.bind(),wt(yt,tt,o0,0,1,!1),yt}function Et(z){pt.push(z)}function bt(z,tt,yt){z.byteLength=tt.byteLength,g.bufferData(z.type,tt,yt)}function wt(z,tt,yt,Nt,ut,Dt){var dt;if(z.usage=yt,Array.isArray(tt)){if(z.dtype=Nt||zc,tt.length>0){var St;if(Array.isArray(tt[0])){dt=Nh(tt);for(var ht=1,Tt=1;Tt<dt.length;++Tt)ht*=dt[Tt];z.dimension=ht,St=Fc(tt,dt,z.dtype),bt(z,St,yt),Dt?z.persistentData=St:He.freeType(St)}else if(typeof tt[0]=="number"){z.dimension=ut;var Wt=He.allocType(z.dtype,tt.length);Ih(Wt,tt),bt(z,Wt,yt),Dt?z.persistentData=Wt:He.freeType(Wt)}else e(tt[0])?(z.dimension=tt[0].length,z.dtype=Nt||Qo(tt[0])||zc,St=Fc(tt,[tt.length,tt[0].length],z.dtype),bt(z,St,yt),Dt?z.persistentData=St:He.freeType(St)):S.raise("invalid buffer data")}}else if(e(tt))z.dtype=Nt||Qo(tt),z.dimension=ut,bt(z,tt,yt),Dt&&(z.persistentData=new Uint8Array(new Uint8Array(tt.buffer)));else if(Zn(tt)){dt=tt.shape;var ie=tt.stride,Pt=tt.offset,xt=0,ct=0,te=0,ce=0;dt.length===1?(xt=dt[0],ct=1,te=ie[0],ce=0):dt.length===2?(xt=dt[0],ct=dt[1],te=ie[0],ce=ie[1]):S.raise("invalid shape"),z.dtype=Nt||Qo(tt.data)||zc,z.dimension=ct;var Ft=He.allocType(z.dtype,xt*ct);Dh(Ft,tt.data,xt,ct,te,ce,Pt),bt(z,Ft,yt),Dt?z.persistentData=Ft:He.freeType(Ft)}else tt instanceof ArrayBuffer?(z.dtype=Gc,z.dimension=ut,bt(z,tt,yt),Dt&&(z.persistentData=new Uint8Array(new Uint8Array(tt)))):S.raise("invalid buffer data")}function Mt(z){w.bufferCount--,Y(z);var tt=z.buffer;S(tt,"buffer must not be deleted already"),g.deleteBuffer(tt),z.buffer=null,delete q[z.id]}function gt(z,tt,yt,Nt){w.bufferCount++;var ut=new Q(tt);q[ut.id]=ut;function Dt(ht){var Tt=Lh,Wt=null,ie=0,Pt=0,xt=1;return Array.isArray(ht)||e(ht)||Zn(ht)||ht instanceof ArrayBuffer?Wt=ht:typeof ht=="number"?ie=ht|0:ht&&(S.type(ht,"object","buffer arguments must be an object, a number or an array"),"data"in ht&&(S(Wt===null||Array.isArray(Wt)||e(Wt)||Zn(Wt),"invalid data for buffer"),Wt=ht.data),"usage"in ht&&(S.parameter(ht.usage,Zo,"invalid buffer usage"),Tt=Zo[ht.usage]),"type"in ht&&(S.parameter(ht.type,ci,"invalid buffer type"),Pt=ci[ht.type]),"dimension"in ht&&(S.type(ht.dimension,"number","invalid dimension"),xt=ht.dimension|0),"length"in ht&&(S.nni(ie,"buffer length must be a nonnegative integer"),ie=ht.length|0)),ut.bind(),Wt?wt(ut,Wt,Tt,Pt,xt,Nt):(ie&&g.bufferData(ut.type,ie,Tt),ut.dtype=Pt||Gc,ut.usage=Tt,ut.dimension=xt,ut.byteLength=ie),M.profile&&(ut.stats.size=ut.byteLength*Dr[ut.dtype]),Dt}function dt(ht,Tt){S(Tt+ht.byteLength<=ut.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+ht.byteLength+" starting from offset "+Tt+" to a buffer of size "+ut.byteLength),g.bufferSubData(ut.type,Tt,ht)}function St(ht,Tt){var Wt=(Tt||0)|0,ie;if(ut.bind(),e(ht)||ht instanceof ArrayBuffer)dt(ht,Wt);else if(Array.isArray(ht)){if(ht.length>0)if(typeof ht[0]=="number"){var Pt=He.allocType(ut.dtype,ht.length);Ih(Pt,ht),dt(Pt,Wt),He.freeType(Pt)}else if(Array.isArray(ht[0])||e(ht[0])){ie=Nh(ht);var xt=Fc(ht,ie,ut.dtype);dt(xt,Wt),He.freeType(xt)}else S.raise("invalid buffer data")}else if(Zn(ht)){ie=ht.shape;var ct=ht.stride,te=0,ce=0,Ft=0,fe=0;ie.length===1?(te=ie[0],ce=1,Ft=ct[0],fe=0):ie.length===2?(te=ie[0],ce=ie[1],Ft=ct[0],fe=ct[1]):S.raise("invalid shape");var se=Array.isArray(ht.data)?ut.dtype:Qo(ht.data),he=He.allocType(se,te*ce);Dh(he,ht.data,te,ce,Ft,fe,ht.offset),dt(he,Wt),He.freeType(he)}else S.raise("invalid data for buffer subdata");return Dt}return yt||Dt(z),Dt._reglType="buffer",Dt._buffer=ut,Dt.subdata=St,M.profile&&(Dt.stats=ut.stats),Dt.destroy=function(){Mt(ut)},Dt}function At(){Gn(q).forEach(function(z){z.buffer=g.createBuffer(),g.bindBuffer(z.type,z.buffer),g.bufferData(z.type,z.persistentData||z.byteLength,z.usage)})}return M.profile&&(w.getTotalBufferSize=function(){var z=0;return Object.keys(q).forEach(function(tt){z+=q[tt].stats.size}),z}),{create:gt,createStream:mt,destroyStream:Et,clear:function(){Gn(q).forEach(Mt),pt.forEach(Mt)},getBuffer:function(z){return z&&z._buffer instanceof Q?z._buffer:null},restore:At,_initBuffer:wt}}var c0=0,l0=0,u0=1,h0=1,f0=4,d0=4,Bi={points:c0,point:l0,lines:u0,line:h0,triangles:f0,triangle:d0,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},p0=0,g0=1,Us=4,m0=5120,ji=5121,kh=5122,Fi=5123,Bh=5124,li=5125,Uc=34963,b0=35040,v0=35044;function y0(g,w,M,Y){var it={},q=0,Q={uint8:ji,uint16:Fi};w.oes_element_index_uint&&(Q.uint32=li);function pt(At){this.id=q++,it[this.id]=this,this.buffer=At,this.primType=Us,this.vertCount=0,this.type=0}pt.prototype.bind=function(){this.buffer.bind()};var mt=[];function Et(At){var z=mt.pop();return z||(z=new pt(M.create(null,Uc,!0,!1)._buffer)),wt(z,At,b0,-1,-1,0,0),z}function bt(At){mt.push(At)}function wt(At,z,tt,yt,Nt,ut,Dt){At.buffer.bind();var dt;if(z){var St=Dt;!Dt&&(!e(z)||Zn(z)&&!e(z.data))&&(St=w.oes_element_index_uint?li:Fi),M._initBuffer(At.buffer,z,tt,St,3)}else g.bufferData(Uc,ut,tt),At.buffer.dtype=dt||ji,At.buffer.usage=tt,At.buffer.dimension=3,At.buffer.byteLength=ut;if(dt=Dt,!Dt){switch(At.buffer.dtype){case ji:case m0:dt=ji;break;case Fi:case kh:dt=Fi;break;case li:case Bh:dt=li;break;default:S.raise("unsupported type for element array")}At.buffer.dtype=dt}At.type=dt,S(dt!==li||!!w.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var ht=Nt;ht<0&&(ht=At.buffer.byteLength,dt===Fi?ht>>=1:dt===li&&(ht>>=2)),At.vertCount=ht;var Tt=yt;if(yt<0){Tt=Us;var Wt=At.buffer.dimension;Wt===1&&(Tt=p0),Wt===2&&(Tt=g0),Wt===3&&(Tt=Us)}At.primType=Tt}function Mt(At){Y.elementsCount--,S(At.buffer!==null,"must not double destroy elements"),delete it[At.id],At.buffer.destroy(),At.buffer=null}function gt(At,z){var tt=M.create(null,Uc,!0),yt=new pt(tt._buffer);Y.elementsCount++;function Nt(ut){if(!ut)tt(),yt.primType=Us,yt.vertCount=0,yt.type=ji;else if(typeof ut=="number")tt(ut),yt.primType=Us,yt.vertCount=ut|0,yt.type=ji;else{var Dt=null,dt=v0,St=-1,ht=-1,Tt=0,Wt=0;Array.isArray(ut)||e(ut)||Zn(ut)?Dt=ut:(S.type(ut,"object","invalid arguments for elements"),"data"in ut&&(Dt=ut.data,S(Array.isArray(Dt)||e(Dt)||Zn(Dt),"invalid data for element buffer")),"usage"in ut&&(S.parameter(ut.usage,Zo,"invalid element buffer usage"),dt=Zo[ut.usage]),"primitive"in ut&&(S.parameter(ut.primitive,Bi,"invalid element buffer primitive"),St=Bi[ut.primitive]),"count"in ut&&(S(typeof ut.count=="number"&&ut.count>=0,"invalid vertex count for elements"),ht=ut.count|0),"type"in ut&&(S.parameter(ut.type,Q,"invalid buffer type"),Wt=Q[ut.type]),"length"in ut?Tt=ut.length|0:(Tt=ht,Wt===Fi||Wt===kh?Tt*=2:(Wt===li||Wt===Bh)&&(Tt*=4))),wt(yt,Dt,dt,St,ht,Tt,Wt)}return Nt}return Nt(At),Nt._reglType="elements",Nt._elements=yt,Nt.subdata=function(ut,Dt){return tt.subdata(ut,Dt),Nt},Nt.destroy=function(){Mt(yt)},Nt}return{create:gt,createStream:Et,destroyStream:bt,getElements:function(At){return typeof At=="function"&&At._elements instanceof pt?At._elements:null},clear:function(){Gn(it).forEach(Mt)}}}var jh=new Float32Array(1),E0=new Uint32Array(jh.buffer),x0=5123;function Fh(g){for(var w=He.allocType(x0,g.length),M=0;M<g.length;++M)if(isNaN(g[M]))w[M]=65535;else if(g[M]===1/0)w[M]=31744;else if(g[M]===-1/0)w[M]=64512;else{jh[0]=g[M];var Y=E0[0],it=Y>>>31<<15,q=(Y<<1>>>24)-127,Q=Y>>13&1023;if(q<-24)w[M]=it;else if(q<-14){var pt=-14-q;w[M]=it+(Q+1024>>pt)}else q>15?w[M]=it+31744:w[M]=it+(q+15<<10)+Q}return w}function Ge(g){return Array.isArray(g)||e(g)}var Gh=function(g){return!(g&g-1)&&!!g},w0=34467,cr=3553,Vc=34067,ta=34069,ui=6408,$c=6406,ea=6407,Vs=6409,na=6410,zh=32854,Hc=32855,Uh=36194,A0=32819,S0=32820,T0=33635,C0=34042,Xc=6402,ra=34041,Wc=35904,qc=35906,Gi=36193,Yc=33776,Jc=33777,Kc=33778,Zc=33779,Vh=35986,$h=35987,Hh=34798,Xh=35840,Wh=35841,qh=35842,Yh=35843,Jh=36196,zi=5121,Qc=5123,tl=5125,$s=5126,_0=10242,O0=10243,M0=10497,el=33071,P0=33648,R0=10240,N0=10241,nl=9728,L0=9729,rl=9984,Kh=9985,Zh=9986,il=9987,I0=33170,ia=4352,D0=4353,k0=4354,B0=34046,j0=3317,F0=37440,G0=37441,z0=37443,Qh=37444,Hs=33984,U0=[rl,Zh,Kh,il],sa=[0,Vs,na,ea,ui],Un={};Un[Vs]=Un[$c]=Un[Xc]=1,Un[ra]=Un[na]=2,Un[ea]=Un[Wc]=3,Un[ui]=Un[qc]=4;function Ui(g){return"[object "+g+"]"}var tf=Ui("HTMLCanvasElement"),ef=Ui("OffscreenCanvas"),nf=Ui("CanvasRenderingContext2D"),rf=Ui("ImageBitmap"),sf=Ui("HTMLImageElement"),of=Ui("HTMLVideoElement"),V0=Object.keys(jc).concat([tf,ef,nf,rf,sf,of]),Vi=[];Vi[zi]=1,Vi[$s]=4,Vi[Gi]=2,Vi[Qc]=2,Vi[tl]=4;var mn=[];mn[zh]=2,mn[Hc]=2,mn[Uh]=2,mn[ra]=4,mn[Yc]=.5,mn[Jc]=.5,mn[Kc]=1,mn[Zc]=1,mn[Vh]=.5,mn[$h]=1,mn[Hh]=1,mn[Xh]=.5,mn[Wh]=.25,mn[qh]=.5,mn[Yh]=.25,mn[Jh]=.5;function af(g){return Array.isArray(g)&&(g.length===0||typeof g[0]=="number")}function cf(g){if(!Array.isArray(g))return!1;var w=g.length;return!(w===0||!Ge(g[0]))}function hi(g){return Object.prototype.toString.call(g)}function lf(g){return hi(g)===tf}function uf(g){return hi(g)===ef}function $0(g){return hi(g)===nf}function H0(g){return hi(g)===rf}function X0(g){return hi(g)===sf}function W0(g){return hi(g)===of}function sl(g){if(!g)return!1;var w=hi(g);return V0.indexOf(w)>=0?!0:af(g)||cf(g)||Zn(g)}function hf(g){return jc[Object.prototype.toString.call(g)]|0}function q0(g,w){var M=w.length;switch(g.type){case zi:case Qc:case tl:case $s:var Y=He.allocType(g.type,M);Y.set(w),g.data=Y;break;case Gi:g.data=Fh(w);break;default:S.raise("unsupported texture type, must specify a typed array")}}function ff(g,w){return He.allocType(g.type===Gi?$s:g.type,w)}function df(g,w){g.type===Gi?(g.data=Fh(w),He.freeType(w)):g.data=w}function Y0(g,w,M,Y,it,q){for(var Q=g.width,pt=g.height,mt=g.channels,Et=Q*pt*mt,bt=ff(g,Et),wt=0,Mt=0;Mt<pt;++Mt)for(var gt=0;gt<Q;++gt)for(var At=0;At<mt;++At)bt[wt++]=w[M*gt+Y*Mt+it*At+q];df(g,bt)}function oa(g,w,M,Y,it,q){var Q;if(typeof mn[g]<"u"?Q=mn[g]:Q=Un[g]*Vi[w],q&&(Q*=6),it){for(var pt=0,mt=M;mt>=1;)pt+=Q*mt*mt,mt/=2;return pt}else return Q*M*Y}function J0(g,w,M,Y,it,q,Q){var pt={"don't care":ia,"dont care":ia,nice:k0,fast:D0},mt={repeat:M0,clamp:el,mirror:P0},Et={nearest:nl,linear:L0},bt=r({mipmap:il,"nearest mipmap nearest":rl,"linear mipmap nearest":Kh,"nearest mipmap linear":Zh,"linear mipmap linear":il},Et),wt={none:0,browser:Qh},Mt={uint8:zi,rgba4:A0,rgb565:T0,"rgb5 a1":S0},gt={alpha:$c,luminance:Vs,"luminance alpha":na,rgb:ea,rgba:ui,rgba4:zh,"rgb5 a1":Hc,rgb565:Uh},At={};w.ext_srgb&&(gt.srgb=Wc,gt.srgba=qc),w.oes_texture_float&&(Mt.float32=Mt.float=$s),w.oes_texture_half_float&&(Mt.float16=Mt["half float"]=Gi),w.webgl_depth_texture&&(r(gt,{depth:Xc,"depth stencil":ra}),r(Mt,{uint16:Qc,uint32:tl,"depth stencil":C0})),w.webgl_compressed_texture_s3tc&&r(At,{"rgb s3tc dxt1":Yc,"rgba s3tc dxt1":Jc,"rgba s3tc dxt3":Kc,"rgba s3tc dxt5":Zc}),w.webgl_compressed_texture_atc&&r(At,{"rgb atc":Vh,"rgba atc explicit alpha":$h,"rgba atc interpolated alpha":Hh}),w.webgl_compressed_texture_pvrtc&&r(At,{"rgb pvrtc 4bppv1":Xh,"rgb pvrtc 2bppv1":Wh,"rgba pvrtc 4bppv1":qh,"rgba pvrtc 2bppv1":Yh}),w.webgl_compressed_texture_etc1&&(At["rgb etc1"]=Jh);var z=Array.prototype.slice.call(g.getParameter(w0));Object.keys(At).forEach(function(_){var J=At[_];z.indexOf(J)>=0&&(gt[_]=J)});var tt=Object.keys(gt);M.textureFormats=tt;var yt=[];Object.keys(gt).forEach(function(_){var J=gt[_];yt[J]=_});var Nt=[];Object.keys(Mt).forEach(function(_){var J=Mt[_];Nt[J]=_});var ut=[];Object.keys(Et).forEach(function(_){var J=Et[_];ut[J]=_});var Dt=[];Object.keys(bt).forEach(function(_){var J=bt[_];Dt[J]=_});var dt=[];Object.keys(mt).forEach(function(_){var J=mt[_];dt[J]=_});var St=tt.reduce(function(_,J){var $=gt[J];return $===Vs||$===$c||$===Vs||$===na||$===Xc||$===ra||w.ext_srgb&&($===Wc||$===qc)?_[$]=$:$===Hc||J.indexOf("rgba")>=0?_[$]=ui:_[$]=ea,_},{});function ht(){this.internalformat=ui,this.format=ui,this.type=zi,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Qh,this.width=0,this.height=0,this.channels=0}function Tt(_,J){_.internalformat=J.internalformat,_.format=J.format,_.type=J.type,_.compressed=J.compressed,_.premultiplyAlpha=J.premultiplyAlpha,_.flipY=J.flipY,_.unpackAlignment=J.unpackAlignment,_.colorSpace=J.colorSpace,_.width=J.width,_.height=J.height,_.channels=J.channels}function Wt(_,J){if(!(typeof J!="object"||!J)){if("premultiplyAlpha"in J&&(S.type(J.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),_.premultiplyAlpha=J.premultiplyAlpha),"flipY"in J&&(S.type(J.flipY,"boolean","invalid texture flip"),_.flipY=J.flipY),"alignment"in J&&(S.oneOf(J.alignment,[1,2,4,8],"invalid texture unpack alignment"),_.unpackAlignment=J.alignment),"colorSpace"in J&&(S.parameter(J.colorSpace,wt,"invalid colorSpace"),_.colorSpace=wt[J.colorSpace]),"type"in J){var $=J.type;S(w.oes_texture_float||!($==="float"||$==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),S(w.oes_texture_half_float||!($==="half float"||$==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),S(w.webgl_depth_texture||!($==="uint16"||$==="uint32"||$==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter($,Mt,"invalid texture type"),_.type=Mt[$]}var jt=_.width,de=_.height,T=_.channels,x=!1;"shape"in J?(S(Array.isArray(J.shape)&&J.shape.length>=2,"shape must be an array"),jt=J.shape[0],de=J.shape[1],J.shape.length===3&&(T=J.shape[2],S(T>0&&T<=4,"invalid number of channels"),x=!0),S(jt>=0&&jt<=M.maxTextureSize,"invalid width"),S(de>=0&&de<=M.maxTextureSize,"invalid height")):("radius"in J&&(jt=de=J.radius,S(jt>=0&&jt<=M.maxTextureSize,"invalid radius")),"width"in J&&(jt=J.width,S(jt>=0&&jt<=M.maxTextureSize,"invalid width")),"height"in J&&(de=J.height,S(de>=0&&de<=M.maxTextureSize,"invalid height")),"channels"in J&&(T=J.channels,S(T>0&&T<=4,"invalid number of channels"),x=!0)),_.width=jt|0,_.height=de|0,_.channels=T|0;var N=!1;if("format"in J){var F=J.format;S(w.webgl_depth_texture||!(F==="depth"||F==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),S.parameter(F,gt,"invalid texture format");var U=_.internalformat=gt[F];_.format=St[U],F in Mt&&("type"in J||(_.type=Mt[F])),F in At&&(_.compressed=!0),N=!0}!x&&N?_.channels=Un[_.format]:x&&!N?_.channels!==sa[_.format]&&(_.format=_.internalformat=sa[_.channels]):N&&x&&S(_.channels===Un[_.format],"number of channels inconsistent with specified format")}}function ie(_){g.pixelStorei(F0,_.flipY),g.pixelStorei(G0,_.premultiplyAlpha),g.pixelStorei(z0,_.colorSpace),g.pixelStorei(j0,_.unpackAlignment)}function Pt(){ht.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function xt(_,J){var $=null;if(sl(J)?$=J:J&&(S.type(J,"object","invalid pixel data type"),Wt(_,J),"x"in J&&(_.xOffset=J.x|0),"y"in J&&(_.yOffset=J.y|0),sl(J.data)&&($=J.data)),S(!_.compressed||$ instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),J.copy){S(!$,"can not specify copy and data field for the same texture");var jt=it.viewportWidth,de=it.viewportHeight;_.width=_.width||jt-_.xOffset,_.height=_.height||de-_.yOffset,_.needsCopy=!0,S(_.xOffset>=0&&_.xOffset<jt&&_.yOffset>=0&&_.yOffset<de&&_.width>0&&_.width<=jt&&_.height>0&&_.height<=de,"copy texture read out of bounds")}else if(!$)_.width=_.width||1,_.height=_.height||1,_.channels=_.channels||4;else if(e($))_.channels=_.channels||4,_.data=$,!("type"in J)&&_.type===zi&&(_.type=hf($));else if(af($))_.channels=_.channels||4,q0(_,$),_.alignment=1,_.needsFree=!0;else if(Zn($)){var T=$.data;!Array.isArray(T)&&_.type===zi&&(_.type=hf(T));var x=$.shape,N=$.stride,F,U,D,L,B,C;x.length===3?(D=x[2],C=N[2]):(S(x.length===2,"invalid ndarray pixel data, must be 2 or 3D"),D=1,C=1),F=x[0],U=x[1],L=N[0],B=N[1],_.alignment=1,_.width=F,_.height=U,_.channels=D,_.format=_.internalformat=sa[D],_.needsFree=!0,Y0(_,T,L,B,C,$.offset)}else if(lf($)||uf($)||$0($))lf($)||uf($)?_.element=$:_.element=$.canvas,_.width=_.element.width,_.height=_.element.height,_.channels=4;else if(H0($))_.element=$,_.width=$.width,_.height=$.height,_.channels=4;else if(X0($))_.element=$,_.width=$.naturalWidth,_.height=$.naturalHeight,_.channels=4;else if(W0($))_.element=$,_.width=$.videoWidth,_.height=$.videoHeight,_.channels=4;else if(cf($)){var P=_.width||$[0].length,A=_.height||$.length,j=_.channels;Ge($[0][0])?j=j||$[0][0].length:j=j||1;for(var V=Ko.shape($),rt=1,st=0;st<V.length;++st)rt*=V[st];var nt=ff(_,rt);Ko.flatten($,V,"",nt),df(_,nt),_.alignment=1,_.width=P,_.height=A,_.channels=j,_.format=_.internalformat=sa[j],_.needsFree=!0}_.type===$s?S(M.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):_.type===Gi&&S(M.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function ct(_,J,$){var jt=_.element,de=_.data,T=_.internalformat,x=_.format,N=_.type,F=_.width,U=_.height;ie(_),jt?g.texImage2D(J,$,x,x,N,jt):_.compressed?g.compressedTexImage2D(J,$,T,F,U,0,de):_.needsCopy?(Y(),g.copyTexImage2D(J,$,x,_.xOffset,_.yOffset,F,U,0)):g.texImage2D(J,$,x,F,U,0,x,N,de||null)}function te(_,J,$,jt,de){var T=_.element,x=_.data,N=_.internalformat,F=_.format,U=_.type,D=_.width,L=_.height;ie(_),T?g.texSubImage2D(J,de,$,jt,F,U,T):_.compressed?g.compressedTexSubImage2D(J,de,$,jt,N,D,L,x):_.needsCopy?(Y(),g.copyTexSubImage2D(J,de,$,jt,_.xOffset,_.yOffset,D,L)):g.texSubImage2D(J,de,$,jt,D,L,F,U,x)}var ce=[];function Ft(){return ce.pop()||new Pt}function fe(_){_.needsFree&&He.freeType(_.data),Pt.call(_),ce.push(_)}function se(){ht.call(this),this.genMipmaps=!1,this.mipmapHint=ia,this.mipmask=0,this.images=Array(16)}function he(_,J,$){var jt=_.images[0]=Ft();_.mipmask=1,jt.width=_.width=J,jt.height=_.height=$,jt.channels=_.channels=4}function Ee(_,J){var $=null;if(sl(J))$=_.images[0]=Ft(),Tt($,_),xt($,J),_.mipmask=1;else if(Wt(_,J),Array.isArray(J.mipmap))for(var jt=J.mipmap,de=0;de<jt.length;++de)$=_.images[de]=Ft(),Tt($,_),$.width>>=de,$.height>>=de,xt($,jt[de]),_.mipmask|=1<<de;else $=_.images[0]=Ft(),Tt($,_),xt($,J),_.mipmask=1;Tt(_,_.images[0]),_.compressed&&(_.internalformat===Yc||_.internalformat===Jc||_.internalformat===Kc||_.internalformat===Zc)&&S(_.width%4===0&&_.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function We(_,J){for(var $=_.images,jt=0;jt<$.length;++jt){if(!$[jt])return;ct($[jt],J,jt)}}var on=[];function ge(){var _=on.pop()||new se;ht.call(_),_.mipmask=0;for(var J=0;J<16;++J)_.images[J]=null;return _}function Ze(_){for(var J=_.images,$=0;$<J.length;++$)J[$]&&fe(J[$]),J[$]=null;on.push(_)}function Re(){this.minFilter=nl,this.magFilter=nl,this.wrapS=el,this.wrapT=el,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ia}function qe(_,J){if("min"in J){var $=J.min;S.parameter($,bt),_.minFilter=bt[$],U0.indexOf(_.minFilter)>=0&&!("faces"in J)&&(_.genMipmaps=!0)}if("mag"in J){var jt=J.mag;S.parameter(jt,Et),_.magFilter=Et[jt]}var de=_.wrapS,T=_.wrapT;if("wrap"in J){var x=J.wrap;typeof x=="string"?(S.parameter(x,mt),de=T=mt[x]):Array.isArray(x)&&(S.parameter(x[0],mt),S.parameter(x[1],mt),de=mt[x[0]],T=mt[x[1]])}else{if("wrapS"in J){var N=J.wrapS;S.parameter(N,mt),de=mt[N]}if("wrapT"in J){var F=J.wrapT;S.parameter(F,mt),T=mt[F]}}if(_.wrapS=de,_.wrapT=T,"anisotropic"in J){var U=J.anisotropic;S(typeof U=="number"&&U>=1&&U<=M.maxAnisotropic,"aniso samples must be between 1 and "),_.anisotropic=J.anisotropic}if("mipmap"in J){var D=!1;switch(typeof J.mipmap){case"string":S.parameter(J.mipmap,pt,"invalid mipmap hint"),_.mipmapHint=pt[J.mipmap],_.genMipmaps=!0,D=!0;break;case"boolean":D=_.genMipmaps=J.mipmap;break;case"object":S(Array.isArray(J.mipmap),"invalid mipmap type"),_.genMipmaps=!1,D=!0;break;default:S.raise("invalid mipmap type")}D&&!("min"in J)&&(_.minFilter=rl)}}function Qe(_,J){g.texParameteri(J,N0,_.minFilter),g.texParameteri(J,R0,_.magFilter),g.texParameteri(J,_0,_.wrapS),g.texParameteri(J,O0,_.wrapT),w.ext_texture_filter_anisotropic&&g.texParameteri(J,B0,_.anisotropic),_.genMipmaps&&(g.hint(I0,_.mipmapHint),g.generateMipmap(J))}var tn=0,un={},bn=M.maxTextureUnits,ze=Array(bn).map(function(){return null});function le(_){ht.call(this),this.mipmask=0,this.internalformat=ui,this.id=tn++,this.refCount=1,this.target=_,this.texture=g.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Re,Q.profile&&(this.stats={size:0})}function vn(_){g.activeTexture(Hs),g.bindTexture(_.target,_.texture)}function Se(){var _=ze[0];_?g.bindTexture(_.target,_.texture):g.bindTexture(cr,null)}function Jt(_){var J=_.texture;S(J,"must not double destroy texture");var $=_.unit,jt=_.target;$>=0&&(g.activeTexture(Hs+$),g.bindTexture(jt,null),ze[$]=null),g.deleteTexture(J),_.texture=null,_.params=null,_.pixels=null,_.refCount=0,delete un[_.id],q.textureCount--}r(le.prototype,{bind:function(){var _=this;_.bindCount+=1;var J=_.unit;if(J<0){for(var $=0;$<bn;++$){var jt=ze[$];if(jt){if(jt.bindCount>0)continue;jt.unit=-1}ze[$]=_,J=$;break}J>=bn&&S.raise("insufficient number of texture units"),Q.profile&&q.maxTextureUnits<J+1&&(q.maxTextureUnits=J+1),_.unit=J,g.activeTexture(Hs+J),g.bindTexture(_.target,_.texture)}return J},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Jt(this)}});function pe(_,J){var $=new le(cr);un[$.id]=$,q.textureCount++;function jt(x,N){var F=$.texInfo;Re.call(F);var U=ge();return typeof x=="number"?typeof N=="number"?he(U,x|0,N|0):he(U,x|0,x|0):x?(S.type(x,"object","invalid arguments to regl.texture"),qe(F,x),Ee(U,x)):he(U,1,1),F.genMipmaps&&(U.mipmask=(U.width<<1)-1),$.mipmask=U.mipmask,Tt($,U),S.texture2D(F,U,M),$.internalformat=U.internalformat,jt.width=U.width,jt.height=U.height,vn($),We(U,cr),Qe(F,cr),Se(),Ze(U),Q.profile&&($.stats.size=oa($.internalformat,$.type,U.width,U.height,F.genMipmaps,!1)),jt.format=yt[$.internalformat],jt.type=Nt[$.type],jt.mag=ut[F.magFilter],jt.min=Dt[F.minFilter],jt.wrapS=dt[F.wrapS],jt.wrapT=dt[F.wrapT],jt}function de(x,N,F,U){S(!!x,"must specify image data");var D=N|0,L=F|0,B=U|0,C=Ft();return Tt(C,$),C.width=0,C.height=0,xt(C,x),C.width=C.width||($.width>>B)-D,C.height=C.height||($.height>>B)-L,S($.type===C.type&&$.format===C.format&&$.internalformat===C.internalformat,"incompatible format for texture.subimage"),S(D>=0&&L>=0&&D+C.width<=$.width&&L+C.height<=$.height,"texture.subimage write out of bounds"),S($.mipmask&1<<B,"missing mipmap data"),S(C.data||C.element||C.needsCopy,"missing image data"),vn($),te(C,cr,D,L,B),Se(),fe(C),jt}function T(x,N){var F=x|0,U=N|0||F;if(F===$.width&&U===$.height)return jt;jt.width=$.width=F,jt.height=$.height=U,vn($);for(var D=0;$.mipmask>>D;++D){var L=F>>D,B=U>>D;if(!L||!B)break;g.texImage2D(cr,D,$.format,L,B,0,$.format,$.type,null)}return Se(),Q.profile&&($.stats.size=oa($.internalformat,$.type,F,U,!1,!1)),jt}return jt(_,J),jt.subimage=de,jt.resize=T,jt._reglType="texture2d",jt._texture=$,Q.profile&&(jt.stats=$.stats),jt.destroy=function(){$.decRef()},jt}function ve(_,J,$,jt,de,T){var x=new le(Vc);un[x.id]=x,q.cubeCount++;var N=new Array(6);function F(L,B,C,P,A,j){var V,rt=x.texInfo;for(Re.call(rt),V=0;V<6;++V)N[V]=ge();if(typeof L=="number"||!L){var st=L|0||1;for(V=0;V<6;++V)he(N[V],st,st)}else if(typeof L=="object")if(B)Ee(N[0],L),Ee(N[1],B),Ee(N[2],C),Ee(N[3],P),Ee(N[4],A),Ee(N[5],j);else if(qe(rt,L),Wt(x,L),"faces"in L){var nt=L.faces;for(S(Array.isArray(nt)&&nt.length===6,"cube faces must be a length 6 array"),V=0;V<6;++V)S(typeof nt[V]=="object"&&!!nt[V],"invalid input for cube map face"),Tt(N[V],x),Ee(N[V],nt[V])}else for(V=0;V<6;++V)Ee(N[V],L);else S.raise("invalid arguments to cube map");for(Tt(x,N[0]),M.npotTextureCube||S(Gh(x.width)&&Gh(x.height),"your browser does not support non power or two texture dimensions"),rt.genMipmaps?x.mipmask=(N[0].width<<1)-1:x.mipmask=N[0].mipmask,S.textureCube(x,rt,N,M),x.internalformat=N[0].internalformat,F.width=N[0].width,F.height=N[0].height,vn(x),V=0;V<6;++V)We(N[V],ta+V);for(Qe(rt,Vc),Se(),Q.profile&&(x.stats.size=oa(x.internalformat,x.type,F.width,F.height,rt.genMipmaps,!0)),F.format=yt[x.internalformat],F.type=Nt[x.type],F.mag=ut[rt.magFilter],F.min=Dt[rt.minFilter],F.wrapS=dt[rt.wrapS],F.wrapT=dt[rt.wrapT],V=0;V<6;++V)Ze(N[V]);return F}function U(L,B,C,P,A){S(!!B,"must specify image data"),S(typeof L=="number"&&L===(L|0)&&L>=0&&L<6,"invalid face");var j=C|0,V=P|0,rt=A|0,st=Ft();return Tt(st,x),st.width=0,st.height=0,xt(st,B),st.width=st.width||(x.width>>rt)-j,st.height=st.height||(x.height>>rt)-V,S(x.type===st.type&&x.format===st.format&&x.internalformat===st.internalformat,"incompatible format for texture.subimage"),S(j>=0&&V>=0&&j+st.width<=x.width&&V+st.height<=x.height,"texture.subimage write out of bounds"),S(x.mipmask&1<<rt,"missing mipmap data"),S(st.data||st.element||st.needsCopy,"missing image data"),vn(x),te(st,ta+L,j,V,rt),Se(),fe(st),F}function D(L){var B=L|0;if(B!==x.width){F.width=x.width=B,F.height=x.height=B,vn(x);for(var C=0;C<6;++C)for(var P=0;x.mipmask>>P;++P)g.texImage2D(ta+C,P,x.format,B>>P,B>>P,0,x.format,x.type,null);return Se(),Q.profile&&(x.stats.size=oa(x.internalformat,x.type,F.width,F.height,!1,!0)),F}}return F(_,J,$,jt,de,T),F.subimage=U,F.resize=D,F._reglType="textureCube",F._texture=x,Q.profile&&(F.stats=x.stats),F.destroy=function(){x.decRef()},F}function Ue(){for(var _=0;_<bn;++_)g.activeTexture(Hs+_),g.bindTexture(cr,null),ze[_]=null;Gn(un).forEach(Jt),q.cubeCount=0,q.textureCount=0}Q.profile&&(q.getTotalTextureSize=function(){var _=0;return Object.keys(un).forEach(function(J){_+=un[J].stats.size}),_});function ur(){for(var _=0;_<bn;++_){var J=ze[_];J&&(J.bindCount=0,J.unit=-1,ze[_]=null)}Gn(un).forEach(function($){$.texture=g.createTexture(),g.bindTexture($.target,$.texture);for(var jt=0;jt<32;++jt)if($.mipmask&1<<jt)if($.target===cr)g.texImage2D(cr,jt,$.internalformat,$.width>>jt,$.height>>jt,0,$.internalformat,$.type,null);else for(var de=0;de<6;++de)g.texImage2D(ta+de,jt,$.internalformat,$.width>>jt,$.height>>jt,0,$.internalformat,$.type,null);Qe($.texInfo,$.target)})}function vi(){for(var _=0;_<bn;++_){var J=ze[_];J&&(J.bindCount=0,J.unit=-1,ze[_]=null),g.activeTexture(Hs+_),g.bindTexture(cr,null),g.bindTexture(Vc,null)}}return{create2D:pe,createCube:ve,clear:Ue,getTexture:function(_){return null},restore:ur,refresh:vi}}var kr=36161,aa=32854,pf=32855,gf=36194,mf=33189,bf=36168,vf=34041,yf=35907,Ef=34836,xf=34842,wf=34843,Qn=[];Qn[aa]=2,Qn[pf]=2,Qn[gf]=2,Qn[mf]=2,Qn[bf]=1,Qn[vf]=4,Qn[yf]=4,Qn[Ef]=16,Qn[xf]=8,Qn[wf]=6;function Af(g,w,M){return Qn[g]*w*M}var K0=function(g,w,M,Y,it){var q={rgba4:aa,rgb565:gf,"rgb5 a1":pf,depth:mf,stencil:bf,"depth stencil":vf};w.ext_srgb&&(q.srgba=yf),w.ext_color_buffer_half_float&&(q.rgba16f=xf,q.rgb16f=wf),w.webgl_color_buffer_float&&(q.rgba32f=Ef);var Q=[];Object.keys(q).forEach(function(gt){var At=q[gt];Q[At]=gt});var pt=0,mt={};function Et(gt){this.id=pt++,this.refCount=1,this.renderbuffer=gt,this.format=aa,this.width=0,this.height=0,it.profile&&(this.stats={size:0})}Et.prototype.decRef=function(){--this.refCount<=0&&bt(this)};function bt(gt){var At=gt.renderbuffer;S(At,"must not double destroy renderbuffer"),g.bindRenderbuffer(kr,null),g.deleteRenderbuffer(At),gt.renderbuffer=null,gt.refCount=0,delete mt[gt.id],Y.renderbufferCount--}function wt(gt,At){var z=new Et(g.createRenderbuffer());mt[z.id]=z,Y.renderbufferCount++;function tt(Nt,ut){var Dt=0,dt=0,St=aa;if(typeof Nt=="object"&&Nt){var ht=Nt;if("shape"in ht){var Tt=ht.shape;S(Array.isArray(Tt)&&Tt.length>=2,"invalid renderbuffer shape"),Dt=Tt[0]|0,dt=Tt[1]|0}else"radius"in ht&&(Dt=dt=ht.radius|0),"width"in ht&&(Dt=ht.width|0),"height"in ht&&(dt=ht.height|0);"format"in ht&&(S.parameter(ht.format,q,"invalid renderbuffer format"),St=q[ht.format])}else typeof Nt=="number"?(Dt=Nt|0,typeof ut=="number"?dt=ut|0:dt=Dt):Nt?S.raise("invalid arguments to renderbuffer constructor"):Dt=dt=1;if(S(Dt>0&&dt>0&&Dt<=M.maxRenderbufferSize&&dt<=M.maxRenderbufferSize,"invalid renderbuffer size"),!(Dt===z.width&&dt===z.height&&St===z.format))return tt.width=z.width=Dt,tt.height=z.height=dt,z.format=St,g.bindRenderbuffer(kr,z.renderbuffer),g.renderbufferStorage(kr,St,Dt,dt),S(g.getError()===0,"invalid render buffer format"),it.profile&&(z.stats.size=Af(z.format,z.width,z.height)),tt.format=Q[z.format],tt}function yt(Nt,ut){var Dt=Nt|0,dt=ut|0||Dt;return Dt===z.width&&dt===z.height||(S(Dt>0&&dt>0&&Dt<=M.maxRenderbufferSize&&dt<=M.maxRenderbufferSize,"invalid renderbuffer size"),tt.width=z.width=Dt,tt.height=z.height=dt,g.bindRenderbuffer(kr,z.renderbuffer),g.renderbufferStorage(kr,z.format,Dt,dt),S(g.getError()===0,"invalid render buffer format"),it.profile&&(z.stats.size=Af(z.format,z.width,z.height))),tt}return tt(gt,At),tt.resize=yt,tt._reglType="renderbuffer",tt._renderbuffer=z,it.profile&&(tt.stats=z.stats),tt.destroy=function(){z.decRef()},tt}it.profile&&(Y.getTotalRenderbufferSize=function(){var gt=0;return Object.keys(mt).forEach(function(At){gt+=mt[At].stats.size}),gt});function Mt(){Gn(mt).forEach(function(gt){gt.renderbuffer=g.createRenderbuffer(),g.bindRenderbuffer(kr,gt.renderbuffer),g.renderbufferStorage(kr,gt.format,gt.width,gt.height)}),g.bindRenderbuffer(kr,null)}return{create:wt,clear:function(){Gn(mt).forEach(bt)},restore:Mt}},xr=36160,ol=36161,fi=3553,ca=34069,Sf=36064,Tf=36096,Cf=36128,_f=33306,Of=36053,Z0=36054,Q0=36055,tE=36057,eE=36061,nE=36193,rE=5121,iE=5126,Mf=6407,Pf=6408,sE=6402,oE=[Mf,Pf],al=[];al[Pf]=4,al[Mf]=3;var la=[];la[rE]=1,la[iE]=4,la[nE]=2;var aE=32854,cE=32855,lE=36194,uE=33189,hE=36168,Rf=34041,fE=35907,dE=34836,pE=34842,gE=34843,mE=[aE,cE,lE,fE,pE,gE,dE],$i={};$i[Of]="complete",$i[Z0]="incomplete attachment",$i[tE]="incomplete dimensions",$i[Q0]="incomplete, missing attachment",$i[eE]="unsupported";function bE(g,w,M,Y,it,q){var Q={cur:null,next:null,dirty:!1,setFBO:null},pt=["rgba"],mt=["rgba4","rgb565","rgb5 a1"];w.ext_srgb&&mt.push("srgba"),w.ext_color_buffer_half_float&&mt.push("rgba16f","rgb16f"),w.webgl_color_buffer_float&&mt.push("rgba32f");var Et=["uint8"];w.oes_texture_half_float&&Et.push("half float","float16"),w.oes_texture_float&&Et.push("float","float32");function bt(Pt,xt,ct){this.target=Pt,this.texture=xt,this.renderbuffer=ct;var te=0,ce=0;xt?(te=xt.width,ce=xt.height):ct&&(te=ct.width,ce=ct.height),this.width=te,this.height=ce}function wt(Pt){Pt&&(Pt.texture&&Pt.texture._texture.decRef(),Pt.renderbuffer&&Pt.renderbuffer._renderbuffer.decRef())}function Mt(Pt,xt,ct){if(Pt)if(Pt.texture){var te=Pt.texture._texture,ce=Math.max(1,te.width),Ft=Math.max(1,te.height);S(ce===xt&&Ft===ct,"inconsistent width/height for supplied texture"),te.refCount+=1}else{var fe=Pt.renderbuffer._renderbuffer;S(fe.width===xt&&fe.height===ct,"inconsistent width/height for renderbuffer"),fe.refCount+=1}}function gt(Pt,xt){xt&&(xt.texture?g.framebufferTexture2D(xr,Pt,xt.target,xt.texture._texture.texture,0):g.framebufferRenderbuffer(xr,Pt,ol,xt.renderbuffer._renderbuffer.renderbuffer))}function At(Pt){var xt=fi,ct=null,te=null,ce=Pt;typeof Pt=="object"&&(ce=Pt.data,"target"in Pt&&(xt=Pt.target|0)),S.type(ce,"function","invalid attachment data");var Ft=ce._reglType;return Ft==="texture2d"?(ct=ce,S(xt===fi)):Ft==="textureCube"?(ct=ce,S(xt>=ca&&xt<ca+6,"invalid cube map target")):Ft==="renderbuffer"?(te=ce,xt=ol):S.raise("invalid regl object for attachment"),new bt(xt,ct,te)}function z(Pt,xt,ct,te,ce){if(ct){var Ft=Y.create2D({width:Pt,height:xt,format:te,type:ce});return Ft._texture.refCount=0,new bt(fi,Ft,null)}else{var fe=it.create({width:Pt,height:xt,format:te});return fe._renderbuffer.refCount=0,new bt(ol,null,fe)}}function tt(Pt){return Pt&&(Pt.texture||Pt.renderbuffer)}function yt(Pt,xt,ct){Pt&&(Pt.texture?Pt.texture.resize(xt,ct):Pt.renderbuffer&&Pt.renderbuffer.resize(xt,ct),Pt.width=xt,Pt.height=ct)}var Nt=0,ut={};function Dt(){this.id=Nt++,ut[this.id]=this,this.framebuffer=g.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function dt(Pt){Pt.colorAttachments.forEach(wt),wt(Pt.depthAttachment),wt(Pt.stencilAttachment),wt(Pt.depthStencilAttachment)}function St(Pt){var xt=Pt.framebuffer;S(xt,"must not double destroy framebuffer"),g.deleteFramebuffer(xt),Pt.framebuffer=null,q.framebufferCount--,delete ut[Pt.id]}function ht(Pt){var xt;g.bindFramebuffer(xr,Pt.framebuffer);var ct=Pt.colorAttachments;for(xt=0;xt<ct.length;++xt)gt(Sf+xt,ct[xt]);for(xt=ct.length;xt<M.maxColorAttachments;++xt)g.framebufferTexture2D(xr,Sf+xt,fi,null,0);g.framebufferTexture2D(xr,_f,fi,null,0),g.framebufferTexture2D(xr,Tf,fi,null,0),g.framebufferTexture2D(xr,Cf,fi,null,0),gt(Tf,Pt.depthAttachment),gt(Cf,Pt.stencilAttachment),gt(_f,Pt.depthStencilAttachment);var te=g.checkFramebufferStatus(xr);!g.isContextLost()&&te!==Of&&S.raise("framebuffer configuration not supported, status = "+$i[te]),g.bindFramebuffer(xr,Q.next?Q.next.framebuffer:null),Q.cur=Q.next,g.getError()}function Tt(Pt,xt){var ct=new Dt;q.framebufferCount++;function te(Ft,fe){var se;S(Q.next!==ct,"can not update framebuffer which is currently in use");var he=0,Ee=0,We=!0,on=!0,ge=null,Ze=!0,Re="rgba",qe="uint8",Qe=1,tn=null,un=null,bn=null,ze=!1;if(typeof Ft=="number")he=Ft|0,Ee=fe|0||he;else if(!Ft)he=Ee=1;else{S.type(Ft,"object","invalid arguments for framebuffer");var le=Ft;if("shape"in le){var vn=le.shape;S(Array.isArray(vn)&&vn.length>=2,"invalid shape for framebuffer"),he=vn[0],Ee=vn[1]}else"radius"in le&&(he=Ee=le.radius),"width"in le&&(he=le.width),"height"in le&&(Ee=le.height);("color"in le||"colors"in le)&&(ge=le.color||le.colors,Array.isArray(ge)&&S(ge.length===1||w.webgl_draw_buffers,"multiple render targets not supported")),ge||("colorCount"in le&&(Qe=le.colorCount|0,S(Qe>0,"invalid color buffer count")),"colorTexture"in le&&(Ze=!!le.colorTexture,Re="rgba4"),"colorType"in le&&(qe=le.colorType,Ze?(S(w.oes_texture_float||!(qe==="float"||qe==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),S(w.oes_texture_half_float||!(qe==="half float"||qe==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):qe==="half float"||qe==="float16"?(S(w.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Re="rgba16f"):(qe==="float"||qe==="float32")&&(S(w.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Re="rgba32f"),S.oneOf(qe,Et,"invalid color type")),"colorFormat"in le&&(Re=le.colorFormat,pt.indexOf(Re)>=0?Ze=!0:mt.indexOf(Re)>=0?Ze=!1:Ze?S.oneOf(le.colorFormat,pt,"invalid color format for texture"):S.oneOf(le.colorFormat,mt,"invalid color format for renderbuffer"))),("depthTexture"in le||"depthStencilTexture"in le)&&(ze=!!(le.depthTexture||le.depthStencilTexture),S(!ze||w.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in le&&(typeof le.depth=="boolean"?We=le.depth:(tn=le.depth,on=!1)),"stencil"in le&&(typeof le.stencil=="boolean"?on=le.stencil:(un=le.stencil,We=!1)),"depthStencil"in le&&(typeof le.depthStencil=="boolean"?We=on=le.depthStencil:(bn=le.depthStencil,We=!1,on=!1))}var Se=null,Jt=null,pe=null,ve=null;if(Array.isArray(ge))Se=ge.map(At);else if(ge)Se=[At(ge)];else for(Se=new Array(Qe),se=0;se<Qe;++se)Se[se]=z(he,Ee,Ze,Re,qe);S(w.webgl_draw_buffers||Se.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),S(Se.length<=M.maxColorAttachments,"too many color attachments, not supported"),he=he||Se[0].width,Ee=Ee||Se[0].height,tn?Jt=At(tn):We&&!on&&(Jt=z(he,Ee,ze,"depth","uint32")),un?pe=At(un):on&&!We&&(pe=z(he,Ee,!1,"stencil","uint8")),bn?ve=At(bn):!tn&&!un&&on&&We&&(ve=z(he,Ee,ze,"depth stencil","depth stencil")),S(!!tn+!!un+!!bn<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Ue=null;for(se=0;se<Se.length;++se)if(Mt(Se[se],he,Ee),S(!Se[se]||Se[se].texture&&oE.indexOf(Se[se].texture._texture.format)>=0||Se[se].renderbuffer&&mE.indexOf(Se[se].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+se+" is invalid"),Se[se]&&Se[se].texture){var ur=al[Se[se].texture._texture.format]*la[Se[se].texture._texture.type];Ue===null?Ue=ur:S(Ue===ur,"all color attachments much have the same number of bits per pixel.")}return Mt(Jt,he,Ee),S(!Jt||Jt.texture&&Jt.texture._texture.format===sE||Jt.renderbuffer&&Jt.renderbuffer._renderbuffer.format===uE,"invalid depth attachment for framebuffer object"),Mt(pe,he,Ee),S(!pe||pe.renderbuffer&&pe.renderbuffer._renderbuffer.format===hE,"invalid stencil attachment for framebuffer object"),Mt(ve,he,Ee),S(!ve||ve.texture&&ve.texture._texture.format===Rf||ve.renderbuffer&&ve.renderbuffer._renderbuffer.format===Rf,"invalid depth-stencil attachment for framebuffer object"),dt(ct),ct.width=he,ct.height=Ee,ct.colorAttachments=Se,ct.depthAttachment=Jt,ct.stencilAttachment=pe,ct.depthStencilAttachment=ve,te.color=Se.map(tt),te.depth=tt(Jt),te.stencil=tt(pe),te.depthStencil=tt(ve),te.width=ct.width,te.height=ct.height,ht(ct),te}function ce(Ft,fe){S(Q.next!==ct,"can not resize a framebuffer which is currently in use");var se=Math.max(Ft|0,1),he=Math.max(fe|0||se,1);if(se===ct.width&&he===ct.height)return te;for(var Ee=ct.colorAttachments,We=0;We<Ee.length;++We)yt(Ee[We],se,he);return yt(ct.depthAttachment,se,he),yt(ct.stencilAttachment,se,he),yt(ct.depthStencilAttachment,se,he),ct.width=te.width=se,ct.height=te.height=he,ht(ct),te}return te(Pt,xt),r(te,{resize:ce,_reglType:"framebuffer",_framebuffer:ct,destroy:function(){St(ct),dt(ct)},use:function(Ft){Q.setFBO({framebuffer:te},Ft)}})}function Wt(Pt){var xt=Array(6);function ct(ce){var Ft;S(xt.indexOf(Q.next)<0,"can not update framebuffer which is currently in use");var fe={color:null},se=0,he=null,Ee="rgba",We="uint8",on=1;if(typeof ce=="number")se=ce|0;else if(!ce)se=1;else{S.type(ce,"object","invalid arguments for framebuffer");var ge=ce;if("shape"in ge){var Ze=ge.shape;S(Array.isArray(Ze)&&Ze.length>=2,"invalid shape for framebuffer"),S(Ze[0]===Ze[1],"cube framebuffer must be square"),se=Ze[0]}else"radius"in ge&&(se=ge.radius|0),"width"in ge?(se=ge.width|0,"height"in ge&&S(ge.height===se,"must be square")):"height"in ge&&(se=ge.height|0);("color"in ge||"colors"in ge)&&(he=ge.color||ge.colors,Array.isArray(he)&&S(he.length===1||w.webgl_draw_buffers,"multiple render targets not supported")),he||("colorCount"in ge&&(on=ge.colorCount|0,S(on>0,"invalid color buffer count")),"colorType"in ge&&(S.oneOf(ge.colorType,Et,"invalid color type"),We=ge.colorType),"colorFormat"in ge&&(Ee=ge.colorFormat,S.oneOf(ge.colorFormat,pt,"invalid color format for texture"))),"depth"in ge&&(fe.depth=ge.depth),"stencil"in ge&&(fe.stencil=ge.stencil),"depthStencil"in ge&&(fe.depthStencil=ge.depthStencil)}var Re;if(he)if(Array.isArray(he))for(Re=[],Ft=0;Ft<he.length;++Ft)Re[Ft]=he[Ft];else Re=[he];else{Re=Array(on);var qe={radius:se,format:Ee,type:We};for(Ft=0;Ft<on;++Ft)Re[Ft]=Y.createCube(qe)}for(fe.color=Array(Re.length),Ft=0;Ft<Re.length;++Ft){var Qe=Re[Ft];S(typeof Qe=="function"&&Qe._reglType==="textureCube","invalid cube map"),se=se||Qe.width,S(Qe.width===se&&Qe.height===se,"invalid cube map shape"),fe.color[Ft]={target:ca,data:Re[Ft]}}for(Ft=0;Ft<6;++Ft){for(var tn=0;tn<Re.length;++tn)fe.color[tn].target=ca+Ft;Ft>0&&(fe.depth=xt[0].depth,fe.stencil=xt[0].stencil,fe.depthStencil=xt[0].depthStencil),xt[Ft]?xt[Ft](fe):xt[Ft]=Tt(fe)}return r(ct,{width:se,height:se,color:Re})}function te(ce){var Ft,fe=ce|0;if(S(fe>0&&fe<=M.maxCubeMapSize,"invalid radius for cube fbo"),fe===ct.width)return ct;var se=ct.color;for(Ft=0;Ft<se.length;++Ft)se[Ft].resize(fe);for(Ft=0;Ft<6;++Ft)xt[Ft].resize(fe);return ct.width=ct.height=fe,ct}return ct(Pt),r(ct,{faces:xt,resize:te,_reglType:"framebufferCube",destroy:function(){xt.forEach(function(ce){ce.destroy()})}})}function ie(){Q.cur=null,Q.next=null,Q.dirty=!0,Gn(ut).forEach(function(Pt){Pt.framebuffer=g.createFramebuffer(),ht(Pt)})}return r(Q,{getFramebuffer:function(Pt){if(typeof Pt=="function"&&Pt._reglType==="framebuffer"){var xt=Pt._framebuffer;if(xt instanceof Dt)return xt}return null},create:Tt,createCube:Wt,clear:function(){Gn(ut).forEach(St)},restore:ie})}var vE=5126,Nf=34962;function cl(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=vE,this.offset=0,this.stride=0,this.divisor=0}function yE(g,w,M,Y,it){for(var q=M.maxAttributes,Q=new Array(q),pt=0;pt<q;++pt)Q[pt]=new cl;var mt=0,Et={},bt={Record:cl,scope:{},state:Q,currentVAO:null,targetVAO:null,restore:Mt()?ut:function(){},createVAO:Dt,getVAO:At,destroyBuffer:wt,setVAO:Mt()?z:tt,clear:Mt()?yt:function(){}};function wt(dt){for(var St=0;St<Q.length;++St){var ht=Q[St];ht.buffer===dt&&(g.disableVertexAttribArray(St),ht.buffer=null)}}function Mt(){return w.oes_vertex_array_object}function gt(){return w.angle_instanced_arrays}function At(dt){return typeof dt=="function"&&dt._vao?dt._vao:null}function z(dt){if(dt!==bt.currentVAO){var St=Mt();dt?St.bindVertexArrayOES(dt.vao):St.bindVertexArrayOES(null),bt.currentVAO=dt}}function tt(dt){if(dt!==bt.currentVAO){if(dt)dt.bindAttrs();else for(var St=gt(),ht=0;ht<Q.length;++ht){var Tt=Q[ht];Tt.buffer?(g.enableVertexAttribArray(ht),g.vertexAttribPointer(ht,Tt.size,Tt.type,Tt.normalized,Tt.stride,Tt.offfset),St&&Tt.divisor&&St.vertexAttribDivisorANGLE(ht,Tt.divisor)):(g.disableVertexAttribArray(ht),g.vertexAttrib4f(ht,Tt.x,Tt.y,Tt.z,Tt.w))}bt.currentVAO=dt}}function yt(){Gn(Et).forEach(function(dt){dt.destroy()})}function Nt(){this.id=++mt,this.attributes=[];var dt=Mt();dt?this.vao=dt.createVertexArrayOES():this.vao=null,Et[this.id]=this,this.buffers=[]}Nt.prototype.bindAttrs=function(){for(var dt=gt(),St=this.attributes,ht=0;ht<St.length;++ht){var Tt=St[ht];Tt.buffer?(g.enableVertexAttribArray(ht),g.bindBuffer(Nf,Tt.buffer.buffer),g.vertexAttribPointer(ht,Tt.size,Tt.type,Tt.normalized,Tt.stride,Tt.offset),dt&&Tt.divisor&&dt.vertexAttribDivisorANGLE(ht,Tt.divisor)):(g.disableVertexAttribArray(ht),g.vertexAttrib4f(ht,Tt.x,Tt.y,Tt.z,Tt.w))}for(var Wt=St.length;Wt<q;++Wt)g.disableVertexAttribArray(Wt)},Nt.prototype.refresh=function(){var dt=Mt();dt&&(dt.bindVertexArrayOES(this.vao),this.bindAttrs(),bt.currentVAO=this)},Nt.prototype.destroy=function(){if(this.vao){var dt=Mt();this===bt.currentVAO&&(bt.currentVAO=null,dt.bindVertexArrayOES(null)),dt.deleteVertexArrayOES(this.vao),this.vao=null}Et[this.id]&&(delete Et[this.id],Y.vaoCount-=1)};function ut(){var dt=Mt();dt&&Gn(Et).forEach(function(St){St.refresh()})}function Dt(dt){var St=new Nt;Y.vaoCount+=1;function ht(Tt){S(Array.isArray(Tt),"arguments to vertex array constructor must be an array"),S(Tt.length<q,"too many attributes"),S(Tt.length>0,"must specify at least one attribute");var Wt={},ie=St.attributes;ie.length=Tt.length;for(var Pt=0;Pt<Tt.length;++Pt){var xt=Tt[Pt],ct=ie[Pt]=new cl,te=xt.data||xt;if(Array.isArray(te)||e(te)||Zn(te)){var ce;St.buffers[Pt]&&(ce=St.buffers[Pt],e(te)&&ce._buffer.byteLength>=te.byteLength?ce.subdata(te):(ce.destroy(),St.buffers[Pt]=null)),St.buffers[Pt]||(ce=St.buffers[Pt]=it.create(xt,Nf,!1,!0)),ct.buffer=it.getBuffer(ce),ct.size=ct.buffer.dimension|0,ct.normalized=!1,ct.type=ct.buffer.dtype,ct.offset=0,ct.stride=0,ct.divisor=0,ct.state=1,Wt[Pt]=1}else it.getBuffer(xt)?(ct.buffer=it.getBuffer(xt),ct.size=ct.buffer.dimension|0,ct.normalized=!1,ct.type=ct.buffer.dtype,ct.offset=0,ct.stride=0,ct.divisor=0,ct.state=1):it.getBuffer(xt.buffer)?(ct.buffer=it.getBuffer(xt.buffer),ct.size=(+xt.size||ct.buffer.dimension)|0,ct.normalized=!!xt.normalized||!1,"type"in xt?(S.parameter(xt.type,ci,"invalid buffer type"),ct.type=ci[xt.type]):ct.type=ct.buffer.dtype,ct.offset=(xt.offset||0)|0,ct.stride=(xt.stride||0)|0,ct.divisor=(xt.divisor||0)|0,ct.state=1,S(ct.size>=1&&ct.size<=4,"size must be between 1 and 4"),S(ct.offset>=0,"invalid offset"),S(ct.stride>=0&&ct.stride<=255,"stride must be between 0 and 255"),S(ct.divisor>=0,"divisor must be positive"),S(!ct.divisor||!!w.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in xt?(S(Pt>0,"first attribute must not be a constant"),ct.x=+xt.x||0,ct.y=+xt.y||0,ct.z=+xt.z||0,ct.w=+xt.w||0,ct.state=2):S(!1,"invalid attribute spec for location "+Pt)}for(var Ft=0;Ft<St.buffers.length;++Ft)!Wt[Ft]&&St.buffers[Ft]&&(St.buffers[Ft].destroy(),St.buffers[Ft]=null);return St.refresh(),ht}return ht.destroy=function(){for(var Tt=0;Tt<St.buffers.length;++Tt)St.buffers[Tt]&&St.buffers[Tt].destroy();St.buffers.length=0,St.destroy()},ht._vao=St,ht._reglType="vao",ht(dt)}return bt}var Lf=35632,EE=35633,xE=35718,wE=35721;function AE(g,w,M,Y){var it={},q={};function Q(z,tt,yt,Nt){this.name=z,this.id=tt,this.location=yt,this.info=Nt}function pt(z,tt){for(var yt=0;yt<z.length;++yt)if(z[yt].id===tt.id){z[yt].location=tt.location;return}z.push(tt)}function mt(z,tt,yt){var Nt=z===Lf?it:q,ut=Nt[tt];if(!ut){var Dt=w.str(tt);ut=g.createShader(z),g.shaderSource(ut,Dt),g.compileShader(ut),S.shaderError(g,ut,Dt,z,yt),Nt[tt]=ut}return ut}var Et={},bt=[],wt=0;function Mt(z,tt){this.id=wt++,this.fragId=z,this.vertId=tt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,Y.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function gt(z,tt,yt){var Nt,ut,Dt=mt(Lf,z.fragId),dt=mt(EE,z.vertId),St=z.program=g.createProgram();if(g.attachShader(St,Dt),g.attachShader(St,dt),yt)for(Nt=0;Nt<yt.length;++Nt){var ht=yt[Nt];g.bindAttribLocation(St,ht[0],ht[1])}g.linkProgram(St),S.linkError(g,St,w.str(z.fragId),w.str(z.vertId),tt);var Tt=g.getProgramParameter(St,xE);Y.profile&&(z.stats.uniformsCount=Tt);var Wt=z.uniforms;for(Nt=0;Nt<Tt;++Nt)if(ut=g.getActiveUniform(St,Nt),ut)if(ut.size>1)for(var ie=0;ie<ut.size;++ie){var Pt=ut.name.replace("[0]","["+ie+"]");pt(Wt,new Q(Pt,w.id(Pt),g.getUniformLocation(St,Pt),ut))}else pt(Wt,new Q(ut.name,w.id(ut.name),g.getUniformLocation(St,ut.name),ut));var xt=g.getProgramParameter(St,wE);Y.profile&&(z.stats.attributesCount=xt);var ct=z.attributes;for(Nt=0;Nt<xt;++Nt)ut=g.getActiveAttrib(St,Nt),ut&&pt(ct,new Q(ut.name,w.id(ut.name),g.getAttribLocation(St,ut.name),ut))}Y.profile&&(M.getMaxUniformsCount=function(){var z=0;return bt.forEach(function(tt){tt.stats.uniformsCount>z&&(z=tt.stats.uniformsCount)}),z},M.getMaxAttributesCount=function(){var z=0;return bt.forEach(function(tt){tt.stats.attributesCount>z&&(z=tt.stats.attributesCount)}),z});function At(){it={},q={};for(var z=0;z<bt.length;++z)gt(bt[z],null,bt[z].attributes.map(function(tt){return[tt.location,tt.name]}))}return{clear:function(){var z=g.deleteShader.bind(g);Gn(it).forEach(z),it={},Gn(q).forEach(z),q={},bt.forEach(function(tt){g.deleteProgram(tt.program)}),bt.length=0,Et={},M.shaderCount=0},program:function(z,tt,yt,Nt){S.command(z>=0,"missing vertex shader",yt),S.command(tt>=0,"missing fragment shader",yt);var ut=Et[tt];ut||(ut=Et[tt]={});var Dt=ut[z];if(Dt&&(Dt.refCount++,!Nt))return Dt;var dt=new Mt(tt,z);return M.shaderCount++,gt(dt,yt,Nt),Dt||(ut[z]=dt),bt.push(dt),r(dt,{destroy:function(){if(dt.refCount--,dt.refCount<=0){g.deleteProgram(dt.program);var St=bt.indexOf(dt);bt.splice(St,1),M.shaderCount--}ut[dt.vertId].refCount<=0&&(g.deleteShader(q[dt.vertId]),delete q[dt.vertId],delete Et[dt.fragId][dt.vertId]),Object.keys(Et[dt.fragId]).length||(g.deleteShader(it[dt.fragId]),delete it[dt.fragId],delete Et[dt.fragId])}})},restore:At,shader:mt,frag:-1,vert:-1}}var SE=6408,Xs=5121,TE=3333,ua=5126;function CE(g,w,M,Y,it,q,Q){function pt(bt){var wt;w.next===null?(S(it.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),wt=Xs):(S(w.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),wt=w.next.colorAttachments[0].texture._texture.type,q.oes_texture_float?(S(wt===Xs||wt===ua,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),wt===ua&&S(Q.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):S(wt===Xs,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Mt=0,gt=0,At=Y.framebufferWidth,z=Y.framebufferHeight,tt=null;e(bt)?tt=bt:bt&&(S.type(bt,"object","invalid arguments to regl.read()"),Mt=bt.x|0,gt=bt.y|0,S(Mt>=0&&Mt<Y.framebufferWidth,"invalid x offset for regl.read"),S(gt>=0&&gt<Y.framebufferHeight,"invalid y offset for regl.read"),At=(bt.width||Y.framebufferWidth-Mt)|0,z=(bt.height||Y.framebufferHeight-gt)|0,tt=bt.data||null),tt&&(wt===Xs?S(tt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):wt===ua&&S(tt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),S(At>0&&At+Mt<=Y.framebufferWidth,"invalid width for read pixels"),S(z>0&&z+gt<=Y.framebufferHeight,"invalid height for read pixels"),M();var yt=At*z*4;return tt||(wt===Xs?tt=new Uint8Array(yt):wt===ua&&(tt=tt||new Float32Array(yt))),S.isTypedArray(tt,"data buffer for regl.read() must be a typedarray"),S(tt.byteLength>=yt,"data buffer for regl.read() too small"),g.pixelStorei(TE,4),g.readPixels(Mt,gt,At,z,SE,wt,tt),tt}function mt(bt){var wt;return w.setFBO({framebuffer:bt.framebuffer},function(){wt=pt(bt)}),wt}function Et(bt){return!bt||!("framebuffer"in bt)?pt(bt):mt(bt)}return Et}function Hi(g){return Array.prototype.slice.call(g)}function Xi(g){return Hi(g).join("")}function _E(){var g=0,w=[],M=[];function Y(wt){for(var Mt=0;Mt<M.length;++Mt)if(M[Mt]===wt)return w[Mt];var gt="g"+g++;return w.push(gt),M.push(wt),gt}function it(){var wt=[];function Mt(){wt.push.apply(wt,Hi(arguments))}var gt=[];function At(){var z="v"+g++;return gt.push(z),arguments.length>0&&(wt.push(z,"="),wt.push.apply(wt,Hi(arguments)),wt.push(";")),z}return r(Mt,{def:At,toString:function(){return Xi([gt.length>0?"var "+gt.join(",")+";":"",Xi(wt)])}})}function q(){var wt=it(),Mt=it(),gt=wt.toString,At=Mt.toString;function z(tt,yt){Mt(tt,yt,"=",wt.def(tt,yt),";")}return r(function(){wt.apply(wt,Hi(arguments))},{def:wt.def,entry:wt,exit:Mt,save:z,set:function(tt,yt,Nt){z(tt,yt),wt(tt,yt,"=",Nt,";")},toString:function(){return gt()+At()}})}function Q(){var wt=Xi(arguments),Mt=q(),gt=q(),At=Mt.toString,z=gt.toString;return r(Mt,{then:function(){return Mt.apply(Mt,Hi(arguments)),this},else:function(){return gt.apply(gt,Hi(arguments)),this},toString:function(){var tt=z();return tt&&(tt="else{"+tt+"}"),Xi(["if(",wt,"){",At(),"}",tt])}})}var pt=it(),mt={};function Et(wt,Mt){var gt=[];function At(){var ut="a"+gt.length;return gt.push(ut),ut}Mt=Mt||0;for(var z=0;z<Mt;++z)At();var tt=q(),yt=tt.toString,Nt=mt[wt]=r(tt,{arg:At,toString:function(){return Xi(["function(",gt.join(),"){",yt(),"}"])}});return Nt}function bt(){var wt=['"use strict";',pt,"return {"];Object.keys(mt).forEach(function(At){wt.push('"',At,'":',mt[At].toString(),",")}),wt.push("}");var Mt=Xi(wt).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),gt=Function.apply(null,w.concat(Mt));return gt.apply(null,M)}return{global:pt,link:Y,block:it,proc:Et,scope:q,cond:Q,compile:bt}}var Wi="xyzw".split(""),If=5121,qi=1,ll=2,ul=0,hl=1,fl=2,dl=3,ha=4,Df=5,kf=6,Bf="dither",jf="blend.enable",Ff="blend.color",pl="blend.equation",gl="blend.func",Gf="depth.enable",zf="depth.func",Uf="depth.range",Vf="depth.mask",ml="colorMask",$f="cull.enable",Hf="cull.face",bl="frontFace",vl="lineWidth",Xf="polygonOffset.enable",yl="polygonOffset.offset",Wf="sample.alpha",qf="sample.enable",El="sample.coverage",Yf="stencil.enable",Jf="stencil.mask",xl="stencil.func",wl="stencil.opFront",Ws="stencil.opBack",Kf="scissor.enable",fa="scissor.box",wr="viewport",qs="profile",di="framebuffer",Ys="vert",Js="frag",pi="elements",gi="primitive",mi="count",da="offset",pa="instances",Ks="vao",Al="Width",Sl="Height",Yi=di+Al,Ji=di+Sl,OE=wr+Al,ME=wr+Sl,Zf="drawingBuffer",Qf=Zf+Al,td=Zf+Sl,PE=[gl,pl,xl,wl,Ws,El,wr,fa,yl],Ki=34962,RE=34963,NE=35632,LE=35633,ed=3553,IE=34067,DE=2884,kE=3042,BE=3024,jE=2960,FE=2929,GE=3089,zE=32823,UE=32926,VE=32928,Tl=5126,ga=35664,ma=35665,ba=35666,Cl=5124,va=35667,ya=35668,Ea=35669,_l=35670,xa=35671,wa=35672,Aa=35673,Zs=35674,Qs=35675,to=35676,eo=35678,no=35680,nd=4,ro=1028,bi=1029,rd=2304,Ol=2305,$E=32775,HE=32776,XE=519,Br=7680,id=0,sd=1,od=32774,WE=513,ad=36160,qE=36064,lr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},cd=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Zi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},jr={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},ld={frag:NE,vert:LE},Ml={cw:rd,ccw:Ol};function Sa(g){return Array.isArray(g)||e(g)||Zn(g)}function ud(g){return g.sort(function(w,M){return w===wr?-1:M===wr?1:w<M?-1:1})}function Mn(g,w,M,Y){this.thisDep=g,this.contextDep=w,this.propDep=M,this.append=Y}function Fr(g){return g&&!(g.thisDep||g.contextDep||g.propDep)}function Xe(g){return new Mn(!1,!1,!1,g)}function In(g,w){var M=g.type;if(M===ul){var Y=g.data.length;return new Mn(!0,Y>=1,Y>=2,w)}else if(M===ha){var it=g.data;return new Mn(it.thisDep,it.contextDep,it.propDep,w)}else{if(M===Df)return new Mn(!1,!1,!1,w);if(M===kf){for(var q=!1,Q=!1,pt=!1,mt=0;mt<g.data.length;++mt){var Et=g.data[mt];if(Et.type===hl)pt=!0;else if(Et.type===fl)Q=!0;else if(Et.type===dl)q=!0;else if(Et.type===ul){q=!0;var bt=Et.data;bt>=1&&(Q=!0),bt>=2&&(pt=!0)}else Et.type===ha&&(q=q||Et.data.thisDep,Q=Q||Et.data.contextDep,pt=pt||Et.data.propDep)}return new Mn(q,Q,pt,w)}else return new Mn(M===dl,M===fl,M===hl,w)}}var hd=new Mn(!1,!1,!1,function(){});function YE(g,w,M,Y,it,q,Q,pt,mt,Et,bt,wt,Mt,gt,At){var z=Et.Record,tt={add:32774,subtract:32778,"reverse subtract":32779};M.ext_blend_minmax&&(tt.min=$E,tt.max=HE);var yt=M.angle_instanced_arrays,Nt=M.webgl_draw_buffers,ut={dirty:!0,profile:At.profile},Dt={},dt=[],St={},ht={};function Tt(T){return T.replace(".","_")}function Wt(T,x,N){var F=Tt(T);dt.push(T),Dt[F]=ut[F]=!!N,St[F]=x}function ie(T,x,N){var F=Tt(T);dt.push(T),Array.isArray(N)?(ut[F]=N.slice(),Dt[F]=N.slice()):ut[F]=Dt[F]=N,ht[F]=x}Wt(Bf,BE),Wt(jf,kE),ie(Ff,"blendColor",[0,0,0,0]),ie(pl,"blendEquationSeparate",[od,od]),ie(gl,"blendFuncSeparate",[sd,id,sd,id]),Wt(Gf,FE,!0),ie(zf,"depthFunc",WE),ie(Uf,"depthRange",[0,1]),ie(Vf,"depthMask",!0),ie(ml,ml,[!0,!0,!0,!0]),Wt($f,DE),ie(Hf,"cullFace",bi),ie(bl,bl,Ol),ie(vl,vl,1),Wt(Xf,zE),ie(yl,"polygonOffset",[0,0]),Wt(Wf,UE),Wt(qf,VE),ie(El,"sampleCoverage",[1,!1]),Wt(Yf,jE),ie(Jf,"stencilMask",-1),ie(xl,"stencilFunc",[XE,0,-1]),ie(wl,"stencilOpSeparate",[ro,Br,Br,Br]),ie(Ws,"stencilOpSeparate",[bi,Br,Br,Br]),Wt(Kf,GE),ie(fa,"scissor",[0,0,g.drawingBufferWidth,g.drawingBufferHeight]),ie(wr,wr,[0,0,g.drawingBufferWidth,g.drawingBufferHeight]);var Pt={gl:g,context:Mt,strings:w,next:Dt,current:ut,draw:wt,elements:q,buffer:it,shader:bt,attributes:Et.state,vao:Et,uniforms:mt,framebuffer:pt,extensions:M,timer:gt,isBufferArgs:Sa},xt={primTypes:Bi,compareFuncs:Zi,blendFuncs:lr,blendEquations:tt,stencilOps:jr,glTypes:ci,orientationType:Ml};S.optional(function(){Pt.isArrayLike=Ge}),Nt&&(xt.backBuffer=[bi],xt.drawBuffer=Ln(Y.maxDrawbuffers,function(T){return T===0?[0]:Ln(T,function(x){return qE+x})}));var ct=0;function te(){var T=_E(),x=T.link,N=T.global;T.id=ct++,T.batchId="0";var F=x(Pt),U=T.shared={props:"a0"};Object.keys(Pt).forEach(function(P){U[P]=N.def(F,".",P)}),S.optional(function(){T.CHECK=x(S),T.commandStr=S.guessCommand(),T.command=x(T.commandStr),T.assert=function(P,A,j){P("if(!(",A,"))",this.CHECK,".commandRaise(",x(j),",",this.command,");")},xt.invalidBlendCombinations=cd});var D=T.next={},L=T.current={};Object.keys(ht).forEach(function(P){Array.isArray(ut[P])&&(D[P]=N.def(U.next,".",P),L[P]=N.def(U.current,".",P))});var B=T.constants={};Object.keys(xt).forEach(function(P){B[P]=N.def(JSON.stringify(xt[P]))}),T.invoke=function(P,A){switch(A.type){case ul:var j=["this",U.context,U.props,T.batchId];return P.def(x(A.data),".call(",j.slice(0,Math.max(A.data.length+1,4)),")");case hl:return P.def(U.props,A.data);case fl:return P.def(U.context,A.data);case dl:return P.def("this",A.data);case ha:return A.data.append(T,P),A.data.ref;case Df:return A.data.toString();case kf:return A.data.map(function(V){return T.invoke(P,V)})}},T.attribCache={};var C={};return T.scopeAttrib=function(P){var A=w.id(P);if(A in C)return C[A];var j=Et.scope[A];j||(j=Et.scope[A]=new z);var V=C[A]=x(j);return V},T}function ce(T){var x=T.static,N=T.dynamic,F;if(qs in x){var U=!!x[qs];F=Xe(function(L,B){return U}),F.enable=U}else if(qs in N){var D=N[qs];F=In(D,function(L,B){return L.invoke(B,D)})}return F}function Ft(T,x){var N=T.static,F=T.dynamic;if(di in N){var U=N[di];return U?(U=pt.getFramebuffer(U),S.command(U,"invalid framebuffer object"),Xe(function(L,B){var C=L.link(U),P=L.shared;B.set(P.framebuffer,".next",C);var A=P.context;return B.set(A,"."+Yi,C+".width"),B.set(A,"."+Ji,C+".height"),C})):Xe(function(L,B){var C=L.shared;B.set(C.framebuffer,".next","null");var P=C.context;return B.set(P,"."+Yi,P+"."+Qf),B.set(P,"."+Ji,P+"."+td),"null"})}else if(di in F){var D=F[di];return In(D,function(L,B){var C=L.invoke(B,D),P=L.shared,A=P.framebuffer,j=B.def(A,".getFramebuffer(",C,")");S.optional(function(){L.assert(B,"!"+C+"||"+j,"invalid framebuffer object")}),B.set(A,".next",j);var V=P.context;return B.set(V,"."+Yi,j+"?"+j+".width:"+V+"."+Qf),B.set(V,"."+Ji,j+"?"+j+".height:"+V+"."+td),j})}else return null}function fe(T,x,N){var F=T.static,U=T.dynamic;function D(C){if(C in F){var P=F[C];S.commandType(P,"object","invalid "+C,N.commandStr);var A=!0,j=P.x|0,V=P.y|0,rt,st;return"width"in P?(rt=P.width|0,S.command(rt>=0,"invalid "+C,N.commandStr)):A=!1,"height"in P?(st=P.height|0,S.command(st>=0,"invalid "+C,N.commandStr)):A=!1,new Mn(!A&&x&&x.thisDep,!A&&x&&x.contextDep,!A&&x&&x.propDep,function($t,ue){var Gt=$t.shared.context,Kt=rt;"width"in P||(Kt=ue.def(Gt,".",Yi,"-",j));var oe=st;return"height"in P||(oe=ue.def(Gt,".",Ji,"-",V)),[j,V,Kt,oe]})}else if(C in U){var nt=U[C],vt=In(nt,function($t,ue){var Gt=$t.invoke(ue,nt);S.optional(function(){$t.assert(ue,Gt+"&&typeof "+Gt+'==="object"',"invalid "+C)});var Kt=$t.shared.context,oe=ue.def(Gt,".x|0"),xe=ue.def(Gt,".y|0"),je=ue.def('"width" in ',Gt,"?",Gt,".width|0:","(",Kt,".",Yi,"-",oe,")"),Pn=ue.def('"height" in ',Gt,"?",Gt,".height|0:","(",Kt,".",Ji,"-",xe,")");return S.optional(function(){$t.assert(ue,je+">=0&&"+Pn+">=0","invalid "+C)}),[oe,xe,je,Pn]});return x&&(vt.thisDep=vt.thisDep||x.thisDep,vt.contextDep=vt.contextDep||x.contextDep,vt.propDep=vt.propDep||x.propDep),vt}else return x?new Mn(x.thisDep,x.contextDep,x.propDep,function($t,ue){var Gt=$t.shared.context;return[0,0,ue.def(Gt,".",Yi),ue.def(Gt,".",Ji)]}):null}var L=D(wr);if(L){var B=L;L=new Mn(L.thisDep,L.contextDep,L.propDep,function(C,P){var A=B.append(C,P),j=C.shared.context;return P.set(j,"."+OE,A[2]),P.set(j,"."+ME,A[3]),A})}return{viewport:L,scissor_box:D(fa)}}function se(T,x){var N=T.static,F=typeof N[Js]=="string"&&typeof N[Ys]=="string";if(F){if(Object.keys(x.dynamic).length>0)return null;var U=x.static,D=Object.keys(U);if(D.length>0&&typeof U[D[0]]=="number"){for(var L=[],B=0;B<D.length;++B)S(typeof U[D[B]]=="number","must specify all vertex attribute locations when using vaos"),L.push([U[D[B]]|0,D[B]]);return L}}return null}function he(T,x,N){var F=T.static,U=T.dynamic;function D(A){if(A in F){var j=w.id(F[A]);S.optional(function(){bt.shader(ld[A],j,S.guessCommand())});var V=Xe(function(){return j});return V.id=j,V}else if(A in U){var rt=U[A];return In(rt,function(st,nt){var vt=st.invoke(nt,rt),$t=nt.def(st.shared.strings,".id(",vt,")");return S.optional(function(){nt(st.shared.shader,".shader(",ld[A],",",$t,",",st.command,");")}),$t})}return null}var L=D(Js),B=D(Ys),C=null,P;return Fr(L)&&Fr(B)?(C=bt.program(B.id,L.id,null,N),P=Xe(function(A,j){return A.link(C)})):P=new Mn(L&&L.thisDep||B&&B.thisDep,L&&L.contextDep||B&&B.contextDep,L&&L.propDep||B&&B.propDep,function(A,j){var V=A.shared.shader,rt;L?rt=L.append(A,j):rt=j.def(V,".",Js);var st;B?st=B.append(A,j):st=j.def(V,".",Ys);var nt=V+".program("+st+","+rt;return S.optional(function(){nt+=","+A.command}),j.def(nt+")")}),{frag:L,vert:B,progVar:P,program:C}}function Ee(T,x){var N=T.static,F=T.dynamic;function U(){if(pi in N){var A=N[pi];Sa(A)?A=q.getElements(q.create(A,!0)):A&&(A=q.getElements(A),S.command(A,"invalid elements",x.commandStr));var j=Xe(function(rt,st){if(A){var nt=rt.link(A);return rt.ELEMENTS=nt,nt}return rt.ELEMENTS=null,null});return j.value=A,j}else if(pi in F){var V=F[pi];return In(V,function(rt,st){var nt=rt.shared,vt=nt.isBufferArgs,$t=nt.elements,ue=rt.invoke(st,V),Gt=st.def("null"),Kt=st.def(vt,"(",ue,")"),oe=rt.cond(Kt).then(Gt,"=",$t,".createStream(",ue,");").else(Gt,"=",$t,".getElements(",ue,");");return S.optional(function(){rt.assert(oe.else,"!"+ue+"||"+Gt,"invalid elements")}),st.entry(oe),st.exit(rt.cond(Kt).then($t,".destroyStream(",Gt,");")),rt.ELEMENTS=Gt,Gt})}return null}var D=U();function L(){if(gi in N){var A=N[gi];return S.commandParameter(A,Bi,"invalid primitve",x.commandStr),Xe(function(V,rt){return Bi[A]})}else if(gi in F){var j=F[gi];return In(j,function(V,rt){var st=V.constants.primTypes,nt=V.invoke(rt,j);return S.optional(function(){V.assert(rt,nt+" in "+st,"invalid primitive, must be one of "+Object.keys(Bi))}),rt.def(st,"[",nt,"]")})}else if(D)return Fr(D)?D.value?Xe(function(V,rt){return rt.def(V.ELEMENTS,".primType")}):Xe(function(){return nd}):new Mn(D.thisDep,D.contextDep,D.propDep,function(V,rt){var st=V.ELEMENTS;return rt.def(st,"?",st,".primType:",nd)});return null}function B(A,j){if(A in N){var V=N[A]|0;return S.command(!j||V>=0,"invalid "+A,x.commandStr),Xe(function(st,nt){return j&&(st.OFFSET=V),V})}else if(A in F){var rt=F[A];return In(rt,function(st,nt){var vt=st.invoke(nt,rt);return j&&(st.OFFSET=vt,S.optional(function(){st.assert(nt,vt+">=0","invalid "+A)})),vt})}else if(j&&D)return Xe(function(st,nt){return st.OFFSET="0",0});return null}var C=B(da,!0);function P(){if(mi in N){var A=N[mi]|0;return S.command(typeof A=="number"&&A>=0,"invalid vertex count",x.commandStr),Xe(function(){return A})}else if(mi in F){var j=F[mi];return In(j,function(st,nt){var vt=st.invoke(nt,j);return S.optional(function(){st.assert(nt,"typeof "+vt+'==="number"&&'+vt+">=0&&"+vt+"===("+vt+"|0)","invalid vertex count")}),vt})}else if(D)if(Fr(D)){if(D)return C?new Mn(C.thisDep,C.contextDep,C.propDep,function(st,nt){var vt=nt.def(st.ELEMENTS,".vertCount-",st.OFFSET);return S.optional(function(){st.assert(nt,vt+">=0","invalid vertex offset/element buffer too small")}),vt}):Xe(function(st,nt){return nt.def(st.ELEMENTS,".vertCount")});var V=Xe(function(){return-1});return S.optional(function(){V.MISSING=!0}),V}else{var rt=new Mn(D.thisDep||C.thisDep,D.contextDep||C.contextDep,D.propDep||C.propDep,function(st,nt){var vt=st.ELEMENTS;return st.OFFSET?nt.def(vt,"?",vt,".vertCount-",st.OFFSET,":-1"):nt.def(vt,"?",vt,".vertCount:-1")});return S.optional(function(){rt.DYNAMIC=!0}),rt}return null}return{elements:D,primitive:L(),count:P(),instances:B(pa,!1),offset:C}}function We(T,x){var N=T.static,F=T.dynamic,U={};return dt.forEach(function(D){var L=Tt(D);function B(C,P){if(D in N){var A=C(N[D]);U[L]=Xe(function(){return A})}else if(D in F){var j=F[D];U[L]=In(j,function(V,rt){return P(V,rt,V.invoke(rt,j))})}}switch(D){case $f:case jf:case Bf:case Yf:case Gf:case Kf:case Xf:case Wf:case qf:case Vf:return B(function(C){return S.commandType(C,"boolean",D,x.commandStr),C},function(C,P,A){return S.optional(function(){C.assert(P,"typeof "+A+'==="boolean"',"invalid flag "+D,C.commandStr)}),A});case zf:return B(function(C){return S.commandParameter(C,Zi,"invalid "+D,x.commandStr),Zi[C]},function(C,P,A){var j=C.constants.compareFuncs;return S.optional(function(){C.assert(P,A+" in "+j,"invalid "+D+", must be one of "+Object.keys(Zi))}),P.def(j,"[",A,"]")});case Uf:return B(function(C){return S.command(Ge(C)&&C.length===2&&typeof C[0]=="number"&&typeof C[1]=="number"&&C[0]<=C[1],"depth range is 2d array",x.commandStr),C},function(C,P,A){S.optional(function(){C.assert(P,C.shared.isArrayLike+"("+A+")&&"+A+".length===2&&typeof "+A+'[0]==="number"&&typeof '+A+'[1]==="number"&&'+A+"[0]<="+A+"[1]","depth range must be a 2d array")});var j=P.def("+",A,"[0]"),V=P.def("+",A,"[1]");return[j,V]});case gl:return B(function(C){S.commandType(C,"object","blend.func",x.commandStr);var P="srcRGB"in C?C.srcRGB:C.src,A="srcAlpha"in C?C.srcAlpha:C.src,j="dstRGB"in C?C.dstRGB:C.dst,V="dstAlpha"in C?C.dstAlpha:C.dst;return S.commandParameter(P,lr,L+".srcRGB",x.commandStr),S.commandParameter(A,lr,L+".srcAlpha",x.commandStr),S.commandParameter(j,lr,L+".dstRGB",x.commandStr),S.commandParameter(V,lr,L+".dstAlpha",x.commandStr),S.command(cd.indexOf(P+", "+j)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+P+", "+j+")",x.commandStr),[lr[P],lr[j],lr[A],lr[V]]},function(C,P,A){var j=C.constants.blendFuncs;S.optional(function(){C.assert(P,A+"&&typeof "+A+'==="object"',"invalid blend func, must be an object")});function V(Gt,Kt){var oe=P.def('"',Gt,Kt,'" in ',A,"?",A,".",Gt,Kt,":",A,".",Gt);return S.optional(function(){C.assert(P,oe+" in "+j,"invalid "+D+"."+Gt+Kt+", must be one of "+Object.keys(lr))}),oe}var rt=V("src","RGB"),st=V("dst","RGB");S.optional(function(){var Gt=C.constants.invalidBlendCombinations;C.assert(P,Gt+".indexOf("+rt+'+", "+'+st+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var nt=P.def(j,"[",rt,"]"),vt=P.def(j,"[",V("src","Alpha"),"]"),$t=P.def(j,"[",st,"]"),ue=P.def(j,"[",V("dst","Alpha"),"]");return[nt,$t,vt,ue]});case pl:return B(function(C){if(typeof C=="string")return S.commandParameter(C,tt,"invalid "+D,x.commandStr),[tt[C],tt[C]];if(typeof C=="object")return S.commandParameter(C.rgb,tt,D+".rgb",x.commandStr),S.commandParameter(C.alpha,tt,D+".alpha",x.commandStr),[tt[C.rgb],tt[C.alpha]];S.commandRaise("invalid blend.equation",x.commandStr)},function(C,P,A){var j=C.constants.blendEquations,V=P.def(),rt=P.def(),st=C.cond("typeof ",A,'==="string"');return S.optional(function(){function nt(vt,$t,ue){C.assert(vt,ue+" in "+j,"invalid "+$t+", must be one of "+Object.keys(tt))}nt(st.then,D,A),C.assert(st.else,A+"&&typeof "+A+'==="object"',"invalid "+D),nt(st.else,D+".rgb",A+".rgb"),nt(st.else,D+".alpha",A+".alpha")}),st.then(V,"=",rt,"=",j,"[",A,"];"),st.else(V,"=",j,"[",A,".rgb];",rt,"=",j,"[",A,".alpha];"),P(st),[V,rt]});case Ff:return B(function(C){return S.command(Ge(C)&&C.length===4,"blend.color must be a 4d array",x.commandStr),Ln(4,function(P){return+C[P]})},function(C,P,A){return S.optional(function(){C.assert(P,C.shared.isArrayLike+"("+A+")&&"+A+".length===4","blend.color must be a 4d array")}),Ln(4,function(j){return P.def("+",A,"[",j,"]")})});case Jf:return B(function(C){return S.commandType(C,"number",L,x.commandStr),C|0},function(C,P,A){return S.optional(function(){C.assert(P,"typeof "+A+'==="number"',"invalid stencil.mask")}),P.def(A,"|0")});case xl:return B(function(C){S.commandType(C,"object",L,x.commandStr);var P=C.cmp||"keep",A=C.ref||0,j="mask"in C?C.mask:-1;return S.commandParameter(P,Zi,D+".cmp",x.commandStr),S.commandType(A,"number",D+".ref",x.commandStr),S.commandType(j,"number",D+".mask",x.commandStr),[Zi[P],A,j]},function(C,P,A){var j=C.constants.compareFuncs;S.optional(function(){function nt(){C.assert(P,Array.prototype.join.call(arguments,""),"invalid stencil.func")}nt(A+"&&typeof ",A,'==="object"'),nt('!("cmp" in ',A,")||(",A,".cmp in ",j,")")});var V=P.def('"cmp" in ',A,"?",j,"[",A,".cmp]",":",Br),rt=P.def(A,".ref|0"),st=P.def('"mask" in ',A,"?",A,".mask|0:-1");return[V,rt,st]});case wl:case Ws:return B(function(C){S.commandType(C,"object",L,x.commandStr);var P=C.fail||"keep",A=C.zfail||"keep",j=C.zpass||"keep";return S.commandParameter(P,jr,D+".fail",x.commandStr),S.commandParameter(A,jr,D+".zfail",x.commandStr),S.commandParameter(j,jr,D+".zpass",x.commandStr),[D===Ws?bi:ro,jr[P],jr[A],jr[j]]},function(C,P,A){var j=C.constants.stencilOps;S.optional(function(){C.assert(P,A+"&&typeof "+A+'==="object"',"invalid "+D)});function V(rt){return S.optional(function(){C.assert(P,'!("'+rt+'" in '+A+")||("+A+"."+rt+" in "+j+")","invalid "+D+"."+rt+", must be one of "+Object.keys(jr))}),P.def('"',rt,'" in ',A,"?",j,"[",A,".",rt,"]:",Br)}return[D===Ws?bi:ro,V("fail"),V("zfail"),V("zpass")]});case yl:return B(function(C){S.commandType(C,"object",L,x.commandStr);var P=C.factor|0,A=C.units|0;return S.commandType(P,"number",L+".factor",x.commandStr),S.commandType(A,"number",L+".units",x.commandStr),[P,A]},function(C,P,A){S.optional(function(){C.assert(P,A+"&&typeof "+A+'==="object"',"invalid "+D)});var j=P.def(A,".factor|0"),V=P.def(A,".units|0");return[j,V]});case Hf:return B(function(C){var P=0;return C==="front"?P=ro:C==="back"&&(P=bi),S.command(!!P,L,x.commandStr),P},function(C,P,A){return S.optional(function(){C.assert(P,A+'==="front"||'+A+'==="back"',"invalid cull.face")}),P.def(A,'==="front"?',ro,":",bi)});case vl:return B(function(C){return S.command(typeof C=="number"&&C>=Y.lineWidthDims[0]&&C<=Y.lineWidthDims[1],"invalid line width, must be a positive number between "+Y.lineWidthDims[0]+" and "+Y.lineWidthDims[1],x.commandStr),C},function(C,P,A){return S.optional(function(){C.assert(P,"typeof "+A+'==="number"&&'+A+">="+Y.lineWidthDims[0]+"&&"+A+"<="+Y.lineWidthDims[1],"invalid line width")}),A});case bl:return B(function(C){return S.commandParameter(C,Ml,L,x.commandStr),Ml[C]},function(C,P,A){return S.optional(function(){C.assert(P,A+'==="cw"||'+A+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),P.def(A+'==="cw"?'+rd+":"+Ol)});case ml:return B(function(C){return S.command(Ge(C)&&C.length===4,"color.mask must be length 4 array",x.commandStr),C.map(function(P){return!!P})},function(C,P,A){return S.optional(function(){C.assert(P,C.shared.isArrayLike+"("+A+")&&"+A+".length===4","invalid color.mask")}),Ln(4,function(j){return"!!"+A+"["+j+"]"})});case El:return B(function(C){S.command(typeof C=="object"&&C,L,x.commandStr);var P="value"in C?C.value:1,A=!!C.invert;return S.command(typeof P=="number"&&P>=0&&P<=1,"sample.coverage.value must be a number between 0 and 1",x.commandStr),[P,A]},function(C,P,A){S.optional(function(){C.assert(P,A+"&&typeof "+A+'==="object"',"invalid sample.coverage")});var j=P.def('"value" in ',A,"?+",A,".value:1"),V=P.def("!!",A,".invert");return[j,V]})}}),U}function on(T,x){var N=T.static,F=T.dynamic,U={};return Object.keys(N).forEach(function(D){var L=N[D],B;if(typeof L=="number"||typeof L=="boolean")B=Xe(function(){return L});else if(typeof L=="function"){var C=L._reglType;C==="texture2d"||C==="textureCube"?B=Xe(function(P){return P.link(L)}):C==="framebuffer"||C==="framebufferCube"?(S.command(L.color.length>0,'missing color attachment for framebuffer sent to uniform "'+D+'"',x.commandStr),B=Xe(function(P){return P.link(L.color[0])})):S.commandRaise('invalid data for uniform "'+D+'"',x.commandStr)}else Ge(L)?B=Xe(function(P){var A=P.global.def("[",Ln(L.length,function(j){return S.command(typeof L[j]=="number"||typeof L[j]=="boolean","invalid uniform "+D,P.commandStr),L[j]}),"]");return A}):S.commandRaise('invalid or missing data for uniform "'+D+'"',x.commandStr);B.value=L,U[D]=B}),Object.keys(F).forEach(function(D){var L=F[D];U[D]=In(L,function(B,C){return B.invoke(C,L)})}),U}function ge(T,x){var N=T.static,F=T.dynamic,U={};return Object.keys(N).forEach(function(D){var L=N[D],B=w.id(D),C=new z;if(Sa(L))C.state=qi,C.buffer=it.getBuffer(it.create(L,Ki,!1,!0)),C.type=0;else{var P=it.getBuffer(L);if(P)C.state=qi,C.buffer=P,C.type=0;else if(S.command(typeof L=="object"&&L,"invalid data for attribute "+D,x.commandStr),"constant"in L){var A=L.constant;C.buffer="null",C.state=ll,typeof A=="number"?C.x=A:(S.command(Ge(A)&&A.length>0&&A.length<=4,"invalid constant for attribute "+D,x.commandStr),Wi.forEach(function($t,ue){ue<A.length&&(C[$t]=A[ue])}))}else{Sa(L.buffer)?P=it.getBuffer(it.create(L.buffer,Ki,!1,!0)):P=it.getBuffer(L.buffer),S.command(!!P,'missing buffer for attribute "'+D+'"',x.commandStr);var j=L.offset|0;S.command(j>=0,'invalid offset for attribute "'+D+'"',x.commandStr);var V=L.stride|0;S.command(V>=0&&V<256,'invalid stride for attribute "'+D+'", must be integer betweeen [0, 255]',x.commandStr);var rt=L.size|0;S.command(!("size"in L)||rt>0&&rt<=4,'invalid size for attribute "'+D+'", must be 1,2,3,4',x.commandStr);var st=!!L.normalized,nt=0;"type"in L&&(S.commandParameter(L.type,ci,"invalid type for attribute "+D,x.commandStr),nt=ci[L.type]);var vt=L.divisor|0;"divisor"in L&&(S.command(vt===0||yt,'cannot specify divisor for attribute "'+D+'", instancing not supported',x.commandStr),S.command(vt>=0,'invalid divisor for attribute "'+D+'"',x.commandStr)),S.optional(function(){var $t=x.commandStr,ue=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(L).forEach(function(Gt){S.command(ue.indexOf(Gt)>=0,'unknown parameter "'+Gt+'" for attribute pointer "'+D+'" (valid parameters are '+ue+")",$t)})}),C.buffer=P,C.state=qi,C.size=rt,C.normalized=st,C.type=nt||P.dtype,C.offset=j,C.stride=V,C.divisor=vt}}U[D]=Xe(function($t,ue){var Gt=$t.attribCache;if(B in Gt)return Gt[B];var Kt={isStream:!1};return Object.keys(C).forEach(function(oe){Kt[oe]=C[oe]}),C.buffer&&(Kt.buffer=$t.link(C.buffer),Kt.type=Kt.type||Kt.buffer+".dtype"),Gt[B]=Kt,Kt})}),Object.keys(F).forEach(function(D){var L=F[D];function B(C,P){var A=C.invoke(P,L),j=C.shared,V=C.constants,rt=j.isBufferArgs,st=j.buffer;S.optional(function(){C.assert(P,A+"&&(typeof "+A+'==="object"||typeof '+A+'==="function")&&('+rt+"("+A+")||"+st+".getBuffer("+A+")||"+st+".getBuffer("+A+".buffer)||"+rt+"("+A+'.buffer)||("constant" in '+A+"&&(typeof "+A+'.constant==="number"||'+j.isArrayLike+"("+A+".constant))))",'invalid dynamic attribute "'+D+'"')});var nt={isStream:P.def(!1)},vt=new z;vt.state=qi,Object.keys(vt).forEach(function(Kt){nt[Kt]=P.def(""+vt[Kt])});var $t=nt.buffer,ue=nt.type;P("if(",rt,"(",A,")){",nt.isStream,"=true;",$t,"=",st,".createStream(",Ki,",",A,");",ue,"=",$t,".dtype;","}else{",$t,"=",st,".getBuffer(",A,");","if(",$t,"){",ue,"=",$t,".dtype;",'}else if("constant" in ',A,"){",nt.state,"=",ll,";","if(typeof "+A+'.constant === "number"){',nt[Wi[0]],"=",A,".constant;",Wi.slice(1).map(function(Kt){return nt[Kt]}).join("="),"=0;","}else{",Wi.map(function(Kt,oe){return nt[Kt]+"="+A+".constant.length>"+oe+"?"+A+".constant["+oe+"]:0;"}).join(""),"}}else{","if(",rt,"(",A,".buffer)){",$t,"=",st,".createStream(",Ki,",",A,".buffer);","}else{",$t,"=",st,".getBuffer(",A,".buffer);","}",ue,'="type" in ',A,"?",V.glTypes,"[",A,".type]:",$t,".dtype;",nt.normalized,"=!!",A,".normalized;");function Gt(Kt){P(nt[Kt],"=",A,".",Kt,"|0;")}return Gt("size"),Gt("offset"),Gt("stride"),Gt("divisor"),P("}}"),P.exit("if(",nt.isStream,"){",st,".destroyStream(",$t,");","}"),nt}U[D]=In(L,B)}),U}function Ze(T,x){var N=T.static,F=T.dynamic;if(Ks in N){var U=N[Ks];return U!==null&&Et.getVAO(U)===null&&(U=Et.createVAO(U)),Xe(function(L){return L.link(Et.getVAO(U))})}else if(Ks in F){var D=F[Ks];return In(D,function(L,B){var C=L.invoke(B,D);return B.def(L.shared.vao+".getVAO("+C+")")})}return null}function Re(T){var x=T.static,N=T.dynamic,F={};return Object.keys(x).forEach(function(U){var D=x[U];F[U]=Xe(function(L,B){return typeof D=="number"||typeof D=="boolean"?""+D:L.link(D)})}),Object.keys(N).forEach(function(U){var D=N[U];F[U]=In(D,function(L,B){return L.invoke(B,D)})}),F}function qe(T,x,N,F,U){var D=T.static,L=T.dynamic;S.optional(function(){var Gt=[di,Ys,Js,pi,gi,da,mi,pa,qs,Ks].concat(dt);function Kt(oe){Object.keys(oe).forEach(function(xe){S.command(Gt.indexOf(xe)>=0,'unknown parameter "'+xe+'"',U.commandStr)})}Kt(D),Kt(L)});var B=se(T,x),C=Ft(T),P=fe(T,C,U),A=Ee(T,U),j=We(T,U),V=he(T,U,B);function rt(Gt){var Kt=P[Gt];Kt&&(j[Gt]=Kt)}rt(wr),rt(Tt(fa));var st=Object.keys(j).length>0,nt={framebuffer:C,draw:A,shader:V,state:j,dirty:st,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(nt.profile=ce(T),nt.uniforms=on(N,U),nt.drawVAO=nt.scopeVAO=Ze(T),!nt.drawVAO&&V.program&&!B&&M.angle_instanced_arrays){var vt=!0,$t=V.program.attributes.map(function(Gt){var Kt=x.static[Gt];return vt=vt&&!!Kt,Kt});if(vt&&$t.length>0){var ue=Et.getVAO(Et.createVAO($t));nt.drawVAO=new Mn(null,null,null,function(Gt,Kt){return Gt.link(ue)}),nt.useVAO=!0}}return B?nt.useVAO=!0:nt.attributes=ge(x,U),nt.context=Re(F),nt}function Qe(T,x,N){var F=T.shared,U=F.context,D=T.scope();Object.keys(N).forEach(function(L){x.save(U,"."+L);var B=N[L],C=B.append(T,x);Array.isArray(C)?D(U,".",L,"=[",C.join(),"];"):D(U,".",L,"=",C,";")}),x(D)}function tn(T,x,N,F){var U=T.shared,D=U.gl,L=U.framebuffer,B;Nt&&(B=x.def(U.extensions,".webgl_draw_buffers"));var C=T.constants,P=C.drawBuffer,A=C.backBuffer,j;N?j=N.append(T,x):j=x.def(L,".next"),F||x("if(",j,"!==",L,".cur){"),x("if(",j,"){",D,".bindFramebuffer(",ad,",",j,".framebuffer);"),Nt&&x(B,".drawBuffersWEBGL(",P,"[",j,".colorAttachments.length]);"),x("}else{",D,".bindFramebuffer(",ad,",null);"),Nt&&x(B,".drawBuffersWEBGL(",A,");"),x("}",L,".cur=",j,";"),F||x("}")}function un(T,x,N){var F=T.shared,U=F.gl,D=T.current,L=T.next,B=F.current,C=F.next,P=T.cond(B,".dirty");dt.forEach(function(A){var j=Tt(A);if(!(j in N.state)){var V,rt;if(j in L){V=L[j],rt=D[j];var st=Ln(ut[j].length,function(vt){return P.def(V,"[",vt,"]")});P(T.cond(st.map(function(vt,$t){return vt+"!=="+rt+"["+$t+"]"}).join("||")).then(U,".",ht[j],"(",st,");",st.map(function(vt,$t){return rt+"["+$t+"]="+vt}).join(";"),";"))}else{V=P.def(C,".",j);var nt=T.cond(V,"!==",B,".",j);P(nt),j in St?nt(T.cond(V).then(U,".enable(",St[j],");").else(U,".disable(",St[j],");"),B,".",j,"=",V,";"):nt(U,".",ht[j],"(",V,");",B,".",j,"=",V,";")}}}),Object.keys(N.state).length===0&&P(B,".dirty=false;"),x(P)}function bn(T,x,N,F){var U=T.shared,D=T.current,L=U.current,B=U.gl;ud(Object.keys(N)).forEach(function(C){var P=N[C];if(!(F&&!F(P))){var A=P.append(T,x);if(St[C]){var j=St[C];Fr(P)?A?x(B,".enable(",j,");"):x(B,".disable(",j,");"):x(T.cond(A).then(B,".enable(",j,");").else(B,".disable(",j,");")),x(L,".",C,"=",A,";")}else if(Ge(A)){var V=D[C];x(B,".",ht[C],"(",A,");",A.map(function(rt,st){return V+"["+st+"]="+rt}).join(";"),";")}else x(B,".",ht[C],"(",A,");",L,".",C,"=",A,";")}})}function ze(T,x){yt&&(T.instancing=x.def(T.shared.extensions,".angle_instanced_arrays"))}function le(T,x,N,F,U){var D=T.shared,L=T.stats,B=D.current,C=D.timer,P=N.profile;function A(){return typeof performance>"u"?"Date.now()":"performance.now()"}var j,V;function rt(Gt){j=x.def(),Gt(j,"=",A(),";"),typeof U=="string"?Gt(L,".count+=",U,";"):Gt(L,".count++;"),gt&&(F?(V=x.def(),Gt(V,"=",C,".getNumPendingQueries();")):Gt(C,".beginQuery(",L,");"))}function st(Gt){Gt(L,".cpuTime+=",A(),"-",j,";"),gt&&(F?Gt(C,".pushScopeStats(",V,",",C,".getNumPendingQueries(),",L,");"):Gt(C,".endQuery();"))}function nt(Gt){var Kt=x.def(B,".profile");x(B,".profile=",Gt,";"),x.exit(B,".profile=",Kt,";")}var vt;if(P){if(Fr(P)){P.enable?(rt(x),st(x.exit),nt("true")):nt("false");return}vt=P.append(T,x),nt(vt)}else vt=x.def(B,".profile");var $t=T.block();rt($t),x("if(",vt,"){",$t,"}");var ue=T.block();st(ue),x.exit("if(",vt,"){",ue,"}")}function vn(T,x,N,F,U){var D=T.shared;function L(C){switch(C){case ga:case va:case xa:return 2;case ma:case ya:case wa:return 3;case ba:case Ea:case Aa:return 4;default:return 1}}function B(C,P,A){var j=D.gl,V=x.def(C,".location"),rt=x.def(D.attributes,"[",V,"]"),st=A.state,nt=A.buffer,vt=[A.x,A.y,A.z,A.w],$t=["buffer","normalized","offset","stride"];function ue(){x("if(!",rt,".buffer){",j,".enableVertexAttribArray(",V,");}");var Kt=A.type,oe;if(A.size?oe=x.def(A.size,"||",P):oe=P,x("if(",rt,".type!==",Kt,"||",rt,".size!==",oe,"||",$t.map(function(je){return rt+"."+je+"!=="+A[je]}).join("||"),"){",j,".bindBuffer(",Ki,",",nt,".buffer);",j,".vertexAttribPointer(",[V,oe,Kt,A.normalized,A.stride,A.offset],");",rt,".type=",Kt,";",rt,".size=",oe,";",$t.map(function(je){return rt+"."+je+"="+A[je]+";"}).join(""),"}"),yt){var xe=A.divisor;x("if(",rt,".divisor!==",xe,"){",T.instancing,".vertexAttribDivisorANGLE(",[V,xe],");",rt,".divisor=",xe,";}")}}function Gt(){x("if(",rt,".buffer){",j,".disableVertexAttribArray(",V,");",rt,".buffer=null;","}if(",Wi.map(function(Kt,oe){return rt+"."+Kt+"!=="+vt[oe]}).join("||"),"){",j,".vertexAttrib4f(",V,",",vt,");",Wi.map(function(Kt,oe){return rt+"."+Kt+"="+vt[oe]+";"}).join(""),"}")}st===qi?ue():st===ll?Gt():(x("if(",st,"===",qi,"){"),ue(),x("}else{"),Gt(),x("}"))}F.forEach(function(C){var P=C.name,A=N.attributes[P],j;if(A){if(!U(A))return;j=A.append(T,x)}else{if(!U(hd))return;var V=T.scopeAttrib(P);S.optional(function(){T.assert(x,V+".state","missing attribute "+P)}),j={},Object.keys(new z).forEach(function(rt){j[rt]=x.def(V,".",rt)})}B(T.link(C),L(C.info.type),j)})}function Se(T,x,N,F,U){for(var D=T.shared,L=D.gl,B,C=0;C<F.length;++C){var P=F[C],A=P.name,j=P.info.type,V=N.uniforms[A],rt=T.link(P),st=rt+".location",nt;if(V){if(!U(V))continue;if(Fr(V)){var vt=V.value;if(S.command(vt!==null&&typeof vt<"u",'missing uniform "'+A+'"',T.commandStr),j===eo||j===no){S.command(typeof vt=="function"&&(j===eo&&(vt._reglType==="texture2d"||vt._reglType==="framebuffer")||j===no&&(vt._reglType==="textureCube"||vt._reglType==="framebufferCube")),"invalid texture for uniform "+A,T.commandStr);var $t=T.link(vt._texture||vt.color[0]._texture);x(L,".uniform1i(",st,",",$t+".bind());"),x.exit($t,".unbind();")}else if(j===Zs||j===Qs||j===to){S.optional(function(){S.command(Ge(vt),"invalid matrix for uniform "+A,T.commandStr),S.command(j===Zs&&vt.length===4||j===Qs&&vt.length===9||j===to&&vt.length===16,"invalid length for matrix uniform "+A,T.commandStr)});var ue=T.global.def("new Float32Array(["+Array.prototype.slice.call(vt)+"])"),Gt=2;j===Qs?Gt=3:j===to&&(Gt=4),x(L,".uniformMatrix",Gt,"fv(",st,",false,",ue,");")}else{switch(j){case Tl:S.commandType(vt,"number","uniform "+A,T.commandStr),B="1f";break;case ga:S.command(Ge(vt)&&vt.length===2,"uniform "+A,T.commandStr),B="2f";break;case ma:S.command(Ge(vt)&&vt.length===3,"uniform "+A,T.commandStr),B="3f";break;case ba:S.command(Ge(vt)&&vt.length===4,"uniform "+A,T.commandStr),B="4f";break;case _l:S.commandType(vt,"boolean","uniform "+A,T.commandStr),B="1i";break;case Cl:S.commandType(vt,"number","uniform "+A,T.commandStr),B="1i";break;case xa:S.command(Ge(vt)&&vt.length===2,"uniform "+A,T.commandStr),B="2i";break;case va:S.command(Ge(vt)&&vt.length===2,"uniform "+A,T.commandStr),B="2i";break;case wa:S.command(Ge(vt)&&vt.length===3,"uniform "+A,T.commandStr),B="3i";break;case ya:S.command(Ge(vt)&&vt.length===3,"uniform "+A,T.commandStr),B="3i";break;case Aa:S.command(Ge(vt)&&vt.length===4,"uniform "+A,T.commandStr),B="4i";break;case Ea:S.command(Ge(vt)&&vt.length===4,"uniform "+A,T.commandStr),B="4i";break}x(L,".uniform",B,"(",st,",",Ge(vt)?Array.prototype.slice.call(vt):vt,");")}continue}else nt=V.append(T,x)}else{if(!U(hd))continue;nt=x.def(D.uniforms,"[",w.id(A),"]")}j===eo?(S(!Array.isArray(nt),"must specify a scalar prop for textures"),x("if(",nt,"&&",nt,'._reglType==="framebuffer"){',nt,"=",nt,".color[0];","}")):j===no&&(S(!Array.isArray(nt),"must specify a scalar prop for cube maps"),x("if(",nt,"&&",nt,'._reglType==="framebufferCube"){',nt,"=",nt,".color[0];","}")),S.optional(function(){function Pn(tr,vd){T.assert(x,tr,'bad data or missing for uniform "'+A+'".  '+vd)}function Pl(tr){S(!Array.isArray(nt),"must not specify an array type for uniform"),Pn("typeof "+nt+'==="'+tr+'"',"invalid type, expected "+tr)}function Vn(tr,vd){Array.isArray(nt)?S(nt.length===tr,"must have length "+tr):Pn(D.isArrayLike+"("+nt+")&&"+nt+".length==="+tr,"invalid vector, should have length "+tr,T.commandStr)}function bd(tr){S(!Array.isArray(nt),"must not specify a value type"),Pn("typeof "+nt+'==="function"&&'+nt+'._reglType==="texture'+(tr===ed?"2d":"Cube")+'"',"invalid texture type",T.commandStr)}switch(j){case Cl:Pl("number");break;case va:Vn(2);break;case ya:Vn(3);break;case Ea:Vn(4);break;case Tl:Pl("number");break;case ga:Vn(2);break;case ma:Vn(3);break;case ba:Vn(4);break;case _l:Pl("boolean");break;case xa:Vn(2);break;case wa:Vn(3);break;case Aa:Vn(4);break;case Zs:Vn(4);break;case Qs:Vn(9);break;case to:Vn(16);break;case eo:bd(ed);break;case no:bd(IE);break}});var Kt=1;switch(j){case eo:case no:var oe=x.def(nt,"._texture");x(L,".uniform1i(",st,",",oe,".bind());"),x.exit(oe,".unbind();");continue;case Cl:case _l:B="1i";break;case va:case xa:B="2i",Kt=2;break;case ya:case wa:B="3i",Kt=3;break;case Ea:case Aa:B="4i",Kt=4;break;case Tl:B="1f";break;case ga:B="2f",Kt=2;break;case ma:B="3f",Kt=3;break;case ba:B="4f",Kt=4;break;case Zs:B="Matrix2fv";break;case Qs:B="Matrix3fv";break;case to:B="Matrix4fv";break}if(x(L,".uniform",B,"(",st,","),B.charAt(0)==="M"){var xe=Math.pow(j-Zs+2,2),je=T.global.def("new Float32Array(",xe,")");Array.isArray(nt)?x("false,(",Ln(xe,function(Pn){return je+"["+Pn+"]="+nt[Pn]}),",",je,")"):x("false,(Array.isArray(",nt,")||",nt," instanceof Float32Array)?",nt,":(",Ln(xe,function(Pn){return je+"["+Pn+"]="+nt+"["+Pn+"]"}),",",je,")")}else Kt>1?x(Ln(Kt,function(Pn){return Array.isArray(nt)?nt[Pn]:nt+"["+Pn+"]"})):(S(!Array.isArray(nt),"uniform value must not be an array"),x(nt));x(");")}}function Jt(T,x,N,F){var U=T.shared,D=U.gl,L=U.draw,B=F.draw;function C(){var oe=B.elements,xe,je=x;return oe?((oe.contextDep&&F.contextDynamic||oe.propDep)&&(je=N),xe=oe.append(T,je)):xe=je.def(L,".",pi),xe&&je("if("+xe+")"+D+".bindBuffer("+RE+","+xe+".buffer.buffer);"),xe}function P(){var oe=B.count,xe,je=x;return oe?((oe.contextDep&&F.contextDynamic||oe.propDep)&&(je=N),xe=oe.append(T,je),S.optional(function(){oe.MISSING&&T.assert(x,"false","missing vertex count"),oe.DYNAMIC&&T.assert(je,xe+">=0","missing vertex count")})):(xe=je.def(L,".",mi),S.optional(function(){T.assert(je,xe+">=0","missing vertex count")})),xe}var A=C();function j(oe){var xe=B[oe];return xe?xe.contextDep&&F.contextDynamic||xe.propDep?xe.append(T,N):xe.append(T,x):x.def(L,".",oe)}var V=j(gi),rt=j(da),st=P();if(typeof st=="number"){if(st===0)return}else N("if(",st,"){"),N.exit("}");var nt,vt;yt&&(nt=j(pa),vt=T.instancing);var $t=A+".type",ue=B.elements&&Fr(B.elements);function Gt(){function oe(){N(vt,".drawElementsInstancedANGLE(",[V,st,$t,rt+"<<(("+$t+"-"+If+")>>1)",nt],");")}function xe(){N(vt,".drawArraysInstancedANGLE(",[V,rt,st,nt],");")}A?ue?oe():(N("if(",A,"){"),oe(),N("}else{"),xe(),N("}")):xe()}function Kt(){function oe(){N(D+".drawElements("+[V,st,$t,rt+"<<(("+$t+"-"+If+")>>1)"]+");")}function xe(){N(D+".drawArrays("+[V,rt,st]+");")}A?ue?oe():(N("if(",A,"){"),oe(),N("}else{"),xe(),N("}")):xe()}yt&&(typeof nt!="number"||nt>=0)?typeof nt=="string"?(N("if(",nt,">0){"),Gt(),N("}else if(",nt,"<0){"),Kt(),N("}")):Gt():Kt()}function pe(T,x,N,F,U){var D=te(),L=D.proc("body",U);return S.optional(function(){D.commandStr=x.commandStr,D.command=D.link(x.commandStr)}),yt&&(D.instancing=L.def(D.shared.extensions,".angle_instanced_arrays")),T(D,L,N,F),D.compile().body}function ve(T,x,N,F){ze(T,x),N.useVAO?N.drawVAO?x(T.shared.vao,".setVAO(",N.drawVAO.append(T,x),");"):x(T.shared.vao,".setVAO(",T.shared.vao,".targetVAO);"):(x(T.shared.vao,".setVAO(null);"),vn(T,x,N,F.attributes,function(){return!0})),Se(T,x,N,F.uniforms,function(){return!0}),Jt(T,x,x,N)}function Ue(T,x){var N=T.proc("draw",1);ze(T,N),Qe(T,N,x.context),tn(T,N,x.framebuffer),un(T,N,x),bn(T,N,x.state),le(T,N,x,!1,!0);var F=x.shader.progVar.append(T,N);if(N(T.shared.gl,".useProgram(",F,".program);"),x.shader.program)ve(T,N,x,x.shader.program);else{N(T.shared.vao,".setVAO(null);");var U=T.global.def("{}"),D=N.def(F,".id"),L=N.def(U,"[",D,"]");N(T.cond(L).then(L,".call(this,a0);").else(L,"=",U,"[",D,"]=",T.link(function(B){return pe(ve,T,x,B,1)}),"(",F,");",L,".call(this,a0);"))}Object.keys(x.state).length>0&&N(T.shared.current,".dirty=true;")}function ur(T,x,N,F){T.batchId="a1",ze(T,x);function U(){return!0}vn(T,x,N,F.attributes,U),Se(T,x,N,F.uniforms,U),Jt(T,x,x,N)}function vi(T,x,N,F){ze(T,x);var U=N.contextDep,D=x.def(),L="a0",B="a1",C=x.def();T.shared.props=C,T.batchId=D;var P=T.scope(),A=T.scope();x(P.entry,"for(",D,"=0;",D,"<",B,";++",D,"){",C,"=",L,"[",D,"];",A,"}",P.exit);function j($t){return $t.contextDep&&U||$t.propDep}function V($t){return!j($t)}if(N.needsContext&&Qe(T,A,N.context),N.needsFramebuffer&&tn(T,A,N.framebuffer),bn(T,A,N.state,j),N.profile&&j(N.profile)&&le(T,A,N,!1,!0),F)N.useVAO?N.drawVAO?j(N.drawVAO)?A(T.shared.vao,".setVAO(",N.drawVAO.append(T,A),");"):P(T.shared.vao,".setVAO(",N.drawVAO.append(T,P),");"):P(T.shared.vao,".setVAO(",T.shared.vao,".targetVAO);"):(P(T.shared.vao,".setVAO(null);"),vn(T,P,N,F.attributes,V),vn(T,A,N,F.attributes,j)),Se(T,P,N,F.uniforms,V),Se(T,A,N,F.uniforms,j),Jt(T,P,A,N);else{var rt=T.global.def("{}"),st=N.shader.progVar.append(T,A),nt=A.def(st,".id"),vt=A.def(rt,"[",nt,"]");A(T.shared.gl,".useProgram(",st,".program);","if(!",vt,"){",vt,"=",rt,"[",nt,"]=",T.link(function($t){return pe(ur,T,N,$t,2)}),"(",st,");}",vt,".call(this,a0[",D,"],",D,");")}}function _(T,x){var N=T.proc("batch",2);T.batchId="0",ze(T,N);var F=!1,U=!0;Object.keys(x.context).forEach(function(rt){F=F||x.context[rt].propDep}),F||(Qe(T,N,x.context),U=!1);var D=x.framebuffer,L=!1;D?(D.propDep?F=L=!0:D.contextDep&&F&&(L=!0),L||tn(T,N,D)):tn(T,N,null),x.state.viewport&&x.state.viewport.propDep&&(F=!0);function B(rt){return rt.contextDep&&F||rt.propDep}un(T,N,x),bn(T,N,x.state,function(rt){return!B(rt)}),(!x.profile||!B(x.profile))&&le(T,N,x,!1,"a1"),x.contextDep=F,x.needsContext=U,x.needsFramebuffer=L;var C=x.shader.progVar;if(C.contextDep&&F||C.propDep)vi(T,N,x,null);else{var P=C.append(T,N);if(N(T.shared.gl,".useProgram(",P,".program);"),x.shader.program)vi(T,N,x,x.shader.program);else{N(T.shared.vao,".setVAO(null);");var A=T.global.def("{}"),j=N.def(P,".id"),V=N.def(A,"[",j,"]");N(T.cond(V).then(V,".call(this,a0,a1);").else(V,"=",A,"[",j,"]=",T.link(function(rt){return pe(vi,T,x,rt,2)}),"(",P,");",V,".call(this,a0,a1);"))}}Object.keys(x.state).length>0&&N(T.shared.current,".dirty=true;")}function J(T,x){var N=T.proc("scope",3);T.batchId="a2";var F=T.shared,U=F.current;Qe(T,N,x.context),x.framebuffer&&x.framebuffer.append(T,N),ud(Object.keys(x.state)).forEach(function(L){var B=x.state[L],C=B.append(T,N);Ge(C)?C.forEach(function(P,A){N.set(T.next[L],"["+A+"]",P)}):N.set(F.next,"."+L,C)}),le(T,N,x,!0,!0),[pi,da,mi,pa,gi].forEach(function(L){var B=x.draw[L];B&&N.set(F.draw,"."+L,""+B.append(T,N))}),Object.keys(x.uniforms).forEach(function(L){var B=x.uniforms[L].append(T,N);Array.isArray(B)&&(B="["+B.join()+"]"),N.set(F.uniforms,"["+w.id(L)+"]",B)}),Object.keys(x.attributes).forEach(function(L){var B=x.attributes[L].append(T,N),C=T.scopeAttrib(L);Object.keys(new z).forEach(function(P){N.set(C,"."+P,B[P])})}),x.scopeVAO&&N.set(F.vao,".targetVAO",x.scopeVAO.append(T,N));function D(L){var B=x.shader[L];B&&N.set(F.shader,"."+L,B.append(T,N))}D(Ys),D(Js),Object.keys(x.state).length>0&&(N(U,".dirty=true;"),N.exit(U,".dirty=true;")),N("a1(",T.shared.context,",a0,",T.batchId,");")}function $(T){if(!(typeof T!="object"||Ge(T))){for(var x=Object.keys(T),N=0;N<x.length;++N)if(Fn.isDynamic(T[x[N]]))return!0;return!1}}function jt(T,x,N){var F=x.static[N];if(!F||!$(F))return;var U=T.global,D=Object.keys(F),L=!1,B=!1,C=!1,P=T.global.def("{}");D.forEach(function(j){var V=F[j];if(Fn.isDynamic(V)){typeof V=="function"&&(V=F[j]=Fn.unbox(V));var rt=In(V,null);L=L||rt.thisDep,C=C||rt.propDep,B=B||rt.contextDep}else{switch(U(P,".",j,"="),typeof V){case"number":U(V);break;case"string":U('"',V,'"');break;case"object":Array.isArray(V)&&U("[",V.join(),"]");break;default:U(T.link(V));break}U(";")}});function A(j,V){D.forEach(function(rt){var st=F[rt];if(Fn.isDynamic(st)){var nt=j.invoke(V,st);V(P,".",rt,"=",nt,";")}})}x.dynamic[N]=new Fn.DynamicVariable(ha,{thisDep:L,contextDep:B,propDep:C,ref:P,append:A}),delete x.static[N]}function de(T,x,N,F,U){var D=te();D.stats=D.link(U),Object.keys(x.static).forEach(function(B){jt(D,x,B)}),PE.forEach(function(B){jt(D,T,B)});var L=qe(T,x,N,F,D);return Ue(D,L),J(D,L),_(D,L),r(D.compile(),{destroy:function(){L.shader.program.destroy()}})}return{next:Dt,current:ut,procs:function(){var T=te(),x=T.proc("poll"),N=T.proc("refresh"),F=T.block();x(F),N(F);var U=T.shared,D=U.gl,L=U.next,B=U.current;F(B,".dirty=false;"),tn(T,x),tn(T,N,null,!0);var C;yt&&(C=T.link(yt)),M.oes_vertex_array_object&&N(T.link(M.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var P=0;P<Y.maxAttributes;++P){var A=N.def(U.attributes,"[",P,"]"),j=T.cond(A,".buffer");j.then(D,".enableVertexAttribArray(",P,");",D,".bindBuffer(",Ki,",",A,".buffer.buffer);",D,".vertexAttribPointer(",P,",",A,".size,",A,".type,",A,".normalized,",A,".stride,",A,".offset);").else(D,".disableVertexAttribArray(",P,");",D,".vertexAttrib4f(",P,",",A,".x,",A,".y,",A,".z,",A,".w);",A,".buffer=null;"),N(j),yt&&N(C,".vertexAttribDivisorANGLE(",P,",",A,".divisor);")}return N(T.shared.vao,".currentVAO=null;",T.shared.vao,".setVAO(",T.shared.vao,".targetVAO);"),Object.keys(St).forEach(function(V){var rt=St[V],st=F.def(L,".",V),nt=T.block();nt("if(",st,"){",D,".enable(",rt,")}else{",D,".disable(",rt,")}",B,".",V,"=",st,";"),N(nt),x("if(",st,"!==",B,".",V,"){",nt,"}")}),Object.keys(ht).forEach(function(V){var rt=ht[V],st=ut[V],nt,vt,$t=T.block();if($t(D,".",rt,"("),Ge(st)){var ue=st.length;nt=T.global.def(L,".",V),vt=T.global.def(B,".",V),$t(Ln(ue,function(Gt){return nt+"["+Gt+"]"}),");",Ln(ue,function(Gt){return vt+"["+Gt+"]="+nt+"["+Gt+"];"}).join("")),x("if(",Ln(ue,function(Gt){return nt+"["+Gt+"]!=="+vt+"["+Gt+"]"}).join("||"),"){",$t,"}")}else nt=F.def(L,".",V),vt=F.def(B,".",V),$t(nt,");",B,".",V,"=",nt,";"),x("if(",nt,"!==",vt,"){",$t,"}");N($t)}),T.compile()}(),compile:de}}function JE(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var KE=34918,ZE=34919,fd=35007,QE=function(g,w){if(!w.ext_disjoint_timer_query)return null;var M=[];function Y(){return M.pop()||w.ext_disjoint_timer_query.createQueryEXT()}function it(yt){M.push(yt)}var q=[];function Q(yt){var Nt=Y();w.ext_disjoint_timer_query.beginQueryEXT(fd,Nt),q.push(Nt),gt(q.length-1,q.length,yt)}function pt(){w.ext_disjoint_timer_query.endQueryEXT(fd)}function mt(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Et=[];function bt(){return Et.pop()||new mt}function wt(yt){Et.push(yt)}var Mt=[];function gt(yt,Nt,ut){var Dt=bt();Dt.startQueryIndex=yt,Dt.endQueryIndex=Nt,Dt.sum=0,Dt.stats=ut,Mt.push(Dt)}var At=[],z=[];function tt(){var yt,Nt,ut=q.length;if(ut!==0){z.length=Math.max(z.length,ut+1),At.length=Math.max(At.length,ut+1),At[0]=0,z[0]=0;var Dt=0;for(yt=0,Nt=0;Nt<q.length;++Nt){var dt=q[Nt];w.ext_disjoint_timer_query.getQueryObjectEXT(dt,ZE)?(Dt+=w.ext_disjoint_timer_query.getQueryObjectEXT(dt,KE),it(dt)):q[yt++]=dt,At[Nt+1]=Dt,z[Nt+1]=yt}for(q.length=yt,yt=0,Nt=0;Nt<Mt.length;++Nt){var St=Mt[Nt],ht=St.startQueryIndex,Tt=St.endQueryIndex;St.sum+=At[Tt]-At[ht];var Wt=z[ht],ie=z[Tt];ie===Wt?(St.stats.gpuTime+=St.sum/1e6,wt(St)):(St.startQueryIndex=Wt,St.endQueryIndex=ie,Mt[yt++]=St)}Mt.length=yt}}return{beginQuery:Q,endQuery:pt,pushScopeStats:gt,update:tt,getNumPendingQueries:function(){return q.length},clear:function(){M.push.apply(M,q);for(var yt=0;yt<M.length;yt++)w.ext_disjoint_timer_query.deleteQueryEXT(M[yt]);q.length=0,M.length=0},restore:function(){q.length=0,M.length=0}}},tx=16384,ex=256,nx=1024,rx=34962,dd="webglcontextlost",pd="webglcontextrestored",gd=1,ix=2,sx=3;function md(g,w){for(var M=0;M<g.length;++M)if(g[M]===w)return M;return-1}function ox(g){var w=ry(g);if(!w)return null;var M=w.gl,Y=M.getContextAttributes(),it=M.isContextLost(),q=iy(M,w);if(!q)return null;var Q=Zv(),pt=JE(),mt=q.extensions,Et=QE(M,mt),bt=Ah(),wt=M.drawingBufferWidth,Mt=M.drawingBufferHeight,gt={tick:0,time:0,viewportWidth:wt,viewportHeight:Mt,framebufferWidth:wt,framebufferHeight:Mt,drawingBufferWidth:wt,drawingBufferHeight:Mt,pixelRatio:w.pixelRatio},At={},z={elements:null,primitive:4,count:-1,offset:0,instances:-1},tt=Hy(M,mt),yt=a0(M,pt,w,ut),Nt=yE(M,mt,tt,pt,yt);function ut(Jt){return Nt.destroyBuffer(Jt)}var Dt=y0(M,mt,yt,pt),dt=AE(M,Q,pt,w),St=J0(M,mt,tt,function(){Wt.procs.poll()},gt,pt,w),ht=K0(M,mt,tt,pt,w),Tt=bE(M,mt,tt,St,ht,pt),Wt=YE(M,Q,mt,tt,yt,Dt,St,Tt,At,Nt,dt,z,gt,Et,w),ie=CE(M,Tt,Wt.procs.poll,gt,Y,mt,tt),Pt=Wt.next,xt=M.canvas,ct=[],te=[],ce=[],Ft=[w.onDestroy],fe=null;function se(){if(ct.length===0){Et&&Et.update(),fe=null;return}fe=Dc.next(se),bn();for(var Jt=ct.length-1;Jt>=0;--Jt){var pe=ct[Jt];pe&&pe(gt,null,0)}M.flush(),Et&&Et.update()}function he(){!fe&&ct.length>0&&(fe=Dc.next(se))}function Ee(){fe&&(Dc.cancel(se),fe=null)}function We(Jt){Jt.preventDefault(),it=!0,Ee(),te.forEach(function(pe){pe()})}function on(Jt){M.getError(),it=!1,q.restore(),dt.restore(),yt.restore(),St.restore(),ht.restore(),Tt.restore(),Nt.restore(),Et&&Et.restore(),Wt.procs.refresh(),he(),ce.forEach(function(pe){pe()})}xt&&(xt.addEventListener(dd,We,!1),xt.addEventListener(pd,on,!1));function ge(){ct.length=0,Ee(),xt&&(xt.removeEventListener(dd,We),xt.removeEventListener(pd,on)),dt.clear(),Tt.clear(),ht.clear(),St.clear(),Dt.clear(),yt.clear(),Nt.clear(),Et&&Et.clear(),Ft.forEach(function(Jt){Jt()})}function Ze(Jt){S(!!Jt,"invalid args to regl({...})"),S.type(Jt,"object","invalid args to regl({...})");function pe(U){var D=r({},U);delete D.uniforms,delete D.attributes,delete D.context,delete D.vao,"stencil"in D&&D.stencil.op&&(D.stencil.opBack=D.stencil.opFront=D.stencil.op,delete D.stencil.op);function L(B){if(B in D){var C=D[B];delete D[B],Object.keys(C).forEach(function(P){D[B+"."+P]=C[P]})}}return L("blend"),L("depth"),L("cull"),L("stencil"),L("polygonOffset"),L("scissor"),L("sample"),"vao"in U&&(D.vao=U.vao),D}function ve(U,D){var L={},B={};return Object.keys(U).forEach(function(C){var P=U[C];if(Fn.isDynamic(P)){B[C]=Fn.unbox(P,C);return}else if(D&&Array.isArray(P)){for(var A=0;A<P.length;++A)if(Fn.isDynamic(P[A])){B[C]=Fn.unbox(P,C);return}}L[C]=P}),{dynamic:B,static:L}}var Ue=ve(Jt.context||{},!0),ur=ve(Jt.uniforms||{},!0),vi=ve(Jt.attributes||{},!1),_=ve(pe(Jt),!1),J={gpuTime:0,cpuTime:0,count:0},$=Wt.compile(_,vi,ur,Ue,J),jt=$.draw,de=$.batch,T=$.scope,x=[];function N(U){for(;x.length<U;)x.push(null);return x}function F(U,D){var L;if(it&&S.raise("context lost"),typeof U=="function")return T.call(this,null,U,0);if(typeof D=="function")if(typeof U=="number")for(L=0;L<U;++L)T.call(this,null,D,L);else if(Array.isArray(U))for(L=0;L<U.length;++L)T.call(this,U[L],D,L);else return T.call(this,U,D,0);else if(typeof U=="number"){if(U>0)return de.call(this,N(U|0),U|0)}else if(Array.isArray(U)){if(U.length)return de.call(this,U,U.length)}else return jt.call(this,U)}return r(F,{stats:J,destroy:function(){$.destroy()}})}var Re=Tt.setFBO=Ze({framebuffer:Fn.define.call(null,gd,"framebuffer")});function qe(Jt,pe){var ve=0;Wt.procs.poll();var Ue=pe.color;Ue&&(M.clearColor(+Ue[0]||0,+Ue[1]||0,+Ue[2]||0,+Ue[3]||0),ve|=tx),"depth"in pe&&(M.clearDepth(+pe.depth),ve|=ex),"stencil"in pe&&(M.clearStencil(pe.stencil|0),ve|=nx),S(!!ve,"called regl.clear with no buffer specified"),M.clear(ve)}function Qe(Jt){if(S(typeof Jt=="object"&&Jt,"regl.clear() takes an object as input"),"framebuffer"in Jt)if(Jt.framebuffer&&Jt.framebuffer_reglType==="framebufferCube")for(var pe=0;pe<6;++pe)Re(r({framebuffer:Jt.framebuffer.faces[pe]},Jt),qe);else Re(Jt,qe);else qe(null,Jt)}function tn(Jt){S.type(Jt,"function","regl.frame() callback must be a function"),ct.push(Jt);function pe(){var ve=md(ct,Jt);S(ve>=0,"cannot cancel a frame twice");function Ue(){var ur=md(ct,Ue);ct[ur]=ct[ct.length-1],ct.length-=1,ct.length<=0&&Ee()}ct[ve]=Ue}return he(),{cancel:pe}}function un(){var Jt=Pt.viewport,pe=Pt.scissor_box;Jt[0]=Jt[1]=pe[0]=pe[1]=0,gt.viewportWidth=gt.framebufferWidth=gt.drawingBufferWidth=Jt[2]=pe[2]=M.drawingBufferWidth,gt.viewportHeight=gt.framebufferHeight=gt.drawingBufferHeight=Jt[3]=pe[3]=M.drawingBufferHeight}function bn(){gt.tick+=1,gt.time=le(),un(),Wt.procs.poll()}function ze(){St.refresh(),un(),Wt.procs.refresh(),Et&&Et.update()}function le(){return(Ah()-bt)/1e3}ze();function vn(Jt,pe){S.type(pe,"function","listener callback must be a function");var ve;switch(Jt){case"frame":return tn(pe);case"lost":ve=te;break;case"restore":ve=ce;break;case"destroy":ve=Ft;break;default:S.raise("invalid event, must be one of frame,lost,restore,destroy")}return ve.push(pe),{cancel:function(){for(var Ue=0;Ue<ve.length;++Ue)if(ve[Ue]===pe){ve[Ue]=ve[ve.length-1],ve.pop();return}}}}var Se=r(Ze,{clear:Qe,prop:Fn.define.bind(null,gd),context:Fn.define.bind(null,ix),this:Fn.define.bind(null,sx),draw:Ze({}),buffer:function(Jt){return yt.create(Jt,rx,!1,!1)},elements:function(Jt){return Dt.create(Jt,!1)},texture:St.create2D,cube:St.createCube,renderbuffer:ht.create,framebuffer:Tt.create,framebufferCube:Tt.createCube,vao:Nt.createVAO,attributes:Y,frame:tn,on:vn,limits:tt,hasExtension:function(Jt){return tt.extensions.indexOf(Jt.toLowerCase())>=0},read:ie,destroy:ge,_gl:M,_refresh:ze,poll:function(){bn(),Et&&Et.update()},now:le,stats:pt});return w.onDone(null,Se),Se}return ox})})(sM);var Ar,so,Sr,$n,oo,Gr,ao,_a,hr,yi,Sn,fr,dr,Oa;Ar={},kt(Ar,It.POINTS,"points"),kt(Ar,It.LINES,"lines"),kt(Ar,It.LINE_LOOP,"line loop"),kt(Ar,It.LINE_STRIP,"line strip"),kt(Ar,It.TRIANGLES,"triangles"),kt(Ar,It.TRIANGLE_FAN,"triangle fan"),kt(Ar,It.TRIANGLE_STRIP,"triangle strip");so={},kt(so,It.STATIC_DRAW,"static"),kt(so,It.DYNAMIC_DRAW,"dynamic"),kt(so,It.STREAM_DRAW,"stream");Sr={},kt(Sr,It.BYTE,"int8"),kt(Sr,It.UNSIGNED_INT,"int16"),kt(Sr,It.INT,"int32"),kt(Sr,It.UNSIGNED_BYTE,"uint8"),kt(Sr,It.UNSIGNED_SHORT,"uint16"),kt(Sr,It.UNSIGNED_INT,"uint32"),kt(Sr,It.FLOAT,"float");$n={},kt($n,It.ALPHA,"alpha"),kt($n,It.LUMINANCE,"luminance"),kt($n,It.LUMINANCE_ALPHA,"luminance alpha"),kt($n,It.RGB,"rgb"),kt($n,It.RGBA,"rgba"),kt($n,It.RGBA4,"rgba4"),kt($n,It.RGB5_A1,"rgb5 a1"),kt($n,It.RGB565,"rgb565"),kt($n,It.DEPTH_COMPONENT,"depth"),kt($n,It.DEPTH_STENCIL,"depth stencil");oo={},kt(oo,It.DONT_CARE,"dont care"),kt(oo,It.NICEST,"nice"),kt(oo,It.FASTEST,"fast");Gr={},kt(Gr,It.NEAREST,"nearest"),kt(Gr,It.LINEAR,"linear"),kt(Gr,It.LINEAR_MIPMAP_LINEAR,"mipmap"),kt(Gr,It.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),kt(Gr,It.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),kt(Gr,It.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest");ao={},kt(ao,It.REPEAT,"repeat"),kt(ao,It.CLAMP_TO_EDGE,"clamp"),kt(ao,It.MIRRORED_REPEAT,"mirror");_a={},kt(_a,It.NONE,"none"),kt(_a,It.BROWSER_DEFAULT_WEBGL,"browser");hr={},kt(hr,It.NEVER,"never"),kt(hr,It.ALWAYS,"always"),kt(hr,It.LESS,"less"),kt(hr,It.LEQUAL,"lequal"),kt(hr,It.GREATER,"greater"),kt(hr,It.GEQUAL,"gequal"),kt(hr,It.EQUAL,"equal"),kt(hr,It.NOTEQUAL,"notequal");yi={},kt(yi,It.FUNC_ADD,"add"),kt(yi,It.MIN_EXT,"min"),kt(yi,It.MAX_EXT,"max"),kt(yi,It.FUNC_SUBTRACT,"subtract"),kt(yi,It.FUNC_REVERSE_SUBTRACT,"reverse subtract");Sn={},kt(Sn,It.ZERO,"zero"),kt(Sn,It.ONE,"one"),kt(Sn,It.SRC_COLOR,"src color"),kt(Sn,It.ONE_MINUS_SRC_COLOR,"one minus src color"),kt(Sn,It.SRC_ALPHA,"src alpha"),kt(Sn,It.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),kt(Sn,It.DST_COLOR,"dst color"),kt(Sn,It.ONE_MINUS_DST_COLOR,"one minus dst color"),kt(Sn,It.DST_ALPHA,"dst alpha"),kt(Sn,It.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),kt(Sn,It.CONSTANT_COLOR,"constant color"),kt(Sn,It.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),kt(Sn,It.CONSTANT_ALPHA,"constant alpha"),kt(Sn,It.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),kt(Sn,It.SRC_ALPHA_SATURATE,"src alpha saturate");fr={},kt(fr,It.NEVER,"never"),kt(fr,It.ALWAYS,"always"),kt(fr,It.LESS,"less"),kt(fr,It.LEQUAL,"lequal"),kt(fr,It.GREATER,"greater"),kt(fr,It.GEQUAL,"gequal"),kt(fr,It.EQUAL,"equal"),kt(fr,It.NOTEQUAL,"notequal");dr={},kt(dr,It.ZERO,"zero"),kt(dr,It.KEEP,"keep"),kt(dr,It.REPLACE,"replace"),kt(dr,It.INVERT,"invert"),kt(dr,It.INCR,"increment"),kt(dr,It.DECR,"decrement"),kt(dr,It.INCR_WRAP,"increment wrap"),kt(dr,It.DECR_WRAP,"decrement wrap");Oa={},kt(Oa,It.FRONT,"front"),kt(Oa,It.BACK,"back");var oM=Function.prototype,aM=oM.toString;aM.call(Object);typeof window=="object"&&window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);typeof window<"u"&&function(n){n.forEach(t=>{Object.prototype.hasOwnProperty.call(t,"append")||Object.defineProperty(t,"append",{configurable:!0,enumerable:!0,writable:!0,value(...e){const r=document.createDocumentFragment();e.forEach(i=>{const s=i instanceof Node;r.appendChild(s?i:document.createTextNode(String(i)))}),this.appendChild(r)}})})}([Element.prototype,Document.prototype,DocumentFragment.prototype]);class Rn{get disposed(){return this._disposed===!0}dispose(){this._disposed=!0}}(function(n){function t(){return(e,r,i)=>{const s=i.value,o=e.__proto__;i.value=function(...a){this.disposed||(s.call(this,...a),o.dispose.call(this))}}}n.dispose=t})(Rn||(Rn={}));class Bp{constructor(){this.isDisposed=!1,this.items=new Set}get disposed(){return this.isDisposed}dispose(){this.isDisposed||(this.isDisposed=!0,this.items.forEach(t=>{t.dispose()}),this.items.clear())}contains(t){return this.items.has(t)}add(t){this.items.add(t)}remove(t){this.items.delete(t)}clear(){this.items.clear()}}(function(n){function t(e){const r=new n;return e.forEach(i=>{r.add(i)}),r}n.from=t})(Bp||(Bp={}));function ub(n,t,e){if(e)switch(e.length){case 0:return n.call(t);case 1:return n.call(t,e[0]);case 2:return n.call(t,e[0],e[1]);case 3:return n.call(t,e[0],e[1],e[2]);case 4:return n.call(t,e[0],e[1],e[2],e[3]);case 5:return n.call(t,e[0],e[1],e[2],e[3],e[4]);case 6:return n.call(t,e[0],e[1],e[2],e[3],e[4],e[5]);default:return n.apply(t,e)}return n.call(t)}function Qt(n,t,...e){return ub(n,t,e)}function cM(n){return typeof n=="object"&&n.then&&typeof n.then=="function"}function mu(n){return n!=null&&(n instanceof Promise||cM(n))}function Ku(...n){const t=[];if(n.forEach(r=>{Array.isArray(r)?t.push(...r):t.push(r)}),t.some(r=>mu(r))){const r=t.map(i=>mu(i)?i:Promise.resolve(i!==!1));return Promise.all(r).then(i=>i.reduce((s,o)=>o!==!1&&s,!0))}return t.every(r=>r!==!1)}function lM(...n){const t=Ku(n);return typeof t=="boolean"?Promise.resolve(t):t}function Wl(n,t){const e=[];for(let r=0;r<n.length;r+=2){const i=n[r],s=n[r+1],o=Array.isArray(t)?t:[t],a=ub(i,s,o);e.push(a)}return Ku(e)}class uM{constructor(){this.listeners={}}on(t,e,r){return e==null?this:(this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e,r),this)}once(t,e,r){const i=(...s)=>(this.off(t,i),Wl([e,r],s));return this.on(t,i,this)}off(t,e,r){if(!(t||e||r))return this.listeners={},this;const i=this.listeners;return(t?[t]:Object.keys(i)).forEach(o=>{const a=i[o];if(a){if(!(e||r)){delete i[o];return}for(let c=a.length-2;c>=0;c-=2)e&&a[c]!==e||r&&a[c+1]!==r||a.splice(c,2)}}),this}trigger(t,...e){let r=!0;if(t!=="*"){const s=this.listeners[t];s!=null&&(r=Wl([...s],e))}const i=this.listeners["*"];return i!=null?Ku([r,Wl([...i],[t,...e])]):r}emit(t,...e){return this.trigger(t,...e)}}function hM(n,...t){t.forEach(e=>{Object.getOwnPropertyNames(e.prototype).forEach(r=>{r!=="constructor"&&Object.defineProperty(n.prototype,r,Object.getOwnPropertyDescriptor(e.prototype,r))})})}const fM=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])};function dM(n,t){fM(n,t);function e(){this.constructor=n}n.prototype=t===null?Object.create(t):(e.prototype=t.prototype,new e)}class pM{}const gM=/^\s*class\s+/.test(`${pM}`)||/^\s*class\s*\{/.test(`${class{}}`);function Zu(n,t){let e;return gM?e=class extends t{}:(e=function(){return t.apply(this,arguments)},dM(e,t)),Object.defineProperty(e,"name",{value:n}),e}function jp(n){return n==="__proto__"}function Qu(n,t,e="/"){let r;const i=Array.isArray(t)?t:t.split(e);if(i.length)for(r=n;i.length;){const s=i.shift();if(Object(r)===r&&s&&s in r)r=r[s];else return}return r}function Is(n,t,e,r="/"){const i=Array.isArray(t)?t:t.split(r),s=i.pop();if(s&&!jp(s)){let o=n;i.forEach(a=>{jp(a)||(o[a]==null&&(o[a]={}),o=o[a])}),o[s]=e}return n}function Fp(n,t,e="/"){const r=Array.isArray(t)?t.slice():t.split(e),i=r.pop();if(i)if(r.length>0){const s=Qu(n,r);s&&delete s[i]}else delete n[i];return n}var mM=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class $e extends uM{dispose(){this.off()}}mM([Rn.dispose()],$e.prototype,"dispose",null);(function(n){n.dispose=Rn.dispose})($e||($e={}));hM($e,Rn);const hb=n=>{const t=Object.create(null);return e=>t[e]||(t[e]=n(e))},fb=hb(n=>n.replace(/\B([A-Z])/g,"-$1").toLowerCase()),th=hb(n=>LA(hc(n)).replace(/ /g,""));function ql(n){let t=2166136261,e=!1,r=n;for(let i=0,s=r.length;i<s;i+=1){let o=r.charCodeAt(i);o>127&&!e&&(r=unescape(encodeURIComponent(r)),o=r.charCodeAt(i),e=!0),t^=o,t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}return t>>>0}function Ya(){let n="";const t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";for(let e=0,r=t.length;e<r;e+=1){const i=t[e],s=Math.random()*16|0,o=i==="x"?s:i==="y"?s&3|8:i;n+=o.toString(16)}return n}function bM(n,t,e){const r=Math.min(2,Math.floor(n.length*.34));let i=Math.floor(n.length*.4)+1,s,o=!1;const a=n.toLowerCase();for(const c of t){const l=e(c);if(l!==void 0&&Math.abs(l.length-a.length)<=r){const u=l.toLowerCase();if(u===a){if(l===n)continue;return c}if(o||l.length<3)continue;const f=vM(a,u,i-1);if(f===void 0)continue;f<3?(o=!0,s=c):(i=f,s=c)}}return s}function vM(n,t,e){let r=new Array(t.length+1),i=new Array(t.length+1);const s=e+1;for(let a=0;a<=t.length;a+=1)r[a]=a;for(let a=1;a<=n.length;a+=1){const c=n.charCodeAt(a-1),l=a>e?a-e:1,u=t.length>e+a?e+a:t.length;i[0]=a;let f=a;for(let d=1;d<l;d+=1)i[d]=s;for(let d=l;d<=u;d+=1){const p=c===t.charCodeAt(d-1)?r[d-1]:Math.min(r[d]+1,i[d-1]+1,r[d-1]+2);i[d]=p,f=Math.min(f,p)}for(let d=u+1;d<=t.length;d+=1)i[d]=s;if(f>e)return;const h=r;r=i,i=h}const o=r[t.length];return o>e?void 0:o}function Mr(n){return typeof n=="string"&&n.slice(-1)==="%"}function nr(n,t){if(n==null)return 0;let e;if(typeof n=="string"){if(e=parseFloat(n),Mr(n)&&(e/=100,Number.isFinite(e)))return e*t}else e=n;return Number.isFinite(e)?e>0&&e<1?e*t:e:0}function Pi(n){if(typeof n=="object"){let e=0,r=0,i=0,s=0;return n.vertical!=null&&Number.isFinite(n.vertical)&&(r=s=n.vertical),n.horizontal!=null&&Number.isFinite(n.horizontal)&&(i=e=n.horizontal),n.left!=null&&Number.isFinite(n.left)&&(e=n.left),n.top!=null&&Number.isFinite(n.top)&&(r=n.top),n.right!=null&&Number.isFinite(n.right)&&(i=n.right),n.bottom!=null&&Number.isFinite(n.bottom)&&(s=n.bottom),{top:r,right:i,bottom:s,left:e}}let t=0;return n!=null&&Number.isFinite(n)&&(t=n),{top:t,right:t,bottom:t,left:t}}let eh=!1,db=!1,pb=!1,gb=!1,mb=!1,bb=!1,vb=!1,yb=!1,Eb=!1,xb=!1,wb=!1,Ab=!1,Sb=!1,Tb=!1,Cb=!1,_b=!1;if(typeof navigator=="object"){const n=navigator.userAgent;eh=n.indexOf("Macintosh")>=0,db=!!n.match(/(iPad|iPhone|iPod)/g),pb=n.indexOf("Windows")>=0,gb=n.indexOf("MSIE")>=0,mb=!!n.match(/Trident\/7\./),bb=!!n.match(/Edge\//),vb=n.indexOf("Mozilla/")>=0&&n.indexOf("MSIE")<0&&n.indexOf("Edge/")<0,Eb=n.indexOf("Chrome/")>=0&&n.indexOf("Edge/")<0,xb=n.indexOf("Opera/")>=0||n.indexOf("OPR/")>=0,wb=n.indexOf("Firefox/")>=0,Ab=n.indexOf("AppleWebKit/")>=0&&n.indexOf("Chrome/")<0&&n.indexOf("Edge/")<0,typeof document=="object"&&(_b=!document.createElementNS||`${document.createElementNS("http://www.w3.org/2000/svg","foreignObject")}`!="[object SVGForeignObjectElement]"||n.indexOf("Opera/")>=0)}typeof window=="object"&&(yb=window.chrome!=null&&window.chrome.app!=null&&window.chrome.app.runtime!=null,Tb=window.PointerEvent!=null&&!eh);if(typeof document=="object"){Sb="ontouchstart"in document.documentElement;try{const n=Object.defineProperty({},"passive",{get(){Cb=!0}}),t=document.createElement("div");t.addEventListener&&t.addEventListener("click",()=>{},n)}catch{}}var Wr;(function(n){n.IS_MAC=eh,n.IS_IOS=db,n.IS_WINDOWS=pb,n.IS_IE=gb,n.IS_IE11=mb,n.IS_EDGE=bb,n.IS_NETSCAPE=vb,n.IS_CHROME_APP=yb,n.IS_CHROME=Eb,n.IS_OPERA=xb,n.IS_FIREFOX=wb,n.IS_SAFARI=Ab,n.SUPPORT_TOUCH=Sb,n.SUPPORT_POINTER=Tb,n.SUPPORT_PASSIVE=Cb,n.NO_FOREIGNOBJECT=_b,n.SUPPORT_FOREIGNOBJECT=!n.NO_FOREIGNOBJECT})(Wr||(Wr={}));(function(n){function t(){const s=window.module;return s!=null&&s.hot!=null&&s.hot.status!=null?s.hot.status():"unkonwn"}n.getHMRStatus=t;function e(){return t()==="apply"}n.isApplyingHMR=e;const r={select:"input",change:"input",submit:"form",reset:"form",error:"img",load:"img",abort:"img"};function i(s){const o=document.createElement(r[s]||"div"),a=`on${s}`;let c=a in o;return c||(o.setAttribute(a,"return;"),c=typeof o[a]=="function"),c}n.isEventSupported=i})(Wr||(Wr={}));const nh=/[\t\r\n\f]/g,rh=/\S+/g,ds=n=>` ${n} `;function ps(n){return n&&n.getAttribute&&n.getAttribute("class")||""}function gr(n,t){if(n==null||t==null)return!1;const e=ds(ps(n)),r=ds(t);return n.nodeType===1?e.replace(nh," ").includes(r):!1}function qt(n,t){if(!(n==null||t==null)){if(typeof t=="function")return qt(n,t(ps(n)));if(typeof t=="string"&&n.nodeType===1){const e=t.match(rh)||[],r=ds(ps(n)).replace(nh," ");let i=e.reduce((s,o)=>s.indexOf(ds(o))<0?`${s}${o} `:s,r);i=i.trim(),r!==i&&n.setAttribute("class",i)}}}function Fe(n,t){if(n!=null){if(typeof t=="function")return Fe(n,t(ps(n)));if((!t||typeof t=="string")&&n.nodeType===1){const e=(t||"").match(rh)||[],r=ds(ps(n)).replace(nh," ");let i=e.reduce((s,o)=>{const a=ds(o);return s.indexOf(a)>-1?s.replace(a," "):s},r);i=t?i.trim():"",r!==i&&n.setAttribute("class",i)}}}function er(n,t,e){if(!(n==null||t==null)){if(e!=null&&typeof t=="string"){e?qt(n,t):Fe(n,t);return}if(typeof t=="function")return er(n,t(ps(n),e),e);typeof t=="string"&&(t.match(rh)||[]).forEach(i=>{gr(n,i)?Fe(n,i):qt(n,i)})}}let Gp=0;function yM(){return Gp+=1,`v${Gp}`}function ih(n){return(n.id==null||n.id==="")&&(n.id=yM()),n.id}function qr(n){return n==null?!1:typeof n.getScreenCTM=="function"&&n instanceof SVGElement}const yn={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns/",xml:"http://www.w3.org/XML/1998/namespace",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml"},zp="1.1";function Up(n,t=document){return t.createElement(n)}function sh(n,t=yn.xhtml,e=document){return e.createElementNS(t,n)}function ar(n,t=document){return sh(n,yn.svg,t)}function Ja(n){if(n){const e=`<svg xmlns="${yn.svg}" xmlns:xlink="${yn.xlink}" version="${zp}">${n}</svg>`,{documentElement:r}=EM(e,{async:!1});return r}const t=document.createElementNS(yn.svg,"svg");return t.setAttributeNS(yn.xmlns,"xmlns:xlink",yn.xlink),t.setAttribute("version",zp),t}function EM(n,t={}){let e;try{const r=new DOMParser;if(t.async!=null){const i=r;i.async=t.async}e=r.parseFromString(n,t.mimeType||"text/xml")}catch{e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw new Error(`Invalid XML: ${n}`);return e}function xM(n,t=!0){const e=n.nodeName;return t?e.toLowerCase():e.toUpperCase()}function oh(n){let t=0,e=n.previousSibling;for(;e;)e.nodeType===1&&(t+=1),e=e.previousSibling;return t}function wM(n,t){return n.querySelectorAll(t)}function AM(n,t){return n.querySelector(t)}function Ob(n,t,e){const r=n.ownerSVGElement;let i=n.parentNode;for(;i&&i!==e&&i!==r;){if(gr(i,t))return i;i=i.parentNode}return null}function ah(n,t){const e=t&&t.parentNode;return n===e||!!(e&&e.nodeType===1&&n.compareDocumentPosition(e)&16)}function Yn(n){n&&(Array.isArray(n)?n:[n]).forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)})}function $o(n){for(;n.firstChild;)n.removeChild(n.firstChild)}function zn(n,t){(Array.isArray(t)?t:[t]).forEach(r=>{r!=null&&n.appendChild(r)})}function Mb(n,t){const e=n.firstChild;return e?ch(e,t):zn(n,t)}function ch(n,t){const e=n.parentNode;e&&(Array.isArray(t)?t:[t]).forEach(i=>{i!=null&&e.insertBefore(i,n)})}function qI(n,t){const e=n.parentNode;e&&(Array.isArray(t)?t:[t]).forEach(i=>{i!=null&&e.insertBefore(i,n.nextSibling)})}function Hr(n,t){t!=null&&t.appendChild(n)}function Vp(n){try{return n instanceof HTMLElement}catch{return typeof n=="object"&&n.nodeType===1&&typeof n.style=="object"&&typeof n.ownerDocument=="object"}}function SM(n,t){const e=[];let r=n.firstChild;for(;r;r=r.nextSibling)r.nodeType===1&&(!t||gr(r,t))&&e.push(r);return e}const Pb=["viewBox","attributeName","attributeType","repeatCount","textLength","lengthAdjust","gradientUnits"];function TM(n,t){return n.getAttribute(t)}function lh(n,t){const e=Nb(t);e.ns?n.hasAttributeNS(e.ns,e.local)&&n.removeAttributeNS(e.ns,e.local):n.hasAttribute(t)&&n.removeAttribute(t)}function uh(n,t,e){if(e==null)return lh(n,t);const r=Nb(t);r.ns&&typeof e=="string"?n.setAttributeNS(r.ns,t,e):t==="id"?n.id=`${e}`:n.setAttribute(t,`${e}`)}function Rb(n,t){Object.keys(t).forEach(e=>{uh(n,e,t[e])})}function ye(n,t,e){if(t==null){const r=n.attributes,i={};for(let s=0;s<r.length;s+=1)i[r[s].name]=r[s].value;return i}if(typeof t=="string"&&e===void 0)return n.getAttribute(t);typeof t=="object"?Rb(n,t):uh(n,t,e)}function Nb(n){if(n.indexOf(":")!==-1){const t=n.split(":");return{ns:yn[t[0]],local:t[1]}}return{ns:null,local:n}}function _o(n){const t={};return Object.keys(n).forEach(e=>{const r=Pb.includes(e)?e:fb(e);t[r]=n[e]}),t}function Ma(n){const t={};return n.split(";").forEach(r=>{const i=r.trim();if(i){const s=i.split("=");s.length&&(t[s[0].trim()]=s[1]?s[1].trim():"")}}),t}function bu(n,t){return Object.keys(t).forEach(e=>{if(e==="class")n[e]=n[e]?`${n[e]} ${t[e]}`:t[e];else if(e==="style"){const r=typeof n[e]=="object",i=typeof t[e]=="object";let s,o;r&&i?(s=n[e],o=t[e]):r?(s=n[e],o=Ma(t[e])):i?(s=Ma(n[e]),o=t[e]):(s=Ma(n[e]),o=Ma(t[e])),n[e]=bu(s,o)}else n[e]=t[e]}),n}function CM(n,t,e={}){const r=e.offset||0,i=[],s=[];let o,a,c=null;for(let l=0;l<n.length;l+=1){o=s[l]=n[l];for(let u=0,f=t.length;u<f;u+=1){const h=t[u],d=h.start+r,p=h.end+r;l>=d&&l<p&&(typeof o=="string"?o=s[l]={t:n[l],attrs:h.attrs}:o.attrs=bu(bu({},o.attrs),h.attrs),e.includeAnnotationIndices&&(o.annotations==null&&(o.annotations=[]),o.annotations.push(u)))}a=s[l-1],a?wi(o)&&wi(a)?(c=c,JSON.stringify(o.attrs)===JSON.stringify(a.attrs)?c.t+=o.t:(i.push(c),c=o)):wi(o)||wi(a)?(c=c,i.push(c),c=o):c=(c||"")+o:c=o}return c!=null&&i.push(c),i}function _M(n){return n.replace(/ /g," ")}var $p;(function(n){function t(l){const u="data:";return l.substr(0,u.length)===u}n.isDataUrl=t;function e(l,u){if(!l||t(l)){setTimeout(()=>u(null,l));return}const f=()=>{u(new Error(`Failed to load image: ${l}`))},h=window.FileReader?p=>{if(p.status===200){const m=new FileReader;m.onload=b=>{const v=b.target.result;u(null,v)},m.onerror=f,m.readAsDataURL(p.response)}else f()}:p=>{const m=b=>{const E=[];for(let y=0;y<b.length;y+=32768)E.push(String.fromCharCode.apply(null,b.subarray(y,y+32768)));return E.join("")};if(p.status===200){let b=l.split(".").pop()||"png";b==="svg"&&(b="svg+xml");const v=`data:image/${b};base64,`,E=new Uint8Array(p.response),y=v+btoa(m(E));u(null,y)}else f()},d=new XMLHttpRequest;d.responseType=window.FileReader?"blob":"arraybuffer",d.open("GET",l,!0),d.addEventListener("error",f),d.addEventListener("load",()=>h(d)),d.send()}n.imageToDataUri=e;function r(l){let u=l.replace(/\s/g,"");u=decodeURIComponent(u);const f=u.indexOf(","),h=u.slice(0,f),d=h.split(":")[1].split(";")[0],p=u.slice(f+1);let m;h.indexOf("base64")>=0?m=atob(p):m=unescape(encodeURIComponent(p));const b=new Uint8Array(m.length);for(let v=0;v<m.length;v+=1)b[v]=m.charCodeAt(v);return new Blob([b],{type:d})}n.dataUriToBlob=r;function i(l,u){const f=window.navigator.msSaveBlob;if(f)f(l,u);else{const h=window.URL.createObjectURL(l),d=document.createElement("a");d.href=h,d.download=u,document.body.appendChild(d),d.click(),document.body.removeChild(d),window.URL.revokeObjectURL(h)}}n.downloadBlob=i;function s(l,u){const f=r(l);i(f,u)}n.downloadDataUri=s;function o(l){const u=l.match(/<svg[^>]*viewBox\s*=\s*(["']?)(.+?)\1[^>]*>/i);return u&&u[2]?u[2].replace(/\s+/," ").split(" "):null}function a(l){const u=parseFloat(l);return Number.isNaN(u)?null:u}function c(l,u={}){let f=null;const h=y=>(f==null&&(f=o(l)),f!=null?a(f[y]):null),d=y=>{const O=l.match(y);return O&&O[2]?a(O[2]):null};let p=u.width;if(p==null&&(p=d(/<svg[^>]*width\s*=\s*(["']?)(.+?)\1[^>]*>/i)),p==null&&(p=h(2)),p==null)throw new Error("Can not parse width from svg string");let m=u.height;if(m==null&&(m=d(/<svg[^>]*height\s*=\s*(["']?)(.+?)\1[^>]*>/i)),m==null&&(m=h(3)),m==null)throw new Error("Can not parse height from svg string");return`data:image/svg+xml,${encodeURIComponent(l).replace(/'/g,"%27").replace(/"/g,"%22")}`}n.svgToDataUrl=c})($p||($p={}));let xi;const OM={px(n){return n},mm(n){return xi*n},cm(n){return xi*n*10},in(n){return xi*n*25.4},pt(n){return xi*(25.4*n/72)},pc(n){return xi*(25.4*n/6)}};var Hp;(function(n){function t(r,i,s){const o=document.createElement("div"),a=o.style;a.display="inline-block",a.position="absolute",a.left="-15000px",a.top="-15000px",a.width=r+(s||"px"),a.height=i+(s||"px"),document.body.appendChild(o);const c=o.getBoundingClientRect(),l={width:c.width||0,height:c.height||0};return document.body.removeChild(o),l}n.measure=t;function e(r,i){xi==null&&(xi=t("1","1","mm").width);const s=i?OM[i]:null;return s?s(r):r}n.toPx=e})(Hp||(Hp={}));const MM=/-(.)/g;function PM(n){return n.replace(MM,(t,e)=>e.toUpperCase())}const Yl={},Xp=["webkit","ms","moz","o"],Lb=typeof document<"u"?document.createElement("div").style:{};function RM(n){for(let t=0;t<Xp.length;t+=1){const e=Xp[t]+n;if(e in Lb)return e}return null}function NM(n){const t=PM(n);if(Yl[t]==null){const e=t.charAt(0).toUpperCase()+t.slice(1);Yl[t]=t in Lb?t:RM(e)}return Yl[t]}function Wp(n,t){const e=n.ownerDocument&&n.ownerDocument.defaultView&&n.ownerDocument.defaultView.opener?n.ownerDocument.defaultView.getComputedStyle(n,null):window.getComputedStyle(n,null);return e&&t?e.getPropertyValue(t)||e[t]:e}const LM={animationIterationCount:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0};function IM(n){return/^--/.test(n)}function DM(n,t,e){const r=window.getComputedStyle(n,null);return e?r.getPropertyValue(t)||void 0:r[t]||n.style[t]}function kM(n,t){return!LM[n]&&typeof t=="number"?`${t}px`:t}function dn(n,t,e){if(typeof t=="string"){const r=IM(t);if(r||(t=NM(t)),e===void 0)return DM(n,t,r);r||(e=kM(t,e));const i=n.style;r?i.setProperty(t,e):i[t]=e;return}for(const r in t)dn(n,r,t[r])}const Ka=new WeakMap;function qp(n,t){const e=hc(t),r=Ka.get(n);if(r)return r[e]}function BM(n,t,e){const r=hc(t),i=Ka.get(n);i?i[r]=e:Ka.set(n,{[r]:e})}function Ri(n,t,e){if(!t){const r={};return Object.keys(Ka).forEach(i=>{r[i]=qp(n,i)}),r}if(typeof t=="string"){if(e===void 0)return qp(n,t);BM(n,t,e);return}for(const r in t)Ri(n,r,t[r])}class ae{get[Symbol.toStringTag](){return ae.toStringTag}get type(){return this.node.nodeName}get id(){return this.node.id}set id(t){this.node.id=t}constructor(t,e,r){if(!t)throw new TypeError("Invalid element to create vector");let i;if(ae.isVector(t))i=t.node;else if(typeof t=="string")if(t.toLowerCase()==="svg")i=Ja();else if(t[0]==="<"){const s=Ja(t);i=document.importNode(s.firstChild,!0)}else i=document.createElementNS(yn.svg,t);else i=t;this.node=i,e&&this.setAttributes(e),r&&this.append(r)}transform(t,e){return t==null?gs(this.node):(gs(this.node,t,e),this)}translate(t,e=0,r={}){return t==null?Jp(this.node):(Jp(this.node,t,e,r),this)}rotate(t,e,r,i={}){return t==null?Eu(this.node):(Eu(this.node,t,e,r,i),this)}scale(t,e){return t==null?xu(this.node):(xu(this.node,t,e),this)}getTransformToElement(t){const e=ae.toNode(t);return po(this.node,e)}removeAttribute(t){return lh(this.node,t),this}getAttribute(t){return TM(this.node,t)}setAttribute(t,e){return uh(this.node,t,e),this}setAttributes(t){return Rb(this.node,t),this}attr(t,e){return t==null?ye(this.node):typeof t=="string"&&e===void 0?ye(this.node,t):(typeof t=="object"?ye(this.node,t):ye(this.node,t,e),this)}svg(){return this.node instanceof SVGSVGElement?this:ae.create(this.node.ownerSVGElement)}defs(){const t=this.svg()||this,e=t.node.getElementsByTagName("defs")[0];return e?ae.create(e):ae.create("defs").appendTo(t)}text(t,e={}){return Db(this.node,t,e),this}tagName(){return xM(this.node)}clone(){return ae.create(this.node.cloneNode(!0))}remove(){return Yn(this.node),this}empty(){return $o(this.node),this}append(t){return zn(this.node,ae.toNodes(t)),this}appendTo(t){return Hr(this.node,ae.isVector(t)?t.node:t),this}prepend(t){return Mb(this.node,ae.toNodes(t)),this}before(t){return ch(this.node,ae.toNodes(t)),this}replace(t){return this.node.parentNode&&this.node.parentNode.replaceChild(ae.toNode(t),this.node),ae.create(t)}first(){return this.node.firstChild?ae.create(this.node.firstChild):null}last(){return this.node.lastChild?ae.create(this.node.lastChild):null}get(t){const e=this.node.childNodes[t];return e?ae.create(e):null}indexOf(t){return Array.prototype.slice.call(this.node.childNodes).indexOf(ae.toNode(t))}find(t){const e=[],r=wM(this.node,t);if(r)for(let i=0,s=r.length;i<s;i+=1)e.push(ae.create(r[i]));return e}findOne(t){const e=AM(this.node,t);return e?ae.create(e):null}findParentByClass(t,e){const r=Ob(this.node,t,e);return r?ae.create(r):null}matches(t){const e=this.node;this.node.matches;const r=e.matches||e.matchesSelector||e.msMatchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||null;return r&&r.call(e,t)}contains(t){return ah(this.node,ae.isVector(t)?t.node:t)}wrap(t){const e=ae.create(t),r=this.node.parentNode;return r!=null&&r.insertBefore(e.node,this.node),e.append(this)}parent(t){let e=this;if(e.node.parentNode==null)return null;if(e=ae.create(e.node.parentNode),t==null)return e;do if(typeof t=="string"?e.matches(t):e instanceof t)return e;while(e=ae.create(e.node.parentNode));return e}children(){const t=this.node.childNodes,e=[];for(let r=0;r<t.length;r+=1)t[r].nodeType===1&&e.push(ae.create(t[r]));return e}eachChild(t,e){const r=this.children();for(let i=0,s=r.length;i<s;i+=1)t.call(r[i],r[i],i,r),e&&r[i].eachChild(t,e);return this}index(){return oh(this.node)}hasClass(t){return gr(this.node,t)}addClass(t){return qt(this.node,t),this}removeClass(t){return Fe(this.node,t),this}toggleClass(t,e){return er(this.node,t,e),this}toLocalPoint(t,e){return rP(this.node,t,e)}sample(t=1){return this.node instanceof SVGPathElement?zM(this.node,t):[]}toPath(){return ae.create(qM(this.node))}toPathData(){return Fb(this.node)}}(function(n){n.toStringTag=`X6.${n.name}`;function t(o){if(o==null)return!1;if(o instanceof n)return!0;const a=o[Symbol.toStringTag],c=o;return(a==null||a===n.toStringTag)&&c.node instanceof SVGElement&&typeof c.sample=="function"&&typeof c.toPath=="function"}n.isVector=t;function e(o,a,c){return new n(o,a,c)}n.create=e;function r(o){if(o[0]==="<"){const a=Ja(o),c=[];for(let l=0,u=a.childNodes.length;l<u;l+=1){const f=a.childNodes[l];c.push(e(document.importNode(f,!0)))}return c}return[e(o)]}n.createVectors=r;function i(o){return t(o)?o.node:o}n.toNode=i;function s(o){return Array.isArray(o)?o.map(a=>i(a)):[i(o)]}n.toNodes=s})(ae||(ae={}));function jM(n,t){const e=ae.create(t),r=ae.create("textPath"),i=n.d;if(i&&n["xlink:href"]===void 0){const s=ae.create("path").attr("d",i).appendTo(e.defs());r.attr("xlink:href",`#${s.id}`)}return typeof n=="object"&&r.attr(n),r.node}function FM(n,t,e){const r=e.eol,i=e.baseSize,s=e.lineHeight;let o=0,a;const c={},l=t.length-1;for(let u=0;u<=l;u+=1){let f=t[u],h=null;if(typeof f=="object"){const d=f.attrs,p=ae.create("tspan",d);a=p.node;let m=f.t;r&&u===l&&(m+=r),a.textContent=m;const b=d.class;b&&p.addClass(b),e.includeAnnotationIndices&&p.attr("annotations",f.annotations.join(",")),h=parseFloat(d["font-size"]),h===void 0&&(h=i),h&&h>o&&(o=h)}else r&&u===l&&(f+=r),a=document.createTextNode(f||" "),i&&i>o&&(o=i);n.appendChild(a)}return o&&(c.maxFontSize=o),s?c.lineHeight=s:o&&(c.lineHeight=o*1.2),c}const Ib=/em$/;function Pa(n,t){const e=parseFloat(n);return Ib.test(n)?e*t:e}function GM(n,t,e,r){if(!Array.isArray(t))return 0;const i=t.length;if(!i)return 0;let s=t[0];const o=Pa(s.maxFontSize,e)||e;let a=0;const c=Pa(r,e);for(let f=1;f<i;f+=1){s=t[f];const h=Pa(s.lineHeight,e)||c;a+=h}const l=Pa(s.maxFontSize,e)||e;let u;switch(n){case"middle":u=o/2-.15*l-a/2;break;case"bottom":u=-(.25*l)-a;break;case"top":default:u=.8*o;break}return u}function Db(n,t,e={}){t=_M(t);const r=e.eol;let i=e.textPath;const s=e.textVerticalAnchor,o=s==="middle"||s==="bottom"||s==="top";let a=e.x;a===void 0&&(a=n.getAttribute("x")||0);const c=e.includeAnnotationIndices;let l=e.annotations;l&&!Array.isArray(l)&&(l=[l]);const u=e.lineHeight,f=u==="auto",h=f?"1.5em":u||"1em";let d=!0;const p=n.childNodes;if(p.length===1){const Z=p[0];Z&&Z.tagName.toUpperCase()==="TITLE"&&(d=!1)}d&&$o(n),ye(n,{"xml:space":"preserve",display:t||e.displayEmpty?null:"none"});const m=ye(n,"font-size");let b=parseFloat(m);b||(b=16,(o||l)&&!m&&ye(n,"font-size",`${b}`));let v;i?(typeof i=="string"&&(i={d:i}),v=jM(i,n)):v=document.createDocumentFragment();let E,y=0,O;const I=t.split(`
`),G=[],k=I.length-1;for(let Z=0;Z<=k;Z+=1){E=h;let at="v-line";const ft=ar("tspan");let H,Ut=I[Z];if(Ut)if(l){const zt=CM(Ut,l,{offset:-y,includeAnnotationIndices:c});H=FM(ft,zt,{eol:Z!==k&&r,baseSize:b,lineHeight:f?null:h,includeAnnotationIndices:c});const W=H.lineHeight;W&&f&&Z!==0&&(E=W),Z===0&&(O=H.maxFontSize*.8)}else r&&Z!==k&&(Ut+=r),ft.textContent=Ut;else{ft.textContent="-",at+=" v-empty-line";const zt=ft.style;zt.fillOpacity=0,zt.strokeOpacity=0,l&&(H={})}H&&G.push(H),Z>0&&ft.setAttribute("dy",E),(Z>0||i)&&ft.setAttribute("x",a),ft.className.baseVal=at,v.appendChild(ft),y+=Ut.length+1}if(o)if(l)E=GM(s,G,b,h);else if(s==="top")E="0.8em";else{let Z;switch(k>0?(Z=parseFloat(h)||1,Z*=k,Ib.test(h)||(Z/=b)):Z=0,s){case"middle":E=`${.3-Z/2}em`;break;case"bottom":E=`${-Z-.3}em`;break}}else s===0?E="0em":s?E=s:(E=0,n.getAttribute("y")==null&&n.setAttribute("y",`${O||"0.8em"}`));v.firstChild.setAttribute("dy",E),n.appendChild(v)}function fo(n,t={}){const e=document.createElement("canvas").getContext("2d");if(!n)return{width:0};const r=[],i=t["font-size"]?`${parseFloat(t["font-size"])}px`:"14px";return r.push(t["font-style"]||"normal"),r.push(t["font-variant"]||"normal"),r.push(t["font-weight"]||400),r.push(i),r.push(t["font-family"]||"sans-serif"),e.font=r.join(" "),e.measureText(n)}function Yp(n,t,e,r={}){if(t>=e)return[n,""];const i=n.length,s={};let o=Math.round(t/e*i-1);for(o<0&&(o=0);o>=0&&o<i;){const a=n.slice(0,o),c=s[a]||fo(a,r).width,l=n.slice(0,o+1),u=s[l]||fo(l,r).width;if(s[a]=c,s[l]=u,c>t)o-=1;else if(u<=t)o+=1;else break}return[n.slice(0,o),n.slice(o)]}function kb(n,t,e={},r={}){const i=t.width,s=t.height,o=r.eol||`
`,a=e.fontSize||14,c=e.lineHeight?parseFloat(e.lineHeight):Math.ceil(a*1.4),l=Math.floor(s/c);if(n.indexOf(o)>-1){const b=Ya(),v=[];return n.split(o).map(E=>{const y=kb(E,Object.assign(Object.assign({},t),{height:Number.MAX_SAFE_INTEGER}),e,Object.assign(Object.assign({},r),{eol:b}));y&&v.push(...y.split(b))}),v.slice(0,l).join(o)}const{width:u}=fo(n,e);if(u<i)return n;const f=[];let h=n,d=u,p=r.ellipsis,m=0;p&&(typeof p!="string"&&(p="…"),m=fo(p,e).width);for(let b=0;b<l;b+=1)if(d>i)if(b===l-1){const[E]=Yp(h,i-m,d,e);f.push(p?`${E}${p}`:E)}else{const[E,y]=Yp(h,i,d,e);f.push(E),h=y,d=fo(h,e).width}else{f.push(h);break}return f.join(o)}const vu=.551784;function Cn(n,t,e=NaN){const r=n.getAttribute(t);if(r==null)return e;const i=parseFloat(r);return Number.isNaN(i)?e:i}function zM(n,t=1){const e=n.getTotalLength(),r=[];let i=0,s;for(;i<e;)s=n.getPointAtLength(i),r.push({distance:i,x:s.x,y:s.y}),i+=t;return r}function UM(n){return["M",Cn(n,"x1"),Cn(n,"y1"),"L",Cn(n,"x2"),Cn(n,"y2")].join(" ")}function VM(n){const t=Za(n);return t.length===0?null:`${Bb(t)} Z`}function $M(n){const t=Za(n);return t.length===0?null:Bb(t)}function Bb(n){return`M ${n.map(e=>`${e.x} ${e.y}`).join(" L")}`}function Za(n){const t=[],e=n.points;if(e)for(let r=0,i=e.numberOfItems;r<i;r+=1)t.push(e.getItem(r));return t}function HM(n){const t=Cn(n,"cx",0),e=Cn(n,"cy",0),r=Cn(n,"r"),i=r*vu;return["M",t,e-r,"C",t+i,e-r,t+r,e-i,t+r,e,"C",t+r,e+i,t+i,e+r,t,e+r,"C",t-i,e+r,t-r,e+i,t-r,e,"C",t-r,e-i,t-i,e-r,t,e-r,"Z"].join(" ")}function XM(n){const t=Cn(n,"cx",0),e=Cn(n,"cy",0),r=Cn(n,"rx"),i=Cn(n,"ry")||r,s=r*vu,o=i*vu;return["M",t,e-i,"C",t+s,e-i,t+r,e-o,t+r,e,"C",t+r,e+o,t+s,e+i,t,e+i,"C",t-s,e+i,t-r,e+o,t-r,e,"C",t-r,e-o,t-s,e-i,t,e-i,"Z"].join(" ")}function WM(n){return jb({x:Cn(n,"x",0),y:Cn(n,"y",0),width:Cn(n,"width",0),height:Cn(n,"height",0),rx:Cn(n,"rx",0),ry:Cn(n,"ry",0)})}function jb(n){let t;const e=n.x,r=n.y,i=n.width,s=n.height,o=Math.min(n.rx||n["top-rx"]||0,i/2),a=Math.min(n.rx||n["bottom-rx"]||0,i/2),c=Math.min(n.ry||n["top-ry"]||0,s/2),l=Math.min(n.ry||n["bottom-ry"]||0,s/2);return o||a||c||l?t=["M",e,r+c,"v",s-c-l,"a",a,l,0,0,0,a,l,"h",i-2*a,"a",a,l,0,0,0,a,-l,"v",-(s-l-c),"a",o,c,0,0,0,-o,-c,"h",-(i-2*o),"a",o,c,0,0,0,-o,c,"Z"]:t=["M",e,r,"H",e+i,"V",r+s,"H",e,"V",r,"Z"],t.join(" ")}function qM(n){const t=ar("path");ye(t,ye(n));const e=Fb(n);return e&&t.setAttribute("d",e),t}function Fb(n){const t=n.tagName.toLowerCase();switch(t){case"path":return n.getAttribute("d");case"line":return UM(n);case"polygon":return VM(n);case"polyline":return $M(n);case"ellipse":return XM(n);case"circle":return HM(n);case"rect":return WM(n)}throw new Error(`"${t}" cannot be converted to svg path element.`)}const YM=/(\w+)\(([^,)]+),?([^)]+)?\)/gi,Gb=/[ ,]+/,JM=/^(\w+)\((.*)\)/;function KM(n,t){const r=ar("svg").createSVGPoint();return r.x=n,r.y=t,r}function xn(n){const e=ar("svg").createSVGMatrix();if(n!=null){const r=n,i=e;for(const s in r)i[s]=r[s]}return e}function uo(n){const t=ar("svg");return n!=null?(n instanceof DOMMatrix||(n=xn(n)),t.createSVGTransformFromMatrix(n)):t.createSVGTransform()}function Oo(n){let t=xn();const e=n!=null&&n.match(YM);if(!e)return t;for(let r=0,i=e.length;r<i;r+=1){const o=e[r].match(JM);if(o){let a,c,l,u,f,h=xn();const d=o[2].split(Gb);switch(o[1].toLowerCase()){case"scale":a=parseFloat(d[0]),c=d[1]===void 0?a:parseFloat(d[1]),h=h.scaleNonUniform(a,c);break;case"translate":l=parseFloat(d[0]),u=parseFloat(d[1]),h=h.translate(l,u);break;case"rotate":f=parseFloat(d[0]),l=parseFloat(d[1])||0,u=parseFloat(d[2])||0,l!==0||u!==0?h=h.translate(l,u).rotate(f).translate(-l,-u):h=h.rotate(f);break;case"skewx":f=parseFloat(d[0]),h=h.skewX(f);break;case"skewy":f=parseFloat(d[0]),h=h.skewY(f);break;case"matrix":h.a=parseFloat(d[0]),h.b=parseFloat(d[1]),h.c=parseFloat(d[2]),h.d=parseFloat(d[3]),h.e=parseFloat(d[4]),h.f=parseFloat(d[5]);break;default:continue}t=t.multiply(h)}}return t}function Ds(n){const t=n||{},e=t.a!=null?t.a:1,r=t.b!=null?t.b:0,i=t.c!=null?t.c:0,s=t.d!=null?t.d:1,o=t.e!=null?t.e:0,a=t.f!=null?t.f:0;return`matrix(${e},${r},${i},${s},${o},${a})`}function Cc(n){let t,e,r;if(n){const s=Gb;if(n.trim().indexOf("matrix")>=0){const o=Oo(n),a=ZM(o);t=[a.translateX,a.translateY],e=[a.rotation],r=[a.scaleX,a.scaleY];const c=[];(t[0]!==0||t[1]!==0)&&c.push(`translate(${t.join(",")})`),(r[0]!==1||r[1]!==1)&&c.push(`scale(${r.join(",")})`),e[0]!==0&&c.push(`rotate(${e[0]})`),n=c.join(" ")}else{const o=n.match(/translate\((.*?)\)/);o&&(t=o[1].split(s));const a=n.match(/rotate\((.*?)\)/);a&&(e=a[1].split(s));const c=n.match(/scale\((.*?)\)/);c&&(r=c[1].split(s))}}const i=r&&r[0]?parseFloat(r[0]):1;return{raw:n||"",translation:{tx:t&&t[0]?parseInt(t[0],10):0,ty:t&&t[1]?parseInt(t[1],10):0},rotation:{angle:e&&e[0]?parseInt(e[0],10):0,cx:e&&e[1]?parseInt(e[1],10):void 0,cy:e&&e[2]?parseInt(e[2],10):void 0},scale:{sx:i,sy:r&&r[1]?parseFloat(r[1]):i}}}function yu(n,t){const e=t.x*n.a+t.y*n.c+0,r=t.x*n.b+t.y*n.d+0;return{x:e,y:r}}function ZM(n){const t=yu(n,{x:0,y:1}),e=yu(n,{x:1,y:0}),r=180/Math.PI*Math.atan2(t.y,t.x)-90,i=180/Math.PI*Math.atan2(e.y,e.x);return{skewX:r,skewY:i,translateX:n.e,translateY:n.f,scaleX:Math.sqrt(n.a*n.a+n.b*n.b),scaleY:Math.sqrt(n.c*n.c+n.d*n.d),rotation:r}}function QM(n){let t,e,r,i;return n?(t=n.a==null?1:n.a,i=n.d==null?1:n.d,e=n.b,r=n.c):t=i=1,{sx:e?Math.sqrt(t*t+e*e):t,sy:r?Math.sqrt(r*r+i*i):i}}function tP(n){let t={x:0,y:1};n&&(t=yu(n,t));const e=180*Math.atan2(t.y,t.x)/Math.PI%360-90;return{angle:e%360+(e<0?360:0)}}function eP(n){return{tx:n&&n.e||0,ty:n&&n.f||0}}function gs(n,t,e={}){if(t==null)return Oo(ye(n,"transform"));if(e.absolute){n.setAttribute("transform",Ds(t));return}const r=n.transform,i=uo(t);r.baseVal.appendItem(i)}function Jp(n,t,e=0,r={}){let i=ye(n,"transform");const s=Cc(i);if(t==null)return s.translation;i=s.raw,i=i.replace(/translate\([^)]*\)/g,"").trim();const o=r.absolute?t:s.translation.tx+t,a=r.absolute?e:s.translation.ty+e,c=`translate(${o},${a})`;n.setAttribute("transform",`${c} ${i}`.trim())}function Eu(n,t,e,r,i={}){let s=ye(n,"transform");const o=Cc(s);if(t==null)return o.rotation;s=o.raw,s=s.replace(/rotate\([^)]*\)/g,"").trim(),t%=360;const a=i.absolute?t:o.rotation.angle+t,c=e!=null&&r!=null?`,${e},${r}`:"",l=`rotate(${a}${c})`;n.setAttribute("transform",`${s} ${l}`.trim())}function xu(n,t,e){let r=ye(n,"transform");const i=Cc(r);if(t==null)return i.scale;e=e??t,r=i.raw,r=r.replace(/scale\([^)]*\)/g,"").trim();const s=`scale(${t},${e})`;n.setAttribute("transform",`${r} ${s}`.trim())}function po(n,t){if(qr(t)&&qr(n)){const e=t.getScreenCTM(),r=n.getScreenCTM();if(e&&r)return e.inverse().multiply(r)}return xn()}function nP(n,t){let e=xn();if(qr(t)&&qr(n)){let r=n;const i=[];for(;r&&r!==t;){const s=r.getAttribute("transform")||null,o=Oo(s);i.push(o),r=r.parentNode}i.reverse().forEach(s=>{e=e.multiply(s)})}return e}function rP(n,t,e){const r=n instanceof SVGSVGElement?n:n.ownerSVGElement,i=r.createSVGPoint();i.x=t,i.y=e;try{const s=r.getScreenCTM(),o=i.matrixTransform(s.inverse()),a=po(n,r).inverse();return o.matrixTransform(a)}catch{return i}}var qn;(function(n){const t={};function e(s){return t[s]||{}}n.get=e;function r(s,o){t[s]=o}n.register=r;function i(s){delete t[s]}n.unregister=i})(qn||(qn={}));var Ai;(function(n){const t=new WeakMap;function e(s){return t.has(s)||t.set(s,{events:Object.create(null)}),t.get(s)}n.ensure=e;function r(s){return t.get(s)}n.get=r;function i(s){return t.delete(s)}n.remove=i})(Ai||(Ai={}));var me;(function(n){n.returnTrue=()=>!0,n.returnFalse=()=>!1;function t(i){i.stopPropagation()}n.stopPropagationCallback=t;function e(i,s,o){i.addEventListener!=null&&i.addEventListener(s,o)}n.addEventListener=e;function r(i,s,o){i.removeEventListener!=null&&i.removeEventListener(s,o)}n.removeEventListener=r})(me||(me={}));(function(n){const t=/[^\x20\t\r\n\f]+/g,e=/^([^.]*)(?:\.(.+)|)/;function r(a){return(a||"").match(t)||[""]}n.splitType=r;function i(a){const c=e.exec(a)||[];return{originType:c[1]?c[1].trim():c[1],namespaces:c[2]?c[2].split(".").map(l=>l.trim()).sort():[]}}n.normalizeType=i;function s(a){return a.nodeType===1||a.nodeType===9||!+a.nodeType}n.isValidTarget=s;function o(a,c){if(c){const l=a;return l.querySelector!=null&&l.querySelector(c)!=null}return!0}n.isValidSelector=o})(me||(me={}));(function(n){let t=0;const e=new WeakMap;function r(a){return e.has(a)||(e.set(a,t),t+=1),e.get(a)}n.ensureHandlerId=r;function i(a){return e.get(a)}n.getHandlerId=i;function s(a){return e.delete(a)}n.removeHandlerId=s;function o(a,c){return e.set(a,c)}n.setHandlerId=o})(me||(me={}));(function(n){function t(e,r){const i=[],s=Ai.get(e),o=s&&s.events&&s.events[r.type],a=o&&o.handlers||[],c=o?o.delegateCount:0;if(c>0&&!(r.type==="click"&&typeof r.button=="number"&&r.button>=1)){for(let l=r.target;l!==e;l=l.parentNode||e)if(l.nodeType===1&&!(r.type==="click"&&l.disabled===!0)){const u=[],f={};for(let h=0;h<c;h+=1){const d=a[h],p=d.selector;if(p!=null&&f[p]==null){const m=e,b=[];m.querySelectorAll(p).forEach(v=>{b.push(v)}),f[p]=b.includes(l)}f[p]&&u.push(d)}u.length&&i.push({elem:l,handlers:u})}}return c<a.length&&i.push({elem:e,handlers:a.slice(c)}),i}n.getHandlerQueue=t})(me||(me={}));(function(n){function t(e){return e!=null&&e===e.window}n.isWindow=t})(me||(me={}));(function(n){function t(e,r){const i=e.nodeType===9?e.documentElement:e,s=r&&r.parentNode;return e===s||!!(s&&s.nodeType===1&&(i.contains?i.contains(s):e.compareDocumentPosition&&e.compareDocumentPosition(s)&16))}n.contains=t})(me||(me={}));class br{constructor(t,e){this.isDefaultPrevented=me.returnFalse,this.isPropagationStopped=me.returnFalse,this.isImmediatePropagationStopped=me.returnFalse,this.isSimulated=!1,this.preventDefault=()=>{const r=this.originalEvent;this.isDefaultPrevented=me.returnTrue,r&&!this.isSimulated&&r.preventDefault()},this.stopPropagation=()=>{const r=this.originalEvent;this.isPropagationStopped=me.returnTrue,r&&!this.isSimulated&&r.stopPropagation()},this.stopImmediatePropagation=()=>{const r=this.originalEvent;this.isImmediatePropagationStopped=me.returnTrue,r&&!this.isSimulated&&r.stopImmediatePropagation(),this.stopPropagation()},typeof t=="string"?this.type=t:t.type&&(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented?me.returnTrue:me.returnFalse,this.target=t.target,this.currentTarget=t.currentTarget,this.relatedTarget=t.relatedTarget,this.timeStamp=t.timeStamp),e&&Object.assign(this,e),this.timeStamp||(this.timeStamp=Date.now())}}(function(n){function t(e){return e instanceof n?e:new n(e)}n.create=t})(br||(br={}));(function(n){function t(e,r){Object.defineProperty(n.prototype,e,{enumerable:!0,configurable:!0,get:typeof r=="function"?function(){if(this.originalEvent)return r(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[e]},set(i){Object.defineProperty(this,e,{enumerable:!0,configurable:!0,writable:!0,value:i})}})}n.addProperty=t})(br||(br={}));(function(n){const t={bubbles:!0,cancelable:!0,eventPhase:!0,detail:!0,view:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pageX:!0,pageY:!0,screenX:!0,screenY:!0,toElement:!0,pointerId:!0,pointerType:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,touches:!0,changedTouches:!0,targetTouches:!0,which:!0,altKey:!0,ctrlKey:!0,metaKey:!0,shiftKey:!0};Object.keys(t).forEach(e=>n.addProperty(e,t[e]))})(br||(br={}));(function(n){qn.register("load",{noBubble:!0})})();(function(n){qn.register("beforeunload",{postDispatch(t,e){e.result!==void 0&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}})})();(function(n){qn.register("mouseenter",{delegateType:"mouseover",bindType:"mouseover",handle(t,e){let r;const i=e.relatedTarget,s=e.handleObj;return(!i||i!==t&&!me.contains(t,i))&&(e.type=s.originType,r=s.handler.call(t,e),e.type="mouseover"),r}}),qn.register("mouseleave",{delegateType:"mouseout",bindType:"mouseout",handle(t,e){let r;const i=e.relatedTarget,s=e.handleObj;return(!i||i!==t&&!me.contains(t,i))&&(e.type=s.originType,r=s.handler.call(t,e),e.type="mouseout"),r}})})();var iP=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e},Mo;(function(n){let t;function e(o,a,c,l,u){if(!me.isValidTarget(o))return;let f;if(typeof c!="function"){const{handler:m,selector:b}=c,v=iP(c,["handler","selector"]);c=m,u=b,f=v}const h=Ai.ensure(o);let d=h.handler;d==null&&(d=h.handler=function(m,...b){return t!==m.type?i(o,m,...b):void 0});const p=me.ensureHandlerId(c);me.splitType(a).forEach(m=>{const{originType:b,namespaces:v}=me.normalizeType(m);if(!b)return;let E=b,y=qn.get(E);E=(u?y.delegateType:y.bindType)||E,y=qn.get(E);const O=Object.assign({type:E,originType:b,data:l,selector:u,guid:p,handler:c,namespace:v.join(".")},f),I=h.events;let G=I[E];G||(G=I[E]={handlers:[],delegateCount:0},(!y.setup||y.setup(o,l,v,d)===!1)&&me.addEventListener(o,E,d)),y.add&&(me.removeHandlerId(O.handler),y.add(o,O),me.setHandlerId(O.handler,p)),u?(G.handlers.splice(G.delegateCount,0,O),G.delegateCount+=1):G.handlers.push(O)})}n.on=e;function r(o,a,c,l,u){const f=Ai.get(o);if(!f)return;const h=f.events;h&&(me.splitType(a).forEach(d=>{const{originType:p,namespaces:m}=me.normalizeType(d);if(!p){Object.keys(h).forEach(I=>{r(o,I+d,c,l,!0)});return}let b=p;const v=qn.get(b);b=(l?v.delegateType:v.bindType)||b;const E=h[b];if(!E)return;const y=m.length>0?new RegExp(`(^|\\.)${m.join("\\.(?:.*\\.|)")}(\\.|$)`):null,O=E.handlers.length;for(let I=E.handlers.length-1;I>=0;I-=1){const G=E.handlers[I];(u||p===G.originType)&&(!c||me.getHandlerId(c)===G.guid)&&(y==null||G.namespace&&y.test(G.namespace))&&(l==null||l===G.selector||l==="**"&&G.selector)&&(E.handlers.splice(I,1),G.selector&&(E.delegateCount-=1),v.remove&&v.remove(o,G))}O&&E.handlers.length===0&&((!v.teardown||v.teardown(o,m,f.handler)===!1)&&me.removeEventListener(o,b,f.handler),delete h[b])}),Object.keys(h).length===0&&Ai.remove(o))}n.off=r;function i(o,a,...c){const l=br.create(a);l.delegateTarget=o;const u=qn.get(l.type);if(u.preDispatch&&u.preDispatch(o,l)===!1)return;const f=me.getHandlerQueue(o,l);for(let h=0,d=f.length;h<d&&!l.isPropagationStopped();h+=1){const p=f[h];l.currentTarget=p.elem;for(let m=0,b=p.handlers.length;m<b&&!l.isImmediatePropagationStopped();m+=1){const v=p.handlers[m];if(l.rnamespace==null||v.namespace&&l.rnamespace.test(v.namespace)){l.handleObj=v,l.data=v.data;const E=qn.get(v.originType).handle,y=E?E(p.elem,l,...c):v.handler.call(p.elem,l,...c);y!==void 0&&(l.result=y,y===!1&&(l.preventDefault(),l.stopPropagation()))}}}return u.postDispatch&&u.postDispatch(o,l),l.result}n.dispatch=i;function s(o,a,c,l){let u=o,f=typeof o=="string"?o:o.type,h=typeof o=="string"||u.namespace==null?[]:u.namespace.split(".");const d=c;if(d.nodeType===3||d.nodeType===8)return;f.indexOf(".")>-1&&(h=f.split("."),f=h.shift(),h.sort());const p=f.indexOf(":")<0&&`on${f}`;u=o instanceof br?o:new br(f,typeof o=="object"?o:null),u.namespace=h.join("."),u.rnamespace=u.namespace?new RegExp(`(^|\\.)${h.join("\\.(?:.*\\.|)")}(\\.|$)`):null,u.result=void 0,u.target||(u.target=d);const m=[u];Array.isArray(a)?m.push(...a):m.push(a);const b=qn.get(f);if(!l&&b.trigger&&b.trigger(d,u,a)===!1)return;let v;const E=[d];if(!l&&!b.noBubble&&!me.isWindow(d)){v=b.delegateType||f;let O=d,I=d.parentNode;for(;I!=null;)E.push(I),O=I,I=I.parentNode;const G=d.ownerDocument||document;if(O===G){const k=O.defaultView||O.parentWindow||window;E.push(k)}}let y=d;for(let O=0,I=E.length;O<I&&!u.isPropagationStopped();O+=1){const G=E[O];y=G,u.type=O>1?v:b.bindType||f;const k=Ai.get(G);k&&k.events[u.type]&&k.handler&&k.handler.call(G,...m);const X=p&&G[p]||null;X&&me.isValidTarget(G)&&(u.result=X.call(G,...m),u.result===!1&&u.preventDefault())}if(u.type=f,!l&&!u.isDefaultPrevented()){const O=b.preventDefault;if((O==null||O(E.pop(),u,a)===!1)&&me.isValidTarget(d)&&p&&typeof d[f]=="function"&&!me.isWindow(d)){const I=d[p];I&&(d[p]=null),t=f,u.isPropagationStopped()&&y.addEventListener(f,me.stopPropagationCallback),d[f](),u.isPropagationStopped()&&y.removeEventListener(f,me.stopPropagationCallback),t=void 0,I&&(d[p]=I)}}return u.result}n.trigger=s})(Mo||(Mo={}));var Tn;(function(n){function t(s,o,a,c,l){return go.on(s,o,a,c,l),s}n.on=t;function e(s,o,a,c,l){return go.on(s,o,a,c,l,!0),s}n.once=e;function r(s,o,a,c){return go.off(s,o,a,c),s}n.off=r;function i(s,o,a,c){return Mo.trigger(o,a,s,c),s}n.trigger=i})(Tn||(Tn={}));var go;(function(n){function t(r,i,s,o,a,c){if(typeof i=="object"){typeof s!="string"&&(o=o||s,s=void 0),Object.keys(i).forEach(l=>t(r,l,s,o,i[l],c));return}if(o==null&&a==null?(a=s,o=s=void 0):a==null&&(typeof s=="string"?(a=o,o=void 0):(a=o,o=s,s=void 0)),a===!1)a=me.returnFalse;else if(!a)return;if(c){const l=a;a=function(u,...f){return n.off(r,u),l.call(this,u,...f)},me.setHandlerId(a,me.ensureHandlerId(l))}Mo.on(r,i,a,o,s)}n.on=t;function e(r,i,s,o){const a=i;if(a&&a.preventDefault!=null&&a.handleObj!=null){const c=a.handleObj;e(a.delegateTarget,c.namespace?`${c.originType}.${c.namespace}`:c.originType,c.selector,c.handler);return}if(typeof i=="object"){const c=i;Object.keys(c).forEach(l=>e(r,l,s,c[l]));return}(s===!1||typeof s=="function")&&(o=s,s=void 0),o===!1&&(o=me.returnFalse),Mo.off(r,i,o,s)}n.off=e})(go||(go={}));class zb{constructor(t,e,r){this.animationFrameId=0,this.deltaX=0,this.deltaY=0,this.eventName=Wr.isEventSupported("wheel")?"wheel":"mousewheel",this.target=t,this.onWheelCallback=e,this.onWheelGuard=r,this.onWheel=this.onWheel.bind(this),this.didWheel=this.didWheel.bind(this)}enable(){this.target.addEventListener(this.eventName,this.onWheel,{passive:!1})}disable(){this.target.removeEventListener(this.eventName,this.onWheel)}onWheel(t){if(this.onWheelGuard!=null&&!this.onWheelGuard(t))return;this.deltaX+=t.deltaX,this.deltaY+=t.deltaY,t.preventDefault();let e;(this.deltaX!==0||this.deltaY!==0)&&(t.stopPropagation(),e=!0),e===!0&&this.animationFrameId===0&&(this.animationFrameId=requestAnimationFrame(()=>{this.didWheel(t)}))}didWheel(t){this.animationFrameId=0,this.onWheelCallback(t,this.deltaX,this.deltaY),this.deltaX=0,this.deltaY=0}}function wu(n){const t=n.getBoundingClientRect(),e=n.ownerDocument.defaultView;return{top:t.top+e.pageYOffset,left:t.left+e.pageXOffset}}function sP(n){return n.getBoundingClientRect().width}function oP(n){return n.getBoundingClientRect().height}function Ub(n,t=60){let e=null;return(...r)=>{e&&clearTimeout(e),e=window.setTimeout(()=>{n.apply(this,r)},t)}}function aP(n){let t=null,e=[];const r=()=>{if(getComputedStyle(n).position==="static"){const l=n.style;l.position="relative"}const c=document.createElement("object");return c.onload=()=>{c.contentDocument.defaultView.addEventListener("resize",i),i()},c.style.display="block",c.style.position="absolute",c.style.top="0",c.style.left="0",c.style.height="100%",c.style.width="100%",c.style.overflow="hidden",c.style.pointerEvents="none",c.style.zIndex="-1",c.style.opacity="0",c.setAttribute("tabindex","-1"),c.type="text/html",n.appendChild(c),c.data="about:blank",c},i=Ub(()=>{e.forEach(c=>c(n))}),s=c=>{t||(t=r()),e.indexOf(c)===-1&&e.push(c)},o=()=>{t&&t.parentNode&&(t.contentDocument&&t.contentDocument.defaultView.removeEventListener("resize",i),t.parentNode.removeChild(t),t=null,e=[])};return{element:n,bind:s,destroy:o,unbind:c=>{const l=e.indexOf(c);l!==-1&&e.splice(l,1),e.length===0&&t&&o()}}}function cP(n){let t=null,e=[];const r=Ub(()=>{e.forEach(c=>{c(n)})}),i=()=>{const c=new ResizeObserver(r);return c.observe(n),r(),c},s=c=>{t||(t=i()),e.indexOf(c)===-1&&e.push(c)},o=()=>{t&&(t.disconnect(),e=[],t=null)};return{element:n,bind:s,destroy:o,unbind:c=>{const l=e.indexOf(c);l!==-1&&e.splice(l,1),e.length===0&&t&&o()}}}const lP=typeof ResizeObserver<"u"?cP:aP;var Qa;(function(n){const t=new WeakMap;function e(i){let s=t.get(i);return s||(s=lP(i),t.set(i,s),s)}function r(i){i.destroy(),t.delete(i.element)}n.bind=(i,s)=>{const o=e(i);return o.bind(s),()=>o.unbind(s)},n.clear=i=>{const s=e(i);r(s)}})(Qa||(Qa={}));class Po{constructor(t={}){this.comparator=t.comparator||Po.defaultComparator,this.index={},this.data=t.data||[],this.heapify()}isEmpty(){return this.data.length===0}insert(t,e,r){const i={priority:t,value:e},s=this.data.length;return r&&(i.id=r,this.index[r]=s),this.data.push(i),this.bubbleUp(s),this}peek(){return this.data[0]?this.data[0].value:null}peekPriority(){return this.data[0]?this.data[0].priority:null}updatePriority(t,e){const r=this.index[t];if(typeof r>"u")throw new Error(`Node with id '${t}' was not found in the heap.`);const i=this.data,s=i[r].priority,o=this.comparator(e,s);o<0?(i[r].priority=e,this.bubbleUp(r)):o>0&&(i[r].priority=e,this.bubbleDown(r))}remove(){const t=this.data,e=t[0],r=t.pop();return e.id&&delete this.index[e.id],t.length>0&&(t[0]=r,r.id&&(this.index[r.id]=0),this.bubbleDown(0)),e?e.value:null}heapify(){for(let t=0;t<this.data.length;t+=1)this.bubbleUp(t)}bubbleUp(t){const e=this.data;let r,i,s=t;for(;s>0&&(i=s-1>>>1,this.comparator(e[s].priority,e[i].priority)<0);){r=e[i],e[i]=e[s];let o=e[s].id;o!=null&&(this.index[o]=i),e[s]=r,o=e[s].id,o!=null&&(this.index[o]=s),s=i}}bubbleDown(t){const e=this.data,r=e.length-1;let i=t;for(;;){const s=(i<<1)+1,o=s+1;let a=i;if(s<=r&&this.comparator(e[s].priority,e[a].priority)<0&&(a=s),o<=r&&this.comparator(e[o].priority,e[a].priority)<0&&(a=o),a!==i){const c=e[a];e[a]=e[i];let l=e[i].id;l!=null&&(this.index[l]=a),e[i]=c,l=e[i].id,l!=null&&(this.index[l]=i),i=a}else break}}}(function(n){n.defaultComparator=(t,e)=>t-e})(Po||(Po={}));var Au;(function(n){function t(e,r,i=(s,o)=>1){const s={},o={},a={},c=new Po;for(s[r]=0,Object.keys(e).forEach(l=>{l!==r&&(s[l]=1/0),c.insert(s[l],l,l)});!c.isEmpty();){const l=c.remove();a[l]=!0;const u=e[l]||[];for(let f=0;f<u.length;f+=1){const h=u[f];if(!a[h]){const d=s[l]+i(l,h);d<s[h]&&(s[h]=d,o[h]=l,c.updatePriority(h,d))}}}return o}n.run=t})(Au||(Au={}));class Cr{constructor(t,e,r,i){if(t==null)return this.set(255,255,255,1);if(typeof t=="number")return this.set(t,e,r,i);if(typeof t=="string")return Cr.fromString(t)||this;if(Array.isArray(t))return this.set(t);this.set(t.r,t.g,t.b,t.a==null?1:t.a)}blend(t,e,r){this.set(t.r+(e.r-t.r)*r,t.g+(e.g-t.g)*r,t.b+(e.b-t.b)*r,t.a+(e.a-t.a)*r)}lighten(t){const e=Cr.lighten(this.toArray(),t);this.r=e[0],this.g=e[1],this.b=e[2],this.a=e[3]}darken(t){this.lighten(-t)}set(t,e,r,i){const s=Array.isArray(t)?t[0]:t,o=Array.isArray(t)?t[1]:e,a=Array.isArray(t)?t[2]:r,c=Array.isArray(t)?t[3]:i;return this.r=Math.round(Bn(s,0,255)),this.g=Math.round(Bn(o,0,255)),this.b=Math.round(Bn(a,0,255)),this.a=c==null?1:Bn(c,0,1),this}toHex(){return`#${["r","g","b"].map(e=>{const r=this[e].toString(16);return r.length<2?`0${r}`:r}).join("")}`}toRGBA(){return this.toArray()}toHSLA(){return Cr.rgba2hsla(this.r,this.g,this.b,this.a)}toCSS(t){const e=`${this.r},${this.g},${this.b},`;return t?`rgb(${e})`:`rgba(${e},${this.a})`}toGrey(){return Cr.makeGrey(Math.round((this.r+this.g+this.b)/3),this.a)}toArray(){return[this.r,this.g,this.b,this.a]}toString(){return this.toCSS()}}(function(n){function t(y){return new n(y)}n.fromArray=t;function e(y){return new n([...p(y),1])}n.fromHex=e;function r(y){const O=y.toLowerCase().match(/^rgba?\(([\s.,0-9]+)\)/);if(O){const I=O[1].split(/\s*,\s*/).map(G=>parseInt(G,10));return new n(I)}return null}n.fromRGBA=r;function i(y,O,I){I<0&&++I,I>1&&--I;const G=6*I;return G<1?y+(O-y)*G:2*I<1?O:3*I<2?y+(O-y)*(2/3-I)*6:y}function s(y){const O=y.toLowerCase().match(/^hsla?\(([\s.,0-9]+)\)/);if(O){const I=O[2].split(/\s*,\s*/),G=(parseFloat(I[0])%360+360)%360/360,k=parseFloat(I[1])/100,X=parseFloat(I[2])/100,Z=I[3]==null?1:parseInt(I[3],10);return new n(l(G,k,X,Z))}return null}n.fromHSLA=s;function o(y){if(y.startsWith("#"))return e(y);if(y.startsWith("rgb"))return r(y);const O=n.named[y];return O?e(O):s(y)}n.fromString=o;function a(y,O){return n.fromArray([y,y,y,O])}n.makeGrey=a;function c(y,O,I,G){const k=Array.isArray(y)?y[0]:y,X=Array.isArray(y)?y[1]:O,Z=Array.isArray(y)?y[2]:I,at=Array.isArray(y)?y[3]:G,ft=Math.max(k,X,Z),H=Math.min(k,X,Z),Ut=(ft+H)/2;let zt=0,W=0;if(H!==ft){const lt=ft-H;switch(W=Ut>.5?lt/(2-ft-H):lt/(ft+H),ft){case k:zt=(X-Z)/lt+(X<Z?6:0);break;case X:zt=(Z-k)/lt+2;break;case Z:zt=(k-X)/lt+4;break}zt/=6}return[zt,W,Ut,at??1]}n.rgba2hsla=c;function l(y,O,I,G){const k=Array.isArray(y)?y[0]:y,X=Array.isArray(y)?y[1]:O,Z=Array.isArray(y)?y[2]:I,at=Array.isArray(y)?y[3]:G,ft=Z<=.5?Z*(X+1):Z+X-Z*X,H=2*Z-ft;return[i(H,ft,k+1/3)*256,i(H,ft,k)*256,i(H,ft,k-1/3)*256,at??1]}n.hsla2rgba=l;function u(y){return new n(Math.round(Math.random()*256),Math.round(Math.random()*256),Math.round(Math.random()*256),y?void 0:parseFloat(Math.random().toFixed(2)))}n.random=u;function f(){const y="0123456789ABCDEF";let O="#";for(let I=0;I<6;I+=1)O+=y[Math.floor(Math.random()*16)];return O}n.randomHex=f;function h(y){return u(y).toString()}n.randomRGBA=h;function d(y,O){if(typeof y=="string"){const Z=y[0]==="#",[at,ft,H]=p(y);return O?at*.299+ft*.587+H*.114>186?"#000000":"#ffffff":`${Z?"#":""}${m(255-at,255-ft,255-H)}`}const I=y[0],G=y[1],k=y[2],X=y[3];return O?I*.299+G*.587+k*.114>186?[0,0,0,X]:[255,255,255,X]:[255-I,255-G,255-k,X]}n.invert=d;function p(y){const O=y.indexOf("#")===0?y:`#${y}`;let I=+`0x${O.substr(1)}`;if(!(O.length===4||O.length===7)||Number.isNaN(I))throw new Error("Invalid hex color.");const G=O.length===4?4:8,k=(1<<G)-1,X=["b","g","r"].map(()=>{const Z=I&k;return I>>=G,G===4?17*Z:Z});return[X[2],X[1],X[0]]}function m(y,O,I){const G=k=>k.length<2?`0${k}`:k;return`${G(y.toString(16))}${G(O.toString(16))}${G(I.toString(16))}`}function b(y,O){return E(y,O)}n.lighten=b;function v(y,O){return E(y,-O)}n.darken=v;function E(y,O){if(typeof y=="string"){const k=y[0]==="#",X=parseInt(k?y.substr(1):y,16),Z=Bn((X>>16)+O,0,255),at=Bn((X>>8&255)+O,0,255),ft=Bn((X&255)+O,0,255);return`${k?"#":""}${(ft|at<<8|Z<<16).toString(16)}`}const I=m(y[0],y[1],y[2]),G=p(E(I,O));return[G[0],G[1],G[2],y[3]]}})(Cr||(Cr={}));(function(n){n.named={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",burntsienna:"#ea7e5d",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}})(Cr||(Cr={}));class Su{constructor(){this.clear()}clear(){this.map=new WeakMap,this.arr=[]}has(t){return this.map.has(t)}get(t){return this.map.get(t)}set(t,e){this.map.set(t,e),this.arr.push(t)}delete(t){const e=this.arr.indexOf(t);e>=0&&this.arr.splice(e,1);const r=this.map.get(t);return this.map.delete(t),r}each(t){this.arr.forEach(e=>{const r=this.map.get(e);t(r,e)})}dispose(){this.clear()}}var Yr;(function(n){function t(i){const s=[],o=[];return Array.isArray(i)?s.push(...i):i.split("|").forEach(a=>{a.indexOf("&")===-1?s.push(a):o.push(...a.split("&"))}),{or:s,and:o}}n.parse=t;function e(i,s){if(i!=null&&s!=null){const o=t(i),a=t(s),c=o.or.sort(),l=a.or.sort(),u=o.and.sort(),f=a.and.sort(),h=(d,p)=>d.length===p.length&&(d.length===0||d.every((m,b)=>m===p[b]));return h(c,l)&&h(u,f)}return i==null&&s==null}n.equals=e;function r(i,s,o){if(s==null||Array.isArray(s)&&s.length===0)return o?i.altKey!==!0&&i.ctrlKey!==!0&&i.metaKey!==!0&&i.shiftKey!==!0:!0;const{or:a,and:c}=t(s),l=u=>{const f=`${u.toLowerCase()}Key`;return i[f]===!0};return a.some(u=>l(u))&&c.every(u=>l(u))}n.isMatch=r})(Yr||(Yr={}));var Ni;(function(n){n.linear=t=>t,n.quad=t=>t*t,n.cubic=t=>t*t*t,n.inout=t=>{if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)},n.exponential=t=>Math.pow(2,10*(t-1)),n.bounce=t=>{for(let e=0,r=1;;e+=r,r/=2)if(t>=(7-4*e)/11){const i=(11-6*e-11*t)/4;return-i*i+r*r}}})(Ni||(Ni={}));(function(n){n.decorators={reverse(t){return e=>1-t(1-e)},reflect(t){return e=>.5*(e<.5?t(2*e):2-t(2-2*e))},clamp(t,e=0,r=1){return i=>{const s=t(i);return s<e?e:s>r?r:s}},back(t=1.70158){return e=>e*e*((t+1)*e-t)},elastic(t=1.5){return e=>Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*t/3*e)}}})(Ni||(Ni={}));(function(n){function t(W){return-1*Math.cos(W*(Math.PI/2))+1}n.easeInSine=t;function e(W){return Math.sin(W*(Math.PI/2))}n.easeOutSine=e;function r(W){return-.5*(Math.cos(Math.PI*W)-1)}n.easeInOutSine=r;function i(W){return W*W}n.easeInQuad=i;function s(W){return W*(2-W)}n.easeOutQuad=s;function o(W){return W<.5?2*W*W:-1+(4-2*W)*W}n.easeInOutQuad=o;function a(W){return W*W*W}n.easeInCubic=a;function c(W){const lt=W-1;return lt*lt*lt+1}n.easeOutCubic=c;function l(W){return W<.5?4*W*W*W:(W-1)*(2*W-2)*(2*W-2)+1}n.easeInOutCubic=l;function u(W){return W*W*W*W}n.easeInQuart=u;function f(W){const lt=W-1;return 1-lt*lt*lt*lt}n.easeOutQuart=f;function h(W){const lt=W-1;return W<.5?8*W*W*W*W:1-8*lt*lt*lt*lt}n.easeInOutQuart=h;function d(W){return W*W*W*W*W}n.easeInQuint=d;function p(W){const lt=W-1;return 1+lt*lt*lt*lt*lt}n.easeOutQuint=p;function m(W){const lt=W-1;return W<.5?16*W*W*W*W*W:1+16*lt*lt*lt*lt*lt}n.easeInOutQuint=m;function b(W){return W===0?0:Math.pow(2,10*(W-1))}n.easeInExpo=b;function v(W){return W===1?1:-Math.pow(2,-10*W)+1}n.easeOutExpo=v;function E(W){if(W===0||W===1)return W;const lt=W*2,Rt=lt-1;return lt<1?.5*Math.pow(2,10*Rt):.5*(-Math.pow(2,-10*Rt)+2)}n.easeInOutExpo=E;function y(W){const lt=W/1;return-1*(Math.sqrt(1-lt*W)-1)}n.easeInCirc=y;function O(W){const lt=W-1;return Math.sqrt(1-lt*lt)}n.easeOutCirc=O;function I(W){const lt=W*2,Rt=lt-2;return lt<1?-.5*(Math.sqrt(1-lt*lt)-1):.5*(Math.sqrt(1-Rt*Rt)+1)}n.easeInOutCirc=I;function G(W,lt=1.70158){return W*W*((lt+1)*W-lt)}n.easeInBack=G;function k(W,lt=1.70158){const Rt=W/1-1;return Rt*Rt*((lt+1)*Rt+lt)+1}n.easeOutBack=k;function X(W,lt=1.70158){const Rt=W*2,Xt=Rt-2,ot=lt*1.525;return Rt<1?.5*Rt*Rt*((ot+1)*Rt-ot):.5*(Xt*Xt*((ot+1)*Xt+ot)+2)}n.easeInOutBack=X;function Z(W,lt=.7){if(W===0||W===1)return W;const Xt=W/1-1,ot=1-lt,et=ot/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*Xt)*Math.sin((Xt-et)*(2*Math.PI)/ot))}n.easeInElastic=Z;function at(W,lt=.7){const Rt=1-lt,Xt=W*2;if(W===0||W===1)return W;const ot=Rt/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*Xt)*Math.sin((Xt-ot)*(2*Math.PI)/Rt)+1}n.easeOutElastic=at;function ft(W,lt=.65){const Rt=1-lt;if(W===0||W===1)return W;const Xt=W*2,ot=Xt-1,et=Rt/(2*Math.PI)*Math.asin(1);return Xt<1?-.5*(Math.pow(2,10*ot)*Math.sin((ot-et)*(2*Math.PI)/Rt)):Math.pow(2,-10*ot)*Math.sin((ot-et)*(2*Math.PI)/Rt)*.5+1}n.easeInOutElastic=ft;function H(W){const lt=W/1;if(lt<1/2.75)return 7.5625*lt*lt;if(lt<2/2.75){const Rt=lt-.5454545454545454;return 7.5625*Rt*Rt+.75}if(lt<2.5/2.75){const Rt=lt-.8181818181818182;return 7.5625*Rt*Rt+.9375}{const Rt=lt-.9545454545454546;return 7.5625*Rt*Rt+.984375}}n.easeOutBounce=H;function Ut(W){return 1-H(1-W)}n.easeInBounce=Ut;function zt(W){return W<.5?Ut(W*2)*.5:H(W*2-1)*.5+.5}n.easeInOutBounce=zt})(Ni||(Ni={}));var Si;(function(n){n.number=(t,e)=>{const r=e-t;return i=>t+r*i},n.object=(t,e)=>{const r=Object.keys(t);return i=>{const s={};for(let o=r.length-1;o!==-1;o-=1){const a=r[o];s[a]=t[a]+(e[a]-t[a])*i}return s}},n.unit=(t,e)=>{const r=/(-?[0-9]*.[0-9]*)(px|em|cm|mm|in|pt|pc|%)/,i=r.exec(t),s=r.exec(e),o=s?s[1]:"",a=i?+i[1]:0,c=s?+s[1]:0,l=o.indexOf("."),u=l>0?o[1].length-l-1:0,f=c-a,h=i?i[2]:"";return d=>(a+f*d).toFixed(u)+h},n.color=(t,e)=>{const r=parseInt(t.slice(1),16),i=parseInt(e.slice(1),16),s=r&255,o=(i&255)-s,a=r&65280,c=(i&65280)-a,l=r&16711680,u=(i&16711680)-l;return f=>{const h=s+o*f&255,d=a+c*f&65280,p=l+u*f&16711680;return`#${(1<<24|h|d|p).toString(16).slice(1)}`}}})(Si||(Si={}));const mo=[];function ks(n,t){const e=mo.find(r=>r.name===n);if(!(e&&(e.loadTimes+=1,e.loadTimes>1))&&!Wr.isApplyingHMR()){const r=document.createElement("style");r.setAttribute("type","text/css"),r.textContent=t;const i=document.querySelector("head");i&&i.insertBefore(r,i.firstChild),mo.push({name:n,loadTimes:1,styleElement:r})}}function Bs(n){const t=mo.findIndex(e=>e.name===n);if(t>-1){const e=mo[t];if(e.loadTimes-=1,e.loadTimes>0)return;let r=e.styleElement;r&&r.parentNode&&r.parentNode.removeChild(r),r=null,mo.splice(t,1)}}var Te;(function(n){function t(r){return 180*r/Math.PI%360}n.toDeg=t,n.toRad=function(r,i=!1){return(i?r:r%360)*Math.PI/180};function e(r){return r%360+(r<0?360:0)}n.normalize=e})(Te||(Te={}));var _e;(function(n){function t(a,c=0){return Number.isInteger(a)?a:+a.toFixed(c)}n.round=t;function e(a,c){let l,u;if(c==null?(u=a??1,l=0):(u=c,l=a??0),u<l){const f=l;l=u,u=f}return Math.floor(Math.random()*(u-l+1)+l)}n.random=e;function r(a,c,l){return Number.isNaN(a)?NaN:Number.isNaN(c)||Number.isNaN(l)?0:c<l?a<c?c:a>l?l:a:a<l?l:a>c?c:a}n.clamp=r;function i(a,c){return c*Math.round(a/c)}n.snapToGrid=i;function s(a,c){return c!=null&&a!=null&&c.x>=a.x&&c.x<=a.x+a.width&&c.y>=a.y&&c.y<=a.y+a.height}n.containsPoint=s;function o(a,c){const l=a.x-c.x,u=a.y-c.y;return l*l+u*u}n.squaredLength=o})(_e||(_e={}));class ri{valueOf(){return this.toJSON()}toString(){return JSON.stringify(this.toJSON())}}class R extends ri{constructor(t,e){super(),this.x=t??0,this.y=e??0}round(t=0){return this.x=_e.round(this.x,t),this.y=_e.round(this.y,t),this}add(t,e){const r=R.create(t,e);return this.x+=r.x,this.y+=r.y,this}update(t,e){const r=R.create(t,e);return this.x=r.x,this.y=r.y,this}translate(t,e){const r=R.create(t,e);return this.x+=r.x,this.y+=r.y,this}rotate(t,e){const r=R.rotate(this,t,e);return this.x=r.x,this.y=r.y,this}scale(t,e,r=new R){const i=R.create(r);return this.x=i.x+t*(this.x-i.x),this.y=i.y+e*(this.y-i.y),this}closest(t){if(t.length===1)return R.create(t[0]);let e=null,r=1/0;return t.forEach(i=>{const s=this.squaredDistance(i);s<r&&(e=i,r=s)}),e?R.create(e):null}distance(t){return Math.sqrt(this.squaredDistance(t))}squaredDistance(t){const e=R.create(t),r=this.x-e.x,i=this.y-e.y;return r*r+i*i}manhattanDistance(t){const e=R.create(t);return Math.abs(e.x-this.x)+Math.abs(e.y-this.y)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)||.01}theta(t=new R){const e=R.create(t),r=-(e.y-this.y),i=e.x-this.x;let s=Math.atan2(r,i);return s<0&&(s=2*Math.PI+s),180*s/Math.PI}angleBetween(t,e){if(this.equals(t)||this.equals(e))return NaN;let r=this.theta(e)-this.theta(t);return r<0&&(r+=360),r}vectorAngle(t){return new R(0,0).angleBetween(this,t)}toPolar(t){return this.update(R.toPolar(this,t)),this}changeInAngle(t,e,r=new R){return this.clone().translate(-t,-e).theta(r)-this.theta(r)}adhereToRect(t){return _e.containsPoint(t,this)||(this.x=Math.min(Math.max(this.x,t.x),t.x+t.width),this.y=Math.min(Math.max(this.y,t.y),t.y+t.height)),this}bearing(t){const e=R.create(t),r=Te.toRad(this.y),i=Te.toRad(e.y),s=this.x,o=e.x,a=Te.toRad(o-s),c=Math.sin(a)*Math.cos(i),l=Math.cos(r)*Math.sin(i)-Math.sin(r)*Math.cos(i)*Math.cos(a),u=Te.toDeg(Math.atan2(c,l)),f=["NE","E","SE","S","SW","W","NW","N"];let h=u-22.5;return h<0&&(h+=360),h=parseInt(h/45,10),f[h]}cross(t,e){if(t!=null&&e!=null){const r=R.create(t),i=R.create(e);return(i.x-this.x)*(r.y-this.y)-(i.y-this.y)*(r.x-this.x)}return NaN}dot(t){const e=R.create(t);return this.x*e.x+this.y*e.y}diff(t,e){if(typeof t=="number")return new R(this.x-t,this.y-e);const r=R.create(t);return new R(this.x-r.x,this.y-r.y)}lerp(t,e){const r=R.create(t);return new R((1-e)*this.x+e*r.x,(1-e)*this.y+e*r.y)}normalize(t=1){const e=t/this.magnitude();return this.scale(e,e)}move(t,e){const r=R.create(t),i=Te.toRad(r.theta(this));return this.translate(Math.cos(i)*e,-Math.sin(i)*e)}reflection(t){return R.create(t).move(this,this.distance(t))}snapToGrid(t,e){return this.x=_e.snapToGrid(this.x,t),this.y=_e.snapToGrid(this.y,e??t),this}equals(t){const e=R.create(t);return e!=null&&e.x===this.x&&e.y===this.y}clone(){return R.clone(this)}toJSON(){return R.toJSON(this)}serialize(){return`${this.x} ${this.y}`}}(function(n){function t(e){return e!=null&&e instanceof n}n.isPoint=t})(R||(R={}));(function(n){function t(r){return r!=null&&typeof r=="object"&&typeof r.x=="number"&&typeof r.y=="number"}n.isPointLike=t;function e(r){return r!=null&&Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}n.isPointData=e})(R||(R={}));(function(n){function t(f,h){return f==null||typeof f=="number"?new n(f,h):e(f)}n.create=t;function e(f){return n.isPoint(f)?new n(f.x,f.y):Array.isArray(f)?new n(f[0],f[1]):new n(f.x,f.y)}n.clone=e;function r(f){return n.isPoint(f)?{x:f.x,y:f.y}:Array.isArray(f)?{x:f[0],y:f[1]}:{x:f.x,y:f.y}}n.toJSON=r;function i(f,h,d=new n){let p=Math.abs(f*Math.cos(h)),m=Math.abs(f*Math.sin(h));const b=e(d),v=Te.normalize(Te.toDeg(h));return v<90?m=-m:v<180?(p=-p,m=-m):v<270&&(p=-p),new n(b.x+p,b.y+m)}n.fromPolar=i;function s(f,h=new n){const d=e(f),p=e(h),m=d.x-p.x,b=d.y-p.y;return new n(Math.sqrt(m*m+b*b),Te.toRad(p.theta(d)))}n.toPolar=s;function o(f,h){return f===h?!0:f!=null&&h!=null?f.x===h.x&&f.y===h.y:!1}n.equals=o;function a(f,h){if(f==null&&h!=null||f!=null&&h==null||f!=null&&h!=null&&f.length!==h.length)return!1;if(f!=null&&h!=null){for(let d=0,p=f.length;d<p;d+=1)if(!o(f[d],h[d]))return!1}return!0}n.equalPoints=a;function c(f,h,d,p){return new n(_e.random(f,h),_e.random(d,p))}n.random=c;function l(f,h,d){const p=Te.toRad(Te.normalize(-h)),m=Math.sin(p),b=Math.cos(p);return u(f,b,m,d)}n.rotate=l;function u(f,h,d,p=new n){const m=e(f),b=e(p),v=m.x-b.x,E=m.y-b.y,y=v*h-E*d,O=E*h+v*d;return new n(y+b.x,O+b.y)}n.rotateEx=u})(R||(R={}));class Bt extends ri{get left(){return this.x}get top(){return this.y}get right(){return this.x+this.width}get bottom(){return this.y+this.height}get origin(){return new R(this.x,this.y)}get topLeft(){return new R(this.x,this.y)}get topCenter(){return new R(this.x+this.width/2,this.y)}get topRight(){return new R(this.x+this.width,this.y)}get center(){return new R(this.x+this.width/2,this.y+this.height/2)}get bottomLeft(){return new R(this.x,this.y+this.height)}get bottomCenter(){return new R(this.x+this.width/2,this.y+this.height)}get bottomRight(){return new R(this.x+this.width,this.y+this.height)}get corner(){return new R(this.x+this.width,this.y+this.height)}get rightMiddle(){return new R(this.x+this.width,this.y+this.height/2)}get leftMiddle(){return new R(this.x,this.y+this.height/2)}get topLine(){return new Ht(this.topLeft,this.topRight)}get rightLine(){return new Ht(this.topRight,this.bottomRight)}get bottomLine(){return new Ht(this.bottomLeft,this.bottomRight)}get leftLine(){return new Ht(this.topLeft,this.bottomLeft)}constructor(t,e,r,i){super(),this.x=t??0,this.y=e??0,this.width=r??0,this.height=i??0}getOrigin(){return this.origin}getTopLeft(){return this.topLeft}getTopCenter(){return this.topCenter}getTopRight(){return this.topRight}getCenter(){return this.center}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}getBottomLeft(){return this.bottomLeft}getBottomCenter(){return this.bottomCenter}getBottomRight(){return this.bottomRight}getCorner(){return this.corner}getRightMiddle(){return this.rightMiddle}getLeftMiddle(){return this.leftMiddle}getTopLine(){return this.topLine}getRightLine(){return this.rightLine}getBottomLine(){return this.bottomLine}getLeftLine(){return this.leftLine}bbox(t){if(!t)return this.clone();const e=Te.toRad(t),r=Math.abs(Math.sin(e)),i=Math.abs(Math.cos(e)),s=this.width*i+this.height*r,o=this.width*r+this.height*i;return new Bt(this.x+(this.width-s)/2,this.y+(this.height-o)/2,s,o)}round(t=0){return this.x=_e.round(this.x,t),this.y=_e.round(this.y,t),this.width=_e.round(this.width,t),this.height=_e.round(this.height,t),this}add(t,e,r,i){const s=Bt.create(t,e,r,i),o=Math.min(this.x,s.x),a=Math.min(this.y,s.y),c=Math.max(this.x+this.width,s.x+s.width),l=Math.max(this.y+this.height,s.y+s.height);return this.x=o,this.y=a,this.width=c-o,this.height=l-a,this}update(t,e,r,i){const s=Bt.create(t,e,r,i);return this.x=s.x,this.y=s.y,this.width=s.width,this.height=s.height,this}inflate(t,e){const r=t,i=e??t;return this.x-=r,this.y-=i,this.width+=2*r,this.height+=2*i,this}snapToGrid(t,e){const r=this.origin.snapToGrid(t,e),i=this.corner.snapToGrid(t,e);return this.x=r.x,this.y=r.y,this.width=i.x-r.x,this.height=i.y-r.y,this}translate(t,e){const r=R.create(t,e);return this.x+=r.x,this.y+=r.y,this}scale(t,e,r=new R){const i=this.origin.scale(t,e,r);return this.x=i.x,this.y=i.y,this.width*=t,this.height*=e,this}rotate(t,e=this.getCenter()){if(t!==0){const r=Te.toRad(t),i=Math.cos(r),s=Math.sin(r);let o=this.getOrigin(),a=this.getTopRight(),c=this.getBottomRight(),l=this.getBottomLeft();o=R.rotateEx(o,i,s,e),a=R.rotateEx(a,i,s,e),c=R.rotateEx(c,i,s,e),l=R.rotateEx(l,i,s,e);const u=new Bt(o.x,o.y,0,0);u.add(a.x,a.y,0,0),u.add(c.x,c.y,0,0),u.add(l.x,l.y,0,0),this.update(u)}return this}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;return this.width=this.height,this.height=e,this}moveAndExpand(t){const e=Bt.clone(t);return this.x+=e.x||0,this.y+=e.y||0,this.width+=e.width||0,this.height+=e.height||0,this}getMaxScaleToFit(t,e=this.center){const r=Bt.clone(t),i=e.x,s=e.y;let o=1/0,a=1/0,c=1/0,l=1/0,u=1/0,f=1/0,h=1/0,d=1/0;const p=r.topLeft;p.x<i&&(o=(this.x-i)/(p.x-i)),p.y<s&&(u=(this.y-s)/(p.y-s));const m=r.bottomRight;m.x>i&&(a=(this.x+this.width-i)/(m.x-i)),m.y>s&&(f=(this.y+this.height-s)/(m.y-s));const b=r.topRight;b.x>i&&(c=(this.x+this.width-i)/(b.x-i)),b.y<s&&(h=(this.y-s)/(b.y-s));const v=r.bottomLeft;return v.x<i&&(l=(this.x-i)/(v.x-i)),v.y>s&&(d=(this.y+this.height-s)/(v.y-s)),{sx:Math.min(o,a,c,l),sy:Math.min(u,f,h,d)}}getMaxUniformScaleToFit(t,e=this.center){const r=this.getMaxScaleToFit(t,e);return Math.min(r.sx,r.sy)}containsPoint(t,e){return _e.containsPoint(this,R.create(t,e))}containsRect(t,e,r,i){const s=Bt.create(t,e,r,i),o=this.x,a=this.y,c=this.width,l=this.height,u=s.x,f=s.y,h=s.width,d=s.height;return c===0||l===0||h===0||d===0?!1:u>=o&&f>=a&&u+h<=o+c&&f+d<=a+l}intersectsWithLine(t){const e=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],r=[],i=[];return e.forEach(s=>{const o=t.intersectsWithLine(s);o!==null&&i.indexOf(o.toString())<0&&(r.push(o),i.push(o.toString()))}),r.length>0?r:null}intersectsWithLineFromCenterToPoint(t,e){const r=R.clone(t),i=this.center;let s=null;e!=null&&e!==0&&r.rotate(e,i);const o=[this.topLine,this.rightLine,this.bottomLine,this.leftLine],a=new Ht(i,r);for(let c=o.length-1;c>=0;c-=1){const l=o[c].intersectsWithLine(a);if(l!==null){s=l;break}}return s&&e!=null&&e!==0&&s.rotate(-e,i),s}intersectsWithRect(t,e,r,i){const s=Bt.create(t,e,r,i);if(!this.isIntersectWithRect(s))return null;const o=this.origin,a=this.corner,c=s.origin,l=s.corner,u=Math.max(o.x,c.x),f=Math.max(o.y,c.y);return new Bt(u,f,Math.min(a.x,l.x)-u,Math.min(a.y,l.y)-f)}isIntersectWithRect(t,e,r,i){const s=Bt.create(t,e,r,i),o=this.origin,a=this.corner,c=s.origin,l=s.corner;return!(l.x<=o.x||l.y<=o.y||c.x>=a.x||c.y>=a.y)}normalize(){let t=this.x,e=this.y,r=this.width,i=this.height;return this.width<0&&(t=this.x+this.width,r=-this.width),this.height<0&&(e=this.y+this.height,i=-this.height),this.x=t,this.y=e,this.width=r,this.height=i,this}union(t){const e=Bt.clone(t),r=this.origin,i=this.corner,s=e.origin,o=e.corner,a=Math.min(r.x,s.x),c=Math.min(r.y,s.y),l=Math.max(i.x,o.x),u=Math.max(i.y,o.y);return new Bt(a,c,l-a,u-c)}getNearestSideToPoint(t){const e=R.clone(t),r=e.x-this.x,i=this.x+this.width-e.x,s=e.y-this.y,o=this.y+this.height-e.y;let a=r,c="left";return i<a&&(a=i,c="right"),s<a&&(a=s,c="top"),o<a&&(c="bottom"),c}getNearestPointToPoint(t){const e=R.clone(t);if(this.containsPoint(e)){const r=this.getNearestSideToPoint(e);if(r==="left")return new R(this.x,e.y);if(r==="top")return new R(e.x,this.y);if(r==="right")return new R(this.x+this.width,e.y);if(r==="bottom")return new R(e.x,this.y+this.height)}return e.adhereToRect(this)}equals(t){return t!=null&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new Bt(this.x,this.y,this.width,this.height)}toJSON(){return{x:this.x,y:this.y,width:this.width,height:this.height}}serialize(){return`${this.x} ${this.y} ${this.width} ${this.height}`}}(function(n){function t(e){return e!=null&&e instanceof n}n.isRectangle=t})(Bt||(Bt={}));(function(n){function t(e){return e!=null&&typeof e=="object"&&typeof e.x=="number"&&typeof e.y=="number"&&typeof e.width=="number"&&typeof e.height=="number"}n.isRectangleLike=t})(Bt||(Bt={}));(function(n){function t(o,a,c,l){return o==null||typeof o=="number"?new n(o,a,c,l):e(o)}n.create=t;function e(o){return n.isRectangle(o)?o.clone():Array.isArray(o)?new n(o[0],o[1],o[2],o[3]):new n(o.x,o.y,o.width,o.height)}n.clone=e;function r(o){return new n(o.x-o.a,o.y-o.b,2*o.a,2*o.b)}n.fromEllipse=r;function i(o){return new n(0,0,o.width,o.height)}n.fromSize=i;function s(o,a){return new n(o.x,o.y,a.width,a.height)}n.fromPositionAndSize=s})(Bt||(Bt={}));class Ht extends ri{get center(){return new R((this.start.x+this.end.x)/2,(this.start.y+this.end.y)/2)}constructor(t,e,r,i){super(),typeof t=="number"&&typeof e=="number"?(this.start=new R(t,e),this.end=new R(r,i)):(this.start=R.create(t),this.end=R.create(e))}getCenter(){return this.center}round(t=0){return this.start.round(t),this.end.round(t),this}translate(t,e){return typeof t=="number"?(this.start.translate(t,e),this.end.translate(t,e)):(this.start.translate(t),this.end.translate(t)),this}rotate(t,e){return this.start.rotate(t,e),this.end.rotate(t,e),this}scale(t,e,r){return this.start.scale(t,e,r),this.end.scale(t,e,r),this}length(){return Math.sqrt(this.squaredLength())}squaredLength(){const t=this.start.x-this.end.x,e=this.start.y-this.end.y;return t*t+e*e}setLength(t){const e=this.length();if(!e)return this;const r=t/e;return this.scale(r,r,this.start)}parallel(t){const e=this.clone();if(!e.isDifferentiable())return e;const{start:r,end:i}=e,s=r.clone().rotate(270,i),o=i.clone().rotate(90,r);return r.move(o,t),i.move(s,t),e}vector(){return new R(this.end.x-this.start.x,this.end.y-this.start.y)}angle(){const t=new R(this.start.x+1,this.start.y);return this.start.angleBetween(this.end,t)}bbox(){const t=Math.min(this.start.x,this.end.x),e=Math.min(this.start.y,this.end.y),r=Math.max(this.start.x,this.end.x),i=Math.max(this.start.y,this.end.y);return new Bt(t,e,r-t,i-e)}bearing(){return this.start.bearing(this.end)}closestPoint(t){return this.pointAt(this.closestPointNormalizedLength(t))}closestPointLength(t){return this.closestPointNormalizedLength(t)*this.length()}closestPointTangent(t){return this.tangentAt(this.closestPointNormalizedLength(t))}closestPointNormalizedLength(t){const e=this.vector().dot(new Ht(this.start,t).vector()),r=Math.min(1,Math.max(0,e/this.squaredLength()));return Number.isNaN(r)?0:r}pointAt(t){const e=this.start,r=this.end;return t<=0?e.clone():t>=1?r.clone():e.lerp(r,t)}pointAtLength(t){const e=this.start,r=this.end;let i=!0;t<0&&(i=!1,t=-t);const s=this.length();if(t>=s)return i?r.clone():e.clone();const o=(i?t:s-t)/s;return this.pointAt(o)}divideAt(t){const e=this.pointAt(t);return[new Ht(this.start,e),new Ht(e,this.end)]}divideAtLength(t){const e=this.pointAtLength(t);return[new Ht(this.start,e),new Ht(e,this.end)]}containsPoint(t){const e=this.start,r=this.end;if(e.cross(t,r)!==0)return!1;const i=this.length();return!(new Ht(e,t).length()>i||new Ht(t,r).length()>i)}intersect(t,e){const r=t.intersectsWithLine(this,e);return r?Array.isArray(r)?r:[r]:null}intersectsWithLine(t){const e=new R(this.end.x-this.start.x,this.end.y-this.start.y),r=new R(t.end.x-t.start.x,t.end.y-t.start.y),i=e.x*r.y-e.y*r.x,s=new R(t.start.x-this.start.x,t.start.y-this.start.y),o=s.x*r.y-s.y*r.x,a=s.x*e.y-s.y*e.x;if(i===0||o*i<0||a*i<0)return null;if(i>0){if(o>i||a>i)return null}else if(o<i||a<i)return null;return new R(this.start.x+o*e.x/i,this.start.y+o*e.y/i)}isDifferentiable(){return!this.start.equals(this.end)}pointOffset(t){const e=R.clone(t),r=this.start,i=this.end;return((i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x))/this.length()}pointSquaredDistance(t,e){const r=R.create(t,e);return this.closestPoint(r).squaredDistance(r)}pointDistance(t,e){const r=R.create(t,e);return this.closestPoint(r).distance(r)}tangentAt(t){if(!this.isDifferentiable())return null;const e=this.start,r=this.end,i=this.pointAt(t),s=new Ht(e,r);return s.translate(i.x-e.x,i.y-e.y),s}tangentAtLength(t){if(!this.isDifferentiable())return null;const e=this.start,r=this.end,i=this.pointAtLength(t),s=new Ht(e,r);return s.translate(i.x-e.x,i.y-e.y),s}relativeCcw(t,e){const r=R.create(t,e);let i=r.x-this.start.x,s=r.y-this.start.y;const o=this.end.x-this.start.x,a=this.end.y-this.start.y;let c=i*a-s*o;return c===0&&(c=i*o+s*a,c>0&&(i-=o,s-=a,c=i*o+s*a,c<0&&(c=0))),c<0?-1:c>0?1:0}equals(t){return t!=null&&this.start.x===t.start.x&&this.start.y===t.start.y&&this.end.x===t.end.x&&this.end.y===t.end.y}clone(){return new Ht(this.start,this.end)}toJSON(){return{start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.end.serialize()].join(" ")}}(function(n){function t(e){return e!=null&&e instanceof n}n.isLine=t})(Ht||(Ht={}));class ir extends ri{get center(){return new R(this.x,this.y)}constructor(t,e,r,i){super(),this.x=t??0,this.y=e??0,this.a=r??0,this.b=i??0}bbox(){return Bt.fromEllipse(this)}getCenter(){return this.center}inflate(t,e){const r=t,i=e??t;return this.a+=2*r,this.b+=2*i,this}normalizedDistance(t,e){const r=R.create(t,e),i=r.x-this.x,s=r.y-this.y,o=this.a,a=this.b;return i*i/(o*o)+s*s/(a*a)}containsPoint(t,e){return this.normalizedDistance(t,e)<=1}intersectsWithLine(t){const e=[],r=this.a,i=this.b,s=t.start,o=t.end,a=t.vector(),c=s.diff(new R(this.x,this.y)),l=new R(a.x/(r*r),a.y/(i*i)),u=new R(c.x/(r*r),c.y/(i*i)),f=a.dot(l),h=a.dot(u),d=c.dot(u)-1,p=h*h-f*d;if(p<0)return null;if(p>0){const m=Math.sqrt(p),b=(-h-m)/f,v=(-h+m)/f;if((b<0||b>1)&&(v<0||v>1))return null;b>=0&&b<=1&&e.push(s.lerp(o,b)),v>=0&&v<=1&&e.push(s.lerp(o,v))}else{const m=-h/f;if(m>=0&&m<=1)e.push(s.lerp(o,m));else return null}return e}intersectsWithLineFromCenterToPoint(t,e=0){const r=R.clone(t);e&&r.rotate(e,this.getCenter());const i=r.x-this.x,s=r.y-this.y;let o;if(i===0)return o=this.bbox().getNearestPointToPoint(r),e?o.rotate(-e,this.getCenter()):o;const a=s/i,c=a*a,l=this.a*this.a,u=this.b*this.b;let f=Math.sqrt(1/(1/l+c/u));f=i<0?-f:f;const h=a*f;return o=new R(this.x+f,this.y+h),e?o.rotate(-e,this.getCenter()):o}tangentTheta(t){const e=R.clone(t),r=e.x,i=e.y,s=this.a,o=this.b,a=this.bbox().center,c=a.x,l=a.y,u=30,f=r>a.x+s/2,h=r<a.x-s/2;let d,p;return f||h?(p=r>a.x?i-u:i+u,d=s*s/(r-c)-s*s*(i-l)*(p-l)/(o*o*(r-c))+c):(d=i>a.y?r+u:r-u,p=o*o/(i-l)-o*o*(r-c)*(d-c)/(s*s*(i-l))+l),new R(d,p).theta(e)}scale(t,e){return this.a*=t,this.b*=e,this}rotate(t,e){const r=Bt.fromEllipse(this);r.rotate(t,e);const i=ir.fromRect(r);return this.a=i.a,this.b=i.b,this.x=i.x,this.y=i.y,this}translate(t,e){const r=R.create(t,e);return this.x+=r.x,this.y+=r.y,this}equals(t){return t!=null&&t.x===this.x&&t.y===this.y&&t.a===this.a&&t.b===this.b}clone(){return new ir(this.x,this.y,this.a,this.b)}toJSON(){return{x:this.x,y:this.y,a:this.a,b:this.b}}serialize(){return`${this.x} ${this.y} ${this.a} ${this.b}`}}(function(n){function t(e){return e!=null&&e instanceof n}n.isEllipse=t})(ir||(ir={}));(function(n){function t(i,s,o,a){return i==null||typeof i=="number"?new n(i,s,o,a):e(i)}n.create=t;function e(i){return n.isEllipse(i)?i.clone():Array.isArray(i)?new n(i[0],i[1],i[2],i[3]):new n(i.x,i.y,i.a,i.b)}n.parse=e;function r(i){const s=i.center;return new n(s.x,s.y,i.width/2,i.height/2)}n.fromRect=r})(ir||(ir={}));const uP=new RegExp("^[\\s\\dLMCZz,.]*$");function hP(n){return typeof n!="string"?!1:uP.test(n)}function Jl(n,t){return(n%t+t)%t}function fP(n,t,e,r,i){const s=[],o=n[n.length-1],a=t!=null&&t>0,c=t||0;if(r&&a){n=n.slice();const f=n[0],h=new R(o.x+(f.x-o.x)/2,o.y+(f.y-o.y)/2);n.splice(0,0,h)}let l=n[0],u=1;for(e?s.push("M",l.x,l.y):s.push("L",l.x,l.y);u<(r?n.length:n.length-1);){let f=n[Jl(u,n.length)],h=l.x-f.x,d=l.y-f.y;if(a&&(h!==0||d!==0)&&(i==null||i.indexOf(u-1)<0)){let p=Math.sqrt(h*h+d*d);const m=h*Math.min(c,p/2)/p,b=d*Math.min(c,p/2)/p,v=f.x+m,E=f.y+b;s.push("L",v,E);let y=n[Jl(u+1,n.length)];for(;u<n.length-2&&Math.round(y.x-f.x)===0&&Math.round(y.y-f.y)===0;)y=n[Jl(u+2,n.length)],u+=1;h=y.x-f.x,d=y.y-f.y,p=Math.max(1,Math.sqrt(h*h+d*d));const O=h*Math.min(c,p/2)/p,I=d*Math.min(c,p/2)/p,G=f.x+O,k=f.y+I;s.push("Q",f.x,f.y,G,k),f=new R(G,k)}else s.push("L",f.x,f.y);l=f,u+=1}return r?s.push("Z"):s.push("L",o.x,o.y),s.map(f=>typeof f=="string"?f:+f.toFixed(3)).join(" ")}function Vb(n,t={}){const e=[];return n&&n.length&&n.forEach(r=>{Array.isArray(r)?e.push({x:r[0],y:r[1]}):e.push({x:r.x,y:r.y})}),fP(e,t.round,t.initialMove==null||t.initialMove,t.close,t.exclude)}function tc(n,t,e,r,i=0,s=0,o=0,a,c){if(e===0||r===0)return[];a-=n,c-=t,e=Math.abs(e),r=Math.abs(r);const l=-a/2,u=-c/2,f=Math.cos(i*Math.PI/180),h=Math.sin(i*Math.PI/180),d=f*l+h*u,p=-1*h*l+f*u,m=d*d,b=p*p,v=e*e,E=r*r,y=m/v+b/E;let O;if(y>1)e=Math.sqrt(y)*e,r=Math.sqrt(y)*r,O=0;else{let ee=1;s===o&&(ee=-1),O=ee*Math.sqrt((v*E-v*b-E*m)/(v*b+E*m))}const I=O*e*p/r,G=-1*O*r*d/e,k=f*I-h*G+a/2,X=h*I+f*G+c/2;let Z=Math.atan2((p-G)/r,(d-I)/e)-Math.atan2(0,1),at=Z>=0?Z:2*Math.PI+Z;Z=Math.atan2((-p-G)/r,(-d-I)/e)-Math.atan2((p-G)/r,(d-I)/e);let ft=Z>=0?Z:2*Math.PI+Z;o===0&&ft>0?ft-=2*Math.PI:o!==0&&ft<0&&(ft+=2*Math.PI);const H=ft*2/Math.PI,Ut=Math.ceil(H<0?-1*H:H),zt=ft/Ut,W=8/3*Math.sin(zt/4)*Math.sin(zt/4)/Math.sin(zt/2),lt=f*e,Rt=f*r,Xt=h*e,ot=h*r;let et=Math.cos(at),K=Math.sin(at),Ct=-W*(lt*K+ot*et),Lt=-W*(Xt*K-Rt*et),Ot=0,re=0;const be=[];for(let ee=0;ee<Ut;ee+=1){at+=zt,et=Math.cos(at),K=Math.sin(at),Ot=lt*et-ot*K+k,re=Xt*et+Rt*K+X;const Oe=-W*(lt*K+ot*et),Zt=-W*(Xt*K-Rt*et),Yt=ee*6;be[Yt]=Number(Ct+n),be[Yt+1]=Number(Lt+t),be[Yt+2]=Number(Ot-Oe+n),be[Yt+3]=Number(re-Zt+t),be[Yt+4]=Number(Ot+n),be[Yt+5]=Number(re+t),Ct=Ot+Oe,Lt=re+Zt}return be.map(ee=>+ee.toFixed(2))}function dP(n,t,e,r,i=0,s=0,o=0,a,c){const l=[],u=tc(n,t,e,r,i,s,o,a,c);if(u!=null)for(let f=0,h=u.length;f<h;f+=6)l.push("C",u[f],u[f+1],u[f+2],u[f+3],u[f+4],u[f+5]);return l.join(" ")}class en extends ri{get start(){return this.points[0]||null}get end(){return this.points[this.points.length-1]||null}constructor(t){if(super(),t!=null){if(typeof t=="string")return en.parse(t);this.points=t.map(e=>R.create(e))}else this.points=[]}scale(t,e,r=new R){return this.points.forEach(i=>i.scale(t,e,r)),this}rotate(t,e){return this.points.forEach(r=>r.rotate(t,e)),this}translate(t,e){const r=R.create(t,e);return this.points.forEach(i=>i.translate(r.x,r.y)),this}round(t=0){return this.points.forEach(e=>e.round(t)),this}bbox(){if(this.points.length===0)return new Bt;let t=1/0,e=-1/0,r=1/0,i=-1/0;const s=this.points;for(let o=0,a=s.length;o<a;o+=1){const c=s[o],l=c.x,u=c.y;l<t&&(t=l),l>e&&(e=l),u<r&&(r=u),u>i&&(i=u)}return new Bt(t,r,e-t,i-r)}closestPoint(t){const e=this.closestPointLength(t);return this.pointAtLength(e)}closestPointLength(t){const e=this.points,r=e.length;if(r===0||r===1)return 0;let i=0,s=0,o=1/0;for(let a=0,c=r-1;a<c;a+=1){const l=new Ht(e[a],e[a+1]),u=l.length(),f=l.closestPointNormalizedLength(t),d=l.pointAt(f).squaredDistance(t);d<o&&(o=d,s=i+f*u),i+=u}return s}closestPointNormalizedLength(t){const e=this.length();return e===0?0:this.closestPointLength(t)/e}closestPointTangent(t){const e=this.closestPointLength(t);return this.tangentAtLength(e)}containsPoint(t){if(this.points.length===0)return!1;const e=R.clone(t),r=e.x,i=e.y,s=this.points,o=s.length;let a=o-1,c=0;for(let l=0;l<o;l+=1){const u=s[a],f=s[l];if(e.equals(u))return!0;const h=new Ht(u,f);if(h.containsPoint(t))return!0;if(i<=u.y&&i>f.y||i>u.y&&i<=f.y){const d=u.x-r>f.x-r?u.x-r:f.x-r;if(d>=0){const p=new R(r+d,i),m=new Ht(t,p);h.intersectsWithLine(m)&&(c+=1)}}a=l}return c%2===1}intersectsWithLine(t){const e=[];for(let r=0,i=this.points.length-1;r<i;r+=1){const s=this.points[r],o=this.points[r+1],a=t.intersectsWithLine(new Ht(s,o));a&&e.push(a)}return e.length>0?e:null}isDifferentiable(){for(let t=0,e=this.points.length-1;t<e;t+=1){const r=this.points[t],i=this.points[t+1];if(new Ht(r,i).isDifferentiable())return!0}return!1}length(){let t=0;for(let e=0,r=this.points.length-1;e<r;e+=1){const i=this.points[e],s=this.points[e+1];t+=i.distance(s)}return t}pointAt(t){const e=this.points,r=e.length;if(r===0)return null;if(r===1||t<=0)return e[0].clone();if(t>=1)return e[r-1].clone();const s=this.length()*t;return this.pointAtLength(s)}pointAtLength(t){const e=this.points,r=e.length;if(r===0)return null;if(r===1)return e[0].clone();let i=!0;t<0&&(i=!1,t=-t);let s=0;for(let a=0,c=r-1;a<c;a+=1){const l=i?a:c-1-a,u=e[l],f=e[l+1],h=new Ht(u,f),d=u.distance(f);if(t<=s+d)return h.pointAtLength((i?1:-1)*(t-s));s+=d}return(i?e[r-1]:e[0]).clone()}tangentAt(t){const r=this.points.length;if(r===0||r===1)return null;t<0&&(t=0),t>1&&(t=1);const s=this.length()*t;return this.tangentAtLength(s)}tangentAtLength(t){const e=this.points,r=e.length;if(r===0||r===1)return null;let i=!0;t<0&&(i=!1,t=-t);let s,o=0;for(let a=0,c=r-1;a<c;a+=1){const l=i?a:c-1-a,u=e[l],f=e[l+1],h=new Ht(u,f),d=u.distance(f);if(h.isDifferentiable()){if(t<=o+d)return h.tangentAtLength((i?1:-1)*(t-o));s=h}o+=d}if(s){const a=i?1:0;return s.tangentAt(a)}return null}simplify(t={}){const e=this.points;if(e.length<3)return this;const r=t.threshold||0;let i=0;for(;e[i+2];){const s=i,o=i+1,a=i+2,c=e[s],l=e[o],u=e[a];new Ht(c,u).closestPoint(l).distance(l)<=r?e.splice(o,1):i+=1}return this}toHull(){const t=this.points,e=t.length;if(e===0)return new en;let r=t[0];for(let h=1;h<e;h+=1)(t[h].y<r.y||t[h].y===r.y&&t[h].x>r.x)&&(r=t[h]);const i=[];for(let h=0;h<e;h+=1){let d=r.theta(t[h]);d===0&&(d=360),i.push([t[h],h,d])}if(i.sort((h,d)=>{let p=h[2]-d[2];return p===0&&(p=d[1]-h[1]),p}),i.length>2){const h=i[i.length-1];i.unshift(h)}const s={},o=[],a=h=>`${h[0].toString()}@${h[1]}`;for(;i.length!==0;){const h=i.pop(),d=h[0];if(s[a(h)])continue;let p=!1;for(;!p;)if(o.length<2)o.push(h),p=!0;else{const m=o.pop(),b=m[0],v=o.pop(),E=v[0],y=E.cross(b,d);if(y<0)o.push(v),o.push(m),o.push(h),p=!0;else if(y===0){const I=b.angleBetween(E,d);Math.abs(I-180)<1e-10||b.equals(d)||E.equals(b)?(s[a(m)]=b,o.push(v)):Math.abs((I+1)%360-1)<1e-10&&(o.push(v),i.push(m))}else s[a(m)]=b,o.push(v)}}o.length>2&&o.pop();let c,l=-1;for(let h=0,d=o.length;h<d;h+=1){const p=o[h][1];(c===void 0||p<c)&&(c=p,l=h)}let u=[];if(l>0){const h=o.slice(l),d=o.slice(0,l);u=h.concat(d)}else u=o;const f=[];for(let h=0,d=u.length;h<d;h+=1)f.push(u[h][0]);return new en(f)}equals(t){return t==null||t.points.length!==this.points.length?!1:t.points.every((e,r)=>e.equals(this.points[r]))}clone(){return new en(this.points.map(t=>t.clone()))}toJSON(){return this.points.map(t=>t.toJSON())}serialize(){return this.points.map(t=>`${t.serialize()}`).join(" ")}}(function(n){function t(e){return e!=null&&e instanceof n}n.isPolyline=t})(en||(en={}));(function(n){function t(e){const r=e.trim();if(r==="")return new n;const i=[],s=r.split(/\s*,\s*|\s+/);for(let o=0,a=s.length;o<a;o+=2)i.push({x:+s[o],y:+s[o+1]});return new n(i)}n.parse=t})(en||(en={}));class Ye extends ri{constructor(t,e,r,i){super(),this.PRECISION=3,this.start=R.create(t),this.controlPoint1=R.create(e),this.controlPoint2=R.create(r),this.end=R.create(i)}bbox(){const t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end,s=t.x,o=t.y,a=e.x,c=e.y,l=r.x,u=r.y,f=i.x,h=i.y,d=[],p=[[],[]];let m,b,v,E,y,O,I,G;for(let lt=0;lt<2;lt+=1){if(lt===0?(b=6*s-12*a+6*l,m=-3*s+9*a-9*l+3*f,v=3*a-3*s):(b=6*o-12*c+6*u,m=-3*o+9*c-9*u+3*h,v=3*c-3*o),Math.abs(m)<1e-12){if(Math.abs(b)<1e-12)continue;E=-v/b,E>0&&E<1&&d.push(E);continue}I=b*b-4*v*m,G=Math.sqrt(I),!(I<0)&&(y=(-b+G)/(2*m),y>0&&y<1&&d.push(y),O=(-b-G)/(2*m),O>0&&O<1&&d.push(O))}let k,X,Z,at=d.length;const ft=at;for(;at;)at-=1,E=d[at],Z=1-E,k=Z*Z*Z*s+3*Z*Z*E*a+3*Z*E*E*l+E*E*E*f,p[0][at]=k,X=Z*Z*Z*o+3*Z*Z*E*c+3*Z*E*E*u+E*E*E*h,p[1][at]=X;d[ft]=0,d[ft+1]=1,p[0][ft]=s,p[1][ft]=o,p[0][ft+1]=f,p[1][ft+1]=h,d.length=ft+2,p[0].length=ft+2,p[1].length=ft+2;const H=Math.min.apply(null,p[0]),Ut=Math.min.apply(null,p[1]),zt=Math.max.apply(null,p[0]),W=Math.max.apply(null,p[1]);return new Bt(H,Ut,zt-H,W-Ut)}closestPoint(t,e={}){return this.pointAtT(this.closestPointT(t,e))}closestPointLength(t,e={}){const r=this.getOptions(e);return this.lengthAtT(this.closestPointT(t,r),r)}closestPointNormalizedLength(t,e={}){const r=this.getOptions(e),i=this.closestPointLength(t,r);if(!i)return 0;const s=this.length(r);return s===0?0:i/s}closestPointT(t,e={}){const r=this.getPrecision(e),i=this.getDivisions(e),s=Math.pow(10,-r);let o=null,a=0,c=0,l=0,u=0,f=0,h=null;const d=i.length;let p=d>0?1/d:0;for(i.forEach((m,b)=>{const v=m.start.distance(t),E=m.end.distance(t),y=v+E;(h==null||y<h)&&(o=m,a=b*p,c=(b+1)*p,l=v,u=E,h=y,f=m.endpointDistance())});;){const m=l?Math.abs(l-u)/l:0,b=u!=null?Math.abs(l-u)/u:0,v=m<s||b<s,E=l?l<f*s:!0,y=u?u<f*s:!0;if(v||(E||y))return l<=u?a:c;const I=o.divide(.5);p/=2;const G=I[0].start.distance(t),k=I[0].end.distance(t),X=G+k,Z=I[1].start.distance(t),at=I[1].end.distance(t),ft=Z+at;X<=ft?(o=I[0],c-=p,l=G,u=k):(o=I[1],a+=p,l=Z,u=at)}}closestPointTangent(t,e={}){return this.tangentAtT(this.closestPointT(t,e))}containsPoint(t,e={}){return this.toPolyline(e).containsPoint(t)}divideAt(t,e={}){if(t<=0)return this.divideAtT(0);if(t>=1)return this.divideAtT(1);const r=this.tAt(t,e);return this.divideAtT(r)}divideAtLength(t,e={}){const r=this.tAtLength(t,e);return this.divideAtT(r)}divide(t){return this.divideAtT(t)}divideAtT(t){const e=this.start,r=this.controlPoint1,i=this.controlPoint2,s=this.end;if(t<=0)return[new Ye(e,e,e,e),new Ye(e,r,i,s)];if(t>=1)return[new Ye(e,r,i,s),new Ye(s,s,s,s)];const o=this.getSkeletonPoints(t),a=o.startControlPoint1,c=o.startControlPoint2,l=o.divider,u=o.dividerControlPoint1,f=o.dividerControlPoint2;return[new Ye(e,a,c,l),new Ye(l,u,f,s)]}endpointDistance(){return this.start.distance(this.end)}getSkeletonPoints(t){const e=this.start,r=this.controlPoint1,i=this.controlPoint2,s=this.end;if(t<=0)return{startControlPoint1:e.clone(),startControlPoint2:e.clone(),divider:e.clone(),dividerControlPoint1:r.clone(),dividerControlPoint2:i.clone()};if(t>=1)return{startControlPoint1:r.clone(),startControlPoint2:i.clone(),divider:s.clone(),dividerControlPoint1:s.clone(),dividerControlPoint2:s.clone()};const o=new Ht(e,r).pointAt(t),a=new Ht(r,i).pointAt(t),c=new Ht(i,s).pointAt(t),l=new Ht(o,a).pointAt(t),u=new Ht(a,c).pointAt(t),f=new Ht(l,u).pointAt(t);return{startControlPoint1:o,startControlPoint2:l,divider:f,dividerControlPoint1:u,dividerControlPoint2:c}}getSubdivisions(t={}){const e=this.getPrecision(t);let r=[new Ye(this.start,this.controlPoint1,this.controlPoint2,this.end)];if(e===0)return r;let i=this.endpointDistance();const s=Math.pow(10,-e);let o=0;for(;;){o+=1;const a=[];r.forEach(u=>{const f=u.divide(.5);a.push(f[0],f[1])});const c=a.reduce((u,f)=>u+f.endpointDistance(),0),l=c!==0?(c-i)/c:0;if(o>1&&l<s)return a;r=a,i=c}}length(t={}){return this.getDivisions(t).reduce((r,i)=>r+i.endpointDistance(),0)}lengthAtT(t,e={}){if(t<=0)return 0;const r=e.precision===void 0?this.PRECISION:e.precision;return this.divide(t)[0].length({precision:r})}pointAt(t,e={}){if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();const r=this.tAt(t,e);return this.pointAtT(r)}pointAtLength(t,e={}){const r=this.tAtLength(t,e);return this.pointAtT(r)}pointAtT(t){return t<=0?this.start.clone():t>=1?this.end.clone():this.getSkeletonPoints(t).divider}isDifferentiable(){const t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end;return!(t.equals(e)&&e.equals(r)&&r.equals(i))}tangentAt(t,e={}){if(!this.isDifferentiable())return null;t<0?t=0:t>1&&(t=1);const r=this.tAt(t,e);return this.tangentAtT(r)}tangentAtLength(t,e={}){if(!this.isDifferentiable())return null;const r=this.tAtLength(t,e);return this.tangentAtT(r)}tangentAtT(t){if(!this.isDifferentiable())return null;t<0&&(t=0),t>1&&(t=1);const e=this.getSkeletonPoints(t),r=e.startControlPoint2,i=e.dividerControlPoint1,s=e.divider,o=new Ht(r,i);return o.translate(s.x-r.x,s.y-r.y),o}getPrecision(t={}){return t.precision==null?this.PRECISION:t.precision}getDivisions(t={}){if(t.subdivisions!=null)return t.subdivisions;const e=this.getPrecision(t);return this.getSubdivisions({precision:e})}getOptions(t={}){const e=this.getPrecision(t),r=this.getDivisions(t);return{precision:e,subdivisions:r}}tAt(t,e={}){if(t<=0)return 0;if(t>=1)return 1;const r=this.getOptions(e),s=this.length(r)*t;return this.tAtLength(s,r)}tAtLength(t,e={}){let r=!0;t<0&&(r=!1,t=-t);const i=this.getPrecision(e),s=this.getDivisions(e),o={precision:i,subdivisions:s};let a=null,c,l,u=0,f=0,h=0;const d=s.length;let p=d>0?1/d:0;for(let v=0;v<d;v+=1){const E=r?v:d-1-v,y=s[v],O=y.endpointDistance();if(t<=h+O){a=y,c=E*p,l=(E+1)*p,u=r?t-h:O+h-t,f=r?O+h-t:t-h;break}h+=O}if(a==null)return r?1:0;const m=this.length(o),b=Math.pow(10,-i);for(;;){let v;if(v=m!==0?u/m:0,v<b)return c;if(v=m!==0?f/m:0,v<b)return l;let E,y;const O=a.divide(.5);p/=2;const I=O[0].endpointDistance(),G=O[1].endpointDistance();u<=I?(a=O[0],l-=p,E=u,y=I-E):(a=O[1],c+=p,E=u-I,y=G-E),u=E,f=y}}toPoints(t={}){const e=this.getDivisions(t),r=[e[0].start.clone()];return e.forEach(i=>r.push(i.end.clone())),r}toPolyline(t={}){return new en(this.toPoints(t))}scale(t,e,r){return this.start.scale(t,e,r),this.controlPoint1.scale(t,e,r),this.controlPoint2.scale(t,e,r),this.end.scale(t,e,r),this}rotate(t,e){return this.start.rotate(t,e),this.controlPoint1.rotate(t,e),this.controlPoint2.rotate(t,e),this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?(this.start.translate(t,e),this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e)):(this.start.translate(t),this.controlPoint1.translate(t),this.controlPoint2.translate(t),this.end.translate(t)),this}equals(t){return t!=null&&this.start.equals(t.start)&&this.controlPoint1.equals(t.controlPoint1)&&this.controlPoint2.equals(t.controlPoint2)&&this.end.equals(t.end)}clone(){return new Ye(this.start,this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){return[this.start.serialize(),this.controlPoint1.serialize(),this.controlPoint2.serialize(),this.end.serialize()].join(" ")}}(function(n){function t(e){return e!=null&&e instanceof n}n.isCurve=t})(Ye||(Ye={}));(function(n){function t(i){const s=i.length,o=[],a=[];let c=2;o[0]=i[0]/c;for(let l=1;l<s;l+=1)a[l]=1/c,c=(l<s-1?4:3.5)-a[l],o[l]=(i[l]-o[l-1])/c;for(let l=1;l<s;l+=1)o[s-l-1]-=a[s-l]*o[s-l];return o}function e(i){const s=i.map(h=>R.clone(h)),o=[],a=[],c=s.length-1;if(c===1)return o[0]=new R((2*s[0].x+s[1].x)/3,(2*s[0].y+s[1].y)/3),a[0]=new R(2*o[0].x-s[0].x,2*o[0].y-s[0].y),[o,a];const l=[];for(let h=1;h<c-1;h+=1)l[h]=4*s[h].x+2*s[h+1].x;l[0]=s[0].x+2*s[1].x,l[c-1]=(8*s[c-1].x+s[c].x)/2;const u=t(l);for(let h=1;h<c-1;h+=1)l[h]=4*s[h].y+2*s[h+1].y;l[0]=s[0].y+2*s[1].y,l[c-1]=(8*s[c-1].y+s[c].y)/2;const f=t(l);for(let h=0;h<c;h+=1)o.push(new R(u[h],f[h])),h<c-1?a.push(new R(2*s[h+1].x-u[h+1],2*s[h+1].y-f[h+1])):a.push(new R((s[c].x+u[c-1])/2,(s[c].y+f[c-1])/2));return[o,a]}function r(i){if(i==null||Array.isArray(i)&&i.length<2)throw new Error("At least 2 points are required");const s=e(i),o=[];for(let a=0,c=s[0].length;a<c;a+=1){const l=new R(s[0][a].x,s[0][a].y),u=new R(s[1][a].x,s[1][a].y);o.push(new n(i[a],l,u,i[a+1]))}return o}n.throughPoints=r})(Ye||(Ye={}));class _c extends ri{constructor(){super(...arguments),this.isVisible=!0,this.isSegment=!0,this.isSubpathStart=!1}get end(){return this.endPoint}get start(){if(this.previousSegment==null)throw new Error("Missing previous segment. (This segment cannot be the first segment of a path, or segment has not yet been added to a path.)");return this.previousSegment.end}closestPointT(t,e){if(this.closestPointNormalizedLength)return this.closestPointNormalizedLength(t);throw new Error("Neither `closestPointT` nor `closestPointNormalizedLength` method is implemented.")}lengthAtT(t,e){if(t<=0)return 0;const r=this.length();return t>=1?r:r*t}divideAtT(t){if(this.divideAt)return this.divideAt(t);throw new Error("Neither `divideAtT` nor `divideAt` method is implemented.")}pointAtT(t){if(this.pointAt)return this.pointAt(t);throw new Error("Neither `pointAtT` nor `pointAt` method is implemented.")}tangentAtT(t){if(this.tangentAt)return this.tangentAt(t);throw new Error("Neither `tangentAtT` nor `tangentAt` method is implemented.")}}class On extends _c{constructor(t,e){super(),Ht.isLine(t)?this.endPoint=t.end.clone().round(2):this.endPoint=R.create(t,e).round(2)}get type(){return"L"}get line(){return new Ht(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(t){return this.line.closestPoint(t)}closestPointLength(t){return this.line.closestPointLength(t)}closestPointNormalizedLength(t){return this.line.closestPointNormalizedLength(t)}closestPointTangent(t){return this.line.closestPointTangent(t)}length(){return this.line.length()}divideAt(t){const e=this.line.divideAt(t);return[new On(e[0]),new On(e[1])]}divideAtLength(t){const e=this.line.divideAtLength(t);return[new On(e[0]),new On(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.line.pointAt(t)}pointAtLength(t){return this.line.pointAtLength(t)}tangentAt(t){return this.line.tangentAt(t)}tangentAtLength(t){return this.line.tangentAtLength(t)}isDifferentiable(){return this.previousSegment==null?!1:!this.start.equals(this.end)}clone(){return new On(this.end)}scale(t,e,r){return this.end.scale(t,e,r),this}rotate(t,e){return this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?this.end.translate(t,e):this.end.translate(t),this}equals(t){return this.type===t.type&&this.start.equals(t.start)&&this.end.equals(t.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){const t=this.end;return`${this.type} ${t.x} ${t.y}`}}(function(n){function t(...e){const r=e.length,i=e[0];if(Ht.isLine(i))return new n(i);if(R.isPointLike(i))return r===1?new n(i):e.map(o=>new n(o));if(r===2)return new n(+e[0],+e[1]);const s=[];for(let o=0;o<r;o+=2){const a=+e[o],c=+e[o+1];s.push(new n(a,c))}return s}n.create=t})(On||(On={}));class ms extends _c{get end(){if(!this.subpathStartSegment)throw new Error("Missing subpath start segment. (This segment needs a subpath start segment (e.g. MoveTo), or segment has not yet been added to a path.)");return this.subpathStartSegment.end}get type(){return"Z"}get line(){return new Ht(this.start,this.end)}bbox(){return this.line.bbox()}closestPoint(t){return this.line.closestPoint(t)}closestPointLength(t){return this.line.closestPointLength(t)}closestPointNormalizedLength(t){return this.line.closestPointNormalizedLength(t)}closestPointTangent(t){return this.line.closestPointTangent(t)}length(){return this.line.length()}divideAt(t){const e=this.line.divideAt(t);return[e[1].isDifferentiable()?new On(e[0]):this.clone(),new On(e[1])]}divideAtLength(t){const e=this.line.divideAtLength(t);return[e[1].isDifferentiable()?new On(e[0]):this.clone(),new On(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.line.pointAt(t)}pointAtLength(t){return this.line.pointAtLength(t)}tangentAt(t){return this.line.tangentAt(t)}tangentAtLength(t){return this.line.tangentAtLength(t)}isDifferentiable(){return!this.previousSegment||!this.subpathStartSegment?!1:!this.start.equals(this.end)}scale(){return this}rotate(){return this}translate(){return this}equals(t){return this.type===t.type&&this.start.equals(t.start)&&this.end.equals(t.end)}clone(){return new ms}toJSON(){return{type:this.type,start:this.start.toJSON(),end:this.end.toJSON()}}serialize(){return this.type}}(function(n){function t(){return new n}n.create=t})(ms||(ms={}));class bs extends _c{constructor(t,e){super(),this.isVisible=!1,this.isSubpathStart=!0,Ht.isLine(t)||Ye.isCurve(t)?this.endPoint=t.end.clone().round(2):this.endPoint=R.create(t,e).round(2)}get start(){throw new Error("Illegal access. Moveto segments should not need a start property.")}get type(){return"M"}bbox(){return null}closestPoint(){return this.end.clone()}closestPointLength(){return 0}closestPointNormalizedLength(){return 0}closestPointT(){return 1}closestPointTangent(){return null}length(){return 0}lengthAtT(){return 0}divideAt(){return[this.clone(),this.clone()]}divideAtLength(){return[this.clone(),this.clone()]}getSubdivisions(){return[]}pointAt(){return this.end.clone()}pointAtLength(){return this.end.clone()}pointAtT(){return this.end.clone()}tangentAt(){return null}tangentAtLength(){return null}tangentAtT(){return null}isDifferentiable(){return!1}scale(t,e,r){return this.end.scale(t,e,r),this}rotate(t,e){return this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?this.end.translate(t,e):this.end.translate(t),this}clone(){return new bs(this.end)}equals(t){return this.type===t.type&&this.end.equals(t.end)}toJSON(){return{type:this.type,end:this.end.toJSON()}}serialize(){const t=this.end;return`${this.type} ${t.x} ${t.y}`}}(function(n){function t(...e){const r=e.length,i=e[0];if(Ht.isLine(i))return new n(i);if(Ye.isCurve(i))return new n(i);if(R.isPointLike(i)){if(r===1)return new n(i);const o=[];for(let a=0;a<r;a+=1)a===0?o.push(new n(e[a])):o.push(new On(e[a]));return o}if(r===2)return new n(+e[0],+e[1]);const s=[];for(let o=0;o<r;o+=2){const a=+e[o],c=+e[o+1];o===0?s.push(new n(a,c)):s.push(new On(a,c))}return s}n.create=t})(bs||(bs={}));class Wn extends _c{constructor(t,e,r,i,s,o){super(),Ye.isCurve(t)?(this.controlPoint1=t.controlPoint1.clone().round(2),this.controlPoint2=t.controlPoint2.clone().round(2),this.endPoint=t.end.clone().round(2)):typeof t=="number"?(this.controlPoint1=new R(t,e).round(2),this.controlPoint2=new R(r,i).round(2),this.endPoint=new R(s,o).round(2)):(this.controlPoint1=R.create(t).round(2),this.controlPoint2=R.create(e).round(2),this.endPoint=R.create(r).round(2))}get type(){return"C"}get curve(){return new Ye(this.start,this.controlPoint1,this.controlPoint2,this.end)}bbox(){return this.curve.bbox()}closestPoint(t){return this.curve.closestPoint(t)}closestPointLength(t){return this.curve.closestPointLength(t)}closestPointNormalizedLength(t){return this.curve.closestPointNormalizedLength(t)}closestPointTangent(t){return this.curve.closestPointTangent(t)}length(){return this.curve.length()}divideAt(t,e={}){const r=this.curve.divideAt(t,e);return[new Wn(r[0]),new Wn(r[1])]}divideAtLength(t,e={}){const r=this.curve.divideAtLength(t,e);return[new Wn(r[0]),new Wn(r[1])]}divideAtT(t){const e=this.curve.divideAtT(t);return[new Wn(e[0]),new Wn(e[1])]}getSubdivisions(){return[]}pointAt(t){return this.curve.pointAt(t)}pointAtLength(t){return this.curve.pointAtLength(t)}tangentAt(t){return this.curve.tangentAt(t)}tangentAtLength(t){return this.curve.tangentAtLength(t)}isDifferentiable(){if(!this.previousSegment)return!1;const t=this.start,e=this.controlPoint1,r=this.controlPoint2,i=this.end;return!(t.equals(e)&&e.equals(r)&&r.equals(i))}scale(t,e,r){return this.controlPoint1.scale(t,e,r),this.controlPoint2.scale(t,e,r),this.end.scale(t,e,r),this}rotate(t,e){return this.controlPoint1.rotate(t,e),this.controlPoint2.rotate(t,e),this.end.rotate(t,e),this}translate(t,e){return typeof t=="number"?(this.controlPoint1.translate(t,e),this.controlPoint2.translate(t,e),this.end.translate(t,e)):(this.controlPoint1.translate(t),this.controlPoint2.translate(t),this.end.translate(t)),this}equals(t){return this.start.equals(t.start)&&this.end.equals(t.end)&&this.controlPoint1.equals(t.controlPoint1)&&this.controlPoint2.equals(t.controlPoint2)}clone(){return new Wn(this.controlPoint1,this.controlPoint2,this.end)}toJSON(){return{type:this.type,start:this.start.toJSON(),controlPoint1:this.controlPoint1.toJSON(),controlPoint2:this.controlPoint2.toJSON(),end:this.end.toJSON()}}serialize(){const t=this.controlPoint1,e=this.controlPoint2,r=this.end;return[this.type,t.x,t.y,e.x,e.y,r.x,r.y].join(" ")}}(function(n){function t(...e){const r=e.length,i=e[0];if(Ye.isCurve(i))return new n(i);if(R.isPointLike(i)){if(r===3)return new n(e[0],e[1],e[2]);const o=[];for(let a=0;a<r;a+=3)o.push(new n(e[a],e[a+1],e[a+2]));return o}if(r===6)return new n(e[0],e[1],e[2],e[3],e[4],e[5]);const s=[];for(let o=0;o<r;o+=6)s.push(new n(e[o],e[o+1],e[o+2],e[o+3],e[o+4],e[o+5]));return s}n.create=t})(Wn||(Wn={}));function Ra(n,t,e){return{x:n*Math.cos(e)-t*Math.sin(e),y:n*Math.sin(e)+t*Math.cos(e)}}function Kp(n,t,e,r,i,s){const o=.3333333333333333,a=2/3;return[o*n+a*e,o*t+a*r,o*i+a*e,o*s+a*r,i,s]}function $b(n,t,e,r,i,s,o,a,c,l){const u=Math.PI*120/180,f=Math.PI/180*(+i||0);let h=[],d,p,m,b,v;if(l)p=l[0],m=l[1],b=l[2],v=l[3];else{d=Ra(n,t,-f),n=d.x,t=d.y,d=Ra(a,c,-f),a=d.x,c=d.y;const zt=(n-a)/2,W=(t-c)/2;let lt=zt*zt/(e*e)+W*W/(r*r);lt>1&&(lt=Math.sqrt(lt),e=lt*e,r=lt*r);const Rt=e*e,Xt=r*r,ot=(s===o?-1:1)*Math.sqrt(Math.abs((Rt*Xt-Rt*W*W-Xt*zt*zt)/(Rt*W*W+Xt*zt*zt)));b=ot*e*W/r+(n+a)/2,v=ot*-r*zt/e+(t+c)/2,p=Math.asin((t-v)/r),m=Math.asin((c-v)/r),p=n<b?Math.PI-p:p,m=a<b?Math.PI-m:m,p<0&&(p=Math.PI*2+p),m<0&&(m=Math.PI*2+m),o&&p>m&&(p-=Math.PI*2),!o&&m>p&&(m-=Math.PI*2)}let E=m-p;if(Math.abs(E)>u){const zt=m,W=a,lt=c;m=p+u*(o&&m>p?1:-1),a=b+e*Math.cos(m),c=v+r*Math.sin(m),h=$b(a,c,e,r,i,0,o,W,lt,[m,zt,b,v])}E=m-p;const y=Math.cos(p),O=Math.sin(p),I=Math.cos(m),G=Math.sin(m),k=Math.tan(E/4),X=4/3*(e*k),Z=4/3*(r*k),at=[n,t],ft=[n+X*O,t-Z*y],H=[a+X*G,c-Z*I],Ut=[a,c];if(ft[0]=2*at[0]-ft[0],ft[1]=2*at[1]-ft[1],l)return[ft,H,Ut].concat(h);{h=[ft,H,Ut].concat(h).join().split(",");const zt=[],W=h.length;for(let lt=0;lt<W;lt+=1)zt[lt]=lt%2?Ra(+h[lt-1],+h[lt],f).y:Ra(+h[lt],+h[lt+1],f).x;return zt}}function pP(n){if(!n)return null;const t=`	
\v\f\r   ᠎             　\u2028\u2029`,e=new RegExp(`([a-z])[${t},]*((-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?[${t}]*,?[${t}]*)+)`,"ig"),r=new RegExp(`(-?\\d*\\.?\\d*(?:e[\\-+]?\\d+)?)[${t}]*,?[${t}]*`,"ig"),i={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},s=[];return n.replace(e,(o,a,c)=>{const l=[];let u=a.toLowerCase();c.replace(r,(h,d)=>(d&&l.push(+d),h)),u==="m"&&l.length>2&&(s.push([a,...l.splice(0,2)]),u="l",a=a==="m"?"l":"L");const f=i[u];for(;l.length>=f&&(s.push([a,...l.splice(0,f)]),!!f););return o}),s}function gP(n){const t=pP(n);if(!t||!t.length)return[["M",0,0]];let e=0,r=0,i=0,s=0;const o=[];for(let a=0,c=t.length;a<c;a+=1){const l=[];o.push(l);const u=t[a],f=u[0];if(f!==f.toUpperCase())switch(l[0]=f.toUpperCase(),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+u[6]+e,l[7]=+u[7]+r;break;case"V":l[1]=+u[1]+r;break;case"H":l[1]=+u[1]+e;break;case"M":i=+u[1]+e,s=+u[2]+r;for(let h=1,d=u.length;h<d;h+=1)l[h]=+u[h]+(h%2?e:r);break;default:for(let h=1,d=u.length;h<d;h+=1)l[h]=+u[h]+(h%2?e:r);break}else for(let h=0,d=u.length;h<d;h+=1)l[h]=u[h];switch(l[0]){case"Z":e=+i,r=+s;break;case"H":e=l[1];break;case"V":r=l[1];break;case"M":i=l[l.length-2],s=l[l.length-1],e=l[l.length-2],r=l[l.length-1];break;default:e=l[l.length-2],r=l[l.length-1];break}}return o}function mP(n){const t=gP(n),e={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null};function r(c,l,u){let f,h;if(!c)return["C",l.x,l.y,l.x,l.y,l.x,l.y];switch(c[0]in{T:1,Q:1}||(l.qx=null,l.qy=null),c[0]){case"M":l.X=c[1],l.Y=c[2];break;case"A":return parseFloat(c[1])===0||parseFloat(c[2])===0?["L",c[6],c[7]]:["C"].concat($b.apply(0,[l.x,l.y].concat(c.slice(1))));case"S":return u==="C"||u==="S"?(f=l.x*2-l.bx,h=l.y*2-l.by):(f=l.x,h=l.y),["C",f,h].concat(c.slice(1));case"T":return u==="Q"||u==="T"?(l.qx=l.x*2-l.qx,l.qy=l.y*2-l.qy):(l.qx=l.x,l.qy=l.y),["C"].concat(Kp(l.x,l.y,l.qx,l.qy,c[1],c[2]));case"Q":return l.qx=c[1],l.qy=c[2],["C"].concat(Kp(l.x,l.y,c[1],c[2],c[3],c[4]));case"H":return["L"].concat(c[1],l.y);case"V":return["L"].concat(l.x,c[1])}return c}function i(c,l){if(c[l].length>7){c[l].shift();const u=c[l];for(;u.length;)s[l]="A",l+=1,c.splice(l,0,["C"].concat(u.splice(0,6)));c.splice(l,1),a=t.length}}const s=[];let o="",a=t.length;for(let c=0;c<a;c+=1){let l="";t[c]&&(l=t[c][0]),l!=="C"&&(s[c]=l,c>0&&(o=s[c-1])),t[c]=r(t[c],e,o),s[c]!=="A"&&l==="C"&&(s[c]="C"),i(t,c);const u=t[c],f=u.length;e.x=u[f-2],e.y=u[f-1],e.bx=parseFloat(u[f-4])||e.x,e.by=parseFloat(u[f-3])||e.y}return(!t[0][0]||t[0][0]!=="M")&&t.unshift(["M",0,0]),t}function bP(n){return mP(n).map(t=>t.map(e=>typeof e=="string"?e:_e.round(e,2))).join(",").split(",").join(" ")}class ne extends ri{constructor(t){if(super(),this.PRECISION=3,this.segments=[],Array.isArray(t))if(Ht.isLine(t[0])||Ye.isCurve(t[0])){let e=null;t.forEach((i,s)=>{s===0&&this.appendSegment(ne.createSegment("M",i.start)),e!=null&&!e.end.equals(i.start)&&this.appendSegment(ne.createSegment("M",i.start)),Ht.isLine(i)?this.appendSegment(ne.createSegment("L",i.end)):Ye.isCurve(i)&&this.appendSegment(ne.createSegment("C",i.controlPoint1,i.controlPoint2,i.end)),e=i})}else t.forEach(r=>{r.isSegment&&this.appendSegment(r)});else t!=null&&(Ht.isLine(t)?(this.appendSegment(ne.createSegment("M",t.start)),this.appendSegment(ne.createSegment("L",t.end))):Ye.isCurve(t)?(this.appendSegment(ne.createSegment("M",t.start)),this.appendSegment(ne.createSegment("C",t.controlPoint1,t.controlPoint2,t.end))):en.isPolyline(t)?t.points&&t.points.length&&t.points.forEach((e,r)=>{const i=r===0?ne.createSegment("M",e):ne.createSegment("L",e);this.appendSegment(i)}):t.isSegment&&this.appendSegment(t))}get start(){const t=this.segments,e=t.length;if(e===0)return null;for(let r=0;r<e;r+=1){const i=t[r];if(i.isVisible)return i.start}return t[e-1].end}get end(){const t=this.segments,e=t.length;if(e===0)return null;for(let r=e-1;r>=0;r-=1){const i=t[r];if(i.isVisible)return i.end}return t[e-1].end}moveTo(...t){return this.appendSegment(bs.create.call(null,...t))}lineTo(...t){return this.appendSegment(On.create.call(null,...t))}curveTo(...t){return this.appendSegment(Wn.create.call(null,...t))}arcTo(t,e,r,i,s,o,a){const c=this.end||new R,l=typeof o=="number"?tc(c.x,c.y,t,e,r,i,s,o,a):tc(c.x,c.y,t,e,r,i,s,o.x,o.y);if(l!=null)for(let u=0,f=l.length;u<f;u+=6)this.curveTo(l[u],l[u+1],l[u+2],l[u+3],l[u+4],l[u+5]);return this}quadTo(t,e,r,i){const s=this.end||new R,o=["M",s.x,s.y];if(typeof t=="number")o.push("Q",t,e,r,i);else{const c=e;o.push("Q",t.x,t.y,c.x,c.y)}const a=ne.parse(o.join(" "));return this.appendSegment(a.segments.slice(1)),this}close(){return this.appendSegment(ms.create())}drawPoints(t,e={}){const r=Vb(t,e),i=ne.parse(r);i&&i.segments&&this.appendSegment(i.segments)}bbox(){const t=this.segments,e=t.length;if(e===0)return null;let r;for(let s=0;s<e;s+=1){const o=t[s];if(o.isVisible){const a=o.bbox();a!=null&&(r=r?r.union(a):a)}}if(r!=null)return r;const i=t[e-1];return new Bt(i.end.x,i.end.y,0,0)}appendSegment(t){const e=this.segments.length;let r=e!==0?this.segments[e-1]:null,i;const s=null;if(Array.isArray(t))for(let o=0,a=t.length;o<a;o+=1){const c=t[o];i=this.prepareSegment(c,r,s),this.segments.push(i),r=i}else t!=null&&t.isSegment&&(i=this.prepareSegment(t,r,s),this.segments.push(i));return this}insertSegment(t,e){const r=this.segments.length;if(t<0&&(t=r+t+1),t>r||t<0)throw new Error("Index out of range.");let i,s=null,o=null;if(r!==0&&(t>=1?(s=this.segments[t-1],o=s.nextSegment):(s=null,o=this.segments[0])),!Array.isArray(e))i=this.prepareSegment(e,s,o),this.segments.splice(t,0,i);else for(let a=0,c=e.length;a<c;a+=1){const l=e[a];i=this.prepareSegment(l,s,o),this.segments.splice(t+a,0,i),s=i}return this}removeSegment(t){const e=this.fixIndex(t),r=this.segments.splice(e,1)[0],i=r.previousSegment,s=r.nextSegment;return i&&(i.nextSegment=s),s&&(s.previousSegment=i),r.isSubpathStart&&s&&this.updateSubpathStartSegment(s),r}replaceSegment(t,e){const r=this.fixIndex(t);let i;const s=this.segments[r];let o=s.previousSegment;const a=s.nextSegment;let c=s.isSubpathStart;if(!Array.isArray(e))i=this.prepareSegment(e,o,a),this.segments.splice(r,1,i),c&&i.isSubpathStart&&(c=!1);else{this.segments.splice(t,1);for(let l=0,u=e.length;l<u;l+=1){const f=e[l];i=this.prepareSegment(f,o,a),this.segments.splice(t+l,0,i),o=i,c&&i.isSubpathStart&&(c=!1)}}c&&a&&this.updateSubpathStartSegment(a)}getSegment(t){const e=this.fixIndex(t);return this.segments[e]}fixIndex(t){const e=this.segments.length;if(e===0)throw new Error("Path has no segments.");let r=t;for(;r<0;)r=e+r;if(r>=e||r<0)throw new Error("Index out of range.");return r}segmentAt(t,e={}){const r=this.segmentIndexAt(t,e);return r?this.getSegment(r):null}segmentAtLength(t,e={}){const r=this.segmentIndexAtLength(t,e);return r?this.getSegment(r):null}segmentIndexAt(t,e={}){if(this.segments.length===0)return null;const r=_e.clamp(t,0,1),i=this.getOptions(e),o=this.length(i)*r;return this.segmentIndexAtLength(o,i)}segmentIndexAtLength(t,e={}){const r=this.segments.length;if(r===0)return null;let i=!0;t<0&&(i=!1,t=-t);const s=this.getPrecision(e),o=this.getSubdivisions(e);let a=0,c=null;for(let l=0;l<r;l+=1){const u=i?l:r-1-l,f=this.segments[u],h=o[u],d=f.length({precision:s,subdivisions:h});if(f.isVisible){if(t<=a+d)return u;c=u}a+=d}return c}getSegmentSubdivisions(t={}){const e=this.getPrecision(t),r=[];for(let i=0,s=this.segments.length;i<s;i+=1){const a=this.segments[i].getSubdivisions({precision:e});r.push(a)}return r}updateSubpathStartSegment(t){let e=t.previousSegment,r=t;for(;r&&!r.isSubpathStart;)e!=null?r.subpathStartSegment=e.subpathStartSegment:r.subpathStartSegment=null,e=r,r=r.nextSegment}prepareSegment(t,e,r){t.previousSegment=e,t.nextSegment=r,e!=null&&(e.nextSegment=t),r!=null&&(r.previousSegment=t);let i=t;return t.isSubpathStart&&(t.subpathStartSegment=t,i=r),i!=null&&this.updateSubpathStartSegment(i),t}closestPoint(t,e={}){const r=this.closestPointT(t,e);return r?this.pointAtT(r):null}closestPointLength(t,e={}){const r=this.getOptions(e),i=this.closestPointT(t,r);return i?this.lengthAtT(i,r):0}closestPointNormalizedLength(t,e={}){const r=this.getOptions(e),i=this.closestPointLength(t,r);if(i===0)return 0;const s=this.length(r);return s===0?0:i/s}closestPointT(t,e={}){if(this.segments.length===0)return null;const r=this.getPrecision(e),i=this.getSubdivisions(e);let s,o=1/0;for(let a=0,c=this.segments.length;a<c;a+=1){const l=this.segments[a],u=i[a];if(l.isVisible){const f=l.closestPointT(t,{precision:r,subdivisions:u}),h=l.pointAtT(f),d=_e.squaredLength(h,t);d<o&&(s={segmentIndex:a,value:f},o=d)}}return s||{segmentIndex:this.segments.length-1,value:1}}closestPointTangent(t,e={}){if(this.segments.length===0)return null;const r=this.getPrecision(e),i=this.getSubdivisions(e);let s,o=1/0;for(let a=0,c=this.segments.length;a<c;a+=1){const l=this.segments[a],u=i[a];if(l.isDifferentiable()){const f=l.closestPointT(t,{precision:r,subdivisions:u}),h=l.pointAtT(f),d=_e.squaredLength(h,t);d<o&&(s=l.tangentAtT(f),o=d)}}return s||null}containsPoint(t,e={}){const r=this.toPolylines(e);if(!r)return!1;let i=0;for(let s=0,o=r.length;s<o;s+=1)r[s].containsPoint(t)&&(i+=1);return i%2===1}pointAt(t,e={}){if(this.segments.length===0)return null;if(t<=0)return this.start.clone();if(t>=1)return this.end.clone();const r=this.getOptions(e),s=this.length(r)*t;return this.pointAtLength(s,r)}pointAtLength(t,e={}){if(this.segments.length===0)return null;if(t===0)return this.start.clone();let r=!0;t<0&&(r=!1,t=-t);const i=this.getPrecision(e),s=this.getSubdivisions(e);let o,a=0;for(let l=0,u=this.segments.length;l<u;l+=1){const f=r?l:u-1-l,h=this.segments[f],d=s[f],p=h.length({precision:i,subdivisions:d});if(h.isVisible){if(t<=a+p)return h.pointAtLength((r?1:-1)*(t-a),{precision:i,subdivisions:d});o=h}a+=p}return o?r?o.end:o.start:this.segments[this.segments.length-1].end.clone()}pointAtT(t){const e=this.segments,r=e.length;if(r===0)return null;const i=t.segmentIndex;if(i<0)return e[0].pointAtT(0);if(i>=r)return e[r-1].pointAtT(1);const s=_e.clamp(t.value,0,1);return e[i].pointAtT(s)}divideAt(t,e={}){if(this.segments.length===0)return null;const r=_e.clamp(t,0,1),i=this.getOptions(e),o=this.length(i)*r;return this.divideAtLength(o,i)}divideAtLength(t,e={}){if(this.segments.length===0)return null;let r=!0;t<0&&(r=!1,t=-t);const i=this.getPrecision(e),s=this.getSubdivisions(e);let o=0,a,c,l,u,f;for(let I=0,G=this.segments.length;I<G;I+=1){const k=r?I:G-1-I,X=this.getSegment(k),Z=s[k],at={precision:i,subdivisions:Z},ft=X.length(at);if(X.isDifferentiable()&&(l=X,u=k,t<=o+ft)){c=k,a=X.divideAtLength((r?1:-1)*(t-o),at);break}o+=ft}if(!l)return null;a||(c=u,f=r?1:0,a=l.divideAtT(f));const h=this.clone(),d=c;h.replaceSegment(d,a);const p=d;let m=d+1,b=d+2;a[0].isDifferentiable()||(h.removeSegment(p),m-=1,b-=1);const v=h.getSegment(m).start;h.insertSegment(m,ne.createSegment("M",v)),b+=1,a[1].isDifferentiable()||(h.removeSegment(b-1),b-=1);const E=b-p-1;for(let I=b,G=h.segments.length;I<G;I+=1){const k=this.getSegment(I-E),X=h.getSegment(I);if(X.type==="Z"&&!k.subpathStartSegment.end.equals(X.subpathStartSegment.end)){const Z=ne.createSegment("L",k.end);h.replaceSegment(I,Z)}}const y=new ne(h.segments.slice(0,m)),O=new ne(h.segments.slice(m));return[y,O]}intersectsWithLine(t,e={}){const r=this.toPolylines(e);if(r==null)return null;let i=null;for(let s=0,o=r.length;s<o;s+=1){const a=r[s],c=t.intersect(a);c&&(i==null&&(i=[]),Array.isArray(c)?i.push(...c):i.push(c))}return i}isDifferentiable(){for(let t=0,e=this.segments.length;t<e;t+=1)if(this.segments[t].isDifferentiable())return!0;return!1}isValid(){const t=this.segments;return t.length===0||t[0].type==="M"}length(t={}){if(this.segments.length===0)return 0;const e=this.getSubdivisions(t);let r=0;for(let i=0,s=this.segments.length;i<s;i+=1){const o=this.segments[i],a=e[i];r+=o.length({subdivisions:a})}return r}lengthAtT(t,e={}){const r=this.segments.length;if(r===0)return 0;let i=t.segmentIndex;if(i<0)return 0;let s=_e.clamp(t.value,0,1);i>=r&&(i=r-1,s=1);const o=this.getPrecision(e),a=this.getSubdivisions(e);let c=0;for(let f=0;f<i;f+=1){const h=this.segments[f],d=a[f];c+=h.length({precision:o,subdivisions:d})}const l=this.segments[i],u=a[i];return c+=l.lengthAtT(s,{precision:o,subdivisions:u}),c}tangentAt(t,e={}){if(this.segments.length===0)return null;const r=_e.clamp(t,0,1),i=this.getOptions(e),o=this.length(i)*r;return this.tangentAtLength(o,i)}tangentAtLength(t,e={}){if(this.segments.length===0)return null;let r=!0;t<0&&(r=!1,t=-t);const i=this.getPrecision(e),s=this.getSubdivisions(e);let o,a=0;for(let c=0,l=this.segments.length;c<l;c+=1){const u=r?c:l-1-c,f=this.segments[u],h=s[u],d=f.length({precision:i,subdivisions:h});if(f.isDifferentiable()){if(t<=a+d)return f.tangentAtLength((r?1:-1)*(t-a),{precision:i,subdivisions:h});o=f}a+=d}if(o){const c=r?1:0;return o.tangentAtT(c)}return null}tangentAtT(t){const e=this.segments.length;if(e===0)return null;const r=t.segmentIndex;if(r<0)return this.segments[0].tangentAtT(0);if(r>=e)return this.segments[e-1].tangentAtT(1);const i=_e.clamp(t.value,0,1);return this.segments[r].tangentAtT(i)}getPrecision(t={}){return t.precision==null?this.PRECISION:t.precision}getSubdivisions(t={}){if(t.segmentSubdivisions==null){const e=this.getPrecision(t);return this.getSegmentSubdivisions({precision:e})}return t.segmentSubdivisions}getOptions(t={}){const e=this.getPrecision(t),r=this.getSubdivisions(t);return{precision:e,segmentSubdivisions:r}}toPoints(t={}){const e=this.segments,r=e.length;if(r===0)return null;const i=this.getSubdivisions(t),s=[];let o=[];for(let a=0;a<r;a+=1){const c=e[a];if(c.isVisible){const l=i[a];l.length>0?l.forEach(u=>o.push(u.start)):o.push(c.start)}else o.length>0&&(o.push(e[a-1].end),s.push(o),o=[])}return o.length>0&&(o.push(this.end),s.push(o)),s}toPolylines(t={}){const e=this.toPoints(t);return e?e.map(r=>new en(r)):null}scale(t,e,r){return this.segments.forEach(i=>i.scale(t,e,r)),this}rotate(t,e){return this.segments.forEach(r=>r.rotate(t,e)),this}translate(t,e){return typeof t=="number"?this.segments.forEach(r=>r.translate(t,e)):this.segments.forEach(r=>r.translate(t)),this}clone(){const t=new ne;return this.segments.forEach(e=>t.appendSegment(e.clone())),t}equals(t){if(t==null)return!1;const e=this.segments,r=t.segments,i=e.length;if(r.length!==i)return!1;for(let s=0;s<i;s+=1){const o=e[s],a=r[s];if(o.type!==a.type||!o.equals(a))return!1}return!0}toJSON(){return this.segments.map(t=>t.toJSON())}serialize(){if(!this.isValid())throw new Error("Invalid path segments.");return this.segments.map(t=>t.serialize()).join(" ")}toString(){return this.serialize()}}(function(n){function t(e){return e!=null&&e instanceof n}n.isPath=t})(ne||(ne={}));(function(n){function t(r){if(!r)return new n;const i=new n,s=/(?:[a-zA-Z] *)(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)? *,? *)|(?:-?\.\d+ *,? *))+|(?:[a-zA-Z] *)(?! |\d|-|\.)/g,o=n.normalize(r).match(s);if(o!=null)for(let a=0,c=o.length;a<c;a+=1){const l=o[a],u=/(?:[a-zA-Z])|(?:(?:-?\d+(?:\.\d+)?(?:e[-+]?\d+)?))|(?:(?:-?\.\d+))/g,f=l.match(u);if(f!=null){const h=f[0],d=f.slice(1).map(m=>+m),p=e.call(null,h,...d);i.appendSegment(p)}}return i}n.parse=t;function e(r,...i){if(r==="M")return bs.create.call(null,...i);if(r==="L")return On.create.call(null,...i);if(r==="C")return Wn.create.call(null,...i);if(r==="z"||r==="Z")return ms.create();throw new Error(`Invalid path segment type "${r}"`)}n.createSegment=e})(ne||(ne={}));(function(n){n.normalize=bP,n.isValid=hP,n.drawArc=dP,n.drawPoints=Vb,n.arcToCurves=tc})(ne||(ne={}));class rn{constructor(t){this.options=Object.assign({},t),this.data=this.options.data||{},this.register=this.register.bind(this),this.unregister=this.unregister.bind(this)}get names(){return Object.keys(this.data)}register(t,e,r=!1){if(typeof t=="object"){Object.entries(t).forEach(([o,a])=>{this.register(o,a,e)});return}this.exist(t)&&!r&&!Wr.isApplyingHMR()&&this.onDuplicated(t);const i=this.options.process,s=i?Qt(i,this,t,e):e;return this.data[t]=s,s}unregister(t){const e=t?this.data[t]:null;return delete this.data[t],e}get(t){return t?this.data[t]:null}exist(t){return t?this.data[t]!=null:!1}onDuplicated(t){try{throw this.options.onConflict&&Qt(this.options.onConflict,this,t),new Error(`${Fa(this.options.type)} with name '${t}' already registered.`)}catch(e){throw e}}onNotFound(t,e){throw new Error(this.getSpellingSuggestion(t,e))}getSpellingSuggestion(t,e){const r=this.getSpellingSuggestionForName(t),i=e?`${e} ${bA(this.options.type)}`:this.options.type;return`${Fa(i)} with name '${t}' does not exist.${r?` Did you mean '${r}'?`:""}`}getSpellingSuggestionForName(t){return bM(t,Object.keys(this.data),e=>e)}}(function(n){function t(e){return new n(e)}n.create=t})(rn||(rn={}));const vP={color:"#aaaaaa",thickness:1,markup:"rect",update(n,t){const e=t.thickness*t.sx,r=t.thickness*t.sy;ye(n,{width:e,height:r,rx:e,ry:r,fill:t.color})}},yP={color:"#aaaaaa",thickness:1,markup:"rect",update(n,t){const e=t.sx<=1?t.thickness*t.sx:t.thickness;ye(n,{width:e,height:e,rx:e,ry:e,fill:t.color})}},EP={color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(n,t){let e;const r=t.width,i=t.height,s=t.thickness;r-s>=0&&i-s>=0?e=["M",r,0,"H0 M0 0 V0",i].join(" "):e="M 0 0 0 0",ye(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}},xP=[{color:"rgba(224,224,224,1)",thickness:1,markup:"path",update(n,t){let e;const r=t.width,i=t.height,s=t.thickness;r-s>=0&&i-s>=0?e=["M",r,0,"H0 M0 0 V0",i].join(" "):e="M 0 0 0 0",ye(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}},{color:"rgba(224,224,224,0.2)",thickness:3,factor:4,markup:"path",update(n,t){let e;const r=t.factor||1,i=t.width*r,s=t.height*r,o=t.thickness;i-o>=0&&s-o>=0?e=["M",i,0,"H0 M0 0 V0",s].join(" "):e="M 0 0 0 0",t.width=i,t.height=s,ye(n,{d:e,stroke:t.color,"stroke-width":t.thickness})}}],wP=Object.freeze(Object.defineProperty({__proto__:null,dot:vP,doubleMesh:xP,fixedDot:yP,mesh:EP},Symbol.toStringTag,{value:"Module"}));class Vr{constructor(){this.patterns={},this.root=ae.create(Ja(),{width:"100%",height:"100%"},[ar("defs")]).node}add(t,e){const r=this.root.childNodes[0];r&&r.appendChild(e),this.patterns[t]=e,ae.create("rect",{width:"100%",height:"100%",fill:`url(#${t})`}).appendTo(this.root)}get(t){return this.patterns[t]}has(t){return this.patterns[t]!=null}}(function(n){n.presets=wP,n.registry=rn.create({type:"grid"}),n.registry.register(n.presets,!0)})(Vr||(Vr={}));const Hb=function(n){const t=document.createElement("canvas"),e=n.width,r=n.height;t.width=e*2,t.height=r;const i=t.getContext("2d");return i.drawImage(n,0,0,e,r),i.translate(2*e,0),i.scale(-1,1),i.drawImage(n,0,0,e,r),t},Xb=function(n){const t=document.createElement("canvas"),e=n.width,r=n.height;t.width=e,t.height=r*2;const i=t.getContext("2d");return i.drawImage(n,0,0,e,r),i.translate(0,2*r),i.scale(1,-1),i.drawImage(n,0,0,e,r),t},Wb=function(n){const t=document.createElement("canvas"),e=n.width,r=n.height;t.width=2*e,t.height=2*r;const i=t.getContext("2d");return i.drawImage(n,0,0,e,r),i.setTransform(-1,0,0,-1,t.width,t.height),i.drawImage(n,0,0,e,r),i.setTransform(-1,0,0,1,t.width,0),i.drawImage(n,0,0,e,r),i.setTransform(1,0,0,-1,0,t.height),i.drawImage(n,0,0,e,r),t},AP=function(n,t){const e=n.width,r=n.height,i=document.createElement("canvas");i.width=e*3,i.height=r*3;const s=i.getContext("2d"),o=t.angle!=null?-t.angle:-20,a=Te.toRad(o),c=i.width/4,l=i.height/4;for(let u=0;u<4;u+=1)for(let f=0;f<4;f+=1)(u+f)%2>0&&(s.setTransform(1,0,0,1,(2*u-1)*c,(2*f-1)*l),s.rotate(a),s.drawImage(n,-e/2,-r/2,e,r));return i},SP=Object.freeze(Object.defineProperty({__proto__:null,flipX:Hb,flipXY:Wb,flipY:Xb,watermark:AP},Symbol.toStringTag,{value:"Module"}));var Ro;(function(n){n.presets=Object.assign({},SP),n.presets["flip-x"]=Hb,n.presets["flip-y"]=Xb,n.presets["flip-xy"]=Wb,n.registry=rn.create({type:"background pattern"}),n.registry.register(n.presets,!0)})(Ro||(Ro={}));function hh(n,t){return n??t}function En(n,t){return n!=null&&Number.isFinite(n)?n:t}function TP(n={}){const t=hh(n.color,"blue"),e=En(n.width,1),r=En(n.margin,2),i=En(n.opacity,1),s=r,o=r+e;return`
    <filter>
      <feFlood flood-color="${t}" flood-opacity="${i}" result="colored"/>
      <feMorphology in="SourceAlpha" result="morphedOuter" operator="dilate" radius="${o}" />
      <feMorphology in="SourceAlpha" result="morphedInner" operator="dilate" radius="${s}" />
      <feComposite result="morphedOuterColored" in="colored" in2="morphedOuter" operator="in"/>
      <feComposite operator="xor" in="morphedOuterColored" in2="morphedInner" result="outline"/>
      <feMerge>
        <feMergeNode in="outline"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
  `.trim()}function CP(n={}){const t=hh(n.color,"red"),e=En(n.blur,0),r=En(n.width,1),i=En(n.opacity,1);return`
      <filter>
        <feFlood flood-color="${t}" flood-opacity="${i}" result="colored"/>
        <feMorphology result="morphed" in="SourceGraphic" operator="dilate" radius="${r}"/>
        <feComposite result="composed" in="colored" in2="morphed" operator="in"/>
        <feGaussianBlur result="blured" in="composed" stdDeviation="${e}"/>
        <feBlend in="SourceGraphic" in2="blured" mode="normal"/>
      </filter>
    `.trim()}function _P(n={}){const t=En(n.x,2);return`
    <filter>
      <feGaussianBlur stdDeviation="${n.y!=null&&Number.isFinite(n.y)?[t,n.y]:t}"/>
    </filter>
  `.trim()}function OP(n={}){const t=En(n.dx,0),e=En(n.dy,0),r=hh(n.color,"black"),i=En(n.blur,4),s=En(n.opacity,1);return"SVGFEDropShadowElement"in window?`<filter>
         <feDropShadow stdDeviation="${i}" dx="${t}" dy="${e}" flood-color="${r}" flood-opacity="${s}" />
       </filter>`.trim():`<filter>
         <feGaussianBlur in="SourceAlpha" stdDeviation="${i}" />
         <feOffset dx="${t}" dy="${e}" result="offsetblur" />
         <feFlood flood-color="${r}" />
         <feComposite in2="offsetblur" operator="in" />
         <feComponentTransfer>
           <feFuncA type="linear" slope="${s}" />
         </feComponentTransfer>
         <feMerge>
           <feMergeNode/>
           <feMergeNode in="SourceGraphic"/>
         </feMerge>
       </filter>`.trim()}function MP(n={}){const t=En(n.amount,1),e=.2126+.7874*(1-t),r=.7152-.7152*(1-t),i=.0722-.0722*(1-t),s=.2126-.2126*(1-t),o=.7152+.2848*(1-t),a=.0722-.0722*(1-t),c=.2126-.2126*(1-t),l=.0722+.9278*(1-t);return`
    <filter>
      <feColorMatrix type="matrix" values="${e} ${r} ${i} 0 0 ${s} ${o} ${a} 0 0 ${c} ${r} ${l} 0 0 0 0 0 1 0"/>
    </filter>
  `.trim()}function PP(n={}){const t=En(n.amount,1),e=.393+.607*(1-t),r=.769-.769*(1-t),i=.189-.189*(1-t),s=.349-.349*(1-t),o=.686+.314*(1-t),a=.168-.168*(1-t),c=.272-.272*(1-t),l=.534-.534*(1-t),u=.131+.869*(1-t);return`
      <filter>
        <feColorMatrix type="matrix" values="${e} ${r} ${i} 0 0 ${s} ${o} ${a} 0 0 ${c} ${l} ${u} 0 0 0 0 0 1 0"/>
      </filter>
    `.trim()}function RP(n={}){return`
      <filter>
        <feColorMatrix type="saturate" values="${1-En(n.amount,1)}"/>
      </filter>
    `.trim()}function NP(n={}){return`
      <filter>
        <feColorMatrix type="hueRotate" values="${En(n.angle,0)}"/>
      </filter>
    `.trim()}function LP(n={}){const t=En(n.amount,1),e=1-t;return`
      <filter>
        <feComponentTransfer>
          <feFuncR type="table" tableValues="${t} ${e}"/>
          <feFuncG type="table" tableValues="${t} ${e}"/>
          <feFuncB type="table" tableValues="${t} ${e}"/>
        </feComponentTransfer>
      </filter>
    `.trim()}function IP(n={}){const t=En(n.amount,1);return`
    <filter>
      <feComponentTransfer>
        <feFuncR type="linear" slope="${t}"/>
        <feFuncG type="linear" slope="${t}"/>
        <feFuncB type="linear" slope="${t}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}function DP(n={}){const t=En(n.amount,1),e=.5-t/2;return`
    <filter>
     <feComponentTransfer>
        <feFuncR type="linear" slope="${t}" intercept="${e}"/>
        <feFuncG type="linear" slope="${t}" intercept="${e}"/>
        <feFuncB type="linear" slope="${t}" intercept="${e}"/>
      </feComponentTransfer>
    </filter>
  `.trim()}const kP=Object.freeze(Object.defineProperty({__proto__:null,blur:_P,brightness:IP,contrast:DP,dropShadow:OP,grayScale:MP,highlight:CP,hueRotate:NP,invert:LP,outline:TP,saturate:RP,sepia:PP},Symbol.toStringTag,{value:"Module"}));var vs;(function(n){n.presets=kP,n.registry=rn.create({type:"filter"}),n.registry.register(n.presets,!0)})(vs||(vs={}));const BP={xlinkHref:"xlink:href",xlinkShow:"xlink:show",xlinkRole:"xlink:role",xlinkType:"xlink:type",xlinkArcrole:"xlink:arcrole",xlinkTitle:"xlink:title",xlinkActuate:"xlink:actuate",xmlSpace:"xml:space",xmlBase:"xml:base",xmlLang:"xml:lang",preserveAspectRatio:"preserveAspectRatio",requiredExtension:"requiredExtension",requiredFeatures:"requiredFeatures",systemLanguage:"systemLanguage",externalResourcesRequired:"externalResourceRequired"},jP={},qb={position:Oc("x","width","origin")},Yb={position:Oc("y","height","origin")},FP={position:Oc("x","width","corner")},GP={position:Oc("y","height","corner")},Jb={set:Jr("width","width")},Kb={set:Jr("height","height")},zP={set:Jr("rx","width")},UP={set:Jr("ry","height")},Zb={set:(n=>{const t=Jr(n,"width"),e=Jr(n,"height");return function(r,i){const s=i.refBBox,o=s.height>s.width?t:e;return Qt(o,this,r,i)}})("r")},VP={set(n,{refBBox:t}){let e=parseFloat(n);const r=Mr(n);r&&(e/=100);const i=Math.sqrt(t.height*t.height+t.width*t.width);let s;return Number.isFinite(e)&&(r||e>=0&&e<=1?s=e*i:s=Math.max(e+i,0)),{r:s}}},$P={set:Jr("cx","width")},HP={set:Jr("cy","height")},Qb={set:nv({resetOffset:!0})},XP={set:nv({resetOffset:!1})},tv={set:rv({resetOffset:!0})},WP={set:rv({resetOffset:!1})},qP=Zb,YP=Qb,JP=tv,KP=qb,ZP=Yb,QP=Jb,tR=Kb;function Oc(n,t,e){return(r,{refBBox:i})=>{if(r==null)return null;let s=parseFloat(r);const o=Mr(r);o&&(s/=100);let a;if(Number.isFinite(s)){const l=i[e];o||s>0&&s<1?a=l[n]+i[t]*s:a=l[n]+s}const c=new R;return c[n]=a||0,c}}function Jr(n,t){return function(e,{refBBox:r}){let i=parseFloat(e);const s=Mr(e);s&&(i/=100);const o={};if(Number.isFinite(i)){const a=s||i>=0&&i<=1?i*r[t]:Math.max(i+r[t],0);o[n]=a}return o}}function ev(n,t){const e="x6-shape",r=t&&t.resetOffset;return function(i,{elem:s,refBBox:o}){let a=Ri(s,e);if(!a||a.value!==i){const m=n(i);a={value:i,shape:m,shapeBBox:m.bbox()},Ri(s,e,a)}const c=a.shape.clone(),l=a.shapeBBox.clone(),u=l.getOrigin(),f=o.getOrigin();l.x=f.x,l.y=f.y;const h=o.getMaxScaleToFit(l,f),d=l.width===0||o.width===0?1:h.sx,p=l.height===0||o.height===0?1:h.sy;return c.scale(d,p,u),r&&c.translate(-u.x,-u.y),c}}function nv(n){function t(r){return ne.parse(r)}const e=ev(t,n);return(r,i)=>({d:e(r,i).serialize()})}function rv(n){const t=ev(e=>new en(e),n);return(e,r)=>({points:t(e,r).serialize()})}const eR={qualify:Rr,set(n,{view:t}){return`url(#${t.graph.defineGradient(n)})`}},nR={qualify:Rr,set(n,{view:t}){const e=t.cell,r=Object.assign({},n);if(e.isEdge()&&r.type==="linearGradient"){const i=t,s=i.sourcePoint,o=i.targetPoint;r.id=`gradient-${r.type}-${e.id}`,r.attrs=Object.assign(Object.assign({},r.attrs),{x1:s.x,y1:s.y,x2:o.x,y2:o.y,gradientUnits:"userSpaceOnUse"}),t.graph.defs.remove(r.id)}return`url(#${t.graph.defineGradient(r)})`}},iv={qualify(n,{attrs:t}){return t.textWrap==null||!Rr(t.textWrap)},set(n,{view:t,elem:e,attrs:r}){const i="x6-text",s=Ri(e,i),o=u=>{try{return JSON.parse(u)}catch{return u}},a={x:r.x,eol:r.eol,annotations:o(r.annotations),textPath:o(r["text-path"]||r.textPath),textVerticalAnchor:r["text-vertical-anchor"]||r.textVerticalAnchor,displayEmpty:(r["display-empty"]||r.displayEmpty)==="true",lineHeight:r["line-height"]||r.lineHeight},c=r["font-size"]||r.fontSize,l=JSON.stringify([n,a]);if(c&&e.setAttribute("font-size",c),s==null||s!==l){const u=a.textPath;if(u!=null&&typeof u=="object"){const f=u.selector;if(typeof f=="string"){const h=t.find(f)[0];h instanceof SVGPathElement&&(ih(h),a.textPath=Object.assign({"xlink:href":`#${h.id}`},u))}}Db(e,`${n}`,a),Ri(e,i,l)}}},rR={qualify:Rr,set(n,{view:t,elem:e,attrs:r,refBBox:i}){const s=n,o=s.width||0;Mr(o)?i.width*=parseFloat(o)/100:o<=0?i.width+=o:i.width=o;const a=s.height||0;Mr(a)?i.height*=parseFloat(a)/100:a<=0?i.height+=a:i.height=a;let c,l=s.text;l==null&&(l=r.text||(e==null?void 0:e.textContent)),l!=null?c=kb(`${l}`,i,{"font-weight":r["font-weight"]||r.fontWeight,"font-size":r["font-size"]||r.fontSize,"font-family":r["font-family"]||r.fontFamily,lineHeight:r.lineHeight},{ellipsis:s.ellipsis}):c="",Qt(iv.set,this,c,{view:t,elem:e,attrs:r,refBBox:i,cell:t.cell})}},js=(n,{attrs:t})=>t.text!==void 0,iR={qualify:js},sR={qualify:js},oR={qualify:js},aR={qualify:js},cR={qualify:js},lR={qualify:js},uR={qualify(n,{elem:t}){return t instanceof SVGElement},set(n,{elem:t}){const e="x6-title",r=`${n}`,i=Ri(t,e);if(i==null||i!==r){Ri(t,e,r);const s=t.firstChild;if(s&&s.tagName.toUpperCase()==="TITLE"){const o=s;o.textContent=r}else{const o=document.createElementNS(t.namespaceURI,"title");o.textContent=r,t.insertBefore(o,s)}}}},hR={offset:sv("x","width","right")},fR={offset:sv("y","height","bottom")},dR={offset(n,{refBBox:t}){return n?{x:-t.x,y:-t.y}:{x:0,y:0}}};function sv(n,t,e){return(r,{refBBox:i})=>{const s=new R;let o;return r==="middle"?o=i[t]/2:r===e?o=i[t]:typeof r=="number"&&Number.isFinite(r)?o=r>-1&&r<1?-i[t]*r:-r:Mr(r)?o=i[t]*parseFloat(r)/100:o=0,s[n]=-(i[n]+o),s}}const pR={qualify:Rr,set(n,{elem:t}){dn(t,n)}},gR={set(n,{elem:t}){t.innerHTML=`${n}`}},mR={qualify:Rr,set(n,{view:t}){return`url(#${t.graph.defineFilter(n)})`}},bR={set(n){return n!=null&&typeof n=="object"&&n.id?n.id:n}};function ii(n,t,e){let r,i;typeof t=="object"?(r=t.x,i=t.y):(r=t,i=e);const s=ne.parse(n),o=s.bbox();if(o){let a=-o.height/2-o.y,c=-o.width/2-o.x;typeof r=="number"&&(c-=r),typeof i=="number"&&(a-=i),s.translate(c,a)}return s.serialize()}var ov=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const vR=n=>{var{size:t,width:e,height:r,offset:i,open:s}=n,o=ov(n,["size","width","height","offset","open"]);return av({size:t,width:e,height:r,offset:i},s===!0,!0,void 0,o)},yR=n=>{var{size:t,width:e,height:r,offset:i,factor:s}=n,o=ov(n,["size","width","height","offset","factor"]);return av({size:t,width:e,height:r,offset:i},!1,!1,s,o)};function av(n,t,e,r=3/4,i={}){const s=n.size||10,o=n.width||s,a=n.height||s,c=new ne,l={};if(t)c.moveTo(o,0).lineTo(0,a/2).lineTo(o,a),l.fill="none";else{if(c.moveTo(0,a/2),c.lineTo(o,0),!e){const u=Bn(r,0,1);c.lineTo(o*u,a/2)}c.lineTo(o,a),c.close()}return Object.assign(Object.assign(Object.assign({},l),i),{tagName:"path",d:ii(c.serialize(),{x:n.offset!=null?n.offset:-o/2})})}var ER=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const xR=n=>{var{size:t,width:e,height:r,offset:i}=n,s=ER(n,["size","width","height","offset"]);const o=t||10,a=e||o,c=r||o,l=new ne;return l.moveTo(0,c/2).lineTo(a/2,0).lineTo(a,c/2).lineTo(a/2,c).close(),Object.assign(Object.assign({},s),{tagName:"path",d:ii(l.serialize(),i??-a/2)})};var wR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const AR=n=>{var{d:t,offsetX:e,offsetY:r}=n,i=wR(n,["d","offsetX","offsetY"]);return Object.assign(Object.assign({},i),{tagName:"path",d:ii(t,e,r)})};var SR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const TR=n=>{var{size:t,width:e,height:r,offset:i}=n,s=SR(n,["size","width","height","offset"]);const o=t||10,a=e||o,c=r||o,l=new ne;return l.moveTo(0,0).lineTo(a,c).moveTo(0,c).lineTo(a,0),Object.assign(Object.assign({},s),{tagName:"path",fill:"none",d:ii(l.serialize(),i||-a/2)})};var CR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const _R=n=>{var{width:t,height:e,offset:r,open:i,flip:s}=n,o=CR(n,["width","height","offset","open","flip"]);let a=e||6;const c=t||10,l=i===!0,u=s===!0,f=Object.assign(Object.assign({},o),{tagName:"path"});u&&(a=-a);const h=new ne;return h.moveTo(0,a).lineTo(c,0),l?f.fill="none":(h.lineTo(c,a),h.close()),f.d=ii(h.serialize(),{x:r||-c/2,y:a/2}),f};var cv=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const lv=n=>{var{r:t}=n,e=cv(n,["r"]);const r=t||5;return Object.assign(Object.assign({cx:r},e),{tagName:"circle",r})},OR=n=>{var{r:t}=n,e=cv(n,["r"]);const r=t||5,i=new ne;return i.moveTo(r,0).lineTo(r,r*2),i.moveTo(0,r).lineTo(r*2,r),{children:[Object.assign(Object.assign({},lv({r})),{fill:"none"}),Object.assign(Object.assign({},e),{tagName:"path",d:ii(i.serialize(),-r)})]}};var MR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const PR=n=>{var{rx:t,ry:e}=n,r=MR(n,["rx","ry"]);const i=t||5,s=e||5;return Object.assign(Object.assign({cx:i},r),{tagName:"ellipse",rx:i,ry:s})},RR=Object.freeze(Object.defineProperty({__proto__:null,async:_R,block:vR,circle:lv,circlePlus:OR,classic:yR,cross:TR,diamond:xR,ellipse:PR,path:AR},Symbol.toStringTag,{value:"Module"}));var Kr;(function(n){n.presets=RR,n.registry=rn.create({type:"marker"}),n.registry.register(n.presets,!0)})(Kr||(Kr={}));(function(n){n.normalize=ii})(Kr||(Kr={}));var NR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};function fh(n){return typeof n=="string"||Rr(n)}const LR={qualify:fh,set(n,{view:t,attrs:e}){return dh("marker-start",n,t,e)}},IR={qualify:fh,set(n,{view:t,attrs:e}){return dh("marker-end",n,t,e,{transform:"rotate(180)"})}},DR={qualify:fh,set(n,{view:t,attrs:e}){return dh("marker-mid",n,t,e)}};function dh(n,t,e,r,i={}){const s=typeof t=="string"?{name:t}:t,{name:o,args:a}=s,c=NR(s,["name","args"]);let l=c;if(o&&typeof o=="string"){const f=Kr.registry.get(o);if(f)l=f(Object.assign(Object.assign({},c),a));else return Kr.registry.onNotFound(o)}const u=Object.assign(Object.assign(Object.assign({},kR(r,n)),i),l);return{[n]:`url(#${e.graph.defineMarker(u)})`}}function kR(n,t){const e={},r=n.stroke;typeof r=="string"&&(e.stroke=r,e.fill=r);let i=n.strokeOpacity;if(i==null&&(i=n["stroke-opacity"]),i==null&&(i=n.opacity),i!=null&&(e["stroke-opacity"]=i,e["fill-opacity"]=i),t!=="marker-mid"){const s=parseFloat(n.strokeWidth||n["stroke-width"]);if(Number.isFinite(s)&&s>1){const o=Math.ceil(s/2);e.refX=t==="marker-start"?o:-o}}return e}const Ho=(n,{view:t})=>t.cell.isEdge(),BR={qualify:Ho,set(n,t){var e,r,i,s;const o=t.view,a=n.reverse||!1,c=n.stubs||0;let l;if(Number.isFinite(c)&&c!==0)if(a){let u,f;const h=o.getConnectionLength()||0;c<0?(u=(h+c)/2,f=-c):(u=c,f=h-c*2);const d=o.getConnection();l=(s=(i=(r=(e=d==null?void 0:d.divideAtLength(u))===null||e===void 0?void 0:e[1])===null||r===void 0?void 0:r.divideAtLength(f))===null||i===void 0?void 0:i[0])===null||s===void 0?void 0:s.serialize()}else{let u;c<0?u=((o.getConnectionLength()||0)+c)/2:u=c;const f=o.getConnection();if(f){const h=f.divideAtLength(u),d=f.divideAtLength(-u);h&&d&&(l=`${h[0].serialize()} ${d[1].serialize()}`)}}return{d:l||o.getConnectionPathData()}}},uv={qualify:Ho,set:Mc("getTangentAtLength",{rotate:!0})},jR={qualify:Ho,set:Mc("getTangentAtLength",{rotate:!1})},hv={qualify:Ho,set:Mc("getTangentAtRatio",{rotate:!0})},FR={qualify:Ho,set:Mc("getTangentAtRatio",{rotate:!1})},GR=uv,zR=hv;function Mc(n,t){const e={x:1,y:0};return(r,i)=>{let s,o;const a=i.view,c=a[n](Number(r));return c?(o=t.rotate?c.vector().vectorAngle(e):0,s=c.start):(s=a.path.start,o=0),o===0?{transform:`translate(${s.x},${s.y}')`}:{transform:`translate(${s.x},${s.y}') rotate(${o})`}}}const UR=Object.freeze(Object.defineProperty({__proto__:null,annotations:aR,atConnectionLength:GR,atConnectionLengthIgnoreGradient:jR,atConnectionLengthKeepGradient:uv,atConnectionRatio:zR,atConnectionRatioIgnoreGradient:FR,atConnectionRatioKeepGradient:hv,connection:BR,displayEmpty:lR,eol:cR,fill:eR,filter:mR,html:gR,lineHeight:iR,port:bR,ref:jP,refCx:$P,refCy:HP,refD:YP,refDKeepOffset:XP,refDResetOffset:Qb,refDx:FP,refDy:GP,refHeight:Kb,refHeight2:tR,refPoints:JP,refPointsKeepOffset:WP,refPointsResetOffset:tv,refR:qP,refRCircumscribed:VP,refRInscribed:Zb,refRx:zP,refRy:UP,refWidth:Jb,refWidth2:QP,refX:qb,refX2:KP,refY:Yb,refY2:ZP,resetOffset:dR,sourceMarker:LR,stroke:nR,style:pR,targetMarker:IR,text:iv,textPath:oR,textVerticalAnchor:sR,textWrap:rR,title:uR,vertexMarker:DR,xAlign:hR,yAlign:fR},Symbol.toStringTag,{value:"Module"}));var vr;(function(n){function t(e,r,i){return!!(e!=null&&(typeof e=="string"||typeof e.qualify!="function"||Qt(e.qualify,this,r,i)))}n.isValidDefinition=t})(vr||(vr={}));(function(n){n.presets=Object.assign(Object.assign({},BP),UR),n.registry=rn.create({type:"attribute definition"}),n.registry.register(n.presets,!0)})(vr||(vr={}));const Kn={prefixCls:"x6",autoInsertCSS:!0,useCSSSelector:!0,prefix(n){return`${Kn.prefixCls}-${n}`}},Zp=Kn.prefix("highlighted"),VR={highlight(n,t,e){const r=e&&e.className||Zp;qt(t,r)},unhighlight(n,t,e){const r=e&&e.className||Zp;Fe(t,r)}},Qp=Kn.prefix("highlight-opacity"),$R={highlight(n,t){qt(t,Qp)},unhighlight(n,t){Fe(t,Qp)}};var Me;(function(n){n.normalizeMarker=ii;function t(h,d){const p=KM(h.x,h.y).matrixTransform(d);return new R(p.x,p.y)}n.transformPoint=t;function e(h,d){return new Ht(t(h.start,d),t(h.end,d))}n.transformLine=e;function r(h,d){let p=h instanceof en?h.points:h;return Array.isArray(p)||(p=[]),new en(p.map(m=>t(m,d)))}n.transformPolyline=r;function i(h,d){const m=ar("svg").createSVGPoint();m.x=h.x,m.y=h.y;const b=m.matrixTransform(d);m.x=h.x+h.width,m.y=h.y;const v=m.matrixTransform(d);m.x=h.x+h.width,m.y=h.y+h.height;const E=m.matrixTransform(d);m.x=h.x,m.y=h.y+h.height;const y=m.matrixTransform(d),O=Math.min(b.x,v.x,E.x,y.x),I=Math.max(b.x,v.x,E.x,y.x),G=Math.min(b.y,v.y,E.y,y.y),k=Math.max(b.y,v.y,E.y,y.y);return new Bt(O,G,I-O,k-G)}n.transformRectangle=i;function s(h,d,p){let m;const b=h.ownerSVGElement;if(!b)return new Bt(0,0,0,0);try{m=h.getBBox()}catch{m={x:h.clientLeft,y:h.clientTop,width:h.clientWidth,height:h.clientHeight}}if(d)return Bt.create(m);const v=po(h,p||b);return i(m,v)}n.bbox=s;function o(h,d={}){let p;if(!h.ownerSVGElement||!qr(h)){if(Vp(h)){const{left:E,top:y,width:O,height:I}=a(h);return new Bt(E,y,O,I)}return new Bt(0,0,0,0)}let b=d.target;if(!d.recursive){try{p=h.getBBox()}catch{p={x:h.clientLeft,y:h.clientTop,width:h.clientWidth,height:h.clientHeight}}if(!b)return Bt.create(p);const E=po(h,b);return i(p,E)}{const E=h.childNodes,y=E.length;if(y===0)return o(h,{target:b});b||(b=h);for(let O=0;O<y;O+=1){const I=E[O];let G;I.childNodes.length===0?G=o(I,{target:b}):G=o(I,{target:b,recursive:!0}),p?p=p.union(G):p=G}return p}}n.getBBox=o;function a(h){let d=0,p=0,m=0,b=0;if(h){let v=h;for(;v;)d+=v.offsetLeft,p+=v.offsetTop,v=v.offsetParent,v&&(d+=parseInt(Wp(v,"borderLeft"),10),p+=parseInt(Wp(v,"borderTop"),10));m=h.offsetWidth,b=h.offsetHeight}return{left:d,top:p,width:m,height:b}}n.getBoundingOffsetRect=a;function c(h){const d=p=>{const m=h.getAttribute(p),b=m?parseFloat(m):0;return Number.isNaN(b)?0:b};switch(h instanceof SVGElement&&h.nodeName.toLowerCase()){case"rect":return new Bt(d("x"),d("y"),d("width"),d("height"));case"circle":return new ir(d("cx"),d("cy"),d("r"),d("r"));case"ellipse":return new ir(d("cx"),d("cy"),d("rx"),d("ry"));case"polyline":{const p=Za(h);return new en(p)}case"polygon":{const p=Za(h);return p.length>1&&p.push(p[0]),new en(p)}case"path":{let p=h.getAttribute("d");return ne.isValid(p)||(p=ne.normalize(p)),ne.parse(p)}case"line":return new Ht(d("x1"),d("y1"),d("x2"),d("y2"))}return o(h)}n.toGeometryShape=c;function l(h,d,p,m){const b=R.create(d),v=R.create(p);m||(m=h instanceof SVGSVGElement?h:h.ownerSVGElement);const E=xu(h);h.setAttribute("transform","");const y=o(h,{target:m}).scale(E.sx,E.sy),O=uo();O.setTranslate(-y.x-y.width/2,-y.y-y.height/2);const I=uo(),G=b.angleBetween(v,b.clone().translate(1,0));G&&I.setRotate(G,0,0);const k=uo(),X=b.clone().move(v,y.width/2);k.setTranslate(2*b.x-X.x,2*b.y-X.y);const Z=po(h,m),at=uo();at.setMatrix(k.matrix.multiply(I.matrix.multiply(O.matrix.multiply(Z.scale(E.sx,E.sy))))),h.setAttribute("transform",Ds(at.matrix))}n.translateAndAutoOrient=l;function u(h){if(h==null)return null;let d=h;do{let p=d.tagName;if(typeof p!="string")return null;if(p=p.toUpperCase(),gr(d,"x6-port"))d=d.nextElementSibling;else if(p==="G")d=d.firstElementChild;else if(p==="TITLE")d=d.nextElementSibling;else break}while(d);return d}n.findShapeNode=u;function f(h){const d=u(h);if(!qr(d)){if(Vp(h)){const{left:b,top:v,width:E,height:y}=a(h);return new Bt(b,v,E,y)}return new Bt(0,0,0,0)}return c(d).bbox()||Bt.create()}n.getBBoxV2=f})(Me||(Me={}));const HR={padding:3,rx:0,ry:0,attrs:{"stroke-width":3,stroke:"#FEB663"}},XR={highlight(n,t,e){const r=zr.getHighlighterId(t,e);if(zr.hasCache(r))return;e=Bg({},e,HR);const i=ae.create(t);let s,o;try{s=i.toPathData()}catch{o=Me.bbox(i.node,!0),s=jb(Object.assign(Object.assign({},e),o))}const a=ar("path");if(ye(a,Object.assign({d:s,"pointer-events":"none","vector-effect":"non-scaling-stroke",fill:"none"},e.attrs?_o(e.attrs):null)),n.isEdgeElement(t))ye(a,"d",n.getConnectionPathData());else{let u=i.getTransformToElement(n.container);const f=e.padding;if(f){o==null&&(o=Me.bbox(i.node,!0));const h=o.x+o.width/2,d=o.y+o.height/2;o=Me.transformRectangle(o,u);const p=Math.max(o.width,1),m=Math.max(o.height,1),b=(p+f)/p,v=(m+f)/m,E=xn({a:b,b:0,c:0,d:v,e:h-b*h,f:d-v*d});u=u.multiply(E)}gs(a,u)}qt(a,Kn.prefix("highlight-stroke"));const c=n.cell,l=()=>zr.removeHighlighter(r);c.on("removed",l),c.model&&c.model.on("reseted",l),n.container.appendChild(a),zr.setCache(r,a)},unhighlight(n,t,e){zr.removeHighlighter(zr.getHighlighterId(t,e))}};var zr;(function(n){function t(o,a){return ih(o),o.id+JSON.stringify(a)}n.getHighlighterId=t;const e={};function r(o,a){e[o]=a}n.setCache=r;function i(o){return e[o]!=null}n.hasCache=i;function s(o){const a=e[o];a&&(Yn(a),delete e[o])}n.removeHighlighter=s})(zr||(zr={}));const WR=Object.freeze(Object.defineProperty({__proto__:null,className:VR,opacity:$R,stroke:XR},Symbol.toStringTag,{value:"Module"}));var _r;(function(n){function t(e,r){if(typeof r.highlight!="function")throw new Error(`Highlighter '${e}' is missing required \`highlight()\` method`);if(typeof r.unhighlight!="function")throw new Error(`Highlighter '${e}' is missing required \`unhighlight()\` method`)}n.check=t})(_r||(_r={}));(function(n){n.presets=WR,n.registry=rn.create({type:"highlighter"}),n.registry.register(n.presets,!0)})(_r||(_r={}));function Tu(n,t={}){return new R(nr(t.x,n.width),nr(t.y,n.height))}function ph(n,t,e){return Object.assign({angle:t,position:n.toJSON()},e)}const qR=(n,t)=>n.map(({x:e,y:r,angle:i})=>ph(Tu(t,{x:e,y:r}),i||0)),YR=(n,t,e)=>{const r=e.start||0,i=e.step||20;return fv(n,t,r,(s,o)=>(s+.5-o/2)*i)},JR=(n,t,e)=>{const r=e.start||0,i=e.step||360/n.length;return fv(n,t,r,s=>s*i)};function fv(n,t,e,r){const i=t.getCenter(),s=t.getTopCenter(),o=t.width/t.height,a=ir.fromRect(t),c=n.length;return n.map((l,u)=>{const f=e+r(u,c),h=s.clone().rotate(-f,i).scale(o,1,i),d=l.compensateRotate?-a.tangentTheta(h):0;return(l.dx||l.dy)&&h.translate(l.dx||0,l.dy||0),l.dr&&h.move(i,l.dr),ph(h.round(),d,l)})}var KR=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};const ZR=(n,t,e)=>{const r=Tu(t,e.start||t.getOrigin()),i=Tu(t,e.end||t.getCorner());return Xo(n,r,i,e)},QR=(n,t,e)=>Xo(n,t.getTopLeft(),t.getBottomLeft(),e),tN=(n,t,e)=>Xo(n,t.getTopRight(),t.getBottomRight(),e),eN=(n,t,e)=>Xo(n,t.getTopLeft(),t.getTopRight(),e),nN=(n,t,e)=>Xo(n,t.getBottomLeft(),t.getBottomRight(),e);function Xo(n,t,e,r){const i=new Ht(t,e),s=n.length;return n.map((o,a)=>{var{strict:c}=o,l=KR(o,["strict"]);const u=c||r.strict?(a+1)/(s+1):(a+.5)/s,f=i.pointAt(u);return(l.dx||l.dy)&&f.translate(l.dx||0,l.dy||0),ph(f.round(),0,l)})}const rN=Object.freeze(Object.defineProperty({__proto__:null,absolute:qR,bottom:nN,ellipse:YR,ellipseSpread:JR,left:QR,line:ZR,right:tN,top:eN},Symbol.toStringTag,{value:"Module"}));var Ti;(function(n){n.presets=rN,n.registry=rn.create({type:"port layout"}),n.registry.register(n.presets,!0)})(Ti||(Ti={}));const iN={position:{x:0,y:0},angle:0,attrs:{".":{y:"0","text-anchor":"start"}}};function si(n,t){const{x:e,y:r,angle:i,attrs:s}=t||{};return Bg({},{angle:i,attrs:s,position:{x:e,y:r}},n,iN)}const sN=(n,t,e)=>si({position:t.getTopLeft()},e),oN=(n,t,e)=>si({position:{x:-15,y:0},attrs:{".":{y:".3em","text-anchor":"end"}}},e),aN=(n,t,e)=>si({position:{x:15,y:0},attrs:{".":{y:".3em","text-anchor":"start"}}},e),cN=(n,t,e)=>si({position:{x:0,y:-15},attrs:{".":{"text-anchor":"middle"}}},e),lN=(n,t,e)=>si({position:{x:0,y:15},attrs:{".":{y:".6em","text-anchor":"middle"}}},e),uN=(n,t,e)=>dv(n,t,!1,e),hN=(n,t,e)=>dv(n,t,!0,e),fN=(n,t,e)=>pv(n,t,!1,e),dN=(n,t,e)=>pv(n,t,!0,e);function dv(n,t,e,r){const i=r.offset!=null?r.offset:15,s=t.getCenter().theta(n),o=gv(t);let a,c,l,u,f=0;return s<o[1]||s>o[2]?(a=".3em",c=i,l=0,u="start"):s<o[0]?(a="0",c=0,l=-i,e?(f=-90,u="start"):u="middle"):s<o[3]?(a=".3em",c=-i,l=0,u="end"):(a=".6em",c=0,l=i,e?(f=90,u="start"):u="middle"),si({position:{x:Math.round(c),y:Math.round(l)},angle:f,attrs:{".":{y:a,"text-anchor":u}}},r)}function pv(n,t,e,r){const i=r.offset!=null?r.offset:15,s=t.getCenter().theta(n),o=gv(t);let a,c,l,u,f=0;return s<o[1]||s>o[2]?(a=".3em",c=-i,l=0,u="end"):s<o[0]?(a=".6em",c=0,l=i,e?(f=90,u="start"):u="middle"):s<o[3]?(a=".3em",c=i,l=0,u="start"):(a="0em",c=0,l=-i,e?(f=-90,u="start"):u="middle"),si({position:{x:Math.round(c),y:Math.round(l)},angle:f,attrs:{".":{y:a,"text-anchor":u}}},r)}function gv(n){const t=n.getCenter(),e=t.theta(n.getTopLeft()),r=t.theta(n.getBottomLeft()),i=t.theta(n.getBottomRight()),s=t.theta(n.getTopRight());return[e,s,i,r]}const pN=(n,t,e)=>mv(n.diff(t.getCenter()),!1,e),gN=(n,t,e)=>mv(n.diff(t.getCenter()),!0,e);function mv(n,t,e){const r=e.offset!=null?e.offset:20,i=new R(0,0),s=-n.theta(i),o=n.clone().move(i,r).diff(n).round();let a=".3em",c,l=s;return(s+90)%180===0?(c=t?"end":"middle",!t&&s===-270&&(a="0em")):s>-270&&s<-90?(c="start",l=s-180):c="end",si({position:o.round().toJSON(),angle:t?l:0,attrs:{".":{y:a,"text-anchor":c}}},e)}const mN=Object.freeze(Object.defineProperty({__proto__:null,bottom:lN,inside:fN,insideOriented:dN,left:oN,manual:sN,outside:uN,outsideOriented:hN,radial:pN,radialOriented:gN,right:aN,top:cN},Symbol.toStringTag,{value:"Module"}));var ys;(function(n){n.presets=mN,n.registry=rn.create({type:"port label layout"}),n.registry.register(n.presets,!0)})(ys||(ys={}));var bN=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Ce extends $e{get priority(){return 2}get disposeContainer(){return!0}constructor(){super(),this.cid=Cu.uniqueId(),Ce.views[this.cid]=this}confirmUpdate(t,e){return 0}empty(t=this.container){return $o(t),this}unmount(t=this.container){return Yn(t),this}remove(t=this.container){return t===this.container?(this.removeEventListeners(document),this.onRemove(),delete Ce.views[this.cid],this.disposeContainer&&this.unmount(t)):this.unmount(t),this}onRemove(){}setClass(t,e=this.container){e.classList.value=Array.isArray(t)?t.join(" "):t}addClass(t,e=this.container){return qt(e,Array.isArray(t)?t.join(" "):t),this}removeClass(t,e=this.container){return Fe(e,Array.isArray(t)?t.join(" "):t),this}setStyle(t,e=this.container){return dn(e,t),this}setAttrs(t,e=this.container){return t!=null&&e!=null&&ye(e,t),this}findAttr(t,e=this.container){let r=e;for(;r&&r.nodeType===1;){const i=r.getAttribute(t);if(i!=null)return i;if(r===this.container)return null;r=r.parentNode}return null}find(t,e=this.container,r=this.selectors){return Ce.find(t,e,r).elems}findOne(t,e=this.container,r=this.selectors){const i=this.find(t,e,r);return i.length>0?i[0]:null}findByAttr(t,e=this.container){let r=e;for(;r&&r.getAttribute;){const i=r.getAttribute(t);if((i!=null||r===this.container)&&i!=="false")return r;r=r.parentNode}return null}getSelector(t,e){let r;if(t===this.container)return typeof e=="string"&&(r=`> ${e}`),r;if(t){const i=oh(t)+1;r=`${t.tagName.toLowerCase()}:nth-child(${i})`,e&&(r+=` > ${e}`),r=this.getSelector(t.parentNode,r)}return r}prefixClassName(t){return Kn.prefix(t)}delegateEvents(t,e){if(t==null)return this;e||this.undelegateEvents();const r=/^(\S+)\s*(.*)$/;return Object.keys(t).forEach(i=>{const s=i.match(r);if(s==null)return;const o=this.getEventHandler(t[i]);typeof o=="function"&&this.delegateEvent(s[1],s[2],o)}),this}undelegateEvents(){return Tn.off(this.container,this.getEventNamespace()),this}delegateDocumentEvents(t,e){return this.addEventListeners(document,t,e),this}undelegateDocumentEvents(){return this.removeEventListeners(document),this}delegateEvent(t,e,r){return Tn.on(this.container,t+this.getEventNamespace(),e,r),this}undelegateEvent(t,e,r){const i=t+this.getEventNamespace();return e==null?Tn.off(this.container,i):typeof e=="string"?Tn.off(this.container,i,e,r):Tn.off(this.container,i,e),this}addEventListeners(t,e,r){if(e==null)return this;const i=this.getEventNamespace();return Object.keys(e).forEach(s=>{const o=this.getEventHandler(e[s]);typeof o=="function"&&Tn.on(t,s+i,r,o)}),this}removeEventListeners(t){return t!=null&&Tn.off(t,this.getEventNamespace()),this}getEventNamespace(){return`.${Kn.prefixCls}-event-${this.cid}`}getEventHandler(t){let e;if(typeof t=="string"){const r=this[t];typeof r=="function"&&(e=(...i)=>r.call(this,...i))}else e=(...r)=>t.call(this,...r);return e}getEventTarget(t,e={}){const{target:r,type:i,clientX:s=0,clientY:o=0}=t;return e.fromPoint||i==="touchmove"||i==="touchend"?document.elementFromPoint(s,o):r}stopPropagation(t){return this.setEventData(t,{propagationStopped:!0}),this}isPropagationStopped(t){return this.getEventData(t).propagationStopped===!0}getEventData(t){return this.eventData(t)}setEventData(t,e){return this.eventData(t,e)}eventData(t,e){if(t==null)throw new TypeError("Event object required");let r=t.data;const i=`__${this.cid}__`;return e==null?r==null?{}:r[i]||{}:(r==null&&(r=t.data={}),r[i]==null?r[i]=Object.assign({},e):r[i]=Object.assign(Object.assign({},r[i]),e),r[i])}normalizeEvent(t){return Ce.normalizeEvent(t)}dispose(){this.remove()}}bN([Ce.dispose()],Ce.prototype,"dispose",null);(function(n){function t(i,s){return s?ar(i||"g"):sh(i||"div")}n.createElement=t;function e(i,s,o){if(!i||i===".")return{elems:[s]};if(o){const a=o[i];if(a)return{elems:Array.isArray(a)?a:[a]}}{const a=i.includes(">")?`:scope ${i}`:i;return{isCSSSelector:!0,elems:Array.prototype.slice.call(s.querySelectorAll(a))}}}n.find=e;function r(i){let s=i;const o=i.originalEvent,a=o&&o.changedTouches&&o.changedTouches[0];if(a){for(const c in i)a[c]===void 0&&(a[c]=i[c]);s=a}return s}n.normalizeEvent=r})(Ce||(Ce={}));(function(n){n.views={};function t(e){return n.views[e]||null}n.getView=t})(Ce||(Ce={}));var Cu;(function(n){let t=0;function e(){const r=`v${t}`;return t+=1,r}n.uniqueId=e})(Cu||(Cu={}));class vN{constructor(t){this.view=t,this.clean()}clean(){this.elemCache&&this.elemCache.dispose(),this.elemCache=new Su,this.pathCache={}}get(t){return this.elemCache.has(t)||this.elemCache.set(t,{}),this.elemCache.get(t)}getData(t){const e=this.get(t);return e.data||(e.data={}),e.data}getMatrix(t){const e=this.get(t);if(e.matrix==null){const r=this.view.container;e.matrix=nP(t,r)}return xn(e.matrix)}getShape(t){const e=this.get(t);return e.shape==null&&(e.shape=Me.toGeometryShape(t)),e.shape.clone()}getBoundingRect(t){const e=this.get(t);return e.boundingRect==null&&(e.boundingRect=Me.getBBoxV2(t)),e.boundingRect.clone()}}var ke;(function(n){function t(l){return l!=null&&!e(l)}n.isJSONMarkup=t;function e(l){return l!=null&&typeof l=="string"}n.isStringMarkup=e;function r(l){return l==null||e(l)?l:De(l)}n.clone=r;function i(l){return`${l}`.trim().replace(/[\r|\n]/g," ").replace(/>\s+</g,"><")}n.sanitize=i;function s(l,u={ns:yn.svg}){const f=document.createDocumentFragment(),h={},d={},p=[{markup:Array.isArray(l)?l:[l],parent:f,ns:u.ns}];for(;p.length>0;){const m=p.pop();let b=m.ns||yn.svg;const v=m.markup,E=m.parent;v.forEach(y=>{const O=y.tagName;if(!O)throw new TypeError("Invalid tagName");y.ns&&(b=y.ns);const I=b?sh(O,b):Up(O),G=y.attrs;G&&ye(I,_o(G));const k=y.style;k&&dn(I,k);const X=y.className;X!=null&&I.setAttribute("class",Array.isArray(X)?X.join(" "):X),y.textContent&&(I.textContent=y.textContent);const Z=y.selector;if(Z!=null){if(d[Z])throw new TypeError("Selector must be unique");d[Z]=I}if(y.groupSelector){let ft=y.groupSelector;Array.isArray(ft)||(ft=[ft]),ft.forEach(H=>{h[H]||(h[H]=[]),h[H].push(I)})}E.appendChild(I);const at=y.children;Array.isArray(at)&&p.push({ns:b,markup:at,parent:I})})}return Object.keys(h).forEach(m=>{if(d[m])throw new Error("Ambiguous group selector");d[m]=h[m]}),{fragment:f,selectors:d,groups:h}}n.parseJSONMarkup=s;function o(l){return l instanceof SVGElement?ar("g"):Up("div")}function a(l){if(e(l)){const d=ae.createVectors(l),p=d.length;if(p===1)return{elem:d[0].node};if(p>1){const m=o(d[0].node);return d.forEach(b=>{m.appendChild(b.node)}),{elem:m}}return{}}const u=s(l),f=u.fragment;let h=null;return f.childNodes.length>1?(h=o(f.firstChild),h.appendChild(f)):h=f.firstChild,{elem:h,selectors:u.selectors}}n.renderMarkup=a;function c(l){const u=ae.createVectors(l),f=document.createDocumentFragment();for(let h=0,d=u.length;h<d;h+=1){const p=u[h].node;f.appendChild(p)}return{fragment:f,selectors:{}}}n.parseLabelStringMarkup=c})(ke||(ke={}));(function(n){function t(e,r,i){if(e!=null){let s;const o=e.tagName.toLowerCase();if(e===r)return typeof i=="string"?s=`> ${o} > ${i}`:s=`> ${o}`,s;const a=e.parentNode;if(a&&a.childNodes.length>1){const c=oh(e)+1;s=`${o}:nth-child(${c})`}else s=o;return i&&(s+=` > ${i}`),t(e.parentNode,r,s)}return i}n.getSelector=t})(ke||(ke={}));(function(n){function t(){return"g"}n.getPortContainerMarkup=t;function e(){return{tagName:"circle",selector:"circle",attrs:{r:10,fill:"#FFFFFF",stroke:"#000000"}}}n.getPortMarkup=e;function r(){return{tagName:"text",selector:"text",attrs:{fill:"#000000"}}}n.getPortLabelMarkup=r})(ke||(ke={}));(function(n){function t(){return[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}]}n.getEdgeMarkup=t})(ke||(ke={}));(function(n){function t(e=!1){return{tagName:"foreignObject",selector:"fo",children:[{ns:yn.xhtml,tagName:"body",selector:"foBody",attrs:{xmlns:yn.xhtml},style:{width:"100%",height:"100%",background:"transparent"},children:e?[]:[{tagName:"div",selector:"foContent",style:{width:"100%",height:"100%"}}]}]}}n.getForeignObjectMarkup=t})(ke||(ke={}));class bv{constructor(t){this.view=t}get cell(){return this.view.cell}getDefinition(t){return this.cell.getAttrDefinition(t)}processAttrs(t,e){let r,i,s,o;const a=[];return Object.keys(e).forEach(c=>{const l=e[c],u=this.getDefinition(c),f=Qt(vr.isValidDefinition,this.view,u,l,{elem:t,attrs:e,cell:this.cell,view:this.view});if(u&&f)typeof u=="string"?(r==null&&(r={}),r[u]=l):l!==null&&a.push({name:c,definition:u});else{r==null&&(r={});const h=Pb.includes(c)?c:fb(c);r[h]=l}}),a.forEach(({name:c,definition:l})=>{const u=e[c];typeof l.set=="function"&&(i==null&&(i={}),i[c]=u),typeof l.offset=="function"&&(s==null&&(s={}),s[c]=u),typeof l.position=="function"&&(o==null&&(o={}),o[c]=u)}),{raw:e,normal:r,set:i,offset:s,position:o}}mergeProcessedAttrs(t,e){t.set=Object.assign(Object.assign({},t.set),e.set),t.position=Object.assign(Object.assign({},t.position),e.position),t.offset=Object.assign(Object.assign({},t.offset),e.offset);const r=t.normal&&t.normal.transform;r!=null&&e.normal&&(e.normal.transform=r),t.normal=e.normal}findAttrs(t,e,r,i){const s=[],o=new Su;return Object.keys(t).forEach(a=>{const c=t[a];if(!Rr(c))return;const{isCSSSelector:l,elems:u}=Ce.find(a,e,i);r[a]=u;for(let f=0,h=u.length;f<h;f+=1){const d=u[f],p=i&&i[a]===d,m=o.get(d);if(m){m.array||(s.push(d),m.array=!0,m.attrs=[m.attrs],m.priority=[m.priority]);const b=m.attrs,v=m.priority;if(p)b.unshift(c),v.unshift(-1);else{const E=RA(v,l?-1:h);b.splice(E,0,c),v.splice(E,0,h)}}else o.set(d,{elem:d,attrs:c,priority:p?-1:h,array:!1})}}),s.forEach(a=>{const c=o.get(a),l=c.attrs;c.attrs=l.reduceRight((u,f)=>an(u,f),{})}),o}updateRelativeAttrs(t,e,r){const i=e.raw||{};let s=e.normal||{};const o=e.set,a=e.position,c=e.offset,l=()=>({elem:t,cell:this.cell,view:this.view,attrs:i,refBBox:r.clone()});if(o!=null&&Object.keys(o).forEach(b=>{const v=o[b],E=this.getDefinition(b);if(E!=null){const y=Qt(E.set,this.view,v,l());typeof y=="object"?s=Object.assign(Object.assign({},s),y):y!=null&&(s[b]=y)}}),t instanceof HTMLElement){this.view.setAttrs(s,t);return}const u=s.transform,f=u?`${u}`:null,h=Oo(f),d=new R(h.e,h.f);u&&(delete s.transform,h.e=0,h.f=0);let p=!1;a!=null&&Object.keys(a).forEach(b=>{const v=a[b],E=this.getDefinition(b);if(E!=null){const y=Qt(E.position,this.view,v,l());y!=null&&(p=!0,d.translate(R.create(y)))}}),this.view.setAttrs(s,t);let m=!1;if(c!=null){const b=this.view.getBoundingRectOfElement(t);if(b.width>0&&b.height>0){const v=Me.transformRectangle(b,h);Object.keys(c).forEach(E=>{const y=c[E],O=this.getDefinition(E);if(O!=null){const I=Qt(O.offset,this.view,y,{elem:t,cell:this.cell,view:this.view,attrs:i,refBBox:v});I!=null&&(m=!0,d.translate(R.create(I)))}})}}(u!=null||p||m)&&(d.round(1),h.e=d.x,h.f=d.y,t.setAttribute("transform",Ds(h)))}update(t,e,r){const i={},s=this.findAttrs(r.attrs||e,t,i,r.selectors),o=r.attrs?this.findAttrs(e,t,i,r.selectors):s,a=[];s.each(u=>{const f=u.elem,h=u.attrs,d=this.processAttrs(f,h);if(d.set==null&&d.position==null&&d.offset==null)this.view.setAttrs(d.normal,f);else{const p=o.get(f),m=p?p.attrs:null,b=m&&h.ref==null?m.ref:h.ref;let v;if(b){if(v=(i[b]||this.view.find(b,t,r.selectors))[0],!v)throw new Error(`"${b}" reference does not exist.`)}else v=null;const E={node:f,refNode:v,attributes:m,processedAttributes:d},y=a.findIndex(O=>O.refNode===f);y>-1?a.splice(y,0,E):a.push(E)}});const c=new Su;let l;a.forEach(u=>{const f=u.node,h=u.refNode;let d;const p=h!=null&&r.rotatableNode!=null&&ah(r.rotatableNode,h);if(h&&(d=c.get(h)),!d){const v=p?r.rotatableNode:t;d=h?Me.getBBox(h,{target:v}):r.rootBBox,h&&c.set(h,d)}let m;r.attrs&&u.attributes?(m=this.processAttrs(f,u.attributes),this.mergeProcessedAttrs(m,u.processedAttributes)):m=u.processedAttributes;let b=d;p&&r.rotatableNode!=null&&!r.rotatableNode.contains(f)&&(l||(l=Oo(ye(r.rotatableNode,"transform"))),b=Me.transformRectangle(d,l)),this.updateRelativeAttrs(f,m,b)})}}class vv{get cell(){return this.view.cell}constructor(t,e,r=[]){this.view=t;const i={},s={};let o=0;Object.keys(e).forEach(c=>{let l=e[c];Array.isArray(l)||(l=[l]),l.forEach(u=>{let f=i[u];f||(o+=1,f=i[u]=1<<o),s[c]|=f})});let a=r;if(Array.isArray(a)||(a=[a]),a.forEach(c=>{i[c]||(o+=1,i[c]=1<<o)}),o>25)throw new Error("Maximum number of flags exceeded.");this.flags=i,this.attrs=s,this.bootstrap=r}getFlag(t){const e=this.flags;return e==null?0:Array.isArray(t)?t.reduce((r,i)=>r|e[i],0):e[t]|0}hasAction(t,e){return t&this.getFlag(e)}removeAction(t,e){return t^t&this.getFlag(e)}getBootstrapFlag(){return this.getFlag(this.bootstrap)}getChangedFlag(){let t=0;return this.attrs&&Object.keys(this.attrs).forEach(e=>{this.cell.hasChanged(e)&&(t|=this.attrs[e])}),t}}var yN=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},EN=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class nn extends Ce{static getDefaults(){return this.defaults}static config(t){this.defaults=this.getOptions(t)}static getOptions(t){const e=(l,u)=>u!=null?Gg([...Array.isArray(l)?l:[l],...Array.isArray(u)?u:[u]]):Array.isArray(l)?[...l]:[l],r=De(this.getDefaults()),{bootstrap:i,actions:s,events:o,documentEvents:a}=t,c=EN(t,["bootstrap","actions","events","documentEvents"]);return i&&(r.bootstrap=e(r.bootstrap,i)),s&&Object.entries(s).forEach(([l,u])=>{const f=r.actions[l];u&&f?r.actions[l]=e(f,u):u&&(r.actions[l]=e(u))}),o&&(r.events=Object.assign(Object.assign({},r.events),o)),t.documentEvents&&(r.documentEvents=Object.assign(Object.assign({},r.documentEvents),a)),an(r,c)}get[Symbol.toStringTag](){return nn.toStringTag}constructor(t,e={}){super(),this.cell=t,this.options=this.ensureOptions(e),this.graph=this.options.graph,this.attr=new bv(this),this.flag=new vv(this,this.options.actions,this.options.bootstrap),this.cache=new vN(this),this.setContainer(this.ensureContainer()),this.setup(),this.init()}init(){}onRemove(){this.removeTools()}get priority(){return this.options.priority}get rootSelector(){return this.options.rootSelector}getConstructor(){return this.constructor}ensureOptions(t){return this.getConstructor().getOptions(t)}getContainerTagName(){return this.options.isSvgElement?"g":"div"}getContainerStyle(){}getContainerAttrs(){return{"data-cell-id":this.cell.id,"data-shape":this.cell.shape}}getContainerClassName(){return this.prefixClassName("cell")}ensureContainer(){return Ce.createElement(this.getContainerTagName(),this.options.isSvgElement)}setContainer(t){if(this.container!==t){this.undelegateEvents(),this.container=t,this.options.events!=null&&this.delegateEvents(this.options.events);const e=this.getContainerAttrs();e!=null&&this.setAttrs(e,t);const r=this.getContainerStyle();r!=null&&this.setStyle(r,t);const i=this.getContainerClassName();i!=null&&this.addClass(i,t)}return this}isNodeView(){return!1}isEdgeView(){return!1}render(){return this}confirmUpdate(t,e={}){return 0}getBootstrapFlag(){return this.flag.getBootstrapFlag()}getFlag(t){return this.flag.getFlag(t)}hasAction(t,e){return this.flag.hasAction(t,e)}removeAction(t,e){return this.flag.removeAction(t,e)}handleAction(t,e,r,i){if(this.hasAction(t,e)){r();const s=[e];return i&&(typeof i=="string"?s.push(i):s.push(...i)),this.removeAction(t,s)}return t}setup(){this.cell.on("changed",this.onCellChanged,this)}onCellChanged({options:t}){this.onAttrsChange(t)}onAttrsChange(t){let e=this.flag.getChangedFlag();t.updated||!e||(t.dirty&&this.hasAction(e,"update")&&(e|=this.getFlag("render")),t.toolId&&(t.async=!1),this.graph!=null&&this.graph.renderer.requestViewUpdate(this,e,t))}parseJSONMarkup(t,e){const r=ke.parseJSONMarkup(t),i=r.selectors,s=this.rootSelector;if(e&&s){if(i[s])throw new Error("Invalid root selector");i[s]=e}return r}can(t){let e=this.graph.options.interacting;if(typeof e=="function"&&(e=Qt(e,this.graph,this)),typeof e=="object"){let r=e[t];return typeof r=="function"&&(r=Qt(r,this.graph,this)),r!==!1}return typeof e=="boolean"?e:!1}cleanCache(){return this.cache.clean(),this}getCache(t){return this.cache.get(t)}getDataOfElement(t){return this.cache.getData(t)}getMatrixOfElement(t){return this.cache.getMatrix(t)}getShapeOfElement(t){return this.cache.getShape(t)}getBoundingRectOfElement(t){return this.cache.getBoundingRect(t)}getBBoxOfElement(t){const e=this.getBoundingRectOfElement(t),r=this.getMatrixOfElement(t),i=this.getRootRotatedMatrix(),s=this.getRootTranslatedMatrix();return Me.transformRectangle(e,s.multiply(i).multiply(r))}getUnrotatedBBoxOfElement(t){const e=this.getBoundingRectOfElement(t),r=this.getMatrixOfElement(t),i=this.getRootTranslatedMatrix();return Me.transformRectangle(e,i.multiply(r))}getBBox(t={}){let e;if(t.useCellGeometry){const r=this.cell,i=r.isNode()?r.getAngle():0;e=r.getBBox().bbox(i)}else e=this.getBBoxOfElement(this.container);return this.graph.coord.localToGraphRect(e)}getRootTranslatedMatrix(){const t=this.cell,e=t.isNode()?t.getPosition():{x:0,y:0};return xn().translate(e.x,e.y)}getRootRotatedMatrix(){let t=xn();const e=this.cell,r=e.isNode()?e.getAngle():0;if(r){const i=e.getBBox(),s=i.width/2,o=i.height/2;t=t.translate(s,o).rotate(r).translate(-s,-o)}return t}findMagnet(t=this.container){return this.findByAttr("magnet",t)}updateAttrs(t,e,r={}){r.rootBBox==null&&(r.rootBBox=new Bt),r.selectors==null&&(r.selectors=this.selectors),this.attr.update(t,e,r)}isEdgeElement(t){return this.cell.isEdge()&&(t==null||t===this.container)}prepareHighlight(t,e={}){const r=t||this.container;return e.partial=r===this.container,r}highlight(t,e={}){const r=this.prepareHighlight(t,e);return this.notify("cell:highlight",{magnet:r,options:e,view:this,cell:this.cell}),this.isEdgeView()?this.notify("edge:highlight",{magnet:r,options:e,view:this,edge:this.cell,cell:this.cell}):this.isNodeView()&&this.notify("node:highlight",{magnet:r,options:e,view:this,node:this.cell,cell:this.cell}),this}unhighlight(t,e={}){const r=this.prepareHighlight(t,e);return this.notify("cell:unhighlight",{magnet:r,options:e,view:this,cell:this.cell}),this.isNodeView()?this.notify("node:unhighlight",{magnet:r,options:e,view:this,node:this.cell,cell:this.cell}):this.isEdgeView()&&this.notify("edge:unhighlight",{magnet:r,options:e,view:this,edge:this.cell,cell:this.cell}),this}notifyUnhighlight(t,e){}getEdgeTerminal(t,e,r,i,s){const o=this.cell,a=this.findAttr("port",t),c=t.getAttribute("data-selector"),l={cell:o.id};return c!=null&&(l.magnet=c),a!=null?(l.port=a,o.isNode()&&!o.hasPort(a)&&c==null&&(l.selector=this.getSelector(t))):c==null&&this.container!==t&&(l.selector=this.getSelector(t)),l}getMagnetFromEdgeTerminal(t){const e=this.cell,r=this.container,i=t.port;let s=t.magnet,o;return i!=null&&e.isNode()&&e.hasPort(i)?o=this.findPortElem(i,s)||r:(s||(s=t.selector),!s&&i!=null&&(s=`[port="${i}"]`),o=this.findOne(s,r,this.selectors)),o}hasTools(t){const e=this.tools;return e==null?!1:t==null?!0:e.name===t}addTools(t){if(this.removeTools(),t){if(!this.can("toolsAddable"))return this;const e=cn.isToolsView(t)?t:new cn(t);this.tools=e,e.config({view:this}),e.mount()}return this}updateTools(t={}){return this.tools&&this.tools.update(t),this}removeTools(){return this.tools&&(this.tools.remove(),this.tools=null),this}hideTools(){return this.tools&&this.tools.hide(),this}showTools(){return this.tools&&this.tools.show(),this}renderTools(){const t=this.cell.getTools();return this.addTools(t),this}notify(t,e){return this.trigger(t,e),this.graph.trigger(t,e),this}getEventArgs(t,e,r){const i=this,s=i.cell;return e==null||r==null?{e:t,view:i,cell:s}:{e:t,x:e,y:r,view:i,cell:s}}onClick(t,e,r){this.notify("cell:click",this.getEventArgs(t,e,r))}onDblClick(t,e,r){this.notify("cell:dblclick",this.getEventArgs(t,e,r))}onContextMenu(t,e,r){this.notify("cell:contextmenu",this.getEventArgs(t,e,r))}onMouseDown(t,e,r){this.cell.model&&(this.cachedModelForMouseEvent=this.cell.model,this.cachedModelForMouseEvent.startBatch("mouse")),this.notify("cell:mousedown",this.getEventArgs(t,e,r))}onMouseUp(t,e,r){this.notify("cell:mouseup",this.getEventArgs(t,e,r)),this.cachedModelForMouseEvent&&(this.cachedModelForMouseEvent.stopBatch("mouse",{cell:this.cell}),this.cachedModelForMouseEvent=null)}onMouseMove(t,e,r){this.notify("cell:mousemove",this.getEventArgs(t,e,r))}onMouseOver(t){this.notify("cell:mouseover",this.getEventArgs(t))}onMouseOut(t){this.notify("cell:mouseout",this.getEventArgs(t))}onMouseEnter(t){this.notify("cell:mouseenter",this.getEventArgs(t))}onMouseLeave(t){this.notify("cell:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,r,i){this.notify("cell:mousewheel",Object.assign({delta:i},this.getEventArgs(t,e,r)))}onCustomEvent(t,e,r,i){this.notify("cell:customevent",Object.assign({name:e},this.getEventArgs(t,r,i))),this.notify(e,Object.assign({},this.getEventArgs(t,r,i)))}onMagnetMouseDown(t,e,r,i){}onMagnetDblClick(t,e,r,i){}onMagnetContextMenu(t,e,r,i){}onLabelMouseDown(t,e,r){}checkMouseleave(t){const e=this.getEventTarget(t,{fromPoint:!0}),r=this.graph.findViewByElem(e);r!==this&&(this.onMouseLeave(t),r&&r.onMouseEnter(t))}dispose(){this.cell.off("changed",this.onCellChanged,this)}}nn.defaults={isSvgElement:!0,rootSelector:"root",priority:0,bootstrap:[],actions:{}};yN([nn.dispose()],nn.prototype,"dispose",null);(function(n){n.Flag=vv,n.Attr=bv})(nn||(nn={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNodeView=="function"&&typeof i.isEdgeView=="function"&&typeof i.confirmUpdate=="function"}n.isCellView=t})(nn||(nn={}));(function(n){function t(r){return function(i){i.config({priority:r})}}n.priority=t;function e(r){return function(i){i.config({bootstrap:r})}}n.bootstrap=e})(nn||(nn={}));(function(n){n.registry=rn.create({type:"view"})})(nn||(nn={}));class cn extends Ce{get name(){return this.options.name}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get[Symbol.toStringTag](){return cn.toStringTag}constructor(t={}){super(),this.svgContainer=this.createContainer(!0,t),this.htmlContainer=this.createContainer(!1,t),this.config(t)}createContainer(t,e){const r=t?Ce.createElement("g",!0):Ce.createElement("div",!1);return qt(r,this.prefixClassName("cell-tools")),e.className&&qt(r,e.className),r}config(t){if(this.options=Object.assign(Object.assign({},this.options),t),!nn.isCellView(t.view)||t.view===this.cellView)return this;this.cellView=t.view,this.cell.isEdge()?(qt(this.svgContainer,this.prefixClassName("edge-tools")),qt(this.htmlContainer,this.prefixClassName("edge-tools"))):this.cell.isNode()&&(qt(this.svgContainer,this.prefixClassName("node-tools")),qt(this.htmlContainer,this.prefixClassName("node-tools"))),this.svgContainer.setAttribute("data-cell-id",this.cell.id),this.htmlContainer.setAttribute("data-cell-id",this.cell.id),this.name&&(this.svgContainer.setAttribute("data-tools-name",this.name),this.htmlContainer.setAttribute("data-tools-name",this.name));const e=this.options.items;if(!Array.isArray(e))return this;this.tools=[];const r=[];e.forEach(i=>{cn.ToolItem.isToolItem(i)?i.name==="vertices"?r.unshift(i):r.push(i):(typeof i=="object"?i.name:i)==="vertices"?r.unshift(i):r.push(i)});for(let i=0;i<r.length;i+=1){const s=r[i];let o;if(cn.ToolItem.isToolItem(s))o=s;else{const a=typeof s=="object"?s.name:s,c=typeof s=="object"?s.args||{}:{};if(a){if(this.cell.isNode()){const l=xs.registry.get(a);if(l)o=new l(c);else return xs.registry.onNotFound(a)}else if(this.cell.isEdge()){const l=ws.registry.get(a);if(l)o=new l(c);else return ws.registry.onNotFound(a)}}}o&&(o.config(this.cellView,this),o.render(),(o.options.isSVGElement!==!1?this.svgContainer:this.htmlContainer).appendChild(o.container),this.tools.push(o))}return this}update(t={}){const e=this.tools;return e&&e.forEach(r=>{t.toolId!==r.cid&&r.isVisible()&&r.update()}),this}focus(t){const e=this.tools;return e&&e.forEach(r=>{t===r?r.show():r.hide()}),this}blur(t){const e=this.tools;return e&&e.forEach(r=>{r!==t&&!r.isVisible()&&(r.show(),r.update())}),this}hide(){return this.focus(null)}show(){return this.blur(null)}remove(){const t=this.tools;return t&&(t.forEach(e=>e.remove()),this.tools=null),Yn(this.svgContainer),Yn(this.htmlContainer),super.remove()}mount(){const t=this.tools,e=this.cellView;if(e&&t){const r=t.some(s=>s.options.isSVGElement!==!1),i=t.some(s=>s.options.isSVGElement===!1);r&&(this.options.local?e.container:e.graph.view.decorator).appendChild(this.svgContainer),i&&this.graph.container.appendChild(this.htmlContainer)}return this}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&i.graph!=null&&i.cell!=null&&typeof i.config=="function"&&typeof i.update=="function"&&typeof i.focus=="function"&&typeof i.blur=="function"&&typeof i.show=="function"&&typeof i.hide=="function"}n.isToolsView=t})(cn||(cn={}));(function(n){class t extends Ce{static getDefaults(){return this.defaults}static config(r){this.defaults=this.getOptions(r)}static getOptions(r){return an(De(this.getDefaults()),r)}get graph(){return this.cellView.graph}get cell(){return this.cellView.cell}get name(){return this.options.name}get[Symbol.toStringTag](){return t.toStringTag}constructor(r={}){super(),this.visible=!0,this.options=this.getOptions(r),this.container=Ce.createElement(this.options.tagName||"g",this.options.isSVGElement!==!1),qt(this.container,this.prefixClassName("cell-tool")),typeof this.options.className=="string"&&qt(this.container,this.options.className),this.init()}init(){}getOptions(r){return this.constructor.getOptions(r)}delegateEvents(){return this.options.events&&super.delegateEvents(this.options.events),this}config(r,i){return this.cellView=r,this.parent=i,this.stamp(this.container),this.cell.isEdge()?qt(this.container,this.prefixClassName("edge-tool")):this.cell.isNode()&&qt(this.container,this.prefixClassName("node-tool")),this.name&&this.container.setAttribute("data-tool-name",this.name),this.delegateEvents(),this}render(){this.empty();const r=this.options.markup;if(r){const i=ke.parseJSONMarkup(r);this.container.appendChild(i.fragment),this.childNodes=i.selectors}return this.onRender(),this}onRender(){}update(){return this}stamp(r){r&&r.setAttribute("data-cell-id",this.cellView.cell.id)}show(){return this.container.style.display="",this.visible=!0,this}hide(){return this.container.style.display="none",this.visible=!1,this}isVisible(){return this.visible}focus(){const r=this.options.focusOpacity;return r!=null&&Number.isFinite(r)&&(this.container.style.opacity=`${r}`),this.parent.focus(this),this}blur(){return this.container.style.opacity="",this.parent.blur(this),this}guard(r){return this.graph==null||this.cellView==null?!0:this.graph.view.guard(r,this.cellView)}}t.defaults={isSVGElement:!0,tagName:"g"},n.ToolItem=t,function(e){let r=0;function i(o){return o?th(o):(r+=1,`CustomTool${r}`)}function s(o){const a=Zu(i(o.name),this);return a.config(o),a}e.define=s}(t=n.ToolItem||(n.ToolItem={})),function(e){e.toStringTag=`X6.${e.name}`;function r(i){if(i==null)return!1;if(i instanceof e)return!0;const s=i[Symbol.toStringTag],o=i;return(s==null||s===e.toStringTag)&&o.graph!=null&&o.cell!=null&&typeof o.config=="function"&&typeof o.update=="function"&&typeof o.focus=="function"&&typeof o.blur=="function"&&typeof o.show=="function"&&typeof o.hide=="function"&&typeof o.isVisible=="function"}e.isToolItem=r}(t=n.ToolItem||(n.ToolItem={}))})(cn||(cn={}));const xN=n=>n;function tg(n,t){return t===0?"0%":`${Math.round(n/t*100)}%`}function yv(n){return(e,r,i,s)=>r.isEdgeElement(i)?AN(n,e,r,i,s):wN(n,e,r,i,s)}function wN(n,t,e,r,i){const s=e.cell,o=s.getAngle(),a=e.getUnrotatedBBoxOfElement(r),c=s.getBBox().getCenter(),l=R.create(i).rotate(o,c);let u=l.x-a.x,f=l.y-a.y;return n&&(u=tg(u,a.width),f=tg(f,a.height)),t.anchor={name:"topLeft",args:{dx:u,dy:f,rotate:!0}},t}function AN(n,t,e,r,i){const s=e.getConnection();if(!s)return t;const o=s.closestPointLength(i);if(n){const a=s.length();t.anchor={name:"ratio",args:{ratio:o/a}}}else t.anchor={name:"length",args:{length:o}};return t}const SN=yv(!0),TN=yv(!1),CN=Object.freeze(Object.defineProperty({__proto__:null,noop:xN,pinAbsolute:TN,pinRelative:SN},Symbol.toStringTag,{value:"Module"}));var _u;(function(n){n.presets=CN,n.registry=rn.create({type:"connection strategy"}),n.registry.register(n.presets,!0)})(_u||(_u={}));function Ev(n,t,e,r){return Qt(_u.presets.pinRelative,this.graph,{},t,e,n,this.cell,r,{}).anchor}function xv(n,t){return t?n.cell.getBBox():n.cell.isEdge()?n.getConnection().bbox():n.getUnrotatedBBoxOfElement(n.container)}class Zr extends cn.ToolItem{onRender(){qt(this.container,this.prefixClassName("cell-tool-button")),this.update()}update(){return this.updatePosition(),this}updatePosition(){const e=this.cellView.cell.isEdge()?this.getEdgeMatrix():this.getNodeMatrix();gs(this.container,e,{absolute:!0})}getNodeMatrix(){const t=this.cellView,e=this.options;let{x:r=0,y:i=0}=e;const{offset:s,useCellGeometry:o,rotate:a}=e;let c=xv(t,o);const l=t.cell.getAngle();a||(c=c.bbox(l));let u=0,f=0;typeof s=="number"?(u=s,f=s):typeof s=="object"&&(u=s.x,f=s.y),r=nr(r,c.width),i=nr(i,c.height);let h=xn().translate(c.x+c.width/2,c.y+c.height/2);return a&&(h=h.rotate(l)),h=h.translate(r+u-c.width/2,i+f-c.height/2),h}getEdgeMatrix(){const t=this.cellView,e=this.options,{offset:r=0,distance:i=0,rotate:s}=e;let o,a,c;const l=nr(i,1);l>=0&&l<=1?o=t.getTangentAtRatio(l):o=t.getTangentAtLength(l),o?(a=o.start,c=o.vector().vectorAngle(new R(1,0))||0):(a=t.getConnection().start,c=0);let u=xn().translate(a.x,a.y).rotate(c);return typeof r=="object"?u=u.translate(r.x||0,r.y||0):u=u.translate(0,r),s||(u=u.rotate(-c)),u}onMouseDown(t){if(this.guard(t))return;t.stopPropagation(),t.preventDefault();const e=this.options.onClick;typeof e=="function"&&Qt(e,this.cellView,{e:t,view:this.cellView,cell:this.cellView.cell,btn:this})}}(function(n){n.config({name:"button",useCellGeometry:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"}})})(Zr||(Zr={}));(function(n){n.Remove=n.define({name:"button-remove",markup:[{tagName:"circle",selector:"button",attrs:{r:7,fill:"#FF1D00",cursor:"pointer"}},{tagName:"path",selector:"icon",attrs:{d:"M -3 -3 3 3 M -3 3 3 -3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],distance:60,offset:0,useCellGeometry:!0,onClick({view:t,btn:e}){e.parent.remove(),t.cell.remove({ui:!0,toolId:e.cid})}})})(Zr||(Zr={}));var _N=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class ec extends cn.ToolItem{onRender(){if(qt(this.container,this.prefixClassName("cell-tool-boundary")),this.options.attrs){const t=this.options.attrs,{class:e}=t,r=_N(t,["class"]);ye(this.container,_o(r)),e&&qt(this.container,e)}this.update()}update(){const t=this.cellView,e=this.options,{useCellGeometry:r,rotate:i}=e,s=Pi(e.padding);let o=xv(t,r).moveAndExpand({x:-s.left,y:-s.top,width:s.left+s.right,height:s.top+s.bottom});const a=t.cell;if(a.isNode()){const c=a.getAngle();if(c)if(i){const l=a.getBBox().getCenter();Eu(this.container,c,l.x,l.y,{absolute:!0})}else o=o.bbox(c)}return ye(this.container,o.toJSON()),this}}(function(n){n.config({name:"boundary",tagName:"rect",padding:10,useCellGeometry:!0,attrs:{fill:"none",stroke:"#333","stroke-width":.5,"stroke-dasharray":"5, 5","pointer-events":"none"}})})(ec||(ec={}));class No extends cn.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}onRender(){return this.addClass(this.prefixClassName("edge-tool-vertices")),this.options.addable&&this.updatePath(),this.resetHandles(),this.renderHandles(),this}update(){return this.vertices.length===this.handles.length?this.updateHandles():(this.resetHandles(),this.renderHandles()),this.options.addable&&this.updatePath(),this}resetHandles(){const t=this.handles;this.handles=[],t&&t.forEach(e=>{this.stopHandleListening(e),e.remove()})}renderHandles(){const t=this.vertices;for(let e=0,r=t.length;e<r;e+=1){const i=t[e],s=this.options.createHandle,o=this.options.processHandle,a=s({index:e,graph:this.graph,guard:c=>this.guard(c),attrs:this.options.attrs||{}});o&&o(a),a.updatePosition(i.x,i.y),this.stamp(a.container),this.container.appendChild(a.container),this.handles.push(a),this.startHandleListening(a)}}updateHandles(){const t=this.vertices;for(let e=0,r=t.length;e<r;e+=1){const i=t[e],s=this.handles[e];s&&s.updatePosition(i.x,i.y)}}updatePath(){const t=this.childNodes.connection;t&&t.setAttribute("d",this.cellView.getConnectionPathData())}startHandleListening(t){const e=this.cellView;e.can("vertexMovable")&&(t.on("change",this.onHandleChange,this),t.on("changing",this.onHandleChanging,this),t.on("changed",this.onHandleChanged,this)),e.can("vertexDeletable")&&t.on("remove",this.onHandleRemove,this)}stopHandleListening(t){const e=this.cellView;e.can("vertexMovable")&&(t.off("change",this.onHandleChange,this),t.off("changing",this.onHandleChanging,this),t.off("changed",this.onHandleChanged,this)),e.can("vertexDeletable")&&t.off("remove",this.onHandleRemove,this)}getNeighborPoints(t){const e=this.cellView,r=this.vertices,i=t>0?r[t-1]:e.sourceAnchor,s=t<r.length-1?r[t+1]:e.targetAnchor;return{prev:R.create(i),next:R.create(s)}}getMouseEventArgs(t){const e=this.normalizeEvent(t),{x:r,y:i}=this.graph.snapToGrid(e.clientX,e.clientY);return{e,x:r,y:i}}onHandleChange({e:t}){this.focus();const e=this.cellView;if(e.cell.startBatch("move-vertex",{ui:!0,toolId:this.cid}),!this.options.stopPropagation){const{e:r,x:i,y:s}=this.getMouseEventArgs(t);this.eventData(r,{start:{x:i,y:s}}),e.notifyMouseDown(r,i,s)}}onHandleChanging({handle:t,e}){const r=this.cellView,i=t.options.index,{e:s,x:o,y:a}=this.getMouseEventArgs(e),c={x:o,y:a};this.snapVertex(c,i),r.cell.setVertexAt(i,c,{ui:!0,toolId:this.cid}),t.updatePosition(c.x,c.y),this.options.stopPropagation||r.notifyMouseMove(s,o,a)}stopBatch(t){this.cell.stopBatch("move-vertex",{ui:!0,toolId:this.cid}),t&&this.cell.stopBatch("add-vertex",{ui:!0,toolId:this.cid})}onHandleChanged({e:t}){const e=this.options,r=this.cellView;if(e.addable&&this.updatePath(),!e.removeRedundancies){this.stopBatch(this.eventData(t).vertexAdded);return}r.removeRedundantLinearVertices({ui:!0,toolId:this.cid})&&this.render(),this.blur(),this.stopBatch(this.eventData(t).vertexAdded);const{e:s,x:o,y:a}=this.getMouseEventArgs(t);if(!this.options.stopPropagation){r.notifyMouseUp(s,o,a);const{start:c}=this.eventData(s);if(c){const{x:l,y:u}=c;l===o&&u===a&&r.onClick(s,o,a)}}r.checkMouseleave(s),e.onChanged&&e.onChanged({edge:r.cell,edgeView:r})}snapVertex(t,e){const r=this.options.snapRadius||0;if(r>0){const i=this.getNeighborPoints(e),s=i.prev,o=i.next;Math.abs(t.x-s.x)<r?t.x=s.x:Math.abs(t.x-o.x)<r&&(t.x=o.x),Math.abs(t.y-s.y)<r?t.y=i.prev.y:Math.abs(t.y-o.y)<r&&(t.y=o.y)}}onHandleRemove({handle:t,e}){if(this.options.removable){const r=t.options.index,i=this.cellView;i.cell.removeVertexAt(r,{ui:!0}),this.options.addable&&this.updatePath(),i.checkMouseleave(this.normalizeEvent(e))}}allowAddVertex(t){const e=this.guard(t),r=this.options.addable&&this.cellView.can("vertexAddable"),i=this.options.modifiers?Yr.isMatch(t,this.options.modifiers):!0;return!e&&r&&i}onPathMouseDown(t){const e=this.cellView;if(!this.allowAddVertex(t))return;t.stopPropagation(),t.preventDefault();const r=this.normalizeEvent(t),i=this.graph.snapToGrid(r.clientX,r.clientY).toJSON();e.cell.startBatch("add-vertex",{ui:!0,toolId:this.cid});const s=e.getVertexIndex(i.x,i.y);this.snapVertex(i,s),e.cell.insertVertex(i,s,{ui:!0,toolId:this.cid}),this.render();const o=this.handles[s];this.eventData(r,{vertexAdded:!0}),o.onMouseDown(r)}onRemove(){this.resetHandles()}}(function(n){class t extends Ce{get graph(){return this.options.graph}constructor(r){super(),this.options=r,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDoubleClick"})}render(){this.container=Ce.createElement("circle",!0);const r=this.options.attrs;if(typeof r=="function"){const i=n.getDefaults();this.setAttrs(Object.assign(Object.assign({},i.attrs),r(this)))}else this.setAttrs(r);this.addClass(this.prefixClassName("edge-tool-vertex"))}updatePosition(r,i){this.setAttrs({cx:r,cy:i})}onMouseDown(r){this.options.guard(r)||(r.stopPropagation(),r.preventDefault(),this.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},r.data),this.emit("change",{e:r,handle:this}))}onMouseMove(r){this.emit("changing",{e:r,handle:this})}onMouseUp(r){this.emit("changed",{e:r,handle:this}),this.undelegateDocumentEvents(),this.graph.view.delegateEvents()}onDoubleClick(r){this.emit("remove",{e:r,handle:this})}}n.Handle=t})(No||(No={}));(function(n){const t=Kn.prefix("edge-tool-vertex-path");n.config({name:"vertices",snapRadius:20,addable:!0,removable:!0,removeRedundancies:!0,stopPropagation:!0,attrs:{r:6,fill:"#333",stroke:"#fff",cursor:"move","stroke-width":2},createHandle:e=>new n.Handle(e),markup:[{tagName:"path",selector:"connection",className:t,attrs:{fill:"none",stroke:"transparent","stroke-width":10,cursor:"pointer"}}],events:{[`mousedown .${t}`]:"onPathMouseDown",[`touchstart .${t}`]:"onPathMouseDown"}})})(No||(No={}));class Lo extends cn.ToolItem{constructor(){super(...arguments),this.handles=[]}get vertices(){return this.cellView.cell.getVertices()}update(){return this.render(),this}onRender(){qt(this.container,this.prefixClassName("edge-tool-segments")),this.resetHandles();const t=this.cellView,e=[...this.vertices];e.unshift(t.sourcePoint),e.push(t.targetPoint);for(let r=0,i=e.length;r<i-1;r+=1){const s=e[r],o=e[r+1],a=this.renderHandle(s,o,r);this.stamp(a.container),this.handles.push(a)}return this}renderHandle(t,e,r){const i=this.options.createHandle({index:r,graph:this.graph,guard:s=>this.guard(s),attrs:this.options.attrs||{}});return this.options.processHandle&&this.options.processHandle(i),this.updateHandle(i,t,e),this.container.appendChild(i.container),this.startHandleListening(i),i}startHandleListening(t){t.on("change",this.onHandleChange,this),t.on("changing",this.onHandleChanging,this),t.on("changed",this.onHandleChanged,this)}stopHandleListening(t){t.off("change",this.onHandleChange,this),t.off("changing",this.onHandleChanging,this),t.off("changed",this.onHandleChanged,this)}resetHandles(){const t=this.handles;this.handles=[],t&&t.forEach(e=>{this.stopHandleListening(e),e.remove()})}shiftHandleIndexes(t){const e=this.handles;for(let r=0,i=e.length;r<i;r+=1)e[r].options.index+=t}resetAnchor(t,e){const r=this.cellView.cell,i={ui:!0,toolId:this.cid};e?r.prop([t,"anchor"],e,i):r.removeProp([t,"anchor"],i)}snapHandle(t,e,r){const i=t.options.axis,s=t.options.index,c=this.cellView.cell.getVertices(),l=c[s-2]||r.sourceAnchor,u=c[s+1]||r.targetAnchor,f=this.options.snapRadius;return Math.abs(e[i]-l[i])<f?e[i]=l[i]:Math.abs(e[i]-u[i])<f&&(e[i]=u[i]),e}onHandleChanging({handle:t,e}){const r=this.graph,i=this.options,s=this.cellView,o=i.anchor,a=t.options.axis,c=t.options.index-1,l=this.getEventData(e),u=this.normalizeEvent(e),f=r.snapToGrid(u.clientX,u.clientY),h=this.snapHandle(t,f.clone(),l),d=De(this.vertices);let p=d[c],m=d[c+1];const b=s.sourceView,v=s.sourceBBox;let E=!1,y=!1;if(p?c===0?v.containsPoint(p)?(d.shift(),this.shiftHandleIndexes(-1),E=!0):(p[a]=h[a],y=!0):p[a]=h[a]:(p=s.sourceAnchor.toJSON(),p[a]=h[a],v.containsPoint(p)?E=!0:(d.unshift(p),this.shiftHandleIndexes(1),y=!0)),typeof o=="function"&&b){if(E){const X=l.sourceAnchor.clone();X[a]=h[a];const Z=Qt(o,s,X,b,s.sourceMagnet||b.container,"source",s,this);this.resetAnchor("source",Z)}y&&this.resetAnchor("source",l.sourceAnchorDef)}const O=s.targetView,I=s.targetBBox;let G=!1,k=!1;if(m?c===d.length-2?I.containsPoint(m)?(d.pop(),G=!0):(m[a]=h[a],k=!0):m[a]=h[a]:(m=s.targetAnchor.toJSON(),m[a]=h[a],I.containsPoint(m)?G=!0:(d.push(m),k=!0)),typeof o=="function"&&O){if(G){const X=l.targetAnchor.clone();X[a]=h[a];const Z=Qt(o,s,X,O,s.targetMagnet||O.container,"target",s,this);this.resetAnchor("target",Z)}k&&this.resetAnchor("target",l.targetAnchorDef)}R.equalPoints(d,this.vertices)||this.cellView.cell.setVertices(d,{ui:!0,toolId:this.cid}),this.updateHandle(t,p,m,0),i.stopPropagation||s.notifyMouseMove(u,f.x,f.y)}onHandleChange({handle:t,e}){const r=this.options,i=this.handles,s=this.cellView,o=t.options.index;if(Array.isArray(i)){for(let a=0,c=i.length;a<c;a+=1)a!==o&&i[a].hide();if(this.focus(),this.setEventData(e,{sourceAnchor:s.sourceAnchor.clone(),targetAnchor:s.targetAnchor.clone(),sourceAnchorDef:De(this.cell.prop(["source","anchor"])),targetAnchorDef:De(this.cell.prop(["target","anchor"]))}),this.cell.startBatch("move-segment",{ui:!0,toolId:this.cid}),!r.stopPropagation){const a=this.normalizeEvent(e),c=this.graph.snapToGrid(a.clientX,a.clientY);s.notifyMouseDown(a,c.x,c.y)}}}onHandleChanged({e:t}){const e=this.options,r=this.cellView;e.removeRedundancies&&r.removeRedundantLinearVertices({ui:!0,toolId:this.cid});const i=this.normalizeEvent(t),s=this.graph.snapToGrid(i.clientX,i.clientY);this.render(),this.blur(),this.cell.stopBatch("move-segment",{ui:!0,toolId:this.cid}),e.stopPropagation||r.notifyMouseUp(i,s.x,s.y),r.checkMouseleave(i),e.onChanged&&e.onChanged({edge:r.cell,edgeView:r})}updateHandle(t,e,r,i=0){const s=this.options.precision||0,o=Math.abs(e.x-r.x)<s,a=Math.abs(e.y-r.y)<s;if(o||a){const c=new Ht(e,r);if(c.length()<this.options.threshold)t.hide();else{const u=c.getCenter(),f=o?"x":"y";u[f]+=i||0;const h=c.vector().vectorAngle(new R(1,0));t.updatePosition(u.x,u.y,h,this.cellView),t.show(),t.options.axis=f}}else t.hide()}onRemove(){this.resetHandles()}}(function(n){class t extends Ce{constructor(r){super(),this.options=r,this.render(),this.delegateEvents({mousedown:"onMouseDown",touchstart:"onMouseDown"})}render(){this.container=Ce.createElement("rect",!0);const r=this.options.attrs;if(typeof r=="function"){const i=n.getDefaults();this.setAttrs(Object.assign(Object.assign({},i.attrs),r(this)))}else this.setAttrs(r);this.addClass(this.prefixClassName("edge-tool-segment"))}updatePosition(r,i,s,o){const a=o.getClosestPoint(new R(r,i))||new R(r,i);let c=xn().translate(a.x,a.y);if(a.equals({x:r,y:i}))c=c.rotate(s);else{let u=new Ht(r,i,a.x,a.y).vector().vectorAngle(new R(1,0));u!==0&&(u+=90),c=c.rotate(u)}this.setAttrs({transform:Ds(c),cursor:s%180===0?"row-resize":"col-resize"})}onMouseDown(r){this.options.guard(r)||(this.trigger("change",{e:r,handle:this}),r.stopPropagation(),r.preventDefault(),this.options.graph.view.undelegateEvents(),this.delegateDocumentEvents({mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},r.data))}onMouseMove(r){this.emit("changing",{e:r,handle:this})}onMouseUp(r){this.emit("changed",{e:r,handle:this}),this.undelegateDocumentEvents(),this.options.graph.view.delegateEvents()}show(){this.container.style.display=""}hide(){this.container.style.display="none"}}n.Handle=t})(Lo||(Lo={}));(function(n){n.config({name:"segments",precision:.5,threshold:40,snapRadius:10,stopPropagation:!0,removeRedundancies:!0,attrs:{width:20,height:8,x:-10,y:-4,rx:4,ry:4,fill:"#333",stroke:"#fff","stroke-width":2},createHandle:t=>new n.Handle(t),anchor:Ev})})(Lo||(Lo={}));class nc extends cn.ToolItem{get type(){return this.options.type}onRender(){qt(this.container,this.prefixClassName(`edge-tool-${this.type}-anchor`)),this.toggleArea(!1),this.update()}update(){const t=this.type;return this.cellView.getTerminalView(t)?(this.updateAnchor(),this.updateArea(),this.container.style.display=""):this.container.style.display="none",this}updateAnchor(){const t=this.childNodes;if(!t)return;const e=t.anchor;if(!e)return;const r=this.type,i=this.cellView,s=this.options,o=i.getTerminalAnchor(r),a=i.cell.prop([r,"anchor"]);e.setAttribute("transform",`translate(${o.x}, ${o.y})`);const c=a?s.customAnchorAttrs:s.defaultAnchorAttrs;c&&Object.keys(c).forEach(l=>{e.setAttribute(l,c[l])})}updateArea(){const t=this.childNodes;if(!t)return;const e=t.area;if(!e)return;const r=this.type,i=this.cellView,s=i.getTerminalView(r);if(s){const o=s.cell,a=i.getTerminalMagnet(r);let c=this.options.areaPadding||0;Number.isFinite(c)||(c=0);let l,u,f;s.isEdgeElement(a)?(l=s.getBBox(),u=0,f=l.getCenter()):(l=s.getUnrotatedBBoxOfElement(a),u=o.getAngle(),f=l.getCenter(),u&&f.rotate(-u,o.getBBox().getCenter())),l.inflate(c),ye(e,{x:-l.width/2,y:-l.height/2,width:l.width,height:l.height,transform:`translate(${f.x}, ${f.y}) rotate(${u})`})}}toggleArea(t){if(this.childNodes){const e=this.childNodes.area;e&&(e.style.display=t?"":"none")}}onMouseDown(t){this.guard(t)||(t.stopPropagation(),t.preventDefault(),this.graph.view.undelegateEvents(),this.options.documentEvents&&this.delegateDocumentEvents(this.options.documentEvents),this.focus(),this.toggleArea(this.options.restrictArea),this.cell.startBatch("move-anchor",{ui:!0,toolId:this.cid}))}resetAnchor(t){const e=this.type,r=this.cell;t?r.prop([e,"anchor"],t,{rewrite:!0,ui:!0,toolId:this.cid}):r.removeProp([e,"anchor"],{ui:!0,toolId:this.cid})}onMouseMove(t){const e=this.type,r=this.cellView,i=r.getTerminalView(e);if(i==null)return;const s=this.normalizeEvent(t),o=i.cell,a=r.getTerminalMagnet(e);let c=this.graph.coord.clientToLocalPoint(s.clientX,s.clientY);const l=this.options.snap;if(typeof l=="function"){const h=Qt(l,r,c,i,a,e,r,this);c=R.create(h)}if(this.options.restrictArea)if(i.isEdgeElement(a)){const h=i.getClosestPoint(c);h&&(c=h)}else{const h=i.getUnrotatedBBoxOfElement(a),d=o.getAngle(),p=o.getBBox().getCenter(),m=c.clone().rotate(d,p);h.containsPoint(m)||(c=h.getNearestPointToPoint(m).rotate(-d,p))}let u;const f=this.options.anchor;typeof f=="function"&&(u=Qt(f,r,c,i,a,e,r,this)),this.resetAnchor(u),this.update()}onMouseUp(t){this.graph.view.delegateEvents(),this.undelegateDocumentEvents(),this.blur(),this.toggleArea(!1);const e=this.cellView;this.options.removeRedundancies&&e.removeRedundantLinearVertices({ui:!0,toolId:this.cid}),this.cell.stopBatch("move-anchor",{ui:!0,toolId:this.cid})}onDblClick(){const t=this.options.resetAnchor;t&&this.resetAnchor(t===!0?void 0:t),this.update()}}(function(n){n.config({tagName:"g",markup:[{tagName:"circle",selector:"anchor",attrs:{cursor:"pointer"}},{tagName:"rect",selector:"area",attrs:{"pointer-events":"none",fill:"none",stroke:"#33334F","stroke-dasharray":"2,4",rx:5,ry:5}}],events:{mousedown:"onMouseDown",touchstart:"onMouseDown",dblclick:"onDblClick"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"},customAnchorAttrs:{"stroke-width":4,stroke:"#33334F",fill:"#FFFFFF",r:5},defaultAnchorAttrs:{"stroke-width":2,stroke:"#FFFFFF",fill:"#33334F",r:6},areaPadding:6,snapRadius:10,resetAnchor:!0,restrictArea:!0,removeRedundancies:!0,anchor:Ev,snap(t,e,r,i,s,o){const a=o.options.snapRadius||0,c=i==="source",l=c?0:-1,u=this.cell.getVertexAt(l)||this.getTerminalAnchor(c?"target":"source");return u&&(Math.abs(u.x-t.x)<a&&(t.x=u.x),Math.abs(u.y-t.y)<a&&(t.y=u.y)),t}})})(nc||(nc={}));const ON=nc.define({name:"source-anchor",type:"source"}),MN=nc.define({name:"target-anchor",type:"target"});var PN=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class rc extends cn.ToolItem{get type(){return this.options.type}get ratio(){return this.options.ratio}init(){if(this.options.attrs){const t=this.options.attrs,{class:e}=t,r=PN(t,["class"]);this.setAttrs(r,this.container),e&&qt(this.container,e)}}onRender(){qt(this.container,this.prefixClassName(`edge-tool-${this.type}-arrowhead`)),this.update()}update(){const t=this.ratio,e=this.cellView,r=e.getTangentAtRatio(t),i=r?r.start:e.getPointAtRatio(t),s=r&&r.vector().vectorAngle(new R(1,0))||0;if(!i)return this;const o=xn().translate(i.x,i.y).rotate(s);return gs(this.container,o,{absolute:!0}),this}onMouseDown(t){if(this.guard(t))return;t.stopPropagation(),t.preventDefault();const e=this.cellView;if(e.can("arrowheadMovable")){e.cell.startBatch("move-arrowhead",{ui:!0,toolId:this.cid});const r=this.graph.snapToGrid(t.clientX,t.clientY),i=e.prepareArrowheadDragging(this.type,{x:r.x,y:r.y,options:Object.assign(Object.assign({},this.options),{toolId:this.cid})});this.cellView.setEventData(t,i),this.delegateDocumentEvents(this.options.documentEvents,t.data),e.graph.view.undelegateEvents(),this.container.style.pointerEvents="none"}this.focus()}onMouseMove(t){const e=this.normalizeEvent(t),r=this.graph.snapToGrid(e.clientX,e.clientY);this.cellView.onMouseMove(e,r.x,r.y),this.update()}onMouseUp(t){this.undelegateDocumentEvents();const e=this.normalizeEvent(t),r=this.cellView,i=this.graph.snapToGrid(e.clientX,e.clientY);r.onMouseUp(e,i.x,i.y),this.graph.view.delegateEvents(),this.blur(),this.container.style.pointerEvents="",r.cell.stopBatch("move-arrowhead",{ui:!0,toolId:this.cid})}}(function(n){n.config({tagName:"path",isSVGElement:!0,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"}})})(rc||(rc={}));const RN=rc.define({name:"source-arrowhead",type:"source",ratio:0,attrs:{d:"M 10 -8 -10 0 10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}}),NN=rc.define({name:"target-arrowhead",type:"target",ratio:1,attrs:{d:"M -10 -8 10 0 -10 8 Z",fill:"#333",stroke:"#fff","stroke-width":2,cursor:"move"}});class Es extends cn.ToolItem{constructor(){super(...arguments),this.labelIndex=-1,this.distance=.5,this.dblClick=this.onCellDblClick.bind(this)}onRender(){const t=this.cellView;t&&t.on("cell:dblclick",this.dblClick)}createElement(){const t=[this.prefixClassName(`${this.cell.isEdge()?"edge":"node"}-tool-editor`),this.prefixClassName("cell-tool-editor")];this.editor=cn.createElement("div",!1),this.addClass(t,this.editor),this.editor.contentEditable="true",this.container.appendChild(this.editor)}removeElement(){this.undelegateDocumentEvents(),this.editor&&(this.container.removeChild(this.editor),this.editor=null)}updateEditor(){const{cell:t,editor:e}=this;if(!e)return;const{style:r}=e;t.isNode()?this.updateNodeEditorTransform():t.isEdge()&&this.updateEdgeEditorTransform();const{attrs:i}=this.options;r.fontSize=`${i.fontSize}px`,r.fontFamily=i.fontFamily,r.color=i.color,r.backgroundColor=i.backgroundColor;const s=this.getCellText()||"";return e.innerText=s,this.setCellText(""),this}updateNodeEditorTransform(){const{graph:t,cell:e,editor:r}=this;if(!r)return;let i=R.create(),s=20,o="",{x:a,y:c}=this.options;const{width:l,height:u}=this.options;if(typeof a<"u"&&typeof c<"u"){const d=e.getBBox();a=nr(a,d.width),c=nr(c,d.height),i=d.topLeft.translate(a,c),s=d.width-a*2}else{const d=e.getBBox();i=d.center,s=d.width-4,o="translate(-50%, -50%)"}const f=t.scale(),{style:h}=r;i=t.localToGraph(i),h.left=`${i.x}px`,h.top=`${i.y}px`,h.transform=`scale(${f.sx}, ${f.sy}) ${o}`,h.minWidth=`${s}px`,typeof l=="number"&&(h.width=`${l}px`),typeof u=="number"&&(h.height=`${u}px`)}updateEdgeEditorTransform(){if(!this.event)return;const{graph:t,editor:e}=this;if(!e)return;let r=R.create(),i=20;const{style:s}=e,o=this.event.target,a=o.parentElement;if(a&&gr(a,this.prefixClassName("edge-label"))){const u=a.getAttribute("data-index")||"0";this.labelIndex=parseInt(u,10);const f=a.getAttribute("transform"),{translation:h}=Cc(f);r=new R(h.tx,h.ty),i=Me.getBBox(o).width}else{if(!this.options.labelAddable)return this;r=t.clientToLocal(R.create(this.event.clientX,this.event.clientY));const f=this.cellView.path.closestPointLength(r);this.distance=f,this.labelIndex=-1}r=t.localToGraph(r);const l=t.scale();s.left=`${r.x}px`,s.top=`${r.y}px`,s.minWidth=`${i}px`,s.transform=`scale(${l.sx}, ${l.sy}) translate(-50%, -50%)`}onDocumentMouseUp(t){if(this.editor&&t.target!==this.editor){const e=this.editor.innerText.replace(/\n$/,"")||"";this.setCellText(e!==""?e:null),this.removeElement()}}onCellDblClick({e:t}){this.editor||(t.stopPropagation(),this.removeElement(),this.event=t,this.createElement(),this.updateEditor(),this.autoFocus(),this.delegateDocumentEvents(this.options.documentEvents))}onMouseDown(t){t.stopPropagation()}autoFocus(){setTimeout(()=>{this.editor&&(this.editor.focus(),this.selectText())})}selectText(){if(window.getSelection&&this.editor){const t=document.createRange(),e=window.getSelection();t.selectNodeContents(this.editor),e.removeAllRanges(),e.addRange(t)}}getCellText(){const{getText:t}=this.options;if(typeof t=="function")return Qt(t,this.cellView,{cell:this.cell,index:this.labelIndex});if(typeof t=="string"){if(this.cell.isNode())return this.cell.attr(t);if(this.cell.isEdge()&&this.labelIndex!==-1)return this.cell.prop(`labels/${this.labelIndex}/attrs/${t}`)}}setCellText(t){const e=this.options.setText;if(typeof e=="function"){Qt(e,this.cellView,{cell:this.cell,value:t,index:this.labelIndex,distance:this.distance});return}if(typeof e=="string"){if(this.cell.isNode()){t!==null&&this.cell.attr(e,t);return}if(this.cell.isEdge()){const r=this.cell;if(this.labelIndex===-1){if(t){const i={position:{distance:this.distance},attrs:{}};Is(i,`attrs/${e}`,t),r.appendLabel(i)}}else t!==null?r.prop(`labels/${this.labelIndex}/attrs/${e}`,t):typeof this.labelIndex=="number"&&r.removeLabelAt(this.labelIndex)}}}onRemove(){const t=this.cellView;t&&t.off("cell:dblclick",this.dblClick),this.removeElement()}}(function(n){n.config({tagName:"div",isSVGElement:!1,events:{mousedown:"onMouseDown",touchstart:"onMouseDown"},documentEvents:{mouseup:"onDocumentMouseUp",touchend:"onDocumentMouseUp",touchcancel:"onDocumentMouseUp"}})})(Es||(Es={}));(function(n){n.NodeEditor=n.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},getText:"text/text",setText:"text/text"}),n.EdgeEditor=n.define({attrs:{fontSize:14,fontFamily:"Arial, helvetica, sans-serif",color:"#000",backgroundColor:"#fff"},labelAddable:!0,getText:"label/text",setText:"label/text"})})(Es||(Es={}));var wv=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e},xs;(function(n){n.presets={boundary:ec,button:Zr,"button-remove":Zr.Remove,"node-editor":Es.NodeEditor},n.registry=rn.create({type:"node tool",process(t,e){if(typeof e=="function")return e;let r=cn.ToolItem;const{inherit:i}=e,s=wv(e,["inherit"]);if(i){const o=this.get(i);o==null?this.onNotFound(i,"inherited"):r=o}return s.name==null&&(s.name=t),r.define.call(r,s)}}),n.registry.register(n.presets,!0)})(xs||(xs={}));var ws;(function(n){n.presets={boundary:ec,vertices:No,segments:Lo,button:Zr,"button-remove":Zr.Remove,"source-anchor":ON,"target-anchor":MN,"source-arrowhead":RN,"target-arrowhead":NN,"edge-editor":Es.EdgeEditor},n.registry=rn.create({type:"edge tool",process(t,e){if(typeof e=="function")return e;let r=cn.ToolItem;const{inherit:i}=e,s=wv(e,["inherit"]);if(i){const o=this.get(i);o==null?this.onNotFound(i,"inherited"):r=o}return s.name==null&&(s.name=t),r.define.call(r,s)}}),n.registry.register(n.presets,!0)})(ws||(ws={}));const LN=Ir("center"),IN=Ir("topCenter"),DN=Ir("bottomCenter"),kN=Ir("leftMiddle"),BN=Ir("rightMiddle"),jN=Ir("topLeft"),FN=Ir("topRight"),GN=Ir("bottomLeft"),zN=Ir("bottomRight");function Ir(n){return function(t,e,r,i={}){const s=i.rotate?t.getUnrotatedBBoxOfElement(e):t.getBBoxOfElement(e),o=s[n];o.x+=nr(i.dx,s.width),o.y+=nr(i.dy,s.height);const a=t.cell;return i.rotate?o.rotate(-a.getAngle(),a.getBBox().getCenter()):o}}function Pc(n){return function(t,e,r,i){if(r instanceof Element){const s=this.graph.findViewByElem(r);let o;if(s)if(s.isEdgeElement(r)){const a=i.fixedAt!=null?i.fixedAt:"50%";o=Av(s,a)}else o=s.getBBoxOfElement(r).getCenter();else o=new R;return n.call(this,t,e,o,i)}return n.apply(this,arguments)}}function Av(n,t){const e=Mr(t),r=typeof t=="string"?parseFloat(t):t;return e?n.getPointAtRatio(r/100):n.getPointAtLength(r)}const UN=function(n,t,e,r){const i=Te.normalize(n.cell.getAngle()),s=n.getBBoxOfElement(t),o=s.getCenter(),a=s.getTopLeft(),c=s.getBottomRight();let l=r.padding;if(Number.isFinite(l)||(l=0),a.y+l<=e.y&&e.y<=c.y-l){const u=e.y-o.y;o.x+=i===0||i===180?0:u*1/Math.tan(Te.toRad(i)),o.y+=u}else if(a.x+l<=e.x&&e.x<=c.x-l){const u=e.x-o.x;o.y+=i===90||i===270?0:u*Math.tan(Te.toRad(i)),o.x+=u}return o},VN=Pc(UN),$N=function(n,t,e,r,i){const s=n.cell.getConnectionPoint(this.cell,i);return(r.dx||r.dy)&&s.translate(r.dx||0,r.dy||0),s},HN=function(n,t,e,r){let i,s=0,o;const a=n.cell;r.rotate?(i=n.getUnrotatedBBoxOfElement(t),o=a.getBBox().getCenter(),s=a.getAngle()):i=n.getBBoxOfElement(t);const c=r.padding;c!=null&&Number.isFinite(c)&&i.inflate(c),r.rotate&&e.rotate(s,o);const l=i.getNearestSideToPoint(e);let u;switch(l){case"left":u=i.getLeftMiddle();break;case"right":u=i.getRightMiddle();break;case"top":u=i.getTopCenter();break;case"bottom":u=i.getBottomCenter();break}const f=r.direction;return f==="H"?(l==="top"||l==="bottom")&&(e.x<=i.x+i.width?u=i.getLeftMiddle():u=i.getRightMiddle()):f==="V"&&(e.y<=i.y+i.height?u=i.getTopCenter():u=i.getBottomCenter()),r.rotate?u.rotate(-s,o):u},XN=Pc(HN),WN=Object.freeze(Object.defineProperty({__proto__:null,bottom:DN,bottomLeft:GN,bottomRight:zN,center:LN,left:kN,midSide:XN,nodeCenter:$N,orth:VN,right:BN,top:IN,topLeft:jN,topRight:FN},Symbol.toStringTag,{value:"Module"}));var As;(function(n){n.presets=WN,n.registry=rn.create({type:"node endpoint"}),n.registry.register(n.presets,!0)})(As||(As={}));const qN=function(n,t,e,r){let i=r.ratio!=null?r.ratio:.5;return i>1&&(i/=100),n.getPointAtRatio(i)},YN=function(n,t,e,r){const i=r.length!=null?r.length:20;return n.getPointAtLength(i)},Sv=function(n,t,e,r){const i=n.getClosestPoint(e);return i??new R},JN=Pc(Sv),KN=function(n,t,e,r){const s=n.getConnection(),o=n.getConnectionSubdivisions(),a=new Ht(e.clone().translate(0,1e6),e.clone().translate(0,-1e6)),c=new Ht(e.clone().translate(1e6,0),e.clone().translate(-1e6,0)),l=a.intersect(s,{segmentSubdivisions:o}),u=c.intersect(s,{segmentSubdivisions:o}),f=[];return l&&f.push(...l),u&&f.push(...u),f.length>0?e.closest(f):r.fallbackAt!=null?Av(n,r.fallbackAt):Qt(Sv,this,n,t,e,r)},ZN=Pc(KN),QN=Object.freeze(Object.defineProperty({__proto__:null,closest:JN,length:YN,orth:ZN,ratio:qN},Symbol.toStringTag,{value:"Module"}));var Ss;(function(n){n.presets=QN,n.registry=rn.create({type:"edge endpoint"}),n.registry.register(n.presets,!0)})(Ss||(Ss={}));function Rc(n,t,e){let r;if(typeof e=="object"){if(Number.isFinite(e.y)){const s=new Ht(t,n),{start:o,end:a}=s.parallel(e.y);t=o,n=a}r=e.x}else r=e;if(r==null||!Number.isFinite(r))return n;const i=n.distance(t);return r===0&&i>0?n:n.move(t,-Math.min(r,i-1))}function ic(n){const t=n.getAttribute("stroke-width");return t===null?0:parseFloat(t)||0}function tL(n){if(n==null)return null;let t=n;do{let e=t.tagName;if(typeof e!="string")return null;if(e=e.toUpperCase(),e==="G")t=t.firstElementChild;else if(e==="TITLE")t=t.nextElementSibling;else break}while(t);return t}const Tv=function(n,t,e,r){const i=t.getBBoxOfElement(e);r.stroked&&i.inflate(ic(e)/2);const s=n.intersect(i),o=s&&s.length?n.start.closest(s):n.end;return Rc(o,n.start,r.offset)},eL=function(n,t,e,r,i){const s=t.cell,o=s.isNode()?s.getAngle():0;if(o===0)return Qt(Tv,this,n,t,e,r,i);const a=t.getUnrotatedBBoxOfElement(e);r.stroked&&a.inflate(ic(e)/2);const c=a.getCenter(),l=n.clone().rotate(o,c),u=l.setLength(1e6).intersect(a),f=u&&u.length?l.start.closest(u).rotate(-o,c):n.end;return Rc(f,n.start,r.offset)},nL=function(n,t,e,r){let i,s;const o=n.end,a=r.selector;if(typeof a=="string"?i=t.findOne(a):Array.isArray(a)?i=Qu(e,a):i=tL(e),!qr(i)){if(i===e||!qr(e))return o;i=e}const c=t.getShapeOfElement(i),l=t.getMatrixOfElement(i),u=t.getRootTranslatedMatrix(),f=t.getRootRotatedMatrix(),h=u.multiply(f).multiply(l),d=h.inverse(),p=Me.transformLine(n,d),m=p.start.clone(),b=t.getDataOfElement(i);if(r.insideout===!1){b.shapeBBox==null&&(b.shapeBBox=c.bbox());const O=b.shapeBBox;if(O!=null&&O.containsPoint(m))return o}r.extrapolate===!0&&p.setLength(1e6);let v;if(ne.isPath(c)){const O=r.precision||2;b.segmentSubdivisions==null&&(b.segmentSubdivisions=c.getSegmentSubdivisions({precision:O})),v={precision:O,segmentSubdivisions:b.segmentSubdivisions},s=p.intersect(c,v)}else s=p.intersect(c);s?Array.isArray(s)&&(s=m.closest(s)):r.sticky===!0&&(Bt.isRectangle(c)?s=c.getNearestPointToPoint(m):ir.isEllipse(c)?s=c.intersectsWithLineFromCenterToPoint(m):s=c.closestPoint(m,v));const E=s?Me.transformPoint(s,h):o;let y=r.offset||0;return r.stroked!==!1&&(typeof y=="object"?(y=Object.assign({},y),y.x==null&&(y.x=0),y.x+=ic(i)/2):y+=ic(i)/2),Rc(E,n.start,y)};function rL(n,t,e=0){const{start:r,end:i}=n;let s,o,a,c;switch(t){case"left":c="x",s=i,o=r,a=-1;break;case"right":c="x",s=r,o=i,a=1;break;case"top":c="y",s=i,o=r,a=-1;break;case"bottom":c="y",s=r,o=i,a=1;break;default:return}r[c]<i[c]?s[c]=o[c]:o[c]=s[c],Number.isFinite(e)&&(s[c]+=a*e,o[c]+=a*e)}const iL=function(n,t,e,r){const{alignOffset:i,align:s}=r;return s&&rL(n,s,i),Rc(n.end,n.start,r.offset)},sL=Object.freeze(Object.defineProperty({__proto__:null,anchor:iL,bbox:Tv,boundary:nL,rect:eL},Symbol.toStringTag,{value:"Module"}));var Ts;(function(n){n.presets=sL,n.registry=rn.create({type:"connection point"}),n.registry.register(n.presets,!0)})(Ts||(Ts={}));const oL=function(n){return[...n]},aL=function(n,t,e){const r=t.side||"bottom",i=Pi(t.padding||40),s=e.sourceBBox,o=e.targetBBox,a=s.getCenter(),c=o.getCenter();let l,u,f;switch(r){case"top":f=-1,l="y",u="height";break;case"left":f=-1,l="x",u="width";break;case"right":f=1,l="x",u="width";break;case"bottom":default:f=1,l="y",u="height";break}return a[l]+=f*(s[u]/2+i[r]),c[l]+=f*(o[u]/2+i[r]),f*(a[l]-c[l])>0?c[l]=a[l]:a[l]=c[l],[a.toJSON(),...n,c.toJSON()]};function Na(n){return new Bt(n.x,n.y,0,0)}function sc(n={}){const t=Pi(n.padding||20);return{x:-t.left,y:-t.top,width:t.left+t.right,height:t.top+t.bottom}}function Cv(n,t={}){return n.sourceBBox.clone().moveAndExpand(sc(t))}function _v(n,t={}){return n.targetBBox.clone().moveAndExpand(sc(t))}function cL(n,t={}){return n.sourceAnchor?n.sourceAnchor:Cv(n,t).getCenter()}function lL(n,t={}){return n.targetAnchor?n.targetAnchor:_v(n,t).getCenter()}const Ov=function(n,t,e){let r=Cv(e,t),i=_v(e,t);const s=cL(e,t),o=lL(e,t);r=r.union(Na(s)),i=i.union(Na(o));const a=n.map(u=>R.create(u));a.unshift(s),a.push(o);let c=null;const l=[];for(let u=0,f=a.length-1;u<f;u+=1){let h=null;const d=a[u],p=a[u+1],m=Xn.getBearing(d,p)!=null;if(u===0)u+1===f?r.intersectsWithRect(i.clone().inflate(1))?h=Xn.insideNode(d,p,r,i):m||(h=Xn.nodeToNode(d,p,r,i)):r.containsPoint(p)?h=Xn.insideNode(d,p,r,Na(p).moveAndExpand(sc(t))):m||(h=Xn.nodeToVertex(d,p,r));else if(u+1===f){const b=m&&Xn.getBearing(p,d)===c;i.containsPoint(d)||b?h=Xn.insideNode(d,p,Na(d).moveAndExpand(sc(t)),i,c):m||(h=Xn.vertexToNode(d,p,i,c))}else m||(h=Xn.vertexToVertex(d,p,c));h?(l.push(...h.points),c=h.direction):c=Xn.getBearing(d,p),u+1<f&&l.push(p)}return l};var Xn;(function(n){const t={N:"S",S:"N",E:"W",W:"E"},e={N:-Math.PI/2*3,S:-Math.PI/2,E:0,W:Math.PI};function r(f,h,d){let p=new R(f.x,h.y);return d.containsPoint(p)&&(p=new R(h.x,f.y)),p}function i(f,h){return f[h==="W"||h==="E"?"width":"height"]}n.getBBoxSize=i;function s(f,h){return f.x===h.x?f.y>h.y?"N":"S":f.y===h.y?f.x>h.x?"W":"E":null}n.getBearing=s;function o(f,h,d){const p=new R(f.x,h.y),m=new R(h.x,f.y),b=s(f,p),v=s(f,m),E=d?t[d]:null,y=b===d||b!==E&&(v===E||v!==d)?p:m;return{points:[y],direction:s(y,h)}}n.vertexToVertex=o;function a(f,h,d){const p=r(f,h,d);return{points:[p],direction:s(p,h)}}n.nodeToVertex=a;function c(f,h,d,p){const m=[new R(f.x,h.y),new R(h.x,f.y)],b=m.filter(y=>!d.containsPoint(y)),v=b.filter(y=>s(y,f)!==p);let E;if(v.length>0)return E=v.filter(y=>s(f,y)===p).pop(),E=E||v[0],{points:[E],direction:s(E,h)};{E=sA(m,b)[0];const y=R.create(h).move(E,-i(d,p)/2);return{points:[r(y,f,d),y],direction:s(y,h)}}}n.vertexToNode=c;function l(f,h,d,p){let m=a(h,f,p);const b=m.points[0];if(d.containsPoint(b)){m=a(f,h,d);const v=m.points[0];if(p.containsPoint(v)){const E=R.create(f).move(v,-i(d,s(f,v))/2),y=R.create(h).move(b,-i(p,s(h,b))/2),O=new Ht(E,y).getCenter(),I=a(f,O,d),G=o(O,h,I.direction);m.points=[I.points[0],G.points[0]],m.direction=G.direction}}return m}n.nodeToNode=l;function u(f,h,d,p,m){const b=d.union(p).inflate(1),v=b.getCenter(),E=v.distance(h)>v.distance(f),y=E?h:f,O=E?f:h;let I,G,k;m?(I=R.fromPolar(b.width+b.height,e[m],y),I=b.getNearestPointToPoint(I).move(I,-1)):I=b.getNearestPointToPoint(y).move(y,1),G=r(I,O,b);let X;I.round().equals(G.round())?(G=R.fromPolar(b.width+b.height,Te.toRad(I.theta(y))+Math.PI/2,O),G=b.getNearestPointToPoint(G).move(O,1).round(),k=r(I,G,b),X=E?[G,k,I]:[I,k,G]):X=E?[G,I]:[I,G];const Z=s(E?I:G,h);return{points:X,direction:Z}}n.insideNode=u})(Xn||(Xn={}));const uL={step:10,maxLoopCount:2e3,precision:1,maxDirectionChange:90,perpendicular:!0,excludeTerminals:[],excludeNodes:[],excludeShapes:[],startDirections:["top","right","bottom","left"],endDirections:["top","right","bottom","left"],directionMap:{top:{x:0,y:-1},right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0}},cost(){return Ur(this.step,this)},directions(){const n=Ur(this.step,this),t=Ur(this.cost,this);return[{cost:t,offsetX:n,offsetY:0},{cost:t,offsetX:-n,offsetY:0},{cost:t,offsetX:0,offsetY:n},{cost:t,offsetX:0,offsetY:-n}]},penalties(){const n=Ur(this.step,this);return{0:0,45:n/2,90:n/2}},paddingBox(){const n=Ur(this.step,this);return{x:-n,y:-n,width:2*n,height:2*n}},fallbackRouter:Ov,draggingRouter:null,snapToGrid:!0};function Ur(n,t){return typeof n=="function"?n.call(t):n}function hL(n){const t=Object.keys(n).reduce((e,r)=>{const i=e;return r==="fallbackRouter"||r==="draggingRouter"||r==="fallbackRoute"?i[r]=n[r]:i[r]=Ur(n[r],n),e},{});if(t.padding){const e=Pi(t.padding);t.paddingBox={x:-e.left,y:-e.top,width:e.left+e.right,height:e.top+e.bottom}}return t.directions.forEach(e=>{const r=new R(0,0),i=new R(e.offsetX,e.offsetY);e.angle=Te.normalize(r.theta(i))}),t}const eg=1,ng=2;class fL{constructor(){this.items=[],this.hash={},this.values={}}add(t,e){this.hash[t]?this.items.splice(this.items.indexOf(t),1):this.hash[t]=eg,this.values[t]=e;const r=NA(this.items,t,i=>this.values[i]);this.items.splice(r,0,t)}pop(){const t=this.items.shift();return t&&(this.hash[t]=ng),t}isOpen(t){return this.hash[t]===eg}isClose(t){return this.hash[t]===ng}isEmpty(){return this.items.length===0}}class dL{constructor(t){this.options=t,this.mapGridSize=100,this.map={}}build(t,e){const r=this.options,i=r.excludeTerminals.reduce((l,u)=>{const f=e[u];if(f){const h=t.getCell(f.cell);h&&l.push(h)}return l},[]);let s=[];const o=t.getCell(e.getSourceCellId());o&&(s=xd(s,o.getAncestors().map(l=>l.id)));const a=t.getCell(e.getTargetCellId());a&&(s=xd(s,a.getAncestors().map(l=>l.id)));const c=this.mapGridSize;return t.getNodes().reduce((l,u)=>{const f=i.some(b=>b.id===u.id),h=u.shape?r.excludeShapes.includes(u.shape):!1,d=r.excludeNodes.some(b=>typeof b=="string"?u.id===b:b===u),p=s.includes(u.id),m=h||f||d||p;if(u.isVisible()&&!m){const b=u.getBBox().moveAndExpand(r.paddingBox),v=b.getOrigin().snapToGrid(c),E=b.getCorner().snapToGrid(c);for(let y=v.x;y<=E.x;y+=c)for(let O=v.y;O<=E.y;O+=c){const I=new R(y,O).toString();l[I]==null&&(l[I]=[]),l[I].push(b)}}return l},this.map),this}isAccessible(t){const e=t.clone().snapToGrid(this.mapGridSize).toString(),r=this.map[e];return r?r.every(i=>!i.containsPoint(t)):!0}}function Mv(n,t){const e=n.sourceBBox.clone();return t&&t.paddingBox?e.moveAndExpand(t.paddingBox):e}function Pv(n,t){const e=n.targetBBox.clone();return t&&t.paddingBox?e.moveAndExpand(t.paddingBox):e}function Rv(n,t){return n.sourceAnchor?n.sourceAnchor:Mv(n,t).getCenter()}function pL(n,t){return n.targetAnchor?n.targetAnchor:Pv(n,t).getCenter()}function Kl(n,t,e,r,i){const s=360/e,o=n.theta(gL(n,t,r,i)),a=Te.normalize(o+s/2);return s*Math.floor(a/s)}function gL(n,t,e,r){const i=r.step,s=t.x-n.x,o=t.y-n.y,a=s/e.x,c=o/e.y,l=a*i,u=c*i;return new R(n.x+l,n.y+u)}function rg(n,t){const e=Math.abs(n-t);return e>180?360-e:e}function mL(n,t){const e=t.step;return t.directions.forEach(r=>{r.gridOffsetX=r.offsetX/e*n.x,r.gridOffsetY=r.offsetY/e*n.y}),t.directions}function bL(n,t,e){return{source:t.clone(),x:ig(e.x-t.x,n),y:ig(e.y-t.y,n)}}function ig(n,t){if(!n)return t;const e=Math.abs(n),r=Math.round(e/t);if(!r)return e;const i=r*t,o=(e-i)/r;return t+o}function vL(n,t){const e=t.source,r=_e.snapToGrid(n.x-e.x,t.x)+e.x,i=_e.snapToGrid(n.y-e.y,t.y)+e.y;return new R(r,i)}function ho(n,t){return n.round(t)}function ja(n,t,e){return ho(vL(n.clone(),t),e)}function bo(n){return n.toString()}function Zl(n){return new R(n.x===0?0:Math.abs(n.x)/n.x,n.y===0?0:Math.abs(n.y)/n.y)}function sg(n,t){let e=1/0;for(let r=0,i=t.length;r<i;r+=1){const s=n.manhattanDistance(t[r]);s<e&&(e=s)}return e}function og(n,t,e,r,i){const s=i.precision,o=i.directionMap,a=n.diff(t.getCenter()),c=Object.keys(o).reduce((l,u)=>{if(e.includes(u)){const f=o[u],h=new R(n.x+f.x*(Math.abs(a.x)+t.width),n.y+f.y*(Math.abs(a.y)+t.height)),p=new Ht(n,h).intersect(t)||[];let m,b=null;for(let v=0;v<p.length;v+=1){const E=p[v],y=n.squaredDistance(E);(m==null||y>m)&&(m=y,b=E)}if(b){let v=ja(b,r,s);t.containsPoint(v)&&(v=ja(v.translate(f.x*r.x,f.y*r.y),r,s)),l.push(v)}}return l},[]);return t.containsPoint(n)||c.push(ja(n,r,s)),c}function yL(n,t,e,r,i){const s=[];let o=Zl(i.diff(e)),a=bo(e),c=n[a],l;for(;c;){l=t[a];const h=Zl(l.diff(c));h.equals(o)||(s.unshift(l),o=h),a=bo(c),c=n[a]}const u=t[a];return Zl(u.diff(r)).equals(o)||s.unshift(u),s}function EL(n,t,e,r,i){const s=i.precision;let o,a;Bt.isRectangle(t)?o=ho(Rv(n,i).clone(),s):o=ho(t.clone(),s),Bt.isRectangle(e)?a=ho(pL(n,i).clone(),s):a=ho(e.clone(),s);const c=bL(i.step,o,a),l=o,u=a;let f,h;if(Bt.isRectangle(t)?f=og(l,t,i.startDirections,c,i):f=[l],Bt.isRectangle(e)?h=og(a,e,i.endDirections,c,i):h=[u],f=f.filter(d=>r.isAccessible(d)),h=h.filter(d=>r.isAccessible(d)),f.length>0&&h.length>0){const d=new fL,p={},m={},b={};for(let at=0,ft=f.length;at<ft;at+=1){const H=f[at],Ut=bo(H);d.add(Ut,sg(H,h)),p[Ut]=H,b[Ut]=0}const v=i.previousDirectionAngle,E=v===void 0;let y,O;const I=mL(c,i),G=I.length,k=h.reduce((at,ft)=>{const H=bo(ft);return at.push(H),at},[]),X=R.equalPoints(f,h);let Z=i.maxLoopCount;for(;!d.isEmpty()&&Z>0;){const at=d.pop(),ft=p[at],H=m[at],Ut=b[at],zt=ft.equals(l),W=H==null;let lt;if(W?E?zt?lt=null:lt=Kl(l,ft,G,c,i):lt=v:lt=Kl(H,ft,G,c,i),!(W&&X)&&k.indexOf(at)>=0)return i.previousDirectionAngle=lt,yL(m,p,ft,l,u);for(let Xt=0;Xt<G;Xt+=1){y=I[Xt];const ot=y.angle;if(O=rg(lt,ot),!(E&&zt)&&O>i.maxDirectionChange)continue;const et=ja(ft.clone().translate(y.gridOffsetX||0,y.gridOffsetY||0),c,s),K=bo(et);if(d.isClose(K)||!r.isAccessible(et))continue;if(k.indexOf(K)>=0&&!et.equals(u)){const be=Kl(et,u,G,c,i);if(rg(ot,be)>i.maxDirectionChange)continue}const Ct=y.cost,Lt=zt?0:i.penalties[O],Ot=Ut+Ct+Lt;(!d.isOpen(K)||Ot<b[K])&&(p[K]=et,m[K]=ft,b[K]=Ot,d.add(K,Ot+sg(et,h)))}Z-=1}}return i.fallbackRoute?Qt(i.fallbackRoute,this,l,u,i):null}function xL(n,t=10){if(n.length<=1)return n;for(let e=0,r=n.length;e<r-1;e+=1){const i=n[e],s=n[e+1];if(i.x===s.x){const o=t*Math.round(i.x/t);i.x!==o&&(i.x=o,s.x=o)}else if(i.y===s.y){const o=t*Math.round(i.y/t);i.y!==o&&(i.y=o,s.y=o)}}return n}const wL=function(n,t,e){const r=hL(t),i=Mv(e,r),s=Pv(e,r),o=Rv(e,r),a=new dL(r).build(e.graph.model,e.cell),c=n.map(d=>R.create(d)),l=[];let u=o,f,h;for(let d=0,p=c.length;d<=p;d+=1){let m=null;if(f=h||i,h=c[d],h==null){h=s;const v=e.cell;if((v.getSourceCellId()==null||v.getTargetCellId()==null)&&typeof r.draggingRouter=="function"){const y=f===i?o:f,O=h.getOrigin();m=Qt(r.draggingRouter,e,y,O,r)}}if(m==null&&(m=EL(e,f,h,a,r)),m===null)return console.warn("Unable to execute manhattan algorithm, use orth instead"),Qt(r.fallbackRouter,this,n,r,e);const b=m[0];b&&b.equals(u)&&m.shift(),u=m[m.length-1]||u,l.push(...m)}return r.snapToGrid?xL(l,e.graph.grid.getGridSize()):l},Nv=function(n,t,e){return Qt(wL,this,n,Object.assign(Object.assign({},uL),t),e)},AL={maxDirectionChange:45,directions(){const n=Ur(this.step,this),t=Ur(this.cost,this),e=Math.ceil(Math.sqrt(n*n<<1));return[{cost:t,offsetX:n,offsetY:0},{cost:e,offsetX:n,offsetY:n},{cost:t,offsetX:0,offsetY:n},{cost:e,offsetX:-n,offsetY:n},{cost:t,offsetX:-n,offsetY:0},{cost:e,offsetX:-n,offsetY:-n},{cost:t,offsetX:0,offsetY:-n},{cost:e,offsetX:n,offsetY:-n}]},fallbackRoute(n,t,e){const r=n.theta(t),i=[];let s={x:t.x,y:n.y},o={x:n.x,y:t.y};if(r%180>90){const y=s;s=o,o=y}const a=r%90<45?s:o,c=new Ht(n,a),l=90*Math.ceil(r/90),u=R.fromPolar(c.squaredLength(),Te.toRad(l+135),a),f=new Ht(t,u),h=c.intersectsWithLine(f),d=h||t,p=h?d:n,m=360/e.directions.length,b=p.theta(t),v=Te.normalize(b+m/2),E=m*Math.floor(v/m);return e.previousDirectionAngle=E,d&&i.push(d.round()),i.push(t),i}},SL=function(n,t,e){return Qt(Nv,this,n,Object.assign(Object.assign({},AL),t),e)},TL=function(n,t,e){const r=t.offset||32,i=t.min==null?16:t.min;let s=0,o=t.direction;const a=e.sourceBBox,c=e.targetBBox,l=a.getCenter(),u=c.getCenter();if(typeof r=="number"&&(s=r),o==null){let v=c.left-a.right,E=c.top-a.bottom;v>=0&&E>=0?o=v>=E?"L":"T":v<=0&&E>=0?(v=a.left-c.right,v>=0?o=v>=E?"R":"T":o="T"):v>=0&&E<=0?(E=a.top-c.bottom,E>=0?o=v>=E?"L":"B":o="L"):(v=a.left-c.right,E=a.top-c.bottom,v>=0&&E>=0?o=v>=E?"R":"B":v<=0&&E>=0?o="B":v>=0&&E<=0?o="R":o=Math.abs(v)>Math.abs(E)?"R":"B")}o==="H"?o=u.x-l.x>=0?"L":"R":o==="V"&&(o=u.y-l.y>=0?"T":"B"),r==="center"&&(o==="L"?s=(c.left-a.right)/2:o==="R"?s=(a.left-c.right)/2:o==="T"?s=(c.top-a.bottom)/2:o==="B"&&(s=(a.top-c.bottom)/2));let f,h,d;const p=o==="L"||o==="R";if(p){if(u.y===l.y)return[...n];d=o==="L"?1:-1,f="x",h="width"}else{if(u.x===l.x)return[...n];d=o==="T"?1:-1,f="y",h="height"}const m=l.clone(),b=u.clone();if(m[f]+=d*(a[h]/2+s),b[f]-=d*(c[h]/2+s),p){const v=m.x,E=b.x,y=a.width/2+i,O=c.width/2+i;u.x>l.x?E<=v&&(m.x=Math.max(E,l.x+y),b.x=Math.min(v,u.x-O)):E>=v&&(m.x=Math.min(E,l.x-y),b.x=Math.max(v,u.x+O))}else{const v=m.y,E=b.y,y=a.height/2+i,O=c.height/2+i;u.y>l.y?E<=v&&(m.y=Math.max(E,l.y+y),b.y=Math.min(v,u.y-O)):E>=v&&(m.y=Math.min(E,l.y-y),b.y=Math.max(v,u.y+O))}return[m.toJSON(),...n,b.toJSON()]};function ts(n,t){if(t!=null&&t!==!1){const e=typeof t=="boolean"?0:t;if(e>0){const r=R.create(n[1]).move(n[2],e),i=R.create(n[1]).move(n[0],e);return[r.toJSON(),...n,i.toJSON()]}{const r=n[1];return[Object.assign({},r),...n,Object.assign({},r)]}}return n}const CL=function(n,t,e){const r=t.width||50,s=(t.height||80)/2,o=t.angle||"auto",a=e.sourceAnchor,c=e.targetAnchor,l=e.sourceBBox,u=e.targetBBox;if(a.equals(c)){const f=v=>{const E=Te.toRad(v),y=Math.sin(E),O=Math.cos(E),I=new R(a.x+O*r,a.y+y*r),G=new R(I.x-O*s,I.y-y*s),k=G.clone().rotate(-90,I),X=G.clone().rotate(90,I);return[k.toJSON(),I.toJSON(),X.toJSON()]},h=v=>{const E=a.clone().move(v,-1),y=new Ht(E,v);return!l.containsPoint(v)&&!l.intersectsWithLine(y)},d=[0,90,180,270,45,135,225,315];if(typeof o=="number")return ts(f(o),t.merge);const p=l.getCenter();if(p.equals(a))return ts(f(0),t.merge);const m=p.angleBetween(a,p.clone().translate(1,0));let b=f(m);if(h(b[1]))return ts(b,t.merge);for(let v=1,E=d.length;v<E;v+=1)if(b=f(m+d[v]),h(b[1]))return ts(b,t.merge);return ts(b,t.merge)}{const f=new Ht(a,c);let h=f.parallel(-r),d=h.getCenter(),p=h.start.clone().move(h.end,s),m=h.end.clone().move(h.start,s);const b=f.parallel(-1),v=new Ht(b.start,d),E=new Ht(b.end,d);if((l.containsPoint(d)||u.containsPoint(d)||l.intersectsWithLine(v)||l.intersectsWithLine(E)||u.intersectsWithLine(v)||u.intersectsWithLine(E))&&(h=f.parallel(r),d=h.getCenter(),p=h.start.clone().move(h.end,s),m=h.end.clone().move(h.start,s)),t.merge){const y=new Ht(a,c),O=new Ht(d,y.center).setLength(Number.MAX_SAFE_INTEGER),I=l.intersectsWithLine(O),G=u.intersectsWithLine(O),k=I?Array.isArray(I)?I:[I]:[];G&&(Array.isArray(G)?k.push(...G):k.push(G));const X=y.center.closest(k);X?(e.sourceAnchor=X.clone(),e.targetAnchor=X.clone()):(e.sourceAnchor=y.center.clone(),e.targetAnchor=y.center.clone())}return ts([p.toJSON(),d.toJSON(),m.toJSON()],t.merge)}},_L=Object.freeze(Object.defineProperty({__proto__:null,er:TL,loop:CL,manhattan:Nv,metro:SL,normal:oL,oneSide:aL,orth:Ov},Symbol.toStringTag,{value:"Module"}));var $r;(function(n){n.presets=_L,n.registry=rn.create({type:"router"}),n.registry.register(n.presets,!0)})($r||($r={}));const OL=function(n,t,e,r={}){const i=[n,...e,t],s=new en(i),o=new ne(s);return r.raw?o:o.serialize()},ML=function(n,t,e,r={}){const i=e.length===3?0:1,s=R.create(e[0+i]),o=R.create(e[2+i]),a=R.create(e[1+i]);if(!R.equals(n,t)){const l=new R((n.x+t.x)/2,(n.y+t.y)/2),u=l.angleBetween(R.create(n).rotate(90,l),a);u>1&&(s.rotate(180-u,l),o.rotate(180-u,l),a.rotate(180-u,l))}const c=`
     M ${n.x} ${n.y}
     Q ${s.x} ${s.y} ${a.x} ${a.y}
     Q ${o.x} ${o.y} ${t.x} ${t.y}
  `;return r.raw?ne.parse(c):c},PL=function(n,t,e,r={}){const i=new ne;i.appendSegment(ne.createSegment("M",n));const s=1/3,o=2/3,a=r.radius||10;let c,l;for(let u=0,f=e.length;u<f;u+=1){const h=R.create(e[u]),d=e[u-1]||n,p=e[u+1]||t;c=l||h.distance(d)/2,l=h.distance(p)/2;const m=-Math.min(a,c),b=-Math.min(a,l),v=h.clone().move(d,m).round(),E=h.clone().move(p,b).round(),y=new R(s*v.x+o*h.x,o*h.y+s*v.y),O=new R(s*E.x+o*h.x,o*h.y+s*E.y);i.appendSegment(ne.createSegment("L",v)),i.appendSegment(ne.createSegment("C",y,O,E))}return i.appendSegment(ne.createSegment("L",t)),r.raw?i:i.serialize()},RL=function(n,t,e,r={}){let i,s=r.direction;if(e&&e.length!==0){const o=[n,...e,t],a=Ye.throughPoints(o);i=new ne(a)}else if(i=new ne,i.appendSegment(ne.createSegment("M",n)),s||(s=Math.abs(n.x-t.x)>=Math.abs(n.y-t.y)?"H":"V"),s==="H"){const o=(n.x+t.x)/2;i.appendSegment(ne.createSegment("C",o,n.y,o,t.y,t.x,t.y))}else{const o=(n.y+t.y)/2;i.appendSegment(ne.createSegment("C",n.x,o,t.x,o,t.x,t.y))}return r.raw?i:i.serialize()},ag=1,La=1/3,Ia=2/3;function NL(n){let t=n.graph._jumpOverUpdateList;if(t==null&&(t=n.graph._jumpOverUpdateList=[],n.graph.on("cell:mouseup",()=>{const e=n.graph._jumpOverUpdateList;setTimeout(()=>{for(let r=0;r<e.length;r+=1)e[r].update()})}),n.graph.on("model:reseted",()=>{t=n.graph._jumpOverUpdateList=[]})),t.indexOf(n)<0){t.push(n);const e=()=>t.splice(t.indexOf(n),1);n.cell.once("change:connector",e),n.cell.once("removed",e)}}function Ql(n,t,e=[]){const r=[n,...e,t],i=[];return r.forEach((s,o)=>{const a=r[o+1];a!=null&&i.push(new Ht(s,a))}),i}function LL(n,t){const e=[];return t.forEach(r=>{const i=n.intersectsWithLine(r);i&&e.push(i)}),e}function cg(n,t){return new Ht(n,t).squaredLength()}function IL(n,t,e){return t.reduce((r,i,s)=>{if(oc.includes(i))return r;const o=r.pop()||n,a=R.create(i).move(o.start,-e);let c=R.create(i).move(o.start,+e);const l=t[s+1];if(l!=null){const h=c.distance(l);h<=e&&(c=l.move(o.start,h),oc.push(l))}else if(a.distance(o.end)<e*2+ag)return r.push(o),r;if(c.distance(o.start)<e*2+ag)return r.push(o),r;const f=new Ht(a,c);return Io.push(f),r.push(new Ht(o.start,a),f,new Ht(c,o.end)),r},[])}function lg(n,t,e,r){const i=new ne;let s;return s=ne.createSegment("M",n[0].start),i.appendSegment(s),n.forEach((o,a)=>{if(Io.includes(o)){let c,l,u,f;if(e==="arc"){c=-90,l=o.start.diff(o.end),(l.x<0||l.x===0&&l.y<0)&&(c+=180);const d=o.getCenter(),p=new Ht(d,o.end).rotate(c,d);let m;m=new Ht(o.start,d),u=m.pointAt(2/3).rotate(c,o.start),f=p.pointAt(1/3).rotate(-c,p.end),s=ne.createSegment("C",u,f,p.end),i.appendSegment(s),m=new Ht(d,o.end),u=p.pointAt(1/3).rotate(c,p.end),f=m.pointAt(1/3).rotate(-c,o.end),s=ne.createSegment("C",u,f,o.end),i.appendSegment(s)}else if(e==="gap")s=ne.createSegment("M",o.end),i.appendSegment(s);else if(e==="cubic"){c=o.start.theta(o.end);const h=t*.6;let d=t*1.35;l=o.start.diff(o.end),(l.x<0||l.x===0&&l.y<0)&&(d*=-1),u=new R(o.start.x+h,o.start.y+d).rotate(c,o.start),f=new R(o.end.x-h,o.end.y+d).rotate(c,o.end),s=ne.createSegment("C",u,f,o.end),i.appendSegment(s)}}else{const c=n[a+1];r===0||!c||Io.includes(c)?(s=ne.createSegment("L",o.end),i.appendSegment(s)):DL(r,i,o.end,o.start,c.end)}}),i}function DL(n,t,e,r,i){const s=e.distance(r)/2,o=e.distance(i)/2,a=-Math.min(n,s),c=-Math.min(n,o),l=e.clone().move(r,a).round(),u=e.clone().move(i,c).round(),f=new R(La*l.x+Ia*e.x,Ia*e.y+La*l.y),h=new R(La*u.x+Ia*e.x,Ia*e.y+La*u.y);let d;d=ne.createSegment("L",l),t.appendSegment(d),d=ne.createSegment("C",f,h,u),t.appendSegment(d)}let Io,oc;const kL=function(n,t,e,r={}){Io=[],oc=[],NL(this);const i=r.size||5,s=r.type||"arc",o=r.radius||0,a=r.ignoreConnectors||["smooth"],c=this.graph,u=c.model.getEdges();if(u.length===1)return lg(Ql(n,t,e),i,s,o);const f=this.cell,h=u.indexOf(f),d=c.options.connecting.connector||{},p=u.filter((O,I)=>{const G=O.getConnector()||d;return a.includes(G.name)?!1:I>h?G.name!=="jumpover":!0}),m=p.map(O=>c.findViewByCell(O)),b=Ql(n,t,e),v=m.map(O=>O==null?[]:O===this?b:Ql(O.sourcePoint,O.targetPoint,O.routePoints)),E=[];b.forEach(O=>{const I=p.reduce((G,k,X)=>{if(k!==f){const Z=LL(O,v[X]);G.push(...Z)}return G},[]).sort((G,k)=>cg(O.start,G)-cg(O.start,k));I.length>0?E.push(...IL(O,I,i)):E.push(O)});const y=lg(E,i,s,o);return Io=[],oc=[],r.raw?y:y.serialize()},BL=Object.freeze(Object.defineProperty({__proto__:null,jumpover:kL,loop:ML,normal:OL,rounded:PL,smooth:RL},Symbol.toStringTag,{value:"Module"}));var Ci;(function(n){n.presets=BL,n.registry=rn.create({type:"connector"}),n.registry.register(n.presets,!0)})(Ci||(Ci={}));var jL=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Lv extends $e{constructor(t={}){super(),this.pending=!1,this.changing=!1,this.data={},this.mutate(De(t)),this.changed={}}mutate(t,e={}){const r=e.unset===!0,i=e.silent===!0,s=[],o=this.changing;this.changing=!0,o||(this.previous=De(this.data),this.changed={});const a=this.data,c=this.previous,l=this.changed;if(Object.keys(t).forEach(u=>{const f=u,h=t[f];mr(a[f],h)||s.push(f),mr(c[f],h)?delete l[f]:l[f]=h,r?delete a[f]:a[f]=h}),!i&&s.length>0&&(this.pending=!0,this.pendingOptions=e,s.forEach(u=>{this.emit("change:*",{key:u,options:e,store:this,current:a[u],previous:c[u]})})),o)return this;if(!i)for(;this.pending;)this.pending=!1,this.emit("changed",{current:a,previous:c,store:this,options:this.pendingOptions});return this.pending=!1,this.changing=!1,this.pendingOptions=null,this}get(t,e){if(t==null)return this.data;const r=this.data[t];return r??e}getPrevious(t){if(this.previous){const e=this.previous[t];return e??void 0}}set(t,e,r){return t!=null&&(typeof t=="object"?this.mutate(t,e):this.mutate({[t]:e},r)),this}remove(t,e){const i={};let s;if(typeof t=="string")i[t]=void 0,s=e;else if(Array.isArray(t))t.forEach(o=>i[o]=void 0),s=e;else{for(const o in this.data)i[o]=void 0;s=t}return this.mutate(i,Object.assign(Object.assign({},s),{unset:!0})),this}getByPath(t){return Qu(this.data,t,"/")}setByPath(t,e,r={}){const i="/",s=Array.isArray(t)?[...t]:t.split(i),o=Array.isArray(t)?t.join(i):t,a=s[0],c=s.length;if(r.propertyPath=o,r.propertyValue=e,r.propertyPathArray=s,c===1)this.set(a,e,r);else{const l={};let u=l,f=a;for(let p=1;p<c;p+=1){const m=s[p],b=Number.isFinite(Number(m));u=u[f]=b?[]:{},f=m}Is(l,s,e,i);const h=De(this.data);r.rewrite&&Fp(h,t,i);const d=an(h,l);this.set(a,d[a],r)}return this}removeByPath(t,e){const r=Array.isArray(t)?t:t.split("/"),i=r[0];if(r.length===1)this.remove(i,e);else{const s=r.slice(1),o=De(this.get(i));o&&Fp(o,s),this.set(i,o,e)}return this}hasChanged(t){return t==null?Object.keys(this.changed).length>0:t in this.changed}getChanges(t){if(t==null)return this.hasChanged()?De(this.changed):null;const e=this.changing?this.previous:this.data,r={};let i;for(const s in t){const o=t[s];mr(e[s],o)||(r[s]=o,i=!0)}return i?De(r):null}toJSON(){return De(this.data)}clone(){const t=this.constructor;return new t(this.data)}dispose(){this.off(),this.data={},this.previous={},this.changed={},this.pending=!1,this.changing=!1,this.pendingOptions=null,this.trigger("disposed",{store:this})}}jL([$e.dispose()],Lv.prototype,"dispose",null);class Do{constructor(t){this.cell=t,this.ids={},this.cache={}}get(){return Object.keys(this.ids)}start(t,e,r={},i="/"){const s=this.cell.getPropByPath(t),o=eA(r,Do.defaultOptions),a=this.getTiming(o.timing),c=this.getInterp(o.interp,s,e);let l=0;const u=Array.isArray(t)?t.join(i):t,f=Array.isArray(t)?t:t.split(i),h=()=>{const d=new Date().getTime();l===0&&(l=d);let m=(d-l)/o.duration;m<1?this.ids[u]=requestAnimationFrame(h):m=1;const b=c(a(m));this.cell.setPropByPath(f,b),r.progress&&r.progress(Object.assign({progress:m,currentValue:b},this.getArgs(u))),m===1&&(this.cell.notify("transition:complete",this.getArgs(u)),r.complete&&r.complete(this.getArgs(u)),this.cell.notify("transition:finish",this.getArgs(u)),r.finish&&r.finish(this.getArgs(u)),this.clean(u))};return setTimeout(()=>{this.stop(t,void 0,i),this.cache[u]={startValue:s,targetValue:e,options:o},this.ids[u]=requestAnimationFrame(h),this.cell.notify("transition:start",this.getArgs(u)),r.start&&r.start(this.getArgs(u))},r.delay),this.stop.bind(this,t,i,r)}stop(t,e={},r="/"){const i=Array.isArray(t)?t:t.split(r);return Object.keys(this.ids).filter(s=>mr(i,s.split(r).slice(0,i.length))).forEach(s=>{cancelAnimationFrame(this.ids[s]);const o=this.cache[s],a=this.getArgs(s),c=Object.assign(Object.assign({},o.options),e),l=c.jumpedToEnd;l&&o.targetValue!=null&&(this.cell.setPropByPath(s,o.targetValue),this.cell.notify("transition:end",Object.assign({},a)),this.cell.notify("transition:complete",Object.assign({},a)),c.complete&&c.complete(Object.assign({},a)));const u=Object.assign({jumpedToEnd:l},a);this.cell.notify("transition:stop",Object.assign({},u)),c.stop&&c.stop(Object.assign({},u)),this.cell.notify("transition:finish",Object.assign({},a)),c.finish&&c.finish(Object.assign({},a)),this.clean(s)}),this}clean(t){delete this.ids[t],delete this.cache[t]}getTiming(t){return typeof t=="string"?Ni[t]:t}getInterp(t,e,r){return t?t(e,r):typeof r=="number"?Si.number(e,r):typeof r=="string"?r[0]==="#"?Si.color(e,r):Si.unit(e,r):Si.object(e,r)}getArgs(t){const e=this.cache[t];return{path:t,startValue:e.startValue,targetValue:e.targetValue,cell:this.cell}}}(function(n){n.defaultOptions={delay:10,duration:100,timing:"linear"}})(Do||(Do={}));var FL=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},Iv=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class Ae extends $e{static config(t){const{markup:e,propHooks:r,attrHooks:i}=t,s=Iv(t,["markup","propHooks","attrHooks"]);e!=null&&(this.markup=e),r&&(this.propHooks=this.propHooks.slice(),Array.isArray(r)?this.propHooks.push(...r):typeof r=="function"?this.propHooks.push(r):Object.values(r).forEach(o=>{typeof o=="function"&&this.propHooks.push(o)})),i&&(this.attrHooks=Object.assign(Object.assign({},this.attrHooks),i)),this.defaults=an({},this.defaults,s)}static getMarkup(){return this.markup}static getDefaults(t){return t?this.defaults:De(this.defaults)}static getAttrHooks(){return this.attrHooks}static applyPropHooks(t,e){return this.propHooks.reduce((r,i)=>i?Qt(i,t,r):r,e)}get[Symbol.toStringTag](){return Ae.toStringTag}constructor(t={}){super();const r=this.constructor.getDefaults(!0),i=an({},this.preprocess(r),this.preprocess(t));this.id=i.id||Ya(),this.store=new Lv(i),this.animation=new Do(this),this.setup(),this.init(),this.postprocess(t)}init(){}get model(){return this._model}set model(t){this._model!==t&&(this._model=t)}preprocess(t,e){const r=t.id,s=this.constructor.applyPropHooks(this,t);return r==null&&e!==!0&&(s.id=Ya()),s}postprocess(t){}setup(){this.store.on("change:*",t=>{const{key:e,current:r,previous:i,options:s}=t;this.notify("change:*",{key:e,options:s,current:r,previous:i,cell:this}),this.notify(`change:${e}`,{options:s,current:r,previous:i,cell:this});const o=e;(o==="source"||o==="target")&&this.notify("change:terminal",{type:o,current:r,previous:i,options:s,cell:this})}),this.store.on("changed",({options:t})=>this.notify("changed",{options:t,cell:this}))}notify(t,e){this.trigger(t,e);const r=this.model;return r&&(r.notify(`cell:${t}`,e),this.isNode()?r.notify(`node:${t}`,Object.assign(Object.assign({},e),{node:this})):this.isEdge()&&r.notify(`edge:${t}`,Object.assign(Object.assign({},e),{edge:this}))),this}isNode(){return!1}isEdge(){return!1}isSameStore(t){return this.store===t.store}get view(){return this.store.get("view")}get shape(){return this.store.get("shape","")}getProp(t,e){return t==null?this.store.get():this.store.get(t,e)}setProp(t,e,r){if(typeof t=="string")this.store.set(t,e,r);else{const i=this.preprocess(t,!0);this.store.set(an({},this.getProp(),i),e),this.postprocess(t)}return this}removeProp(t,e){return typeof t=="string"||Array.isArray(t)?this.store.removeByPath(t,e):this.store.remove(e),this}hasChanged(t){return t==null?this.store.hasChanged():this.store.hasChanged(t)}getPropByPath(t){return this.store.getByPath(t)}setPropByPath(t,e,r={}){return this.model&&(t==="children"?this._children=e?e.map(i=>this.model.getCell(i)).filter(i=>i!=null):null:t==="parent"&&(this._parent=e?this.model.getCell(e):null)),this.store.setByPath(t,e,r),this}removePropByPath(t,e={}){const r=Array.isArray(t)?t:t.split("/");return r[0]==="attrs"&&(e.dirty=!0),this.store.removeByPath(r,e),this}prop(t,e,r){return t==null?this.getProp():typeof t=="string"||Array.isArray(t)?arguments.length===1?this.getPropByPath(t):e==null?this.removePropByPath(t,r||{}):this.setPropByPath(t,e,r||{}):this.setProp(t,e||{})}previous(t){return this.store.getPrevious(t)}get zIndex(){return this.getZIndex()}set zIndex(t){t==null?this.removeZIndex():this.setZIndex(t)}getZIndex(){return this.store.get("zIndex")}setZIndex(t,e={}){return this.store.set("zIndex",t,e),this}removeZIndex(t={}){return this.store.remove("zIndex",t),this}toFront(t={}){const e=this.model;if(e){let r=e.getMaxZIndex(),i;t.deep?(i=this.getDescendants({deep:!0,breadthFirst:!0}),i.unshift(this)):i=[this],r=r-i.length+1;const s=e.total();let o=e.indexOf(this)!==s-i.length;o||(o=i.some((a,c)=>a.getZIndex()!==r+c)),o&&this.batchUpdate("to-front",()=>{r+=i.length,i.forEach((a,c)=>{a.setZIndex(r+c,t)})})}return this}toBack(t={}){const e=this.model;if(e){let r=e.getMinZIndex(),i;t.deep?(i=this.getDescendants({deep:!0,breadthFirst:!0}),i.unshift(this)):i=[this];let s=e.indexOf(this)!==0;s||(s=i.some((o,a)=>o.getZIndex()!==r+a)),s&&this.batchUpdate("to-back",()=>{r-=i.length,i.forEach((o,a)=>{o.setZIndex(r+a,t)})})}return this}get markup(){return this.getMarkup()}set markup(t){t==null?this.removeMarkup():this.setMarkup(t)}getMarkup(){let t=this.store.get("markup");return t==null&&(t=this.constructor.getMarkup()),t}setMarkup(t,e={}){return this.store.set("markup",t,e),this}removeMarkup(t={}){return this.store.remove("markup",t),this}get attrs(){return this.getAttrs()}set attrs(t){t==null?this.removeAttrs():this.setAttrs(t)}getAttrs(){const t=this.store.get("attrs");return t?Object.assign({},t):{}}setAttrs(t,e={}){if(t==null)this.removeAttrs(e);else{const r=i=>this.store.set("attrs",i,e);if(e.overwrite===!0)r(t);else{const i=this.getAttrs();e.deep===!1?r(Object.assign(Object.assign({},i),t)):r(an({},i,t))}}return this}replaceAttrs(t,e={}){return this.setAttrs(t,Object.assign(Object.assign({},e),{overwrite:!0}))}updateAttrs(t,e={}){return this.setAttrs(t,Object.assign(Object.assign({},e),{deep:!1}))}removeAttrs(t={}){return this.store.remove("attrs",t),this}getAttrDefinition(t){if(!t)return null;const r=this.constructor.getAttrHooks()||{};let i=r[t]||vr.registry.get(t);if(!i){const s=hc(t);i=r[s]||vr.registry.get(s)}return i||null}getAttrByPath(t){return t==null||t===""?this.getAttrs():this.getPropByPath(this.prefixAttrPath(t))}setAttrByPath(t,e,r={}){return this.setPropByPath(this.prefixAttrPath(t),e,r),this}removeAttrByPath(t,e={}){return this.removePropByPath(this.prefixAttrPath(t),e),this}prefixAttrPath(t){return Array.isArray(t)?["attrs"].concat(t):`attrs/${t}`}attr(t,e,r){return t==null?this.getAttrByPath():typeof t=="string"||Array.isArray(t)?arguments.length===1?this.getAttrByPath(t):e==null?this.removeAttrByPath(t,r||{}):this.setAttrByPath(t,e,r||{}):this.setAttrs(t,e||{})}get visible(){return this.isVisible()}set visible(t){this.setVisible(t)}setVisible(t,e={}){return this.store.set("visible",t,e),this}isVisible(){return this.store.get("visible")!==!1}show(t={}){return this.isVisible()||this.setVisible(!0,t),this}hide(t={}){return this.isVisible()&&this.setVisible(!1,t),this}toggleVisible(t,e={}){const r=typeof t=="boolean"?t:!this.isVisible(),i=typeof t=="boolean"?e:t;return r?this.show(i):this.hide(i),this}get data(){return this.getData()}set data(t){this.setData(t)}getData(){return this.store.get("data")}setData(t,e={}){if(t==null)this.removeData(e);else{const r=i=>this.store.set("data",i,e);if(e.overwrite===!0)r(t);else{const i=this.getData();e.deep===!1?r(typeof t=="object"?Object.assign(Object.assign({},i),t):t):r(an({},i,t))}}return this}replaceData(t,e={}){return this.setData(t,Object.assign(Object.assign({},e),{overwrite:!0}))}updateData(t,e={}){return this.setData(t,Object.assign(Object.assign({},e),{deep:!1}))}removeData(t={}){return this.store.remove("data",t),this}get parent(){return this.getParent()}get children(){return this.getChildren()}getParentId(){return this.store.get("parent")}getParent(){const t=this.getParentId();if(t&&this.model){const e=this.model.getCell(t);return this._parent=e,e}return null}getChildren(){const t=this.store.get("children");if(t&&t.length&&this.model){const e=t.map(r=>{var i;return(i=this.model)===null||i===void 0?void 0:i.getCell(r)}).filter(r=>r!=null);return this._children=e,[...e]}return null}hasParent(){return this.parent!=null}isParentOf(t){return t!=null&&t.getParent()===this}isChildOf(t){return t!=null&&this.getParent()===t}eachChild(t,e){return this.children&&this.children.forEach(t,e),this}filterChild(t,e){return this.children?this.children.filter(t,e):[]}getChildCount(){return this.children==null?0:this.children.length}getChildIndex(t){return this.children==null?-1:this.children.indexOf(t)}getChildAt(t){return this.children!=null&&t>=0?this.children[t]:null}getAncestors(t={}){const e=[];let r=this.getParent();for(;r;)e.push(r),r=t.deep!==!1?r.getParent():null;return e}getDescendants(t={}){if(t.deep!==!1){if(t.breadthFirst){const e=[],r=this.getChildren()||[];for(;r.length>0;){const i=r.shift(),s=i.getChildren();e.push(i),s&&r.push(...s)}return e}{const e=this.getChildren()||[];return e.forEach(r=>{e.push(...r.getDescendants(t))}),e}}return this.getChildren()||[]}isDescendantOf(t,e={}){if(t==null)return!1;if(e.deep!==!1){let r=this.getParent();for(;r;){if(r===t)return!0;r=r.getParent()}return!1}return this.isChildOf(t)}isAncestorOf(t,e={}){return t==null?!1:t.isDescendantOf(this,e)}contains(t){return this.isAncestorOf(t)}getCommonAncestor(...t){return Ae.getCommonAncestor(this,...t)}setParent(t,e={}){return this._parent=t,t?this.store.set("parent",t.id,e):this.store.remove("parent",e),this}setChildren(t,e={}){return this._children=t,t!=null?this.store.set("children",t.map(r=>r.id),e):this.store.remove("children",e),this}unembed(t,e={}){const r=this.children;if(r!=null&&t!=null){const i=this.getChildIndex(t);i!==-1&&(r.splice(i,1),t.setParent(null,e),this.setChildren(r,e))}return this}embed(t,e={}){return t.addTo(this,e),this}addTo(t,e={}){return Ae.isCell(t)?t.addChild(this,e):t.addCell(this,e),this}insertTo(t,e,r={}){return t.insertChild(this,e,r),this}addChild(t,e={}){return this.insertChild(t,void 0,e)}insertChild(t,e,r={}){if(t!=null&&t!==this){const i=t.getParent(),s=this!==i;let o=e;if(o==null&&(o=this.getChildCount(),s||(o-=1)),i){const c=i.getChildren();if(c){const l=c.indexOf(t);l>=0&&(t.setParent(null,r),c.splice(l,1),i.setChildren(c,r))}}let a=this.children;if(a==null?(a=[],a.push(t)):a.splice(o,0,t),t.setParent(this,r),this.setChildren(a,r),s&&this.model){const c=this.model.getIncomingEdges(this),l=this.model.getOutgoingEdges(this);c&&c.forEach(u=>u.updateParent(r)),l&&l.forEach(u=>u.updateParent(r))}this.model&&this.model.addCell(t,r)}return this}removeFromParent(t={}){const e=this.getParent();if(e!=null){const r=e.getChildIndex(this);e.removeChildAt(r,t)}return this}removeChild(t,e={}){const r=this.getChildIndex(t);return this.removeChildAt(r,e)}removeChildAt(t,e={}){const r=this.getChildAt(t);return this.children!=null&&r!=null&&(this.unembed(r,e),r.remove(e)),r}remove(t={}){return this.batchUpdate("remove",()=>{const e=this.getParent();e&&e.removeChild(this,t),t.deep!==!1&&this.eachChild(r=>r.remove(t)),this.model&&this.model.removeCell(this,t)}),this}transition(t,e,r={},i="/"){return this.animation.start(t,e,r,i)}stopTransition(t,e,r="/"){return this.animation.stop(t,e,r),this}getTransitions(){return this.animation.get()}translate(t,e,r){return this}scale(t,e,r,i){return this}addTools(t,e,r){const i=Array.isArray(t)?t:[t],s=typeof e=="string"?e:null,o=typeof e=="object"?e:typeof r=="object"?r:{};if(o.reset)return this.setTools({name:s,items:i,local:o.local},o);let a=De(this.getTools());if(a==null||s==null||a.name===s)return a==null&&(a={}),a.items||(a.items=[]),a.name=s,a.items=[...a.items,...i],this.setTools(Object.assign({},a),o)}setTools(t,e={}){return t==null?this.removeTools():this.store.set("tools",Ae.normalizeTools(t),e),this}getTools(){return this.store.get("tools")}removeTools(t={}){return this.store.remove("tools",t),this}hasTools(t){const e=this.getTools();return e==null?!1:t==null?!0:e.name===t}hasTool(t){const e=this.getTools();return e==null?!1:e.items.some(r=>typeof r=="string"?r===t:r.name===t)}removeTool(t,e={}){const r=De(this.getTools());if(r){let i=!1;const s=r.items.slice(),o=a=>{s.splice(a,1),i=!0};if(typeof t=="number")o(t);else for(let a=s.length-1;a>=0;a-=1){const c=s[a];(typeof c=="string"?c===t:c.name===t)&&o(a)}i&&(r.items=s,this.setTools(r,e))}return this}getBBox(t){return new Bt}getConnectionPoint(t,e){return new R}toJSON(t={}){const e=Object.assign({},this.store.get()),r=Object.prototype.toString,i=this.isNode()?"node":this.isEdge()?"edge":"cell";if(!e.shape){const p=this.constructor;throw new Error(`Unable to serialize ${i} missing "shape" prop, check the ${i} "${p.name||r.call(p)}"`)}const s=this.constructor,o=t.diff===!0,a=e.attrs||{},c=s.getDefaults(!0),l=o?this.preprocess(c,!0):c,u=l.attrs||{},f={};Object.entries(e).forEach(([p,m])=>{if(m!=null&&!Array.isArray(m)&&typeof m=="object"&&!Rr(m))throw new Error(`Can only serialize ${i} with plain-object props, but got a "${r.call(m)}" type of key "${p}" on ${i} "${this.id}"`);if(p!=="attrs"&&p!=="shape"&&o){const b=l[p];mr(m,b)&&delete e[p]}}),Object.keys(a).forEach(p=>{const m=a[p],b=u[p];Object.keys(m).forEach(v=>{const E=m[v],y=b?b[v]:null;E!=null&&typeof E=="object"&&!Array.isArray(E)?Object.keys(E).forEach(O=>{const I=E[O];if(b==null||y==null||!wi(y)||!mr(y[O],I)){f[p]==null&&(f[p]={}),f[p][v]==null&&(f[p][v]={});const G=f[p][v];G[O]=I}}):(b==null||!mr(y,E))&&(f[p]==null&&(f[p]={}),f[p][v]=E)})});const h=Object.assign(Object.assign({},e),{attrs:jg(f)?void 0:f});h.attrs==null&&delete h.attrs;const d=h;return d.angle===0&&delete d.angle,De(d)}clone(t={}){if(!t.deep){const r=Object.assign({},this.store.get());t.keepId||delete r.id,delete r.parent,delete r.children;const i=this.constructor;return new i(r)}return Ae.deepClone(this)[this.id]}findView(t){return t.findViewByCell(this)}startBatch(t,e={},r=this.model){return this.notify("batch:start",{name:t,data:e,cell:this}),r&&r.startBatch(t,Object.assign(Object.assign({},e),{cell:this})),this}stopBatch(t,e={},r=this.model){return r&&r.stopBatch(t,Object.assign(Object.assign({},e),{cell:this})),this.notify("batch:stop",{name:t,data:e,cell:this}),this}batchUpdate(t,e,r){const i=this.model;this.startBatch(t,r,i);const s=e();return this.stopBatch(t,r,i),s}dispose(){this.removeFromParent(),this.store.dispose()}}Ae.defaults={};Ae.attrHooks={};Ae.propHooks=[];FL([$e.dispose()],Ae.prototype,"dispose",null);(function(n){function t(e){return typeof e=="string"?{items:[e]}:Array.isArray(e)?{items:e}:e.items?e:{items:[e]}}n.normalizeTools=t})(Ae||(Ae={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNode=="function"&&typeof i.isEdge=="function"&&typeof i.prop=="function"&&typeof i.attr=="function"}n.isCell=t})(Ae||(Ae={}));(function(n){function t(...s){const o=s.filter(c=>c!=null).map(c=>c.getAncestors()).sort((c,l)=>c.length-l.length);return o.shift().find(c=>o.every(l=>l.includes(c)))||null}n.getCommonAncestor=t;function e(s,o={}){let a=null;for(let c=0,l=s.length;c<l;c+=1){const u=s[c];let f=u.getBBox(o);if(f){if(u.isNode()){const h=u.getAngle();h!=null&&h!==0&&(f=f.bbox(h))}a=a==null?f:a.union(f)}}return a}n.getCellsBBox=e;function r(s){const o=[s,...s.getDescendants({deep:!0})];return n.cloneCells(o)}n.deepClone=r;function i(s){const o=Gg(s),a=o.reduce((c,l)=>(c[l.id]=l.clone(),c),{});return o.forEach(c=>{const l=a[c.id];if(l.isEdge()){const h=l.getSourceCellId(),d=l.getTargetCellId();h&&a[h]&&l.setSource(Object.assign(Object.assign({},l.getSource()),{cell:a[h].id})),d&&a[d]&&l.setTarget(Object.assign(Object.assign({},l.getTarget()),{cell:a[d].id}))}const u=c.getParent();u&&a[u.id]&&l.setParent(a[u.id]);const f=c.getChildren();if(f&&f.length){const h=f.reduce((d,p)=>(a[p.id]&&d.push(a[p.id]),d),[]);h.length>0&&l.setChildren(h)}}),a}n.cloneCells=i})(Ae||(Ae={}));(function(n){n.config({propHooks(t){var{tools:e}=t,r=Iv(t,["tools"]);return e&&(r.tools=n.normalizeTools(e)),r}})})(Ae||(Ae={}));var Cs;(function(n){let t,e;function r(o,a){return a?t!=null&&t.exist(o):e!=null&&e.exist(o)}n.exist=r;function i(o){t=o}n.setEdgeRegistry=i;function s(o){e=o}n.setNodeRegistry=s})(Cs||(Cs={}));class GL{constructor(t){this.ports=[],this.groups={},this.init(De(t))}getPorts(){return this.ports}getGroup(t){return t!=null?this.groups[t]:null}getPortsByGroup(t){return this.ports.filter(e=>e.group===t||e.group==null&&t==null)}getPortsLayoutByGroup(t,e){const r=this.getPortsByGroup(t),i=t?this.getGroup(t):null,s=i?i.position:null,o=s?s.name:null;let a;if(o!=null){const f=Ti.registry.get(o);if(f==null)return Ti.registry.onNotFound(o);a=f}else a=Ti.presets.left;const c=r.map(f=>f&&f.position&&f.position.args||{}),l=s&&s.args||{};return a(c,e,l).map((f,h)=>{const d=r[h];return{portLayout:f,portId:d.id,portSize:d.size,portAttrs:d.attrs,labelSize:d.label.size,labelLayout:this.getPortLabelLayout(d,R.create(f.position),e)}})}init(t){const{groups:e,items:r}=t;e!=null&&Object.keys(e).forEach(i=>{this.groups[i]=this.parseGroup(e[i])}),Array.isArray(r)&&r.forEach(i=>{this.ports.push(this.parsePort(i))})}parseGroup(t){return Object.assign(Object.assign({},t),{label:this.getLabel(t,!0),position:this.getPortPosition(t.position,!0)})}parsePort(t){const e=Object.assign({},t),r=this.getGroup(t.group)||{};return e.markup=e.markup||r.markup,e.attrs=an({},r.attrs,e.attrs),e.position=this.createPosition(r,e),e.label=an({},r.label,this.getLabel(e)),e.zIndex=this.getZIndex(r,e),e.size=Object.assign(Object.assign({},r.size),e.size),e}getZIndex(t,e){return typeof e.zIndex=="number"?e.zIndex:typeof t.zIndex=="number"||t.zIndex==="auto"?t.zIndex:"auto"}createPosition(t,e){return an({name:"left",args:{}},t.position,{args:e.args})}getPortPosition(t,e=!1){if(t==null){if(e)return{name:"left",args:{}}}else{if(typeof t=="string")return{name:t,args:{}};if(Array.isArray(t))return{name:"absolute",args:{x:t[0],y:t[1]}};if(typeof t=="object")return t}return{args:{}}}getPortLabelPosition(t,e=!1){if(t==null){if(e)return{name:"left",args:{}}}else{if(typeof t=="string")return{name:t,args:{}};if(typeof t=="object")return t}return{args:{}}}getLabel(t,e=!1){const r=t.label||{};return r.position=this.getPortLabelPosition(r.position,e),r}getPortLabelLayout(t,e,r){const i=t.label.position.name||"left",s=t.label.position.args||{},o=ys.registry.get(i)||ys.presets.left;return o?o(e,r,s):null}}var Nc=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};let sn=class Dv extends Ae{get[Symbol.toStringTag](){return Dv.toStringTag}constructor(t={}){super(t),this.initPorts()}preprocess(t,e){const{x:r,y:i,width:s,height:o}=t,a=Nc(t,["x","y","width","height"]);if(r!=null||i!=null){const c=a.position;a.position=Object.assign(Object.assign({},c),{x:r??(c?c.x:0),y:i??(c?c.y:0)})}if(s!=null||o!=null){const c=a.size;a.size=Object.assign(Object.assign({},c),{width:s??(c?c.width:0),height:o??(c?c.height:0)})}return super.preprocess(a,e)}isNode(){return!0}size(t,e,r){return t===void 0?this.getSize():typeof t=="number"?this.setSize(t,e,r):this.setSize(t,e)}getSize(){const t=this.store.get("size");return t?Object.assign({},t):{width:1,height:1}}setSize(t,e,r){return typeof t=="object"?this.resize(t.width,t.height,e):this.resize(t,e,r),this}resize(t,e,r={}){this.startBatch("resize",r);const i=r.direction;if(i){const s=this.getSize();switch(i){case"left":case"right":e=s.height;break;case"top":case"bottom":t=s.width;break}let a={right:0,"top-right":0,top:1,"top-left":1,left:2,"bottom-left":2,bottom:3,"bottom-right":3}[i];const c=Te.normalize(this.getAngle()||0);r.absolute&&(a+=Math.floor((c+45)/90),a%=4);const l=this.getBBox();let u;a===0?u=l.getBottomLeft():a===1?u=l.getCorner():a===2?u=l.getTopRight():u=l.getOrigin();const f=u.clone().rotate(-c,l.getCenter()),h=Math.sqrt(t*t+e*e)/2;let d=a*Math.PI/2;d+=Math.atan(a%2===0?e/t:t/e),d-=Te.toRad(c);const m=R.fromPolar(h,d,f).clone().translate(t/-2,e/-2);this.store.set("size",{width:t,height:e},r),this.setPosition(m.x,m.y,r)}else this.store.set("size",{width:t,height:e},r);return this.stopBatch("resize",r),this}scale(t,e,r,i={}){const s=this.getBBox().scale(t,e,r??void 0);return this.startBatch("scale",i),this.setPosition(s.x,s.y,i),this.resize(s.width,s.height,i),this.stopBatch("scale"),this}position(t,e,r){return typeof t=="number"?this.setPosition(t,e,r):this.getPosition(t)}getPosition(t={}){if(t.relative){const r=this.getParent();if(r!=null&&r.isNode()){const i=this.getPosition(),s=r.getPosition();return{x:i.x-s.x,y:i.y-s.y}}}const e=this.store.get("position");return e?Object.assign({},e):{x:0,y:0}}setPosition(t,e,r={}){let i,s,o;if(typeof t=="object"?(i=t.x,s=t.y,o=e||{}):(i=t,s=e,o=r||{}),o.relative){const a=this.getParent();if(a!=null&&a.isNode()){const c=a.getPosition();i+=c.x,s+=c.y}}if(o.deep){const a=this.getPosition();this.translate(i-a.x,s-a.y,o)}else this.store.set("position",{x:i,y:s},o);return this}translate(t=0,e=0,r={}){if(t===0&&e===0)return this;r.translateBy=r.translateBy||this.id;const i=this.getPosition();if(r.restrict!=null&&r.translateBy===this.id){const o=this.getBBox({deep:!0}),a=r.restrict,c=i.x-o.x,l=i.y-o.y,u=Math.max(a.x+c,Math.min(a.x+a.width+c-o.width,i.x+t)),f=Math.max(a.y+l,Math.min(a.y+a.height+l-o.height,i.y+e));t=u-i.x,e=f-i.y}const s={x:i.x+t,y:i.y+e};return r.tx=t,r.ty=e,r.transition?(typeof r.transition!="object"&&(r.transition={}),this.transition("position",s,Object.assign(Object.assign({},r.transition),{interp:Si.object})),this.eachChild(o=>{var a;((a=r.exclude)===null||a===void 0?void 0:a.includes(o))||o.translate(t,e,r)})):(this.startBatch("translate",r),this.store.set("position",s,r),this.eachChild(o=>{var a;((a=r.exclude)===null||a===void 0?void 0:a.includes(o))||o.translate(t,e,r)}),this.stopBatch("translate",r)),this}angle(t,e){return t==null?this.getAngle():this.rotate(t,e)}getAngle(){return this.store.get("angle",0)}rotate(t,e={}){const r=this.getAngle();if(e.center){const i=this.getSize(),s=this.getPosition(),o=this.getBBox().getCenter();o.rotate(r-t,e.center);const a=o.x-i.width/2-s.x,c=o.y-i.height/2-s.y;this.startBatch("rotate",{angle:t,options:e}),this.setPosition(s.x+a,s.y+c,e),this.rotate(t,Object.assign(Object.assign({},e),{center:null})),this.stopBatch("rotate")}else this.store.set("angle",e.absolute?t:(r+t)%360,e);return this}getBBox(t={}){if(t.deep){const e=this.getDescendants({deep:!0,breadthFirst:!0});return e.push(this),Ae.getCellsBBox(e)}return Bt.fromPositionAndSize(this.getPosition(),this.getSize())}getConnectionPoint(t,e){const r=this.getBBox(),i=r.getCenter(),s=t.getTerminal(e);if(s==null)return i;const o=s.port;if(!o||!this.hasPort(o))return i;const a=this.getPort(o);if(!a||!a.group)return i;const l=this.getPortsPosition(a.group)[o].position,u=R.create(l).translate(r.getOrigin()),f=this.getAngle();return f&&u.rotate(-f,i),u}fit(t={}){const r=(this.getChildren()||[]).filter(l=>l.isNode());if(r.length===0)return this;this.startBatch("fit-embeds",t),t.deep&&r.forEach(l=>l.fit(t));let{x:i,y:s,width:o,height:a}=Ae.getCellsBBox(r);const c=Pi(t.padding);return i-=c.left,s-=c.top,o+=c.left+c.right,a+=c.bottom+c.top,this.store.set({position:{x:i,y:s},size:{width:o,height:a}},t),this.stopBatch("fit-embeds"),this}get portContainerMarkup(){return this.getPortContainerMarkup()}set portContainerMarkup(t){this.setPortContainerMarkup(t)}getDefaultPortContainerMarkup(){return this.store.get("defaultPortContainerMarkup")||ke.getPortContainerMarkup()}getPortContainerMarkup(){return this.store.get("portContainerMarkup")||this.getDefaultPortContainerMarkup()}setPortContainerMarkup(t,e={}){return this.store.set("portContainerMarkup",ke.clone(t),e),this}get portMarkup(){return this.getPortMarkup()}set portMarkup(t){this.setPortMarkup(t)}getDefaultPortMarkup(){return this.store.get("defaultPortMarkup")||ke.getPortMarkup()}getPortMarkup(){return this.store.get("portMarkup")||this.getDefaultPortMarkup()}setPortMarkup(t,e={}){return this.store.set("portMarkup",ke.clone(t),e),this}get portLabelMarkup(){return this.getPortLabelMarkup()}set portLabelMarkup(t){this.setPortLabelMarkup(t)}getDefaultPortLabelMarkup(){return this.store.get("defaultPortLabelMarkup")||ke.getPortLabelMarkup()}getPortLabelMarkup(){return this.store.get("portLabelMarkup")||this.getDefaultPortLabelMarkup()}setPortLabelMarkup(t,e={}){return this.store.set("portLabelMarkup",ke.clone(t),e),this}get ports(){const t=this.store.get("ports",{items:[]});return t.items==null&&(t.items=[]),t}getPorts(){return De(this.ports.items)}getPortsByGroup(t){return this.getPorts().filter(e=>e.group===t)}getPort(t){return De(this.ports.items.find(e=>e.id&&e.id===t))}getPortAt(t){return this.ports.items[t]||null}hasPorts(){return this.ports.items.length>0}hasPort(t){return this.getPortIndex(t)!==-1}getPortIndex(t){const e=typeof t=="string"?t:t.id;return e!=null?this.ports.items.findIndex(r=>r.id===e):-1}getPortsPosition(t){const e=this.getSize();return this.port.getPortsLayoutByGroup(t,new Bt(0,0,e.width,e.height)).reduce((i,s)=>{const o=s.portLayout;return i[s.portId]={position:Object.assign({},o.position),angle:o.angle||0},i},{})}getPortProp(t,e){return this.getPropByPath(this.prefixPortPath(t,e))}setPortProp(t,e,r,i){if(typeof e=="string"||Array.isArray(e)){const a=this.prefixPortPath(t,e),c=r;return this.setPropByPath(a,c,i)}const s=this.prefixPortPath(t),o=e;return this.setPropByPath(s,o,r)}removePortProp(t,e,r){return typeof e=="string"||Array.isArray(e)?this.removePropByPath(this.prefixPortPath(t,e),r):this.removePropByPath(this.prefixPortPath(t),e)}portProp(t,e,r,i){return e==null?this.getPortProp(t):typeof e=="string"||Array.isArray(e)?arguments.length===2?this.getPortProp(t,e):r==null?this.removePortProp(t,e,i):this.setPortProp(t,e,r,i):this.setPortProp(t,e,r)}prefixPortPath(t,e){const r=this.getPortIndex(t);if(r===-1)throw new Error(`Unable to find port with id: "${t}"`);return e==null||e===""?["ports","items",`${r}`]:Array.isArray(e)?["ports","items",`${r}`,...e]:`ports/items/${r}/${e}`}addPort(t,e){const r=[...this.ports.items];return r.push(t),this.setPropByPath("ports/items",r,e),this}addPorts(t,e){return this.setPropByPath("ports/items",[...this.ports.items,...t],e),this}insertPort(t,e,r){const i=[...this.ports.items];return i.splice(t,0,e),this.setPropByPath("ports/items",i,r),this}removePort(t,e={}){return this.removePortAt(this.getPortIndex(t),e)}removePortAt(t,e={}){if(t>=0){const r=[...this.ports.items];r.splice(t,1),e.rewrite=!0,this.setPropByPath("ports/items",r,e)}return this}removePorts(t,e){let r;if(Array.isArray(t)){if(r=e||{},t.length){r.rewrite=!0;const s=[...this.ports.items].filter(o=>!t.some(a=>{const c=typeof a=="string"?a:a.id;return o.id===c}));this.setPropByPath("ports/items",s,r)}}else r=t||{},r.rewrite=!0,this.setPropByPath("ports/items",[],r);return this}getParsedPorts(){return this.port.getPorts()}getParsedGroups(){return this.port.groups}getPortsLayoutByGroup(t,e){return this.port.getPortsLayoutByGroup(t,e)}initPorts(){this.updatePortData(),this.on("change:ports",()=>{this.processRemovedPort(),this.updatePortData()})}processRemovedPort(){const t=this.ports,e={};t.items.forEach(o=>{o.id&&(e[o.id]=!0)});const r={};(this.store.getPrevious("ports")||{items:[]}).items.forEach(o=>{o.id&&!e[o.id]&&(r[o.id]=!0)});const s=this.model;s&&!jg(r)&&(s.getConnectedEdges(this,{incoming:!0}).forEach(c=>{const l=c.getTargetPortId();l&&r[l]&&c.remove()}),s.getConnectedEdges(this,{outgoing:!0}).forEach(c=>{const l=c.getSourcePortId();l&&r[l]&&c.remove()}))}validatePorts(){const t={},e=[];return this.ports.items.forEach(r=>{typeof r!="object"&&e.push(`Invalid port ${r}.`),r.id==null&&(r.id=this.generatePortId()),t[r.id]&&e.push("Duplicitied port id."),t[r.id]=!0}),e}generatePortId(){return Ya()}updatePortData(){const t=this.validatePorts();if(t.length>0)throw this.store.set("ports",this.store.getPrevious("ports")),new Error(t.join(" "));const e=this.port?this.port.getPorts():null;this.port=new GL(this.ports);const r=this.port.getPorts(),i=e?r.filter(o=>e.find(a=>a.id===o.id)?null:o):[...r],s=e?e.filter(o=>r.find(a=>a.id===o.id)?null:o):[];i.length>0&&this.notify("ports:added",{added:i,cell:this,node:this}),s.length>0&&this.notify("ports:removed",{removed:s,cell:this,node:this})}};sn.defaults={angle:0,position:{x:0,y:0},size:{width:1,height:1}};(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNode=="function"&&typeof i.isEdge=="function"&&typeof i.prop=="function"&&typeof i.attr=="function"&&typeof i.size=="function"&&typeof i.position=="function"}n.isNode=t})(sn||(sn={}));(function(n){n.config({propHooks(t){var{ports:e}=t,r=Nc(t,["ports"]);return e&&(r.ports=Array.isArray(e)?{items:e}:e),r}})})(sn||(sn={}));(function(n){n.registry=rn.create({type:"node",process(t,e){if(Cs.exist(t,!0))throw new Error(`Node with name '${t}' was registered by anthor Edge`);if(typeof e=="function")return e.config({shape:t}),e;let r=n;const{inherit:i}=e,s=Nc(e,["inherit"]);if(i)if(typeof i=="string"){const a=this.get(i);a==null?this.onNotFound(i,"inherited"):r=a}else r=i;s.constructorName==null&&(s.constructorName=t);const o=r.define.call(r,s);return o.config({shape:t}),o}}),Cs.setNodeRegistry(n.registry)})(sn||(sn={}));(function(n){let t=0;function e(s){return s?th(s):(t+=1,`CustomNode${t}`)}function r(s){const{constructorName:o,overwrite:a}=s,c=Nc(s,["constructorName","overwrite"]),l=Zu(e(o||c.shape),this);return l.config(c),c.shape&&n.registry.register(c.shape,l,a),l}n.define=r;function i(s){const o=s.shape||"rect",a=n.registry.get(o);return a?new a(s):n.registry.onNotFound(o)}n.create=i})(sn||(sn={}));var Lc=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};let Ke=class kv extends Ae{get[Symbol.toStringTag](){return kv.toStringTag}constructor(t={}){super(t)}preprocess(t,e){const{source:r,sourceCell:i,sourcePort:s,sourcePoint:o,target:a,targetCell:c,targetPort:l,targetPoint:u}=t,h=Lc(t,["source","sourceCell","sourcePort","sourcePoint","target","targetCell","targetPort","targetPoint"]),d=p=>typeof p=="string"||typeof p=="number";if(r!=null)if(Ae.isCell(r))h.source={cell:r.id};else if(d(r))h.source={cell:r};else if(R.isPoint(r))h.source=r.toJSON();else if(Array.isArray(r))h.source={x:r[0],y:r[1]};else{const p=r.cell;Ae.isCell(p)?h.source=Object.assign(Object.assign({},r),{cell:p.id}):h.source=r}if(i!=null||s!=null){let p=h.source;if(i!=null){const m=d(i)?i:i.id;p?p.cell=m:p=h.source={cell:m}}s!=null&&p&&(p.port=s)}else o!=null&&(h.source=R.create(o).toJSON());if(a!=null)if(Ae.isCell(a))h.target={cell:a.id};else if(d(a))h.target={cell:a};else if(R.isPoint(a))h.target=a.toJSON();else if(Array.isArray(a))h.target={x:a[0],y:a[1]};else{const p=a.cell;Ae.isCell(p)?h.target=Object.assign(Object.assign({},a),{cell:p.id}):h.target=a}if(c!=null||l!=null){let p=h.target;if(c!=null){const m=d(c)?c:c.id;p?p.cell=m:p=h.target={cell:m}}l!=null&&p&&(p.port=l)}else u!=null&&(h.target=R.create(u).toJSON());return super.preprocess(h,e)}setup(){super.setup(),this.on("change:labels",t=>this.onLabelsChanged(t)),this.on("change:vertices",t=>this.onVertexsChanged(t))}isEdge(){return!0}disconnect(t={}){return this.store.set({source:{x:0,y:0},target:{x:0,y:0}},t),this}get source(){return this.getSource()}set source(t){this.setSource(t)}getSource(){return this.getTerminal("source")}getSourceCellId(){return this.source.cell}getSourcePortId(){return this.source.port}setSource(t,e,r={}){return this.setTerminal("source",t,e,r)}get target(){return this.getTarget()}set target(t){this.setTarget(t)}getTarget(){return this.getTerminal("target")}getTargetCellId(){return this.target.cell}getTargetPortId(){return this.target.port}setTarget(t,e,r={}){return this.setTerminal("target",t,e,r)}getTerminal(t){return Object.assign({},this.store.get(t))}setTerminal(t,e,r,i={}){if(Ae.isCell(e))return this.store.set(t,an({},r,{cell:e.id}),i),this;const s=e;return R.isPoint(e)||s.x!=null&&s.y!=null?(this.store.set(t,an({},r,{x:s.x,y:s.y}),i),this):(this.store.set(t,De(e),i),this)}getSourcePoint(){return this.getTerminalPoint("source")}getTargetPoint(){return this.getTerminalPoint("target")}getTerminalPoint(t){const e=this[t];if(R.isPointLike(e))return R.create(e);const r=this.getTerminalCell(t);return r?r.getConnectionPoint(this,t):new R}getSourceCell(){return this.getTerminalCell("source")}getTargetCell(){return this.getTerminalCell("target")}getTerminalCell(t){if(this.model){const e=t==="source"?this.getSourceCellId():this.getTargetCellId();if(e)return this.model.getCell(e)}return null}getSourceNode(){return this.getTerminalNode("source")}getTargetNode(){return this.getTerminalNode("target")}getTerminalNode(t){let e=this;const r={};for(;e&&e.isEdge();){if(r[e.id])return null;r[e.id]=!0,e=e.getTerminalCell(t)}return e&&e.isNode()?e:null}get router(){return this.getRouter()}set router(t){t==null?this.removeRouter():this.setRouter(t)}getRouter(){return this.store.get("router")}setRouter(t,e,r){return typeof t=="object"?this.store.set("router",t,e):this.store.set("router",{name:t,args:e},r),this}removeRouter(t={}){return this.store.remove("router",t),this}get connector(){return this.getConnector()}set connector(t){t==null?this.removeConnector():this.setConnector(t)}getConnector(){return this.store.get("connector")}setConnector(t,e,r){return typeof t=="object"?this.store.set("connector",t,e):this.store.set("connector",{name:t,args:e},r),this}removeConnector(t={}){return this.store.remove("connector",t)}getDefaultLabel(){const t=this.constructor,e=this.store.get("defaultLabel")||t.defaultLabel||{};return De(e)}get labels(){return this.getLabels()}set labels(t){this.setLabels(t)}getLabels(){return[...this.store.get("labels",[])].map(t=>this.parseLabel(t))}setLabels(t,e={}){return this.store.set("labels",Array.isArray(t)?t:[t],e),this}insertLabel(t,e,r={}){const i=this.getLabels(),s=i.length;let o=e!=null&&Number.isFinite(e)?e:s;return o<0&&(o=s+o+1),i.splice(o,0,this.parseLabel(t)),this.setLabels(i,r)}appendLabel(t,e={}){return this.insertLabel(t,-1,e)}getLabelAt(t){const e=this.getLabels();return t!=null&&Number.isFinite(t)?this.parseLabel(e[t]):null}setLabelAt(t,e,r={}){if(t!=null&&Number.isFinite(t)){const i=this.getLabels();i[t]=this.parseLabel(e),this.setLabels(i,r)}return this}removeLabelAt(t,e={}){const r=this.getLabels(),i=t!=null&&Number.isFinite(t)?t:-1,s=r.splice(i,1);return this.setLabels(r,e),s.length?s[0]:null}parseLabel(t){return typeof t=="string"?this.constructor.parseStringLabel(t):t}onLabelsChanged({previous:t,current:e}){const r=t&&e?e.filter(s=>t.find(o=>s===o||mr(s,o))?null:s):e?[...e]:[],i=t&&e?t.filter(s=>e.find(o=>s===o||mr(s,o))?null:s):t?[...t]:[];r.length>0&&this.notify("labels:added",{added:r,cell:this,edge:this}),i.length>0&&this.notify("labels:removed",{removed:i,cell:this,edge:this})}get vertices(){return this.getVertices()}set vertices(t){this.setVertices(t)}getVertices(){return[...this.store.get("vertices",[])]}setVertices(t,e={}){const r=Array.isArray(t)?t:[t];return this.store.set("vertices",r.map(i=>R.toJSON(i)),e),this}insertVertex(t,e,r={}){const i=this.getVertices(),s=i.length;let o=e!=null&&Number.isFinite(e)?e:s;return o<0&&(o=s+o+1),i.splice(o,0,R.toJSON(t)),this.setVertices(i,r)}appendVertex(t,e={}){return this.insertVertex(t,-1,e)}getVertexAt(t){return t!=null&&Number.isFinite(t)?this.getVertices()[t]:null}setVertexAt(t,e,r={}){if(t!=null&&Number.isFinite(t)){const i=this.getVertices();i[t]=e,this.setVertices(i,r)}return this}removeVertexAt(t,e={}){const r=this.getVertices(),i=t!=null&&Number.isFinite(t)?t:-1;return r.splice(i,1),this.setVertices(r,e)}onVertexsChanged({previous:t,current:e}){const r=t&&e?e.filter(s=>t.find(o=>R.equals(s,o))?null:s):e?[...e]:[],i=t&&e?t.filter(s=>e.find(o=>R.equals(s,o))?null:s):t?[...t]:[];r.length>0&&this.notify("vertexs:added",{added:r,cell:this,edge:this}),i.length>0&&this.notify("vertexs:removed",{removed:i,cell:this,edge:this})}getDefaultMarkup(){return this.store.get("defaultMarkup")||ke.getEdgeMarkup()}getMarkup(){return super.getMarkup()||this.getDefaultMarkup()}translate(t,e,r={}){return r.translateBy=r.translateBy||this.id,r.tx=t,r.ty=e,this.applyToPoints(i=>({x:(i.x||0)+t,y:(i.y||0)+e}),r)}scale(t,e,r,i={}){return this.applyToPoints(s=>R.create(s).scale(t,e,r).toJSON(),i)}applyToPoints(t,e={}){const r={},i=this.getSource(),s=this.getTarget();R.isPointLike(i)&&(r.source=t(i)),R.isPointLike(s)&&(r.target=t(s));const o=this.getVertices();return o.length>0&&(r.vertices=o.map(t)),this.store.set(r,e),this}getBBox(){return this.getPolyline().bbox()}getConnectionPoint(){return this.getPolyline().pointAt(.5)}getPolyline(){const t=[this.getSourcePoint(),...this.getVertices().map(e=>R.create(e)),this.getTargetPoint()];return new en(t)}updateParent(t){let e=null;const r=this.getSourceCell(),i=this.getTargetCell(),s=this.getParent();return r&&i&&(r===i||r.isDescendantOf(i)?e=i:i.isDescendantOf(r)?e=r:e=Ae.getCommonAncestor(r,i)),s&&e&&e.id!==s.id&&s.unembed(this,t),e&&(!s||s.id!==e.id)&&e.embed(this,t),e}hasLoop(t={}){const e=this.getSource(),r=this.getTarget(),i=e.cell,s=r.cell;if(!i||!s)return!1;let o=i===s;if(!o&&t.deep&&this._model){const a=this.getSourceCell(),c=this.getTargetCell();a&&c&&(o=a.isAncestorOf(c,t)||c.isAncestorOf(a,t))}return o}getFragmentAncestor(){const t=[this,this.getSourceNode(),this.getTargetNode()].filter(e=>e!=null);return this.getCommonAncestor(...t)}isFragmentDescendantOf(t){const e=this.getFragmentAncestor();return!!e&&(e.id===t.id||e.isDescendantOf(t))}};Ke.defaults={};(function(n){function t(e,r){const i=e,s=r;return i.cell===s.cell?i.port===s.port||i.port==null&&s.port==null:!1}n.equalTerminals=t})(Ke||(Ke={}));(function(n){n.defaultLabel={markup:[{tagName:"rect",selector:"body"},{tagName:"text",selector:"label"}],attrs:{text:{fill:"#000",fontSize:14,textAnchor:"middle",textVerticalAnchor:"middle",pointerEvents:"none"},rect:{ref:"label",fill:"#fff",rx:3,ry:3,refWidth:1,refHeight:1,refX:0,refY:0}},position:{distance:.5}};function t(e){return{attrs:{label:{text:e}}}}n.parseStringLabel=t})(Ke||(Ke={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNode=="function"&&typeof i.isEdge=="function"&&typeof i.prop=="function"&&typeof i.attr=="function"&&typeof i.disconnect=="function"&&typeof i.getSource=="function"&&typeof i.getTarget=="function"}n.isEdge=t})(Ke||(Ke={}));(function(n){n.registry=rn.create({type:"edge",process(t,e){if(Cs.exist(t,!1))throw new Error(`Edge with name '${t}' was registered by anthor Node`);if(typeof e=="function")return e.config({shape:t}),e;let r=n;const{inherit:i="edge"}=e,s=Lc(e,["inherit"]);if(typeof i=="string"){const a=this.get(i||"edge");a==null&&i?this.onNotFound(i,"inherited"):r=a}else r=i;s.constructorName==null&&(s.constructorName=t);const o=r.define.call(r,s);return o.config({shape:t}),o}}),Cs.setEdgeRegistry(n.registry)})(Ke||(Ke={}));(function(n){let t=0;function e(s){return s?th(s):(t+=1,`CustomEdge${t}`)}function r(s){const{constructorName:o,overwrite:a}=s,c=Lc(s,["constructorName","overwrite"]),l=Zu(e(o||c.shape),this);return l.config(c),c.shape&&n.registry.register(c.shape,l,a),l}n.define=r;function i(s){const o=s.shape||"edge",a=n.registry.get(o);return a?new a(s):n.registry.onNotFound(o)}n.create=i})(Ke||(Ke={}));(function(n){const t="basic.edge";n.config({shape:t,propHooks(e){const{label:r,vertices:i}=e,s=Lc(e,["label","vertices"]);if(r){s.labels==null&&(s.labels=[]);const o=typeof r=="string"?n.parseStringLabel(r):r;s.labels.push(o)}return i&&Array.isArray(i)&&(s.vertices=i.map(o=>R.create(o).toJSON())),s}}),n.registry.register(t,n)})(Ke||(Ke={}));var zL=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class ac extends $e{constructor(t,e={}){super(),this.length=0,this.comparator=e.comparator||"zIndex",this.clean(),t&&this.reset(t,{silent:!0})}toJSON(){return this.cells.map(t=>t.toJSON())}add(t,e,r){let i,s;typeof e=="number"?(i=e,s=Object.assign({merge:!1},r)):(i=this.length,s=Object.assign({merge:!1},e)),i>this.length&&(i=this.length),i<0&&(i+=this.length+1);const o=Array.isArray(t)?t:[t],a=this.comparator&&typeof e!="number"&&s.sort!==!1,c=this.comparator||null;let l=!1;const u=[],f=[];return o.forEach(h=>{const d=this.get(h);d?s.merge&&!h.isSameStore(d)&&(d.setProp(h.getProp(),r),f.push(d),a&&!l&&(c==null||typeof c=="function"?l=d.hasChanged():typeof c=="string"?l=d.hasChanged(c):l=c.some(p=>d.hasChanged(p)))):(u.push(h),this.reference(h))}),u.length&&(a&&(l=!0),this.cells.splice(i,0,...u),this.length=this.cells.length),l&&this.sort({silent:!0}),s.silent||(u.forEach((h,d)=>{const p={cell:h,index:i+d,options:s};this.trigger("added",p),s.dryrun||h.notify("added",Object.assign({},p))}),l&&this.trigger("sorted"),(u.length||f.length)&&this.trigger("updated",{added:u,merged:f,removed:[],options:s})),this}remove(t,e={}){const r=Array.isArray(t)?t:[t],i=this.removeCells(r,e);return!e.silent&&i.length>0&&this.trigger("updated",{options:e,removed:i,added:[],merged:[]}),Array.isArray(t)?i:i[0]}removeCells(t,e){const r=[];for(let i=0;i<t.length;i+=1){const s=this.get(t[i]);if(s==null)continue;const o=this.cells.indexOf(s);this.cells.splice(o,1),this.length-=1,delete this.map[s.id],r.push(s),this.unreference(s),e.dryrun||s.remove(),e.silent||(this.trigger("removed",{cell:s,index:o,options:e}),e.dryrun||s.notify("removed",{cell:s,index:o,options:e}))}return r}reset(t,e={}){const r=this.cells.slice();if(r.forEach(i=>this.unreference(i)),this.clean(),this.add(t,Object.assign({silent:!0},e)),!e.silent){const i=this.cells.slice();this.trigger("reseted",{options:e,previous:r,current:i});const s=[],o=[];i.forEach(a=>{r.some(l=>l.id===a.id)||s.push(a)}),r.forEach(a=>{i.some(l=>l.id===a.id)||o.push(a)}),this.trigger("updated",{options:e,added:s,removed:o,merged:[]})}return this}push(t,e){return this.add(t,this.length,e)}pop(t){const e=this.at(this.length-1);return this.remove(e,t)}unshift(t,e){return this.add(t,0,e)}shift(t){const e=this.at(0);return this.remove(e,t)}get(t){if(t==null)return null;const e=typeof t=="string"||typeof t=="number"?t:t.id;return this.map[e]||null}has(t){return this.get(t)!=null}at(t){return t<0&&(t+=this.length),this.cells[t]||null}first(){return this.at(0)}last(){return this.at(-1)}indexOf(t){return this.cells.indexOf(t)}toArray(){return this.cells.slice()}sort(t={}){return this.comparator!=null&&(this.cells=Nu(this.cells,this.comparator),t.silent||this.trigger("sorted")),this}clone(){const t=this.constructor;return new t(this.cells.slice(),{comparator:this.comparator})}reference(t){this.map[t.id]=t,t.on("*",this.notifyCellEvent,this)}unreference(t){t.off("*",this.notifyCellEvent,this),delete this.map[t.id]}notifyCellEvent(t,e){const r=e.cell;this.trigger(`cell:${t}`,e),r&&(r.isNode()?this.trigger(`node:${t}`,Object.assign(Object.assign({},e),{node:r})):r.isEdge()&&this.trigger(`edge:${t}`,Object.assign(Object.assign({},e),{edge:r})))}clean(){this.length=0,this.cells=[],this.map={}}dispose(){this.reset([])}}zL([ac.dispose()],ac.prototype,"dispose",null);var UL=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class pn extends $e{get[Symbol.toStringTag](){return pn.toStringTag}constructor(t=[]){super(),this.batches={},this.addings=new WeakMap,this.nodes={},this.edges={},this.outgoings={},this.incomings={},this.collection=new ac(t),this.setup()}notify(t,e){this.trigger(t,e);const r=this.graph;return r&&(t==="sorted"||t==="reseted"||t==="updated"?r.trigger(`model:${t}`,e):r.trigger(t,e)),this}setup(){const t=this.collection;t.on("sorted",()=>this.notify("sorted",null)),t.on("updated",e=>this.notify("updated",e)),t.on("cell:change:zIndex",()=>this.sortOnChangeZ()),t.on("added",({cell:e})=>{this.onCellAdded(e)}),t.on("removed",e=>{const r=e.cell;this.onCellRemoved(r,e.options),this.notify("cell:removed",e),r.isNode()?this.notify("node:removed",Object.assign(Object.assign({},e),{node:r})):r.isEdge()&&this.notify("edge:removed",Object.assign(Object.assign({},e),{edge:r}))}),t.on("reseted",e=>{this.onReset(e.current),this.notify("reseted",e)}),t.on("edge:change:source",({edge:e})=>this.onEdgeTerminalChanged(e,"source")),t.on("edge:change:target",({edge:e})=>{this.onEdgeTerminalChanged(e,"target")})}sortOnChangeZ(){this.collection.sort()}onCellAdded(t){const e=t.id;t.isEdge()?(t.updateParent(),this.edges[e]=!0,this.onEdgeTerminalChanged(t,"source"),this.onEdgeTerminalChanged(t,"target")):this.nodes[e]=!0}onCellRemoved(t,e){const r=t.id;if(t.isEdge()){delete this.edges[r];const i=t.getSource(),s=t.getTarget();if(i&&i.cell){const o=this.outgoings[i.cell],a=o?o.indexOf(r):-1;a>=0&&(o.splice(a,1),o.length===0&&delete this.outgoings[i.cell])}if(s&&s.cell){const o=this.incomings[s.cell],a=o?o.indexOf(r):-1;a>=0&&(o.splice(a,1),o.length===0&&delete this.incomings[s.cell])}}else delete this.nodes[r];e.clear||(e.disconnectEdges?this.disconnectConnectedEdges(t,e):this.removeConnectedEdges(t,e)),t.model===this&&(t.model=null)}onReset(t){this.nodes={},this.edges={},this.outgoings={},this.incomings={},t.forEach(e=>this.onCellAdded(e))}onEdgeTerminalChanged(t,e){const r=e==="source"?this.outgoings:this.incomings,i=t.previous(e);if(i&&i.cell){const o=Ae.isCell(i.cell)?i.cell.id:i.cell,a=r[o],c=a?a.indexOf(t.id):-1;c>=0&&(a.splice(c,1),a.length===0&&delete r[o])}const s=t.getTerminal(e);if(s&&s.cell){const o=Ae.isCell(s.cell)?s.cell.id:s.cell,a=r[o]||[];a.indexOf(t.id)===-1&&a.push(t.id),r[o]=a}}prepareCell(t,e){return!t.model&&(!e||!e.dryrun)&&(t.model=this),t.zIndex==null&&t.setZIndex(this.getMaxZIndex()+1,{silent:!0}),t}resetCells(t,e={}){return t.map(r=>this.prepareCell(r,Object.assign(Object.assign({},e),{dryrun:!0}))),this.collection.reset(t,e),t.map(r=>this.prepareCell(r,{options:e})),this}clear(t={}){const e=this.getCells();if(e.length===0)return this;const r=Object.assign(Object.assign({},t),{clear:!0});return this.batchUpdate("clear",()=>{const i=e.sort((s,o)=>{const a=s.isEdge()?1:2,c=o.isEdge()?1:2;return a-c});for(;i.length>0;){const s=i.shift();s&&s.remove(r)}},r),this}addNode(t,e={}){const r=sn.isNode(t)?t:this.createNode(t);return this.addCell(r,e),r}updateNode(t,e={}){const r=this.createNode(t),i=r.getProp();return r.dispose(),this.updateCell(i,e)}createNode(t){return sn.create(t)}addEdge(t,e={}){const r=Ke.isEdge(t)?t:this.createEdge(t);return this.addCell(r,e),r}createEdge(t){return Ke.create(t)}updateEdge(t,e={}){const r=this.createEdge(t),i=r.getProp();return r.dispose(),this.updateCell(i,e)}addCell(t,e={}){return Array.isArray(t)?this.addCells(t,e):(!this.collection.has(t)&&!this.addings.has(t)&&(this.addings.set(t,!0),this.collection.add(this.prepareCell(t,e),e),t.eachChild(r=>this.addCell(r,e)),this.addings.delete(t)),this)}addCells(t,e={}){const r=t.length;if(r===0)return this;const i=Object.assign(Object.assign({},e),{position:r-1,maxPosition:r-1});return this.startBatch("add",Object.assign(Object.assign({},i),{cells:t})),t.forEach(s=>{this.addCell(s,i),i.position-=1}),this.stopBatch("add",Object.assign(Object.assign({},i),{cells:t})),this}updateCell(t,e={}){const r=t.id&&this.getCell(t.id);return r?this.batchUpdate("update",()=>(Object.entries(t).forEach(([i,s])=>r.setProp(i,s,e)),!0),t):!1}removeCell(t,e={}){const r=typeof t=="string"?this.getCell(t):t;return r&&this.has(r)?this.collection.remove(r,e):null}updateCellId(t,e){if(t.id===e)return;this.startBatch("update",{id:e}),t.prop("id",e);const r=t.clone({keepId:!0});return this.addCell(r),this.getConnectedEdges(t).forEach(s=>{const o=s.getSourceCell(),a=s.getTargetCell();o===t&&s.setSource(Object.assign(Object.assign({},s.getSource()),{cell:e})),a===t&&s.setTarget(Object.assign(Object.assign({},s.getTarget()),{cell:e}))}),this.removeCell(t),this.stopBatch("update",{id:e}),r}removeCells(t,e={}){return t.length?this.batchUpdate("remove",()=>t.map(r=>this.removeCell(r,e))):[]}removeConnectedEdges(t,e={}){const r=this.getConnectedEdges(t);return r.forEach(i=>{i.remove(e)}),r}disconnectConnectedEdges(t,e={}){const r=typeof t=="string"?t:t.id;this.getConnectedEdges(t).forEach(i=>{const s=i.getSourceCellId(),o=i.getTargetCellId();s===r&&i.setSource({x:0,y:0},e),o===r&&i.setTarget({x:0,y:0},e)})}has(t){return this.collection.has(t)}total(){return this.collection.length}indexOf(t){return this.collection.indexOf(t)}getCell(t){return this.collection.get(t)}getCells(){return this.collection.toArray()}getFirstCell(){return this.collection.first()}getLastCell(){return this.collection.last()}getMinZIndex(){const t=this.collection.first();return t&&t.getZIndex()||0}getMaxZIndex(){const t=this.collection.last();return t&&t.getZIndex()||0}getCellsFromCache(t){return t?Object.keys(t).map(e=>this.getCell(e)).filter(e=>e!=null):[]}getNodes(){return this.getCellsFromCache(this.nodes)}getEdges(){return this.getCellsFromCache(this.edges)}getOutgoingEdges(t){const e=typeof t=="string"?t:t.id,r=this.outgoings[e];return r?r.map(i=>this.getCell(i)).filter(i=>i&&i.isEdge()):null}getIncomingEdges(t){const e=typeof t=="string"?t:t.id,r=this.incomings[e];return r?r.map(i=>this.getCell(i)).filter(i=>i&&i.isEdge()):null}getConnectedEdges(t,e={}){const r=[],i=typeof t=="string"?this.getCell(t):t;if(i==null)return r;const s={},o=e.indirect;let a=e.incoming,c=e.outgoing;a==null&&c==null&&(a=c=!0);const l=(u,f)=>{const h=f?this.getOutgoingEdges(u):this.getIncomingEdges(u);if(h!=null&&h.forEach(d=>{s[d.id]||(r.push(d),s[d.id]=!0,o&&(a&&l(d,!1),c&&l(d,!0)))}),o&&u.isEdge()){const d=f?u.getTargetCell():u.getSourceCell();d&&d.isEdge()&&(s[d.id]||(r.push(d),l(d,f)))}};if(c&&l(i,!0),a&&l(i,!1),e.deep){const u=i.getDescendants({deep:!0}),f={};u.forEach(d=>{d.isNode()&&(f[d.id]=!0)});const h=(d,p)=>{const m=p?this.getOutgoingEdges(d.id):this.getIncomingEdges(d.id);m!=null&&m.forEach(b=>{if(!s[b.id]){const v=b.getSourceCell(),E=b.getTargetCell();if(!e.enclosed&&v&&f[v.id]&&E&&f[E.id])return;r.push(b),s[b.id]=!0}})};u.forEach(d=>{d.isEdge()||(c&&h(d,!0),a&&h(d,!1))})}return r}isBoundary(t,e){const r=typeof t=="string"?this.getCell(t):t,i=e?this.getIncomingEdges(r):this.getOutgoingEdges(r);return i==null||i.length===0}getBoundaryNodes(t){const e=[];return Object.keys(this.nodes).forEach(r=>{if(this.isBoundary(r,t)){const i=this.getCell(r);i&&e.push(i)}}),e}getRoots(){return this.getBoundaryNodes(!0)}getLeafs(){return this.getBoundaryNodes(!1)}isRoot(t){return this.isBoundary(t,!0)}isLeaf(t){return this.isBoundary(t,!1)}getNeighbors(t,e={}){let r=e.incoming,i=e.outgoing;r==null&&i==null&&(r=i=!0);const o=this.getConnectedEdges(t,e).reduce((a,c)=>{const l=c.hasLoop(e),u=c.getSourceCell(),f=c.getTargetCell();return r&&u&&u.isNode()&&!a[u.id]&&(l||u!==t&&(!e.deep||!u.isDescendantOf(t)))&&(a[u.id]=u),i&&f&&f.isNode()&&!a[f.id]&&(l||f!==t&&(!e.deep||!f.isDescendantOf(t)))&&(a[f.id]=f),a},{});if(t.isEdge()){if(r){const a=t.getSourceCell();a&&a.isNode()&&!o[a.id]&&(o[a.id]=a)}if(i){const a=t.getTargetCell();a&&a.isNode()&&!o[a.id]&&(o[a.id]=a)}}return Object.keys(o).map(a=>o[a])}isNeighbor(t,e,r={}){let i=r.incoming,s=r.outgoing;return i==null&&s==null&&(i=s=!0),this.getConnectedEdges(t,r).some(o=>{const a=o.getSourceCell(),c=o.getTargetCell();return!!(i&&a&&a.id===e.id||s&&c&&c.id===e.id)})}getSuccessors(t,e={}){const r=[];return this.search(t,(i,s)=>{i!==t&&this.matchDistance(s,e.distance)&&r.push(i)},Object.assign(Object.assign({},e),{outgoing:!0})),r}isSuccessor(t,e,r={}){let i=!1;return this.search(t,(s,o)=>{if(s===e&&s!==t&&this.matchDistance(o,r.distance))return i=!0,!1},Object.assign(Object.assign({},r),{outgoing:!0})),i}getPredecessors(t,e={}){const r=[];return this.search(t,(i,s)=>{i!==t&&this.matchDistance(s,e.distance)&&r.push(i)},Object.assign(Object.assign({},e),{incoming:!0})),r}isPredecessor(t,e,r={}){let i=!1;return this.search(t,(s,o)=>{if(s===e&&s!==t&&this.matchDistance(o,r.distance))return i=!0,!1},Object.assign(Object.assign({},r),{incoming:!0})),i}matchDistance(t,e){return e==null?!0:typeof e=="function"?e(t):Array.isArray(e)&&e.includes(t)?!0:t===e}getCommonAncestor(...t){const e=[];return t.forEach(r=>{r&&(Array.isArray(r)?e.push(...r):e.push(r))}),Ae.getCommonAncestor(...e)}getSubGraph(t,e={}){const r=[],i={},s=[],o=[],a=c=>{i[c.id]||(r.push(c),i[c.id]=c,c.isEdge()&&o.push(c),c.isNode()&&s.push(c))};return t.forEach(c=>{a(c),e.deep&&c.getDescendants({deep:!0}).forEach(u=>a(u))}),o.forEach(c=>{const l=c.getSourceCell(),u=c.getTargetCell();l&&!i[l.id]&&(r.push(l),i[l.id]=l,l.isNode()&&s.push(l)),u&&!i[u.id]&&(r.push(u),i[u.id]=u,u.isNode()&&s.push(u))}),s.forEach(c=>{this.getConnectedEdges(c,e).forEach(u=>{const f=u.getSourceCell(),h=u.getTargetCell();!i[u.id]&&f&&i[f.id]&&h&&i[h.id]&&(r.push(u),i[u.id]=u)})}),r}cloneSubGraph(t,e={}){const r=this.getSubGraph(t,e);return this.cloneCells(r)}cloneCells(t){return Ae.cloneCells(t)}getNodesFromPoint(t,e){const r=typeof t=="number"?{x:t,y:e||0}:t;return this.getNodes().filter(i=>i.getBBox().containsPoint(r))}getNodesInArea(t,e,r,i,s){const o=typeof t=="number"?new Bt(t,e,r,i):Bt.create(t),a=typeof t=="number"?s:e,c=a&&a.strict;return this.getNodes().filter(l=>{const u=l.getBBox();return c?o.containsRect(u):o.isIntersectWithRect(u)})}getEdgesInArea(t,e,r,i,s){const o=typeof t=="number"?new Bt(t,e,r,i):Bt.create(t),a=typeof t=="number"?s:e,c=a&&a.strict;return this.getEdges().filter(l=>{const u=l.getBBox();return u.width===0?u.inflate(1,0):u.height===0&&u.inflate(0,1),c?o.containsRect(u):o.isIntersectWithRect(u)})}getNodesUnderNode(t,e={}){const r=t.getBBox();return(e.by==null||e.by==="bbox"?this.getNodesInArea(r):this.getNodesFromPoint(r[e.by])).filter(s=>t.id!==s.id&&!s.isDescendantOf(t))}getAllCellsBBox(){return this.getCellsBBox(this.getCells())}getCellsBBox(t,e={}){return Ae.getCellsBBox(t,e)}search(t,e,r={}){r.breadthFirst?this.breadthFirstSearch(t,e,r):this.depthFirstSearch(t,e,r)}breadthFirstSearch(t,e,r={}){const i=[],s={},o={};for(i.push(t),o[t.id]=0;i.length>0;){const a=i.shift();if(a==null||s[a.id]||(s[a.id]=!0,Qt(e,this,a,o[a.id])===!1))continue;this.getNeighbors(a,r).forEach(l=>{o[l.id]=o[a.id]+1,i.push(l)})}}depthFirstSearch(t,e,r={}){const i=[],s={},o={};for(i.push(t),o[t.id]=0;i.length>0;){const a=i.pop();if(a==null||s[a.id]||(s[a.id]=!0,Qt(e,this,a,o[a.id])===!1))continue;const c=this.getNeighbors(a,r),l=i.length;c.forEach(u=>{o[u.id]=o[a.id]+1,i.splice(l,0,u)})}}getShortestPath(t,e,r={}){const i={};this.getEdges().forEach(l=>{const u=l.getSourceCellId(),f=l.getTargetCellId();u&&f&&(i[u]||(i[u]=[]),i[f]||(i[f]=[]),i[u].push(f),r.directed||i[f].push(u))});const s=typeof t=="string"?t:t.id,o=Au.run(i,s,r.weight),a=[];let c=typeof e=="string"?e:e.id;for(o[c]&&a.push(c);c=o[c];)a.unshift(c);return a}translate(t,e,r){return this.getCells().filter(i=>!i.hasParent()).forEach(i=>i.translate(t,e,r)),this}resize(t,e,r){return this.resizeCells(t,e,this.getCells(),r)}resizeCells(t,e,r,i={}){const s=this.getCellsBBox(r);if(s){const o=Math.max(t/s.width,0),a=Math.max(e/s.height,0),c=s.getOrigin();r.forEach(l=>l.scale(o,a,c,i))}return this}toJSON(t={}){return pn.toJSON(this.getCells(),t)}parseJSON(t){return pn.fromJSON(t)}fromJSON(t,e={}){const r=this.parseJSON(t);return this.resetCells(r,e),this}startBatch(t,e={}){return this.batches[t]=(this.batches[t]||0)+1,this.notify("batch:start",{name:t,data:e}),this}stopBatch(t,e={}){return this.batches[t]=(this.batches[t]||0)-1,this.notify("batch:stop",{name:t,data:e}),this}batchUpdate(t,e,r={}){this.startBatch(t,r);const i=e();return this.stopBatch(t,r),i}hasActiveBatch(t=Object.keys(this.batches)){return(Array.isArray(t)?t:[t]).some(r=>this.batches[r]>0)}dispose(){this.collection.dispose()}}UL([pn.dispose()],pn.prototype,"dispose",null);(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.addNode=="function"&&typeof i.addEdge=="function"&&i.collection!=null}n.isModel=t})(pn||(pn={}));(function(n){function t(r,i={}){return{cells:r.map(s=>s.toJSON(i))}}n.toJSON=t;function e(r){const i=[];return Array.isArray(r)?i.push(...r):(r.cells&&i.push(...r.cells),r.nodes&&r.nodes.forEach(s=>{s.shape==null&&(s.shape="rect"),i.push(s)}),r.edges&&r.edges.forEach(s=>{s.shape==null&&(s.shape="edge"),i.push(s)})),i.map(s=>{const o=s.shape;if(o){if(sn.registry.exist(o))return sn.create(s);if(Ke.registry.exist(o))return Ke.create(s)}throw new Error("The `shape` should be specified when creating a node/edge instance")})}n.fromJSON=e})(pn||(pn={}));var VL=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};let Qr=class extends sn{get label(){return this.getLabel()}set label(t){this.setLabel(t)}getLabel(){return this.getAttrByPath("text/text")}setLabel(t,e){return t==null?this.removeLabel():this.setAttrByPath("text/text",t,e),this}removeLabel(){return this.removeAttrByPath("text/text"),this}};(function(n){n.bodyAttr={fill:"#ffffff",stroke:"#333333",strokeWidth:2},n.labelAttr={fontSize:14,fill:"#000000",refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",fontFamily:"Arial, helvetica, sans-serif"},n.config({attrs:{text:Object.assign({},n.labelAttr)},propHooks(t){const{label:e}=t,r=VL(t,["label"]);return e&&Is(r,"attrs/text/text",e),r},visible:!0})})(Qr||(Qr={}));var $L=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};function HL(n,t="body"){return[{tagName:n,selector:t},{tagName:"text",selector:"label"}]}function XL(n="xlink:href"){return e=>{const{imageUrl:r,imageWidth:i,imageHeight:s}=e,o=$L(e,["imageUrl","imageWidth","imageHeight"]);if(r!=null||i!=null||s!=null){const a=()=>{if(o.attrs){const c=o.attrs.image;r!=null&&(c[n]=r),i!=null&&(c.width=i),s!=null&&(c.height=s),o.attrs.image=c}};o.attrs?(o.attrs.image==null&&(o.attrs.image={}),a()):(o.attrs={image:{}},a())}return o}}function Fs(n,t,e={}){const r={constructorName:n,markup:HL(n,e.selector),attrs:{[n]:Object.assign({},Qr.bodyAttr)}};return(e.parent||Qr).define(an(r,t,{shape:n}))}Fs("rect",{attrs:{body:{refWidth:"100%",refHeight:"100%"}}});const WL=Ke.define({shape:"edge",markup:[{tagName:"path",selector:"wrap",groupSelector:"lines",attrs:{fill:"none",cursor:"pointer",stroke:"transparent",strokeLinecap:"round"}},{tagName:"path",selector:"line",groupSelector:"lines",attrs:{fill:"none",pointerEvents:"none"}}],attrs:{lines:{connection:!0,strokeLinejoin:"round"},wrap:{strokeWidth:10},line:{stroke:"#333",strokeWidth:2,targetMarker:"classic"}}});Fs("ellipse",{attrs:{body:{refCx:"50%",refCy:"50%",refRx:"50%",refRy:"50%"}}});var qL=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class _s extends Qr{get points(){return this.getPoints()}set points(t){this.setPoints(t)}getPoints(){return this.getAttrByPath("body/refPoints")}setPoints(t,e){return t==null?this.removePoints():this.setAttrByPath("body/refPoints",_s.pointsToString(t),e),this}removePoints(){return this.removeAttrByPath("body/refPoints"),this}}(function(n){function t(e){return typeof e=="string"?e:e.map(r=>Array.isArray(r)?r.join(","):R.isPointLike(r)?`${r.x}, ${r.y}`:"").join(" ")}n.pointsToString=t,n.config({propHooks(e){const{points:r}=e,i=qL(e,["points"]);if(r){const s=t(r);s&&Is(i,"attrs/body/refPoints",s)}return i}})})(_s||(_s={}));Fs("polygon",{},{parent:_s});Fs("polyline",{},{parent:_s});var YL=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};Qr.define({shape:"path",markup:[{tagName:"rect",selector:"bg"},{tagName:"path",selector:"body"},{tagName:"text",selector:"label"}],attrs:{bg:{refWidth:"100%",refHeight:"100%",fill:"none",stroke:"none",pointerEvents:"all"},body:{fill:"none",stroke:"#000",strokeWidth:2}},propHooks(n){const{path:t}=n,e=YL(n,["path"]);return t&&Is(e,"attrs/body/refD",t),e}});var JL=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};Qr.define({shape:"text-block",markup:[{tagName:"rect",selector:"body"},Wr.SUPPORT_FOREIGNOBJECT?{tagName:"foreignObject",selector:"foreignObject",children:[{tagName:"div",ns:yn.xhtml,selector:"label",style:{width:"100%",height:"100%",position:"static",backgroundColor:"transparent",textAlign:"center",margin:0,padding:"0px 5px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"center"}}]}:{tagName:"text",selector:"label",attrs:{textAnchor:"middle"}}],attrs:{body:Object.assign(Object.assign({},Qr.bodyAttr),{refWidth:"100%",refHeight:"100%"}),foreignObject:{refWidth:"100%",refHeight:"100%"},label:{style:{fontSize:14}}},propHooks(n){const{text:t}=n,e=JL(n,["text"]);return t&&Is(e,"attrs/label/text",t),e},attrHooks:{text:{set(n,{cell:t,view:e,refBBox:r,elem:i,attrs:s}){if(i instanceof HTMLElement)i.textContent=n;else{const o=s.style||{},a={text:n,width:-5,height:"100%"},c=Object.assign({textVerticalAnchor:"middle"},o),l=vr.presets.textWrap;return Qt(l.set,this,a,{cell:t,view:e,elem:i,refBBox:r,attrs:c}),{fill:o.color||null}}},position(n,{refBBox:t,elem:e}){if(e instanceof SVGElement)return t.getCenter()}}}});Fs("image",{attrs:{image:{refWidth:"100%",refHeight:"100%"}},propHooks:XL()},{selector:"image"});Fs("circle",{attrs:{body:{refCx:"50%",refCy:"50%",refR:"50%"}}});class sr extends nn{constructor(){super(...arguments),this.portsCache={}}get[Symbol.toStringTag](){return sr.toStringTag}getContainerClassName(){const t=[super.getContainerClassName(),this.prefixClassName("node")];return this.can("nodeMovable")||t.push(this.prefixClassName("node-immovable")),t.join(" ")}updateClassName(t){const e=t.target;if(e.hasAttribute("magnet")){const r=this.prefixClassName("port-unconnectable");this.can("magnetConnectable")?Fe(e,r):qt(e,r)}else{const r=this.prefixClassName("node-immovable");this.can("nodeMovable")?this.removeClass(r):this.addClass(r)}}isNodeView(){return!0}confirmUpdate(t,e={}){let r=t;return this.hasAction(r,"ports")&&(this.removePorts(),this.cleanPortsCache()),this.hasAction(r,"render")?(this.render(),r=this.removeAction(r,["render","update","resize","translate","rotate","ports","tools"])):(r=this.handleAction(r,"resize",()=>this.resize(),"update"),r=this.handleAction(r,"update",()=>this.update(),"ports"),r=this.handleAction(r,"translate",()=>this.translate()),r=this.handleAction(r,"rotate",()=>this.rotate()),r=this.handleAction(r,"ports",()=>this.renderPorts()),r=this.handleAction(r,"tools",()=>{this.getFlag("tools")===t?this.renderTools():this.updateTools(e)})),r}update(t){this.cleanCache(),this.removePorts();const e=this.cell,r=e.getSize(),i=e.getAttrs();this.updateAttrs(this.container,i,{attrs:t===i?null:t,rootBBox:new Bt(0,0,r.width,r.height),selectors:this.selectors}),this.renderPorts()}renderMarkup(){const t=this.cell.markup;if(t){if(typeof t=="string")throw new TypeError("Not support string markup.");return this.renderJSONMarkup(t)}throw new TypeError("Invalid node markup.")}renderJSONMarkup(t){const e=this.parseJSONMarkup(t,this.container);this.selectors=e.selectors,this.container.appendChild(e.fragment)}render(){return this.empty(),this.renderMarkup(),this.resize(),this.updateTransform(),this.renderTools(),this}resize(){this.cell.getAngle()&&this.rotate(),this.update()}translate(){this.updateTransform()}rotate(){this.updateTransform()}getTranslationString(){const t=this.cell.getPosition();return`translate(${t.x},${t.y})`}getRotationString(){const t=this.cell.getAngle();if(t){const e=this.cell.getSize();return`rotate(${t},${e.width/2},${e.height/2})`}}updateTransform(){let t=this.getTranslationString();const e=this.getRotationString();e&&(t+=` ${e}`),this.container.setAttribute("transform",t)}findPortElem(t,e){const r=t?this.portsCache[t]:null;if(!r)return null;const i=r.portContentElement,s=r.portContentSelectors||{};return this.findOne(e,i,s)}cleanPortsCache(){this.portsCache={}}removePorts(){Object.values(this.portsCache).forEach(t=>{Yn(t.portElement)})}renderPorts(){const t=this.container,e=[];t.childNodes.forEach(o=>{e.push(o)});const r=this.cell.getParsedPorts(),i=_d(r,"zIndex"),s="auto";i[s]&&i[s].forEach(o=>{const a=this.getPortElement(o);t.append(a),e.push(a)}),Object.keys(i).forEach(o=>{if(o!==s){const a=parseInt(o,10);this.appendPorts(i[o],a,e)}}),this.updatePorts()}appendPorts(t,e,r){const i=t.map(s=>this.getPortElement(s));r[e]||e<0?ch(r[Math.max(e,0)],i):zn(this.container,i)}getPortElement(t){const e=this.portsCache[t.id];return e?e.portElement:this.createPortElement(t)}createPortElement(t){let e=ke.renderMarkup(this.cell.getPortContainerMarkup());const r=e.elem;if(r==null)throw new Error("Invalid port container markup.");e=ke.renderMarkup(this.getPortMarkup(t));const i=e.elem,s=e.selectors;if(i==null)throw new Error("Invalid port markup.");this.setAttrs({port:t.id,"port-group":t.group},i);let o="x6-port";t.group&&(o+=` x6-port-${t.group}`),qt(r,o),qt(r,"x6-port"),qt(i,"x6-port-body"),r.appendChild(i);let a=s,c,l;if(this.existPortLabel(t)){if(e=ke.renderMarkup(this.getPortLabelMarkup(t.label)),c=e.elem,l=e.selectors,c==null)throw new Error("Invalid port label markup.");if(s&&l){for(const f in l)if(s[f]&&f!==this.rootSelector)throw new Error("Selectors within port must be unique.");a=Object.assign(Object.assign({},s),l)}qt(c,"x6-port-label"),r.appendChild(c)}return this.portsCache[t.id]={portElement:r,portSelectors:a,portLabelElement:c,portLabelSelectors:l,portContentElement:i,portContentSelectors:s},this.graph.options.onPortRendered&&this.graph.options.onPortRendered({port:t,node:this.cell,container:r,selectors:a,labelContainer:c,labelSelectors:l,contentContainer:i,contentSelectors:s}),r}updatePorts(){const t=this.cell.getParsedGroups(),e=Object.keys(t);e.length===0?this.updatePortGroup():e.forEach(r=>this.updatePortGroup(r))}updatePortGroup(t){const e=Bt.fromSize(this.cell.getSize()),r=this.cell.getPortsLayoutByGroup(t,e);for(let i=0,s=r.length;i<s;i+=1){const o=r[i],a=o.portId,c=this.portsCache[a]||{},l=o.portLayout;if(this.applyPortTransform(c.portElement,l),o.portAttrs!=null){const f={selectors:c.portSelectors||{}};o.portSize&&(f.rootBBox=Bt.fromSize(o.portSize)),this.updateAttrs(c.portElement,o.portAttrs,f)}const u=o.labelLayout;if(u&&c.portLabelElement&&(this.applyPortTransform(c.portLabelElement,u,-(l.angle||0)),u.attrs)){const f={selectors:c.portLabelSelectors||{}};o.labelSize&&(f.rootBBox=Bt.fromSize(o.labelSize)),this.updateAttrs(c.portLabelElement,u.attrs,f)}}}applyPortTransform(t,e,r=0){const i=e.angle,s=e.position,o=xn().rotate(r).translate(s.x||0,s.y||0).rotate(i||0);gs(t,o,{absolute:!0})}getPortMarkup(t){return t.markup||this.cell.portMarkup}getPortLabelMarkup(t){return t.markup||this.cell.portLabelMarkup}existPortLabel(t){return t.attrs&&t.attrs.text}getEventArgs(t,e,r){const i=this,s=i.cell,o=s;return e==null||r==null?{e:t,view:i,node:s,cell:o}:{e:t,x:e,y:r,view:i,node:s,cell:o}}getPortEventArgs(t,e,r){const i=this,s=i.cell,o=s;return r?{e:t,x:r.x,y:r.y,view:i,node:s,cell:o,port:e}:{e:t,view:i,node:s,cell:o,port:e}}notifyMouseDown(t,e,r){super.onMouseDown(t,e,r),this.notify("node:mousedown",this.getEventArgs(t,e,r))}notifyMouseMove(t,e,r){super.onMouseMove(t,e,r),this.notify("node:mousemove",this.getEventArgs(t,e,r))}notifyMouseUp(t,e,r){super.onMouseUp(t,e,r),this.notify("node:mouseup",this.getEventArgs(t,e,r))}notifyPortEvent(t,e,r){const i=this.findAttr("port",e.target);if(i){const s=e.type;t==="node:port:mouseenter"?e.type="mouseenter":t==="node:port:mouseleave"&&(e.type="mouseleave"),this.notify(t,this.getPortEventArgs(e,i,r)),e.type=s}}onClick(t,e,r){super.onClick(t,e,r),this.notify("node:click",this.getEventArgs(t,e,r)),this.notifyPortEvent("node:port:click",t,{x:e,y:r})}onDblClick(t,e,r){super.onDblClick(t,e,r),this.notify("node:dblclick",this.getEventArgs(t,e,r)),this.notifyPortEvent("node:port:dblclick",t,{x:e,y:r})}onContextMenu(t,e,r){super.onContextMenu(t,e,r),this.notify("node:contextmenu",this.getEventArgs(t,e,r)),this.notifyPortEvent("node:port:contextmenu",t,{x:e,y:r})}onMouseDown(t,e,r){this.isPropagationStopped(t)||(this.notifyMouseDown(t,e,r),this.notifyPortEvent("node:port:mousedown",t,{x:e,y:r}),this.startNodeDragging(t,e,r))}onMouseMove(t,e,r){const i=this.getEventData(t),s=i.action;if(s==="magnet")this.dragMagnet(t,e,r);else{if(s==="move"){const a=i.targetView||this;a.dragNode(t,e,r),a.notify("node:moving",{e:t,x:e,y:r,view:a,cell:a.cell,node:a.cell})}this.notifyMouseMove(t,e,r),this.notifyPortEvent("node:port:mousemove",t,{x:e,y:r})}this.setEventData(t,i)}onMouseUp(t,e,r){const i=this.getEventData(t),s=i.action;s==="magnet"?this.stopMagnetDragging(t,e,r):(this.notifyMouseUp(t,e,r),this.notifyPortEvent("node:port:mouseup",t,{x:e,y:r}),s==="move"&&(i.targetView||this).stopNodeDragging(t,e,r));const o=i.targetMagnet;o&&this.onMagnetClick(t,o,e,r),this.checkMouseleave(t)}onMouseOver(t){super.onMouseOver(t),this.notify("node:mouseover",this.getEventArgs(t)),this.notifyPortEvent("node:port:mouseenter",t),this.notifyPortEvent("node:port:mouseover",t)}onMouseOut(t){super.onMouseOut(t),this.notify("node:mouseout",this.getEventArgs(t)),this.notifyPortEvent("node:port:mouseleave",t),this.notifyPortEvent("node:port:mouseout",t)}onMouseEnter(t){this.updateClassName(t),super.onMouseEnter(t),this.notify("node:mouseenter",this.getEventArgs(t))}onMouseLeave(t){super.onMouseLeave(t),this.notify("node:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,r,i){super.onMouseWheel(t,e,r,i),this.notify("node:mousewheel",Object.assign({delta:i},this.getEventArgs(t,e,r)))}onMagnetClick(t,e,r,i){const s=this.graph;s.view.getMouseMovedCount(t)>s.options.clickThreshold||this.notify("node:magnet:click",Object.assign({magnet:e},this.getEventArgs(t,r,i)))}onMagnetDblClick(t,e,r,i){this.notify("node:magnet:dblclick",Object.assign({magnet:e},this.getEventArgs(t,r,i)))}onMagnetContextMenu(t,e,r,i){this.notify("node:magnet:contextmenu",Object.assign({magnet:e},this.getEventArgs(t,r,i)))}onMagnetMouseDown(t,e,r,i){this.startMagnetDragging(t,r,i)}onCustomEvent(t,e,r,i){this.notify("node:customevent",Object.assign({name:e},this.getEventArgs(t,r,i))),super.onCustomEvent(t,e,r,i)}prepareEmbedding(t){const e=this.graph,i=this.getEventData(t).cell||this.cell,s=e.findViewByCell(i),o=e.snapToGrid(t.clientX,t.clientY);this.notify("node:embed",{e:t,node:i,view:s,cell:i,x:o.x,y:o.y,currentParent:i.getParent()})}processEmbedding(t,e){const r=e.cell||this.cell,i=e.graph||this.graph,s=i.options.embedding,o=s.findParent;let a=typeof o=="function"?Qt(o,i,{view:this,node:this.cell}).filter(h=>Ae.isCell(h)&&this.cell.id!==h.id&&!h.isDescendantOf(this.cell)):i.model.getNodesUnderNode(r,{by:o});if(s.frontOnly&&a.length>0){const h=_d(a,"zIndex"),d=yA(Object.keys(h).map(p=>parseInt(p,10)));d&&(a=h[d])}a=a.filter(h=>h.visible);let c=null;const l=e.candidateEmbedView,u=s.validate;for(let h=a.length-1;h>=0;h-=1){const d=a[h];if(l&&l.cell.id===d.id){c=l;break}else{const p=d.findView(i);if(u&&Qt(u,i,{child:this.cell,parent:p.cell,childView:this,parentView:p})){c=p;break}}}this.clearEmbedding(e),c&&c.highlight(null,{type:"embedding"}),e.candidateEmbedView=c;const f=i.snapToGrid(t.clientX,t.clientY);this.notify("node:embedding",{e:t,cell:r,node:r,view:i.findViewByCell(r),x:f.x,y:f.y,currentParent:r.getParent(),candidateParent:c?c.cell:null})}clearEmbedding(t){const e=t.candidateEmbedView;e&&(e.unhighlight(null,{type:"embedding"}),t.candidateEmbedView=null)}finalizeEmbedding(t,e){this.graph.startBatch("embedding");const r=e.cell||this.cell,i=e.graph||this.graph,s=i.findViewByCell(r),o=r.getParent(),a=e.candidateEmbedView;if(a?(a.unhighlight(null,{type:"embedding"}),e.candidateEmbedView=null,(o==null||o.id!==a.cell.id)&&a.cell.insertChild(r,void 0,{ui:!0})):o&&o.unembed(r,{ui:!0}),i.model.getConnectedEdges(r,{deep:!0}).forEach(c=>{c.updateParent({ui:!0})}),s&&a){const c=i.snapToGrid(t.clientX,t.clientY);s.notify("node:embedded",{e:t,cell:r,x:c.x,y:c.y,node:r,view:i.findViewByCell(r),previousParent:o,currentParent:r.getParent()})}this.graph.stopBatch("embedding")}getDelegatedView(){let t=this.cell,e=this;for(;e&&!t.isEdge();){if(!t.hasParent()||e.can("stopDelegateOnDragging"))return e;t=t.getParent(),e=this.graph.findViewByCell(t)}return null}validateMagnet(t,e,r){if(e.getAttribute("magnet")!=="passive"){const i=this.graph.options.connecting.validateMagnet;return i?Qt(i,this.graph,{e:r,magnet:e,view:t,cell:t.cell}):!0}return!1}startMagnetDragging(t,e,r){if(!this.can("magnetConnectable"))return;t.stopPropagation();const i=t.currentTarget,s=this.graph;this.setEventData(t,{targetMagnet:i}),this.validateMagnet(this,i,t)?(s.options.magnetThreshold<=0&&this.startConnectting(t,i,e,r),this.setEventData(t,{action:"magnet"}),this.stopPropagation(t)):this.onMouseDown(t,e,r),s.view.delegateDragEvents(t,this)}startConnectting(t,e,r,i){this.graph.model.startBatch("add-edge");const s=this.createEdgeFromMagnet(e,r,i);s.setEventData(t,s.prepareArrowheadDragging("target",{x:r,y:i,isNewEdge:!0,fallbackAction:"remove"})),this.setEventData(t,{edgeView:s}),s.notifyMouseDown(t,r,i)}getDefaultEdge(t,e){let r;const i=this.graph.options.connecting.createEdge;return i&&(r=Qt(i,this.graph,{sourceMagnet:e,sourceView:t,sourceCell:t.cell})),r}createEdgeFromMagnet(t,e,r){const i=this.graph,s=i.model,o=this.getDefaultEdge(this,t);return o.setSource(Object.assign(Object.assign({},o.getSource()),this.getEdgeTerminal(t,e,r,o,"source"))),o.setTarget(Object.assign(Object.assign({},o.getTarget()),{x:e,y:r})),o.addTo(s,{async:!1,ui:!0}),o.findView(i)}dragMagnet(t,e,r){const i=this.getEventData(t),s=i.edgeView;if(s)s.onMouseMove(t,e,r),this.autoScrollGraph(t.clientX,t.clientY);else{const o=this.graph,a=o.options.magnetThreshold,c=this.getEventTarget(t),l=i.targetMagnet;if(a==="onleave"){if(l===c||l.contains(c))return}else if(o.view.getMouseMovedCount(t)<=a)return;this.startConnectting(t,l,e,r)}}stopMagnetDragging(t,e,r){const s=this.eventData(t).edgeView;s&&(s.onMouseUp(t,e,r),this.graph.model.stopBatch("add-edge"))}notifyUnhandledMouseDown(t,e,r){this.notify("node:unhandled:mousedown",{e:t,x:e,y:r,view:this,cell:this.cell,node:this.cell})}notifyNodeMove(t,e,r,i,s){let o=[s];const a=this.graph.getPlugin("selection");if(a&&a.isSelectionMovable()){const c=a.getSelectedCells();c.includes(s)&&(o=c.filter(l=>l.isNode()))}o.forEach(c=>{this.notify(t,{e,x:r,y:i,cell:c,node:c,view:c.findView(this.graph)})})}getRestrictArea(t){const e=this.graph.options.translating.restrict,r=typeof e=="function"?Qt(e,this.graph,t):e;return typeof r=="number"?this.graph.transform.getGraphArea().inflate(r):r===!0?this.graph.transform.getGraphArea():r||null}startNodeDragging(t,e,r){const i=this.getDelegatedView();if(i==null||!i.can("nodeMovable"))return this.notifyUnhandledMouseDown(t,e,r);this.setEventData(t,{targetView:i,action:"move"});const s=R.create(i.cell.getPosition());i.setEventData(t,{moving:!1,offset:s.diff(e,r),restrict:this.getRestrictArea(i)})}dragNode(t,e,r){const i=this.cell,s=this.graph,o=s.getGridSize(),a=this.getEventData(t),c=a.offset,l=a.restrict;a.moving||(a.moving=!0,this.addClass("node-moving"),this.notifyNodeMove("node:move",t,e,r,this.cell)),this.autoScrollGraph(t.clientX,t.clientY);const u=_e.snapToGrid(e+c.x,o),f=_e.snapToGrid(r+c.y,o);i.setPosition(u,f,{restrict:l,deep:!0,ui:!0}),s.options.embedding.enabled&&(a.embedding||(this.prepareEmbedding(t),a.embedding=!0),this.processEmbedding(t,a))}stopNodeDragging(t,e,r){const i=this.getEventData(t);i.embedding&&this.finalizeEmbedding(t,i),i.moving&&(this.removeClass("node-moving"),this.notifyNodeMove("node:moved",t,e,r,this.cell)),i.moving=!1,i.embedding=!1}autoScrollGraph(t,e){const r=this.graph.getPlugin("scroller");r&&r.autoScroll(t,e)}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNodeView=="function"&&typeof i.isEdgeView=="function"&&typeof i.confirmUpdate=="function"&&typeof i.update=="function"&&typeof i.findPortElem=="function"&&typeof i.resize=="function"&&typeof i.rotate=="function"&&typeof i.translate=="function"}n.isNodeView=t})(sr||(sr={}));sr.config({isSvgElement:!0,priority:0,bootstrap:["render"],actions:{view:["render"],markup:["render"],attrs:["update"],size:["resize","ports","tools"],angle:["rotate","tools"],position:["translate","tools"],ports:["ports"],tools:["tools"]}});sr.registry.register("node",sr,!0);var KL=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class Pr extends nn{constructor(){super(...arguments),this.POINT_ROUNDING=2,this.labelDestroyFn={}}get[Symbol.toStringTag](){return Pr.toStringTag}getContainerClassName(){return[super.getContainerClassName(),this.prefixClassName("edge")].join(" ")}get sourceBBox(){const t=this.sourceView;if(!t){const r=this.cell.getSource();return new Bt(r.x,r.y)}const e=this.sourceMagnet;return t.isEdgeElement(e)?new Bt(this.sourceAnchor.x,this.sourceAnchor.y):t.getBBoxOfElement(e||t.container)}get targetBBox(){const t=this.targetView;if(!t){const r=this.cell.getTarget();return new Bt(r.x,r.y)}const e=this.targetMagnet;return t.isEdgeElement(e)?new Bt(this.targetAnchor.x,this.targetAnchor.y):t.getBBoxOfElement(e||t.container)}isEdgeView(){return!0}confirmUpdate(t,e={}){let r=t;if(this.hasAction(r,"source")){if(!this.updateTerminalProperties("source"))return r;r=this.removeAction(r,"source")}if(this.hasAction(r,"target")){if(!this.updateTerminalProperties("target"))return r;r=this.removeAction(r,"target")}return this.hasAction(r,"render")?(this.render(),r=this.removeAction(r,["render","update","labels","tools"]),r):(r=this.handleAction(r,"update",()=>this.update(e)),r=this.handleAction(r,"labels",()=>this.onLabelsChange(e)),r=this.handleAction(r,"tools",()=>this.renderTools()),r)}render(){return this.empty(),this.renderMarkup(),this.labelContainer=null,this.renderLabels(),this.update(),this.renderTools(),this}renderMarkup(){const t=this.cell.markup;if(t){if(typeof t=="string")throw new TypeError("Not support string markup.");return this.renderJSONMarkup(t)}throw new TypeError("Invalid edge markup.")}renderJSONMarkup(t){const e=this.parseJSONMarkup(t,this.container);this.selectors=e.selectors,this.container.append(e.fragment)}customizeLabels(){if(this.labelContainer){const t=this.cell,e=t.labels;for(let r=0,i=e.length;r<i;r+=1){const s=e[r],o=this.labelCache[r],a=this.labelSelectors[r],c=this.graph.options.onEdgeLabelRendered;if(c){const l=c({edge:t,label:s,container:o,selectors:a});l&&(this.labelDestroyFn[r]=l)}}}}destroyCustomizeLabels(){const t=this.cell.labels;if(this.labelCache&&this.labelSelectors&&this.labelDestroyFn)for(let e=0,r=t.length;e<r;e+=1){const i=this.labelDestroyFn[e],s=this.labelCache[e],o=this.labelSelectors[e];i&&s&&o&&i({edge:this.cell,label:t[e],container:s,selectors:o})}this.labelDestroyFn={}}renderLabels(){const t=this.cell,e=t.getLabels(),r=e.length;let i=this.labelContainer;if(this.labelCache={},this.labelSelectors={},r<=0)return i&&i.parentNode&&i.parentNode.removeChild(i),this;i?this.empty(i):(i=ar("g"),this.addClass(this.prefixClassName("edge-labels"),i),this.labelContainer=i);for(let s=0,o=e.length;s<o;s+=1){const a=e[s],c=this.normalizeLabelMarkup(this.parseLabelMarkup(a.markup));let l,u;if(c)l=c.node,u=c.selectors;else{const h=t.getDefaultLabel(),d=this.normalizeLabelMarkup(this.parseLabelMarkup(h.markup));l=d.node,u=d.selectors}l.setAttribute("data-index",`${s}`),i.appendChild(l);const f=this.rootSelector;if(u[f])throw new Error("Ambiguous label root selector.");u[f]=l,this.labelCache[s]=l,this.labelSelectors[s]=u}return i.parentNode==null&&this.container.appendChild(i),this.updateLabels(),this.customizeLabels(),this}onLabelsChange(t={}){this.destroyCustomizeLabels(),this.shouldRerenderLabels(t)?this.renderLabels():this.updateLabels(),this.updateLabelPositions()}shouldRerenderLabels(t={}){const e=this.cell.previous("labels");if(e==null)return!0;if("propertyPathArray"in t&&"propertyValue"in t){const r=t.propertyPathArray||[],i=r.length;if(i>1){const s=r[1];if(e[s]){if(i===2)return typeof t.propertyValue=="object"&&Ta(t.propertyValue,"markup");if(r[2]!=="markup")return!1}}}return!0}parseLabelMarkup(t){return t?typeof t=="string"?this.parseLabelStringMarkup(t):this.parseJSONMarkup(t):null}parseLabelStringMarkup(t){const e=ae.createVectors(t),r=document.createDocumentFragment();for(let i=0,s=e.length;i<s;i+=1){const o=e[i].node;r.appendChild(o)}return{fragment:r,selectors:{}}}normalizeLabelMarkup(t){if(t==null)return;const e=t.fragment;if(!(e instanceof DocumentFragment)||!e.hasChildNodes())throw new Error("Invalid label markup.");let r;const i=e.childNodes;return i.length>1||i[0].nodeName.toUpperCase()!=="G"?r=ae.create("g").append(e):r=ae.create(i[0]),r.addClass(this.prefixClassName("edge-label")),{node:r.node,selectors:t.selectors}}updateLabels(){if(this.labelContainer){const t=this.cell,e=t.labels,r=this.can("edgeLabelMovable"),i=t.getDefaultLabel();for(let s=0,o=e.length;s<o;s+=1){const a=this.labelCache[s],c=this.labelSelectors[s];a.setAttribute("cursor",r?"move":"default");const l=e[s],u=an({},i.attrs,l.attrs);this.updateAttrs(a,u,{selectors:c,rootBBox:l.size?Bt.fromSize(l.size):void 0})}}}renderTools(){const t=this.cell.getTools();return this.addTools(t),this}update(t={}){this.cleanCache(),this.updateConnection(t);const e=this.cell.getAttrs(),r=KL(e,["text"]);return r!=null&&this.updateAttrs(this.container,r,{selectors:this.selectors}),this.updateLabelPositions(),this.updateTools(t),this}removeRedundantLinearVertices(t={}){const e=this.cell,r=e.getVertices(),i=[this.sourceAnchor,...r,this.targetAnchor],s=i.length,o=new en(i);o.simplify({threshold:.01});const a=o.points.map(l=>l.toJSON()),c=a.length;return s===c?0:(e.setVertices(a.slice(1,c-1),t),s-c)}getTerminalView(t){switch(t){case"source":return this.sourceView||null;case"target":return this.targetView||null;default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalAnchor(t){switch(t){case"source":return R.create(this.sourceAnchor);case"target":return R.create(this.targetAnchor);default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalConnectionPoint(t){switch(t){case"source":return R.create(this.sourcePoint);case"target":return R.create(this.targetPoint);default:throw new Error(`Unknown terminal type '${t}'`)}}getTerminalMagnet(t,e={}){switch(t){case"source":{if(e.raw)return this.sourceMagnet;const r=this.sourceView;return r?this.sourceMagnet||r.container:null}case"target":{if(e.raw)return this.targetMagnet;const r=this.targetView;return r?this.targetMagnet||r.container:null}default:throw new Error(`Unknown terminal type '${t}'`)}}updateConnection(t={}){const e=this.cell;if(t.translateBy&&e.isFragmentDescendantOf(t.translateBy)){const r=t.tx||0,i=t.ty||0;this.routePoints=new en(this.routePoints).translate(r,i).points,this.translateConnectionPoints(r,i),this.path.translate(r,i)}else{const r=e.getVertices(),i=this.findAnchors(r);this.sourceAnchor=i.source,this.targetAnchor=i.target,this.routePoints=this.findRoutePoints(r);const s=this.findConnectionPoints(this.routePoints,this.sourceAnchor,this.targetAnchor);this.sourcePoint=s.source,this.targetPoint=s.target;const o=this.findMarkerPoints(this.routePoints,this.sourcePoint,this.targetPoint);this.path=this.findPath(this.routePoints,o.source||this.sourcePoint,o.target||this.targetPoint)}this.cleanCache()}findAnchors(t){const e=this.cell,r=e.source,i=e.target,s=t[0],o=t[t.length-1];return i.priority&&!r.priority?this.findAnchorsOrdered("target",o,"source",s):this.findAnchorsOrdered("source",s,"target",o)}findAnchorsOrdered(t,e,r,i){let s,o;const a=this.cell,c=a[t],l=a[r],u=this.getTerminalView(t),f=this.getTerminalView(r),h=this.getTerminalMagnet(t),d=this.getTerminalMagnet(r);if(u){let p;e?p=R.create(e):f?p=d:p=R.create(l),s=this.getAnchor(c.anchor,u,h,p,t)}else s=R.create(c);if(f){const p=R.create(i||s);o=this.getAnchor(l.anchor,f,d,p,r)}else o=R.isPointLike(l)?R.create(l):new R;return{[t]:s,[r]:o}}getAnchor(t,e,r,i,s){const o=e.isEdgeElement(r),a=this.graph.options.connecting;let c=typeof t=="string"?{name:t}:t;if(!c){const f=o?(s==="source"?a.sourceEdgeAnchor:a.targetEdgeAnchor)||a.edgeAnchor:(s==="source"?a.sourceAnchor:a.targetAnchor)||a.anchor;c=typeof f=="string"?{name:f}:f}if(!c)throw new Error("Anchor should be specified.");let l;const u=c.name;if(o){const f=Ss.registry.get(u);if(typeof f!="function")return Ss.registry.onNotFound(u);l=Qt(f,this,e,r,i,c.args||{},s)}else{const f=As.registry.get(u);if(typeof f!="function")return As.registry.onNotFound(u);l=Qt(f,this,e,r,i,c.args||{},s)}return l?l.round(this.POINT_ROUNDING):new R}findRoutePoints(t=[]){const e=this.graph.options.connecting.router||$r.presets.normal,r=this.cell.getRouter()||e;let i;if(typeof r=="function")i=Qt(r,this,t,{},this);else{const s=typeof r=="string"?r:r.name,o=typeof r=="string"?{}:r.args||{},a=s?$r.registry.get(s):$r.presets.normal;if(typeof a!="function")return $r.registry.onNotFound(s);i=Qt(a,this,t,o,this)}return i==null?t.map(s=>R.create(s)):i.map(s=>R.create(s))}findConnectionPoints(t,e,r){const i=this.cell,s=this.graph.options.connecting,o=i.getSource(),a=i.getTarget(),c=this.sourceView,l=this.targetView,u=t[0],f=t[t.length-1];let h;if(c&&!c.isEdgeElement(this.sourceMagnet)){const p=this.sourceMagnet||c.container,m=u||r,b=new Ht(m,e),v=o.connectionPoint||s.sourceConnectionPoint||s.connectionPoint;h=this.getConnectionPoint(v,c,p,b,"source")}else h=e;let d;if(l&&!l.isEdgeElement(this.targetMagnet)){const p=this.targetMagnet||l.container,m=a.connectionPoint||s.targetConnectionPoint||s.connectionPoint,b=f||e,v=new Ht(b,r);d=this.getConnectionPoint(m,l,p,v,"target")}else d=r;return{source:h,target:d}}getConnectionPoint(t,e,r,i,s){const o=i.end;if(t==null)return o;const a=typeof t=="string"?t:t.name,c=typeof t=="string"?{}:t.args,l=Ts.registry.get(a);if(typeof l!="function")return Ts.registry.onNotFound(a);const u=Qt(l,this,i,e,r,c||{},s);return u?u.round(this.POINT_ROUNDING):o}findMarkerPoints(t,e,r){const i=f=>{const h=this.cell.getAttrs(),d=Object.keys(h);for(let p=0,m=d.length;p<m;p+=1){const b=h[d[p]];if(b[`${f}Marker`]||b[`${f}-marker`]){const v=b.strokeWidth||b["stroke-width"];if(v)return parseFloat(v);break}}return null},s=t[0],o=t[t.length-1];let a,c;const l=i("source");l&&(a=e.clone().move(s||r,-l));const u=i("target");return u&&(c=r.clone().move(o||e,-u)),this.sourceMarkerPoint=a||e.clone(),this.targetMarkerPoint=c||r.clone(),{source:a,target:c}}findPath(t,e,r){const i=this.cell.getConnector()||this.graph.options.connecting.connector;let s,o,a;if(typeof i=="string"?s=i:(s=i.name,o=i.args),s){const l=Ci.registry.get(s);if(typeof l!="function")return Ci.registry.onNotFound(s);a=l}else a=Ci.presets.normal;const c=Qt(a,this,e,r,t,Object.assign(Object.assign({},o),{raw:!0}),this);return typeof c=="string"?ne.parse(c):c}translateConnectionPoints(t,e){this.sourcePoint.translate(t,e),this.targetPoint.translate(t,e),this.sourceAnchor.translate(t,e),this.targetAnchor.translate(t,e),this.sourceMarkerPoint.translate(t,e),this.targetMarkerPoint.translate(t,e)}updateLabelPositions(){if(this.labelContainer==null)return this;if(!this.path)return this;const e=this.cell,r=e.getLabels();if(r.length===0)return this;const i=e.getDefaultLabel(),s=this.normalizeLabelPosition(i.position);for(let o=0,a=r.length;o<a;o+=1){const c=r[o],l=this.labelCache[o];if(!l)continue;const u=this.normalizeLabelPosition(c.position),f=an({},s,u),h=this.getLabelTransformationMatrix(f);l.setAttribute("transform",Ds(h))}return this}updateTerminalProperties(t){const e=this.cell,r=this.graph,i=e[t],s=i&&i.cell,o=`${t}View`;if(!s)return this[o]=null,this.updateTerminalMagnet(t),!0;const a=r.getCellById(s);if(!a)throw new Error(`Edge's ${t} node with id "${s}" not exists`);const c=a.findView(r);return c?(this[o]=c,this.updateTerminalMagnet(t),!0):!1}updateTerminalMagnet(t){const e=`${t}Magnet`,r=this.getTerminalView(t);if(r){let i=r.getMagnetFromEdgeTerminal(this.cell[t]);i===r.container&&(i=null),this[e]=i}else this[e]=null}getLabelPositionAngle(t){const e=this.cell.getLabelAt(t);return e&&e.position&&typeof e.position=="object"&&e.position.angle||0}getLabelPositionArgs(t){const e=this.cell.getLabelAt(t);if(e&&e.position&&typeof e.position=="object")return e.position.options}getDefaultLabelPositionArgs(){const t=this.cell.getDefaultLabel();if(t&&t.position&&typeof t.position=="object")return t.position.options}mergeLabelPositionArgs(t,e){return t===null?null:t===void 0?e===null?null:e:an({},e,t)}getConnection(){return this.path!=null?this.path.clone():null}getConnectionPathData(){if(this.path==null)return"";const t=this.cache.pathCache;return Ta(t,"data")||(t.data=this.path.serialize()),t.data||""}getConnectionSubdivisions(){if(this.path==null)return null;const t=this.cache.pathCache;return Ta(t,"segmentSubdivisions")||(t.segmentSubdivisions=this.path.getSegmentSubdivisions()),t.segmentSubdivisions}getConnectionLength(){if(this.path==null)return 0;const t=this.cache.pathCache;return Ta(t,"length")||(t.length=this.path.length({segmentSubdivisions:this.getConnectionSubdivisions()})),t.length}getPointAtLength(t){return this.path==null?null:this.path.pointAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getPointAtRatio(t){return this.path==null?null:(Mr(t)&&(t=parseFloat(t)/100),this.path.pointAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()}))}getTangentAtLength(t){return this.path==null?null:this.path.tangentAtLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getTangentAtRatio(t){return this.path==null?null:this.path.tangentAt(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPoint(t){return this.path==null?null:this.path.closestPoint(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointLength(t){return this.path==null?null:this.path.closestPointLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getClosestPointRatio(t){return this.path==null?null:this.path.closestPointNormalizedLength(t,{segmentSubdivisions:this.getConnectionSubdivisions()})}getLabelPosition(t,e,r,i){const s={distance:0};let o=0,a;typeof r=="number"?(o=r,a=i):a=r,a!=null&&(s.options=a);const c=a&&a.absoluteOffset,l=!(a&&a.absoluteDistance),u=a&&a.absoluteDistance&&a.reverseDistance,f=this.path,h={segmentSubdivisions:this.getConnectionSubdivisions()},d=new R(t,e),p=f.closestPointT(d,h),m=this.getConnectionLength()||0;let b=f.lengthAtT(p,h);l&&(b=m>0?b/m:0),u&&(b=-1*(m-b)||1),s.distance=b;let v;c||(v=f.tangentAtT(p));let E;if(v)E=v.pointOffset(d);else{const y=f.pointAtT(p),O=d.diff(y);E={x:O.x,y:O.y}}return s.offset=E,s.angle=o,s}normalizeLabelPosition(t){return typeof t=="number"?{distance:t}:t}getLabelTransformationMatrix(t){const e=this.normalizeLabelPosition(t),r=e.options||{},i=e.angle||0,s=e.distance,o=s>0&&s<=1;let a=0;const c={x:0,y:0},l=e.offset;l&&(typeof l=="number"?a=l:(l.x!=null&&(c.x=l.x),l.y!=null&&(c.y=l.y)));const u=c.x!==0||c.y!==0||a===0,f=r.keepGradient,h=r.ensureLegibility,d=this.path,p={segmentSubdivisions:this.getConnectionSubdivisions()},m=o?s*this.getConnectionLength():s,b=d.tangentAtLength(m,p);let v,E=i;if(b){if(u)v=b.start,v.translate(c);else{const y=b.clone();y.rotate(-90,b.start),y.setLength(a),v=y.end}f&&(E=b.angle()+i,h&&(E=Te.normalize((E+90)%180-90)))}else v=d.start,u&&v.translate(c);return xn().translate(v.x,v.y).rotate(E)}getVertexIndex(t,e){const i=this.cell.getVertices(),s=this.getClosestPointLength(new R(t,e));let o=0;if(s!=null)for(const a=i.length;o<a;o+=1){const c=i[o],l=this.getClosestPointLength(c);if(l!=null&&s<l)break}return o}getEventArgs(t,e,r){const i=this,s=i.cell,o=s;return e==null||r==null?{e:t,view:i,edge:s,cell:o}:{e:t,x:e,y:r,view:i,edge:s,cell:o}}notifyUnhandledMouseDown(t,e,r){this.notify("edge:unhandled:mousedown",{e:t,x:e,y:r,view:this,cell:this.cell,edge:this.cell})}notifyMouseDown(t,e,r){super.onMouseDown(t,e,r),this.notify("edge:mousedown",this.getEventArgs(t,e,r))}notifyMouseMove(t,e,r){super.onMouseMove(t,e,r),this.notify("edge:mousemove",this.getEventArgs(t,e,r))}notifyMouseUp(t,e,r){super.onMouseUp(t,e,r),this.notify("edge:mouseup",this.getEventArgs(t,e,r))}onClick(t,e,r){super.onClick(t,e,r),this.notify("edge:click",this.getEventArgs(t,e,r))}onDblClick(t,e,r){super.onDblClick(t,e,r),this.notify("edge:dblclick",this.getEventArgs(t,e,r))}onContextMenu(t,e,r){super.onContextMenu(t,e,r),this.notify("edge:contextmenu",this.getEventArgs(t,e,r))}onMouseDown(t,e,r){this.notifyMouseDown(t,e,r),this.startEdgeDragging(t,e,r)}onMouseMove(t,e,r){const i=this.getEventData(t);switch(i.action){case"drag-label":{this.dragLabel(t,e,r);break}case"drag-arrowhead":{this.dragArrowhead(t,e,r);break}case"drag-edge":{this.dragEdge(t,e,r);break}}return this.notifyMouseMove(t,e,r),i}onMouseUp(t,e,r){const i=this.getEventData(t);switch(i.action){case"drag-label":{this.stopLabelDragging(t,e,r);break}case"drag-arrowhead":{this.stopArrowheadDragging(t,e,r);break}case"drag-edge":{this.stopEdgeDragging(t,e,r);break}}return this.notifyMouseUp(t,e,r),this.checkMouseleave(t),i}onMouseOver(t){super.onMouseOver(t),this.notify("edge:mouseover",this.getEventArgs(t))}onMouseOut(t){super.onMouseOut(t),this.notify("edge:mouseout",this.getEventArgs(t))}onMouseEnter(t){super.onMouseEnter(t),this.notify("edge:mouseenter",this.getEventArgs(t))}onMouseLeave(t){super.onMouseLeave(t),this.notify("edge:mouseleave",this.getEventArgs(t))}onMouseWheel(t,e,r,i){super.onMouseWheel(t,e,r,i),this.notify("edge:mousewheel",Object.assign({delta:i},this.getEventArgs(t,e,r)))}onCustomEvent(t,e,r,i){if(Ob(t.target,"edge-tool",this.container)){if(t.stopPropagation(),this.can("useEdgeTools")){if(e==="edge:remove"){this.cell.remove({ui:!0});return}this.notify("edge:customevent",Object.assign({name:e},this.getEventArgs(t,r,i)))}this.notifyMouseDown(t,r,i)}else this.notify("edge:customevent",Object.assign({name:e},this.getEventArgs(t,r,i))),super.onCustomEvent(t,e,r,i)}onLabelMouseDown(t,e,r){this.notifyMouseDown(t,e,r),this.startLabelDragging(t,e,r),this.getEventData(t).stopPropagation&&t.stopPropagation()}startEdgeDragging(t,e,r){if(!this.can("edgeMovable")){this.notifyUnhandledMouseDown(t,e,r);return}this.setEventData(t,{x:e,y:r,moving:!1,action:"drag-edge"})}dragEdge(t,e,r){const i=this.getEventData(t);i.moving||(i.moving=!0,this.addClass("edge-moving"),this.notify("edge:move",{e:t,x:e,y:r,view:this,cell:this.cell,edge:this.cell})),this.cell.translate(e-i.x,r-i.y,{ui:!0}),this.setEventData(t,{x:e,y:r}),this.notify("edge:moving",{e:t,x:e,y:r,view:this,cell:this.cell,edge:this.cell})}stopEdgeDragging(t,e,r){const i=this.getEventData(t);i.moving&&(this.removeClass("edge-moving"),this.notify("edge:moved",{e:t,x:e,y:r,view:this,cell:this.cell,edge:this.cell})),i.moving=!1}prepareArrowheadDragging(t,e){const r=this.getTerminalMagnet(t),i={action:"drag-arrowhead",x:e.x,y:e.y,isNewEdge:e.isNewEdge===!0,terminalType:t,initialMagnet:r,initialTerminal:eu(this.cell[t]),fallbackAction:e.fallbackAction||"revert",getValidateConnectionArgs:this.createValidateConnectionArgs(t),options:e.options};return this.beforeArrowheadDragging(i),i}createValidateConnectionArgs(t){const e=[];e[4]=t,e[5]=this;let r,i=0,s=0;t==="source"?(i=2,r="target"):(s=2,r="source");const o=this.cell[r],a=o.cell;if(a){let c;const l=e[i]=this.graph.findViewByCell(a);l&&(c=l.getMagnetFromEdgeTerminal(o),c===l.container&&(c=void 0)),e[i+1]=c}return(c,l)=>(e[s]=c,e[s+1]=c.container===l?void 0:l,e)}beforeArrowheadDragging(t){t.zIndex=this.cell.zIndex,this.cell.toFront();const e=this.container.style;t.pointerEvents=e.pointerEvents,e.pointerEvents="none",this.graph.options.connecting.highlight&&this.highlightAvailableMagnets(t)}afterArrowheadDragging(t){t.zIndex!=null&&(this.cell.setZIndex(t.zIndex,{ui:!0}),t.zIndex=null);const e=this.container;e.style.pointerEvents=t.pointerEvents||"",this.graph.options.connecting.highlight&&this.unhighlightAvailableMagnets(t)}validateConnection(t,e,r,i,s,o,a){const c=this.graph.options.connecting,l=c.allowLoop,u=c.allowNode,f=c.allowEdge,h=c.allowPort,d=c.allowMulti,p=c.validateConnection,m=o?o.cell:null,b=s==="target"?r:t,v=s==="target"?i:e;let E=!0;const y=O=>{const I=s==="source"?a?a.port:null:m?m.getSourcePortId():null,G=s==="target"?a?a.port:null:m?m.getTargetPortId():null;return Qt(O,this.graph,{edge:m,edgeView:o,sourceView:t,targetView:r,sourcePort:I,targetPort:G,sourceMagnet:e,targetMagnet:i,sourceCell:t?t.cell:null,targetCell:r?r.cell:null,type:s})};if(l!=null&&(typeof l=="boolean"?!l&&t===r&&(E=!1):E=y(l)),E&&h!=null&&(typeof h=="boolean"?!h&&v&&(E=!1):E=y(h)),E&&f!=null&&(typeof f=="boolean"?!f&&Pr.isEdgeView(b)&&(E=!1):E=y(f)),E&&u!=null&&v==null&&(typeof u=="boolean"?!u&&sr.isNodeView(b)&&(E=!1):E=y(u)),E&&d!=null&&o){const O=o.cell,I=s==="source"?a:O.getSource(),G=s==="target"?a:O.getTarget(),k=a?this.graph.getCellById(a.cell):null;if(I&&G&&I.cell&&G.cell&&k)if(typeof d=="function")E=y(d);else{const X=this.graph.model.getConnectedEdges(k,{outgoing:s==="source",incoming:s==="target"});X.length&&(d==="withPort"?X.some(at=>{const ft=at.getSource(),H=at.getTarget();return ft&&H&&ft.cell===I.cell&&H.cell===G.cell&&ft.port!=null&&ft.port===I.port&&H.port!=null&&H.port===G.port})&&(E=!1):d||X.some(at=>{const ft=at.getSource(),H=at.getTarget();return ft&&H&&ft.cell===I.cell&&H.cell===G.cell})&&(E=!1))}}return E&&p!=null&&(E=y(p)),E}allowConnectToBlank(t){const e=this.graph,i=e.options.connecting.allowBlank;if(typeof i!="function")return!!i;const s=e.findViewByCell(t),o=t.getSourceCell(),a=t.getTargetCell(),c=e.findViewByCell(o),l=e.findViewByCell(a);return Qt(i,e,{edge:t,edgeView:s,sourceCell:o,targetCell:a,sourceView:c,targetView:l,sourcePort:t.getSourcePortId(),targetPort:t.getTargetPortId(),sourceMagnet:s.sourceMagnet,targetMagnet:s.targetMagnet})}validateEdge(t,e,r){const i=this.graph;if(!this.allowConnectToBlank(t)){const o=t.getSourceCellId(),a=t.getTargetCellId();if(!(o&&a))return!1}const s=i.options.connecting.validateEdge;return s?Qt(s,i,{edge:t,type:e,previous:r}):!0}arrowheadDragging(t,e,r,i){i.x=e,i.y=r,i.currentTarget!==t&&(i.currentMagnet&&i.currentView&&i.currentView.unhighlight(i.currentMagnet,{type:"magnetAdsorbed"}),i.currentView=this.graph.findViewByElem(t),i.currentView?(i.currentMagnet=i.currentView.findMagnet(t),i.currentMagnet&&this.validateConnection(...i.getValidateConnectionArgs(i.currentView,i.currentMagnet),i.currentView.getEdgeTerminal(i.currentMagnet,e,r,this.cell,i.terminalType))?i.currentView.highlight(i.currentMagnet,{type:"magnetAdsorbed"}):i.currentMagnet=null):i.currentMagnet=null),i.currentTarget=t,this.cell.prop(i.terminalType,{x:e,y:r},Object.assign(Object.assign({},i.options),{ui:!0}))}arrowheadDragged(t,e,r){const i=t.currentView,s=t.currentMagnet;if(!s||!i)return;i.unhighlight(s,{type:"magnetAdsorbed"});const o=t.terminalType,a=i.getEdgeTerminal(s,e,r,this.cell,o);this.cell.setTerminal(o,a,{ui:!0})}snapArrowhead(t,e,r){const i=this.graph,{snap:s,allowEdge:o}=i.options.connecting,a=typeof s=="object"&&s.radius||50,c=typeof s=="object"&&s.anchor||"center",l=i.renderer.findViewsInArea({x:t-a,y:e-a,width:2*a,height:2*a},{nodeOnly:!0});if(o){const O=i.renderer.findEdgeViewsFromPoint({x:t,y:e},a).filter(I=>I!==this);l.push(...O)}const u=r.closestView||null,f=r.closestMagnet||null;r.closestView=null,r.closestMagnet=null;let h,d=Number.MAX_SAFE_INTEGER;const p=new R(t,e);l.forEach(O=>{if(O.container.getAttribute("magnet")!=="false"){if(O.isNodeView())h=c==="center"?O.cell.getBBox().getCenter().distance(p):O.cell.getBBox().getNearestPointToPoint(p).distance(p);else if(O.isEdgeView()){const I=O.getClosestPoint(p);I?h=I.distance(p):h=Number.MAX_SAFE_INTEGER}h<a&&h<d&&(f===O.container||this.validateConnection(...r.getValidateConnectionArgs(O,null),O.getEdgeTerminal(O.container,t,e,this.cell,r.terminalType)))&&(d=h,r.closestView=O,r.closestMagnet=O.container)}O.container.querySelectorAll("[magnet]").forEach(I=>{if(I.getAttribute("magnet")!=="false"){const G=O.getBBoxOfElement(I);h=p.distance(G.getCenter()),h<a&&h<d&&(f===I||this.validateConnection(...r.getValidateConnectionArgs(O,I),O.getEdgeTerminal(I,t,e,this.cell,r.terminalType)))&&(d=h,r.closestView=O,r.closestMagnet=I)}})});let m;const b=r.terminalType,v=r.closestView,E=r.closestMagnet,y=f!==E;if(u&&y&&u.unhighlight(f,{type:"magnetAdsorbed"}),v){if(!y)return;v.highlight(E,{type:"magnetAdsorbed"}),m=v.getEdgeTerminal(E,t,e,this.cell,b)}else m={x:t,y:e};this.cell.setTerminal(b,m,{},Object.assign(Object.assign({},r.options),{ui:!0}))}snapArrowheadEnd(t){const e=t.closestView,r=t.closestMagnet;e&&r&&(e.unhighlight(r,{type:"magnetAdsorbed"}),t.currentMagnet=e.findMagnet(r)),t.closestView=null,t.closestMagnet=null}finishEmbedding(t){this.graph.options.embedding.enabled&&this.cell.updateParent()&&(t.zIndex=null)}fallbackConnection(t){switch(t.fallbackAction){case"remove":this.cell.remove({ui:!0});break;case"revert":default:this.cell.prop(t.terminalType,t.initialTerminal,{ui:!0});break}}notifyConnectionEvent(t,e){const r=t.terminalType,i=t.initialTerminal,s=this.cell[r];if(s&&!Ke.equalTerminals(i,s)){const a=this.graph,c=i,l=c.cell?a.getCellById(c.cell):null,u=c.port,f=l?a.findViewByCell(l):null,h=l||t.isNewEdge?null:R.create(i).toJSON(),d=s,p=d.cell?a.getCellById(d.cell):null,m=d.port,b=p?a.findViewByCell(p):null,v=p?null:R.create(s).toJSON();this.notify("edge:connected",{e,previousCell:l,previousPort:u,previousView:f,previousPoint:h,currentCell:p,currentView:b,currentPort:m,currentPoint:v,previousMagnet:t.initialMagnet,currentMagnet:t.currentMagnet,edge:this.cell,view:this,type:r,isNew:t.isNewEdge})}}highlightAvailableMagnets(t){const e=this.graph,r=e.model.getCells();t.marked={};for(let i=0,s=r.length;i<s;i+=1){const o=e.findViewByCell(r[i]);if(!o||o.cell.id===this.cell.id)continue;const a=Array.prototype.slice.call(o.container.querySelectorAll("[magnet]"));o.container.getAttribute("magnet")!=="false"&&a.push(o.container);const c=a.filter(l=>this.validateConnection(...t.getValidateConnectionArgs(o,l),o.getEdgeTerminal(l,t.x,t.y,this.cell,t.terminalType)));if(c.length>0){for(let l=0,u=c.length;l<u;l+=1)o.highlight(c[l],{type:"magnetAvailable"});o.highlight(null,{type:"nodeAvailable"}),t.marked[o.cell.id]=c}}}unhighlightAvailableMagnets(t){const e=t.marked||{};Object.keys(e).forEach(r=>{const i=this.graph.findViewByCell(r);i&&(e[r].forEach(o=>{i.unhighlight(o,{type:"magnetAvailable"})}),i.unhighlight(null,{type:"nodeAvailable"}))}),t.marked=null}startArrowheadDragging(t,e,r){if(!this.can("arrowheadMovable")){this.notifyUnhandledMouseDown(t,e,r);return}const s=t.target.getAttribute("data-terminal"),o=this.prepareArrowheadDragging(s,{x:e,y:r});this.setEventData(t,o)}dragArrowhead(t,e,r){const i=this.getEventData(t);this.graph.options.connecting.snap?this.snapArrowhead(e,r,i):this.arrowheadDragging(this.getEventTarget(t),e,r,i)}stopArrowheadDragging(t,e,r){const i=this.graph,s=this.getEventData(t);i.options.connecting.snap?this.snapArrowheadEnd(s):this.arrowheadDragged(s,e,r),this.validateEdge(this.cell,s.terminalType,s.initialTerminal)?(this.finishEmbedding(s),this.notifyConnectionEvent(s,t)):this.fallbackConnection(s),this.afterArrowheadDragging(s)}startLabelDragging(t,e,r){if(this.can("edgeLabelMovable")){const i=t.currentTarget,s=parseInt(i.getAttribute("data-index"),10),o=this.getLabelPositionAngle(s),a=this.getLabelPositionArgs(s),c=this.getDefaultLabelPositionArgs(),l=this.mergeLabelPositionArgs(a,c);this.setEventData(t,{index:s,positionAngle:o,positionArgs:l,stopPropagation:!0,action:"drag-label"})}else this.setEventData(t,{stopPropagation:!0});this.graph.view.delegateDragEvents(t,this)}dragLabel(t,e,r){const i=this.getEventData(t),s=this.cell.getLabelAt(i.index),o=an({},s,{position:this.getLabelPosition(e,r,i.positionAngle,i.positionArgs)});this.cell.setLabelAt(i.index,o)}stopLabelDragging(t,e,r){}}(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag],i=e;return(r==null||r===n.toStringTag)&&typeof i.isNodeView=="function"&&typeof i.isEdgeView=="function"&&typeof i.confirmUpdate=="function"&&typeof i.update=="function"&&typeof i.getConnection=="function"}n.isEdgeView=t})(Pr||(Pr={}));Pr.config({isSvgElement:!0,priority:1,bootstrap:["render","source","target"],actions:{view:["render"],markup:["render"],attrs:["update"],source:["source","update"],target:["target","update"],router:["update"],connector:["update"],labels:["labels"],defaultLabel:["labels"],tools:["tools"],vertices:["vertices","update"]}});Pr.registry.register("edge",Pr,!0);var ZL=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class yr extends Ce{get disposeContainer(){return!1}get options(){return this.graph.options}constructor(t){super(),this.graph=t;const{selectors:e,fragment:r}=ke.parseJSONMarkup(yr.markup);this.background=e.background,this.grid=e.grid,this.svg=e.svg,this.defs=e.defs,this.viewport=e.viewport,this.primer=e.primer,this.stage=e.stage,this.decorator=e.decorator,this.overlay=e.overlay,this.container=this.options.container,this.restore=yr.snapshoot(this.container),qt(this.container,this.prefixClassName("graph")),zn(this.container,r),this.delegateEvents()}delegateEvents(){const t=this.constructor;return super.delegateEvents(t.events),this}guard(t,e){return t.type==="mousedown"&&t.button===2||this.options.guard&&this.options.guard(t,e)?!0:t.data&&t.data.guarded!==void 0?t.data.guarded:!(e&&e.cell&&Ae.isCell(e.cell)||this.svg===t.target||this.container===t.target||this.svg.contains(t.target))}findView(t){return this.graph.findViewByElem(t)}onDblClick(t){this.options.preventDefaultDblClick&&t.preventDefault();const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;const i=this.graph.snapToGrid(e.clientX,e.clientY);r?r.onDblClick(e,i.x,i.y):this.graph.trigger("blank:dblclick",{e,x:i.x,y:i.y})}onClick(t){if(this.getMouseMovedCount(t)<=this.options.clickThreshold){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;const i=this.graph.snapToGrid(e.clientX,e.clientY);r?r.onClick(e,i.x,i.y):this.graph.trigger("blank:click",{e,x:i.x,y:i.y})}}isPreventDefaultContextMenu(t){let e=this.options.preventDefaultContextMenu;return typeof e=="function"&&(e=Qt(e,this.graph,{view:t})),e}onContextMenu(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.isPreventDefaultContextMenu(r)&&t.preventDefault(),this.guard(e,r))return;const i=this.graph.snapToGrid(e.clientX,e.clientY);r?r.onContextMenu(e,i.x,i.y):this.graph.trigger("blank:contextmenu",{e,x:i.x,y:i.y})}delegateDragEvents(t,e){t.data==null&&(t.data={}),this.setEventData(t,{currentView:e||null,mouseMovedCount:0,startPosition:{x:t.clientX,y:t.clientY}});const r=this.constructor;this.delegateDocumentEvents(r.documentEvents,t.data),this.undelegateEvents()}getMouseMovedCount(t){return this.getEventData(t).mouseMovedCount||0}onMouseDown(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;this.options.preventDefaultMouseDown&&t.preventDefault();const i=this.graph.snapToGrid(e.clientX,e.clientY);r?r.onMouseDown(e,i.x,i.y):(this.options.preventDefaultBlankAction&&["touchstart"].includes(e.type)&&t.preventDefault(),this.graph.trigger("blank:mousedown",{e,x:i.x,y:i.y})),this.delegateDragEvents(e,r)}onMouseMove(t){const e=this.getEventData(t),r=e.startPosition;if(r&&r.x===t.clientX&&r.y===t.clientY||(e.mouseMovedCount==null&&(e.mouseMovedCount=0),e.mouseMovedCount+=1,e.mouseMovedCount<=this.options.moveThreshold))return;const s=this.normalizeEvent(t),o=this.graph.snapToGrid(s.clientX,s.clientY),a=e.currentView;a?a.onMouseMove(s,o.x,o.y):this.graph.trigger("blank:mousemove",{e:s,x:o.x,y:o.y}),this.setEventData(s,e)}onMouseUp(t){this.undelegateDocumentEvents();const e=this.normalizeEvent(t),r=this.graph.snapToGrid(e.clientX,e.clientY),s=this.getEventData(t).currentView;if(s?s.onMouseUp(e,r.x,r.y):this.graph.trigger("blank:mouseup",{e,x:r.x,y:r.y}),!t.isPropagationStopped()){const o=new br(t,{type:"click",data:t.data});this.onClick(o)}t.stopImmediatePropagation(),this.delegateEvents()}onMouseOver(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(!this.guard(e,r))if(r)r.onMouseOver(e);else{if(this.container===e.target)return;this.graph.trigger("blank:mouseover",{e})}}onMouseOut(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(!this.guard(e,r))if(r)r.onMouseOut(e);else{if(this.container===e.target)return;this.graph.trigger("blank:mouseout",{e})}}onMouseEnter(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;const i=this.graph.findViewByElem(e.relatedTarget);if(r){if(i===r)return;r.onMouseEnter(e)}else{if(i)return;this.graph.trigger("graph:mouseenter",{e})}}onMouseLeave(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;const i=this.graph.findViewByElem(e.relatedTarget);if(r){if(i===r)return;r.onMouseLeave(e)}else{if(i)return;this.graph.trigger("graph:mouseleave",{e})}}onMouseWheel(t){const e=this.normalizeEvent(t),r=this.findView(e.target);if(this.guard(e,r))return;const i=e.originalEvent,s=this.graph.snapToGrid(i.clientX,i.clientY),o=Math.max(-1,Math.min(1,i.wheelDelta||-i.detail));r?r.onMouseWheel(e,s.x,s.y,o):this.graph.trigger("blank:mousewheel",{e,delta:o,x:s.x,y:s.y})}onCustomEvent(t){const e=t.currentTarget,r=e.getAttribute("event")||e.getAttribute("data-event");if(r){const i=this.findView(e);if(i){const s=this.normalizeEvent(t);if(this.guard(s,i))return;const o=this.graph.snapToGrid(s.clientX,s.clientY);i.onCustomEvent(s,r,o.x,o.y)}}}handleMagnetEvent(t,e){const r=t.currentTarget,i=r.getAttribute("magnet");if(i&&i.toLowerCase()!=="false"){const s=this.findView(r);if(s){const o=this.normalizeEvent(t);if(this.guard(o,s))return;const a=this.graph.snapToGrid(o.clientX,o.clientY);Qt(e,this.graph,s,o,r,a.x,a.y)}}}onMagnetMouseDown(t){this.handleMagnetEvent(t,(e,r,i,s,o)=>{e.onMagnetMouseDown(r,i,s,o)})}onMagnetDblClick(t){this.handleMagnetEvent(t,(e,r,i,s,o)=>{e.onMagnetDblClick(r,i,s,o)})}onMagnetContextMenu(t){const e=this.findView(t.target);this.isPreventDefaultContextMenu(e)&&t.preventDefault(),this.handleMagnetEvent(t,(r,i,s,o,a)=>{r.onMagnetContextMenu(i,s,o,a)})}onLabelMouseDown(t){const e=t.currentTarget,r=this.findView(e);if(r){const i=this.normalizeEvent(t);if(this.guard(i,r))return;const s=this.graph.snapToGrid(i.clientX,i.clientY);r.onLabelMouseDown(i,s.x,s.y)}}onImageDragStart(){return!1}dispose(){this.undelegateEvents(),this.undelegateDocumentEvents(),this.restore(),this.restore=()=>{}}}ZL([Ce.dispose()],yr.prototype,"dispose",null);(function(n){const t=`${Kn.prefixCls}-graph`;n.markup=[{ns:yn.xhtml,tagName:"div",selector:"background",className:`${t}-background`},{ns:yn.xhtml,tagName:"div",selector:"grid",className:`${t}-grid`},{ns:yn.svg,tagName:"svg",selector:"svg",className:`${t}-svg`,attrs:{width:"100%",height:"100%","xmlns:xlink":yn.xlink},children:[{tagName:"defs",selector:"defs"},{tagName:"g",selector:"viewport",className:`${t}-svg-viewport`,children:[{tagName:"g",selector:"primer",className:`${t}-svg-primer`},{tagName:"g",selector:"stage",className:`${t}-svg-stage`},{tagName:"g",selector:"decorator",className:`${t}-svg-decorator`},{tagName:"g",selector:"overlay",className:`${t}-svg-overlay`}]}]}];function e(r){const i=r.cloneNode();return r.childNodes.forEach(s=>i.appendChild(s)),()=>{for($o(r);r.attributes.length>0;)r.removeAttribute(r.attributes[0].name);for(let s=0,o=i.attributes.length;s<o;s+=1){const a=i.attributes[s];r.setAttribute(a.name,a.value)}i.childNodes.forEach(s=>r.appendChild(s))}}n.snapshoot=e})(yr||(yr={}));(function(n){const t=Kn.prefixCls;n.events={dblclick:"onDblClick",contextmenu:"onContextMenu",touchstart:"onMouseDown",mousedown:"onMouseDown",mouseover:"onMouseOver",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousewheel:"onMouseWheel",DOMMouseScroll:"onMouseWheel",[`mouseenter  .${t}-cell`]:"onMouseEnter",[`mouseleave  .${t}-cell`]:"onMouseLeave",[`mouseenter  .${t}-cell-tools`]:"onMouseEnter",[`mouseleave  .${t}-cell-tools`]:"onMouseLeave",[`mousedown   .${t}-cell [event]`]:"onCustomEvent",[`touchstart  .${t}-cell [event]`]:"onCustomEvent",[`mousedown   .${t}-cell [data-event]`]:"onCustomEvent",[`touchstart  .${t}-cell [data-event]`]:"onCustomEvent",[`dblclick    .${t}-cell [magnet]`]:"onMagnetDblClick",[`contextmenu .${t}-cell [magnet]`]:"onMagnetContextMenu",[`mousedown   .${t}-cell [magnet]`]:"onMagnetMouseDown",[`touchstart  .${t}-cell [magnet]`]:"onMagnetMouseDown",[`dblclick    .${t}-cell [data-magnet]`]:"onMagnetDblClick",[`contextmenu .${t}-cell [data-magnet]`]:"onMagnetContextMenu",[`mousedown   .${t}-cell [data-magnet]`]:"onMagnetMouseDown",[`touchstart  .${t}-cell [data-magnet]`]:"onMagnetMouseDown",[`dragstart   .${t}-cell image`]:"onImageDragStart",[`mousedown   .${t}-edge .${t}-edge-label`]:"onLabelMouseDown",[`touchstart  .${t}-edge .${t}-edge-label`]:"onLabelMouseDown"},n.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"}})(yr||(yr={}));const QL=`.x6-graph {
  position: relative;
  overflow: hidden;
  outline: none;
  touch-action: none;
}
.x6-graph-background,
.x6-graph-grid,
.x6-graph-svg {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-graph-background-stage,
.x6-graph-grid-stage,
.x6-graph-svg-stage {
  user-select: none;
}
.x6-graph.x6-graph-pannable {
  cursor: grab;
  cursor: -moz-grab;
  cursor: -webkit-grab;
}
.x6-graph.x6-graph-panning {
  cursor: grabbing;
  cursor: -moz-grabbing;
  cursor: -webkit-grabbing;
  user-select: none;
}
.x6-node {
  cursor: move;
  /* stylelint-disable-next-line */
}
.x6-node.x6-node-immovable {
  cursor: default;
}
.x6-node * {
  -webkit-user-drag: none;
}
.x6-node .scalable * {
  vector-effect: non-scaling-stroke;
}
.x6-node [magnet='true'] {
  cursor: crosshair;
  transition: opacity 0.3s;
}
.x6-node [magnet='true']:hover {
  opacity: 0.7;
}
.x6-node foreignObject {
  display: block;
  overflow: visible;
  background-color: transparent;
}
.x6-node foreignObject > body {
  position: static;
  width: 100%;
  height: 100%;
  margin: 0;
  padding: 0;
  overflow: visible;
  background-color: transparent;
}
.x6-edge .source-marker,
.x6-edge .target-marker {
  vector-effect: non-scaling-stroke;
}
.x6-edge .connection {
  stroke-linejoin: round;
  fill: none;
}
.x6-edge .connection-wrap {
  cursor: move;
  opacity: 0;
  fill: none;
  stroke: #000;
  stroke-width: 15;
  stroke-linecap: round;
  stroke-linejoin: round;
}
.x6-edge .connection-wrap:hover {
  opacity: 0.4;
  stroke-opacity: 0.4;
}
.x6-edge .vertices {
  cursor: move;
  opacity: 0;
}
.x6-edge .vertices .vertex {
  fill: #1abc9c;
}
.x6-edge .vertices .vertex :hover {
  fill: #34495e;
  stroke: none;
}
.x6-edge .vertices .vertex-remove {
  cursor: pointer;
  fill: #fff;
}
.x6-edge .vertices .vertex-remove-area {
  cursor: pointer;
  opacity: 0.1;
}
.x6-edge .vertices .vertex-group:hover .vertex-remove-area {
  opacity: 1;
}
.x6-edge .arrowheads {
  cursor: move;
  opacity: 0;
}
.x6-edge .arrowheads .arrowhead {
  fill: #1abc9c;
}
.x6-edge .arrowheads .arrowhead :hover {
  fill: #f39c12;
  stroke: none;
}
.x6-edge .tools {
  cursor: pointer;
  opacity: 0;
}
.x6-edge .tools .tool-options {
  display: none;
}
.x6-edge .tools .tool-remove circle {
  fill: #f00;
}
.x6-edge .tools .tool-remove path {
  fill: #fff;
}
.x6-edge:hover .vertices,
.x6-edge:hover .arrowheads,
.x6-edge:hover .tools {
  opacity: 1;
}
.x6-highlight-opacity {
  opacity: 0.3;
}
.x6-cell-tool-editor {
  position: relative;
  display: inline-block;
  min-height: 1em;
  margin: 0;
  padding: 0;
  line-height: 1;
  white-space: normal;
  text-align: center;
  vertical-align: top;
  overflow-wrap: normal;
  outline: none;
  transform-origin: 0 0;
  -webkit-user-drag: none;
}
.x6-edge-tool-editor {
  border: 1px solid #275fc5;
  border-radius: 2px;
}
`;class wn extends Rn{get options(){return this.graph.options}get model(){return this.graph.model}get view(){return this.graph.view}constructor(t){super(),this.graph=t,this.init()}init(){}}var tI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Ou extends wn{init(){ks("core",QL)}dispose(){Bs("core")}}tI([Ou.dispose()],Ou.prototype,"dispose",null);var eI=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e},ko;(function(n){function t(e){const{grid:r,panning:i,mousewheel:s,embedding:o}=e,a=eI(e,["grid","panning","mousewheel","embedding"]),c=e.container;if(c!=null)a.width==null&&(a.width=c.clientWidth),a.height==null&&(a.height=c.clientHeight);else throw new Error("Ensure the container of the graph is specified and valid");const l=an({},n.defaults,a),u={size:10,visible:!1};return typeof r=="number"?l.grid={size:r,visible:!1}:typeof r=="boolean"?l.grid=Object.assign(Object.assign({},u),{visible:r}):l.grid=Object.assign(Object.assign({},u),r),["panning","mousewheel","embedding"].forEach(h=>{const d=e[h];typeof d=="boolean"?l[h].enabled=d:l[h]=Object.assign(Object.assign({},l[h]),d)}),l}n.get=t})(ko||(ko={}));(function(n){n.defaults={x:0,y:0,scaling:{min:.01,max:16},grid:{size:10,visible:!1},background:!1,panning:{enabled:!1,eventTypes:["leftMouseDown"]},mousewheel:{enabled:!1,factor:1.2,zoomAtMousePosition:!0},highlighting:{default:{name:"stroke",args:{padding:3}},nodeAvailable:{name:"className",args:{className:Kn.prefix("available-node")}},magnetAvailable:{name:"className",args:{className:Kn.prefix("available-magnet")}}},connecting:{snap:!1,allowLoop:!0,allowNode:!0,allowEdge:!1,allowPort:!0,allowBlank:!0,allowMulti:!0,highlight:!1,anchor:"center",edgeAnchor:"ratio",connectionPoint:"boundary",router:"normal",connector:"normal",validateConnection({type:t,sourceView:e,targetView:r}){return(t==="target"?r:e)!=null},createEdge(){return new WL}},translating:{restrict:!1},embedding:{enabled:!1,findParent:"bbox",frontOnly:!0,validate:()=>!0},moveThreshold:0,clickThreshold:0,magnetThreshold:0,preventDefaultDblClick:!0,preventDefaultMouseDown:!1,preventDefaultContextMenu:!0,preventDefaultBlankAction:!0,interacting:{edgeLabelMovable:!1},async:!0,virtual:!1,guard:()=>!1}})(ko||(ko={}));var nI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},rI=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class gh extends wn{get elem(){return this.view.grid}get grid(){return this.options.grid}init(){this.startListening(),this.draw(this.grid)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}setVisible(t){this.grid.visible!==t&&(this.grid.visible=t,this.update())}getGridSize(){return this.grid.size}setGridSize(t){this.grid.size=Math.max(t,1),this.update()}show(){this.setVisible(!0),this.update()}hide(){this.setVisible(!1),this.update()}clear(){this.elem.style.backgroundImage=""}draw(t){this.clear(),this.instance=null,Object.assign(this.grid,t),this.patterns=this.resolveGrid(t),this.update()}update(t={}){const e=this.grid.size;if(e<=1||!this.grid.visible)return this.clear();const r=this.graph.matrix(),i=this.getInstance(),s=Array.isArray(t)?t:[t];this.patterns.forEach((c,l)=>{const u=`pattern_${l}`,f=r.a||1,h=r.d||1,{update:d,markup:p}=c,m=rI(c,["update","markup"]),b=Object.assign(Object.assign(Object.assign({},m),s[l]),{sx:f,sy:h,ox:r.e||0,oy:r.f||0,width:e*f,height:e*h});i.has(u)||i.add(u,ae.create("pattern",{id:u,patternUnits:"userSpaceOnUse"},ae.createVectors(p)).node);const v=i.get(u);typeof d=="function"&&d(v.childNodes[0],b);let E=b.ox%b.width;E<0&&(E+=b.width);let y=b.oy%b.height;y<0&&(y+=b.height),ye(v,{x:E,y,width:b.width,height:b.height})});const o=new XMLSerializer().serializeToString(i.root),a=`url(data:image/svg+xml;base64,${btoa(o)})`;this.elem.style.backgroundImage=a}getInstance(){return this.instance||(this.instance=new Vr),this.instance}resolveGrid(t){if(!t)return[];const e=t.type;if(e==null)return[Object.assign(Object.assign({},Vr.presets.dot),t.args)];const r=Vr.registry.get(e);if(r){let i=t.args||[];return Array.isArray(i)||(i=[i]),Array.isArray(r)?r.map((s,o)=>Object.assign(Object.assign({},s),i[o])):[Object.assign(Object.assign({},r),i[0])]}return Vr.registry.onNotFound(e)}dispose(){this.stopListening(),this.clear()}}nI([wn.dispose()],gh.prototype,"dispose",null);class Bv extends wn{get container(){return this.graph.view.container}get viewport(){return this.graph.view.viewport}get stage(){return this.graph.view.stage}init(){this.resize()}getMatrix(){const t=this.viewport.getAttribute("transform");return t!==this.viewportTransformString&&(this.viewportMatrix=this.viewport.getCTM(),this.viewportTransformString=t),xn(this.viewportMatrix)}setMatrix(t){const e=xn(t),r=Ds(e);this.viewport.setAttribute("transform",r),this.viewportMatrix=e,this.viewportTransformString=r}resize(t,e){let r=t===void 0?this.options.width:t,i=e===void 0?this.options.height:e;this.options.width=r,this.options.height=i,typeof r=="number"&&(r=Math.round(r)),typeof i=="number"&&(i=Math.round(i)),this.container.style.width=r==null?"":`${r}px`,this.container.style.height=i==null?"":`${i}px`;const s=this.getComputedSize();return this.graph.trigger("resize",Object.assign({},s)),this}getComputedSize(){let t=this.options.width,e=this.options.height;return Od(t)||(t=this.container.clientWidth),Od(e)||(e=this.container.clientHeight),{width:t,height:e}}getScale(){return QM(this.getMatrix())}scale(t,e=t,r=0,i=0){if(t=this.clampScale(t),e=this.clampScale(e),r||i){const o=this.getTranslation(),a=o.tx-r*(t-1),c=o.ty-i*(e-1);(a!==o.tx||c!==o.ty)&&this.translate(a,c)}const s=this.getMatrix();return s.a=t,s.d=e,this.setMatrix(s),this.graph.trigger("scale",{sx:t,sy:e,ox:r,oy:i}),this}clampScale(t){const e=this.graph.options.scaling;return Bn(t,e.min||.01,e.max||16)}getZoom(){return this.getScale().sx}zoom(t,e){e=e||{};let r=t,i=t;const s=this.getScale(),o=this.getComputedSize();let a=o.width/2,c=o.height/2;if(e.absolute||(r+=s.sx,i+=s.sy),e.scaleGrid&&(r=Math.round(r/e.scaleGrid)*e.scaleGrid,i=Math.round(i/e.scaleGrid)*e.scaleGrid),e.maxScale&&(r=Math.min(e.maxScale,r),i=Math.min(e.maxScale,i)),e.minScale&&(r=Math.max(e.minScale,r),i=Math.max(e.minScale,i)),e.center&&(a=e.center.x,c=e.center.y),r=this.clampScale(r),i=this.clampScale(i),a||c){const l=this.getTranslation(),u=a-(a-l.tx)*(r/s.sx),f=c-(c-l.ty)*(i/s.sy);(u!==l.tx||f!==l.ty)&&this.translate(u,f)}return this.scale(r,i),this}getRotation(){return tP(this.getMatrix())}rotate(t,e,r){if(e==null||r==null){const s=Me.getBBox(this.stage);e=s.width/2,r=s.height/2}const i=this.getMatrix().translate(e,r).rotate(t).translate(-e,-r);return this.setMatrix(i),this}getTranslation(){return eP(this.getMatrix())}translate(t,e){const r=this.getMatrix();r.e=t||0,r.f=e||0,this.setMatrix(r);const i=this.getTranslation();return this.options.x=i.tx,this.options.y=i.ty,this.graph.trigger("translate",Object.assign({},i)),this}setOrigin(t,e){return this.translate(t||0,e||0)}fitToContent(t,e,r,i){if(typeof t=="object"){const y=t;t=y.gridWidth||1,e=y.gridHeight||1,r=y.padding||0,i=y}else t=t||1,e=e||1,r=r||0,i==null&&(i={});const s=Pi(r),o=i.border||0,a=i.contentArea?Bt.create(i.contentArea):this.getContentArea(i);o>0&&a.inflate(o);const c=this.getScale(),l=this.getTranslation(),u=c.sx,f=c.sy;a.x*=u,a.y*=f,a.width*=u,a.height*=f;let h=Math.max(Math.ceil((a.width+a.x)/t),1)*t,d=Math.max(Math.ceil((a.height+a.y)/e),1)*e,p=0,m=0;(i.allowNewOrigin==="negative"&&a.x<0||i.allowNewOrigin==="positive"&&a.x>=0||i.allowNewOrigin==="any")&&(p=Math.ceil(-a.x/t)*t,p+=s.left,h+=p),(i.allowNewOrigin==="negative"&&a.y<0||i.allowNewOrigin==="positive"&&a.y>=0||i.allowNewOrigin==="any")&&(m=Math.ceil(-a.y/e)*e,m+=s.top,d+=m),h+=s.right,d+=s.bottom,h=Math.max(h,i.minWidth||0),d=Math.max(d,i.minHeight||0),h=Math.min(h,i.maxWidth||Number.MAX_SAFE_INTEGER),d=Math.min(d,i.maxHeight||Number.MAX_SAFE_INTEGER);const b=this.getComputedSize(),v=h!==b.width||d!==b.height;return(p!==l.tx||m!==l.ty)&&this.translate(p,m),v&&this.resize(h,d),new Bt(-p/u,-m/f,h/u,d/f)}scaleContentToFit(t={}){this.scaleContentToFitImpl(t)}scaleContentToFitImpl(t={},e=!0){let r,i;if(t.contentArea){const v=t.contentArea;r=this.graph.localToGraph(v),i=R.create(v)}else r=this.getContentBBox(t),i=this.graph.graphToLocal(r);if(!r.width||!r.height)return;const s=Pi(t.padding),o=t.minScale||0,a=t.maxScale||Number.MAX_SAFE_INTEGER,c=t.minScaleX||o,l=t.maxScaleX||a,u=t.minScaleY||o,f=t.maxScaleY||a;let h;if(t.viewportArea)h=t.viewportArea;else{const v=this.getComputedSize(),E=this.getTranslation();h={x:E.tx,y:E.ty,width:v.width,height:v.height}}h=Bt.create(h).moveAndExpand({x:s.left,y:s.top,width:-s.left-s.right,height:-s.top-s.bottom});const d=this.getScale();let p=h.width/r.width*d.sx,m=h.height/r.height*d.sy;t.preserveAspectRatio!==!1&&(p=m=Math.min(p,m));const b=t.scaleGrid;if(b&&(p=b*Math.floor(p/b),m=b*Math.floor(m/b)),p=Bn(p,c,l),m=Bn(m,u,f),this.scale(p,m),e){const v=this.options,E=h.x-i.x*p-v.x,y=h.y-i.y*m-v.y;this.translate(E,y)}}getContentArea(t={}){return t.useCellGeometry!==!1?this.model.getAllCellsBBox()||new Bt:Me.getBBox(this.stage)}getContentBBox(t={}){return this.graph.localToGraph(this.getContentArea(t))}getGraphArea(){const t=Bt.fromSize(this.getComputedSize());return this.graph.graphToLocal(t)}zoomToRect(t,e={}){const r=Bt.create(t),i=this.graph;e.contentArea=r,e.viewportArea==null&&(e.viewportArea={x:i.options.x,y:i.options.y,width:this.options.width,height:this.options.height}),this.scaleContentToFitImpl(e,!1);const s=r.getCenter();return this.centerPoint(s.x,s.y),this}zoomToFit(t={}){return this.zoomToRect(this.getContentArea(t),t)}centerPoint(t,e){const r=this.getComputedSize(),i=this.getScale(),s=this.getTranslation(),o=r.width/2,a=r.height/2;t=typeof t=="number"?t:o,e=typeof e=="number"?e:a,t=o-t*i.sx,e=a-e*i.sy,(s.tx!==t||s.ty!==e)&&this.translate(t,e)}centerContent(t){const r=this.graph.getContentArea(t).getCenter();this.centerPoint(r.x,r.y)}centerCell(t){return this.positionCell(t,"center")}positionPoint(t,e,r){const i=this.getComputedSize();e=nr(e,Math.max(0,i.width)),e<0&&(e=i.width+e),r=nr(r,Math.max(0,i.height)),r<0&&(r=i.height+r);const s=this.getTranslation(),o=this.getScale(),a=e-t.x*o.sx,c=r-t.y*o.sy;(s.tx!==a||s.ty!==c)&&this.translate(a,c)}positionRect(t,e){const r=Bt.create(t);switch(e){case"center":return this.positionPoint(r.getCenter(),"50%","50%");case"top":return this.positionPoint(r.getTopCenter(),"50%",0);case"top-right":return this.positionPoint(r.getTopRight(),"100%",0);case"right":return this.positionPoint(r.getRightMiddle(),"100%","50%");case"bottom-right":return this.positionPoint(r.getBottomRight(),"100%","100%");case"bottom":return this.positionPoint(r.getBottomCenter(),"50%","100%");case"bottom-left":return this.positionPoint(r.getBottomLeft(),0,"100%");case"left":return this.positionPoint(r.getLeftMiddle(),0,"50%");case"top-left":return this.positionPoint(r.getTopLeft(),0,0);default:return this}}positionCell(t,e){const r=t.getBBox();return this.positionRect(r,e)}positionContent(t,e){const r=this.graph.getContentArea(e);return this.positionRect(r,t)}}var iI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class mh extends wn{get elem(){return this.view.background}init(){this.startListening(),this.options.background&&this.draw(this.options.background)}startListening(){this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this)}stopListening(){this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this)}updateBackgroundImage(t={}){let e=t.size||"auto auto",r=t.position||"center";const i=this.graph.transform.getScale(),s=this.graph.translate();if(typeof r=="object"){const o=s.tx+i.sx*(r.x||0),a=s.ty+i.sy*(r.y||0);r=`${o}px ${a}px`}typeof e=="object"&&(e=Bt.fromSize(e).scale(i.sx,i.sy),e=`${e.width}px ${e.height}px`),this.elem.style.backgroundSize=e,this.elem.style.backgroundPosition=r}drawBackgroundImage(t,e={}){if(!(t instanceof HTMLImageElement)){this.elem.style.backgroundImage="";return}const r=this.optionsCache;if(r&&r.image!==e.image)return;let i;const s=e.opacity,o=e.size;let a=e.repeat||"no-repeat";const c=Ro.registry.get(a);if(typeof c=="function"){const u=e.quality||1;t.width*=u,t.height*=u;const f=c(t,e);if(!(f instanceof HTMLCanvasElement))throw new Error("Background pattern must return an HTML Canvas instance");i=f.toDataURL("image/png"),e.repeat&&a!==e.repeat?a=e.repeat:a="repeat",typeof o=="object"?(o.width*=f.width/t.width,o.height*=f.height/t.height):o===void 0&&(e.size={width:f.width/u,height:f.height/u})}else i=t.src,o===void 0&&(e.size={width:t.width,height:t.height});r!=null&&typeof e.size=="object"&&e.image===r.image&&e.repeat===r.repeat&&e.quality===r.quality&&(r.size=eu(e.size));const l=this.elem.style;l.backgroundImage=`url(${i})`,l.backgroundRepeat=a,l.opacity=s==null||s>=1?"":`${s}`,this.updateBackgroundImage(e)}updateBackgroundColor(t){this.elem.style.backgroundColor=t||""}updateBackgroundOptions(t){this.graph.options.background=t}update(){this.optionsCache&&this.updateBackgroundImage(this.optionsCache)}draw(t){const e=t||{};if(this.updateBackgroundOptions(t),this.updateBackgroundColor(e.color),e.image){this.optionsCache=eu(e);const r=document.createElement("img");r.onload=()=>this.drawBackgroundImage(r,t),r.setAttribute("crossorigin","anonymous"),r.src=e.image}else this.drawBackgroundImage(null),this.optionsCache=null}clear(){this.draw()}dispose(){this.clear(),this.stopListening()}}iI([wn.dispose()],mh.prototype,"dispose",null);var sI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class bh extends wn{get widgetOptions(){return this.options.panning}get pannable(){return this.widgetOptions&&this.widgetOptions.enabled===!0}init(){this.onRightMouseDown=this.onRightMouseDown.bind(this),this.onSpaceKeyDown=this.onSpaceKeyDown.bind(this),this.onSpaceKeyUp=this.onSpaceKeyUp.bind(this),this.startListening(),this.updateClassName()}startListening(){this.graph.on("blank:mousedown",this.onMouseDown,this),this.graph.on("node:unhandled:mousedown",this.onMouseDown,this),this.graph.on("edge:unhandled:mousedown",this.onMouseDown,this),Tn.on(this.graph.container,"mousedown",this.onRightMouseDown),Tn.on(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle=new zb(this.graph.container,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.mousewheelHandle.enable()}stopListening(){this.graph.off("blank:mousedown",this.onMouseDown,this),this.graph.off("node:unhandled:mousedown",this.onMouseDown,this),this.graph.off("edge:unhandled:mousedown",this.onMouseDown,this),Tn.off(this.graph.container,"mousedown",this.onRightMouseDown),Tn.off(document.body,{keydown:this.onSpaceKeyDown,keyup:this.onSpaceKeyUp}),this.mousewheelHandle&&this.mousewheelHandle.disable()}allowPanning(t,e){return t.spaceKey=this.isSpaceKeyPressed,this.pannable&&Yr.isMatch(t,this.widgetOptions.modifiers,e)}startPanning(t){const e=this.view.normalizeEvent(t);this.clientX=e.clientX,this.clientY=e.clientY,this.panning=!0,this.updateClassName(),Tn.on(document.body,{"mousemove.panning touchmove.panning":this.pan.bind(this),"mouseup.panning touchend.panning":this.stopPanning.bind(this),"mouseleave.panning":this.stopPanning.bind(this)}),Tn.on(window,"mouseup.panning",this.stopPanning.bind(this))}pan(t){const e=this.view.normalizeEvent(t),r=e.clientX-this.clientX,i=e.clientY-this.clientY;this.clientX=e.clientX,this.clientY=e.clientY,this.graph.translateBy(r,i)}stopPanning(t){this.panning=!1,this.updateClassName(),Tn.off(document.body,".panning"),Tn.off(window,".panning")}updateClassName(){const t=this.view.container,e=this.view.prefixClassName("graph-panning"),r=this.view.prefixClassName("graph-pannable");this.pannable?this.panning?(qt(t,e),Fe(t,r)):(Fe(t,e),qt(t,r)):(Fe(t,e),Fe(t,r))}onMouseDown({e:t}){if(!this.allowBlankMouseDown(t))return;const e=this.graph.getPlugin("selection"),r=e&&e.allowRubberband(t,!0);(this.allowPanning(t,!0)||this.allowPanning(t)&&!r)&&this.startPanning(t)}onRightMouseDown(t){const e=this.widgetOptions.eventTypes;e!=null&&e.includes("rightMouseDown")&&t.button===2&&this.allowPanning(t,!0)&&this.startPanning(t)}onMouseWheel(t,e,r){this.graph.translateBy(-e,-r)}onSpaceKeyDown(t){t.which===32&&(this.isSpaceKeyPressed=!0)}onSpaceKeyUp(t){t.which===32&&(this.isSpaceKeyPressed=!1)}allowBlankMouseDown(t){const e=this.widgetOptions.eventTypes;return(e==null?void 0:e.includes("leftMouseDown"))&&t.button===0||(e==null?void 0:e.includes("mouseWheelDown"))&&t.button===1}allowMouseWheel(t){var e;return this.pannable&&!t.ctrlKey&&((e=this.widgetOptions.eventTypes)===null||e===void 0?void 0:e.includes("mouseWheel"))}autoPanning(t,e){const i=this.graph.getGraphArea();let s=0,o=0;t<=i.left+10&&(s=-10),e<=i.top+10&&(o=-10),t>=i.right-10&&(s=10),e>=i.bottom-10&&(o=10),(s!==0||o!==0)&&this.graph.translateBy(-s,-o)}enablePanning(){this.pannable||(this.widgetOptions.enabled=!0,this.updateClassName())}disablePanning(){this.pannable&&(this.widgetOptions.enabled=!1,this.updateClassName())}dispose(){this.stopListening()}}sI([wn.dispose()],bh.prototype,"dispose",null);var oI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class vh extends wn{constructor(){super(...arguments),this.cumulatedFactor=1}get widgetOptions(){return this.options.mousewheel}init(){this.container=this.graph.container,this.target=this.widgetOptions.global?document:this.container,this.mousewheelHandle=new zb(this.target,this.onMouseWheel.bind(this),this.allowMouseWheel.bind(this)),this.widgetOptions.enabled&&this.enable(!0)}get disabled(){return this.widgetOptions.enabled!==!0}enable(t){(this.disabled||t)&&(this.widgetOptions.enabled=!0,this.mousewheelHandle.enable())}disable(){this.disabled||(this.widgetOptions.enabled=!1,this.mousewheelHandle.disable())}allowMouseWheel(t){const e=this.widgetOptions.guard;return(e==null||e(t))&&Yr.isMatch(t,this.widgetOptions.modifiers)}onMouseWheel(t){const e=this.widgetOptions.guard;if((e==null||e(t))&&Yr.isMatch(t,this.widgetOptions.modifiers)){const r=this.widgetOptions.factor||1.2;this.currentScale==null&&(this.startPos={x:t.clientX,y:t.clientY},this.currentScale=this.graph.transform.getScale().sx),t.deltaY<0?this.currentScale<.15?this.cumulatedFactor=(this.currentScale+.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*r*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=1.05)):this.currentScale<=.15?this.cumulatedFactor=(this.currentScale-.01)/this.currentScale:(this.cumulatedFactor=Math.round(this.currentScale*(1/r)*20)/20/this.currentScale,this.cumulatedFactor===1&&(this.cumulatedFactor=.95)),this.cumulatedFactor=Math.max(.01,Math.min(this.currentScale*this.cumulatedFactor,160)/this.currentScale);const s=this.currentScale;let o=this.graph.transform.clampScale(s*this.cumulatedFactor);const a=this.widgetOptions.minScale||Number.MIN_SAFE_INTEGER,c=this.widgetOptions.maxScale||Number.MAX_SAFE_INTEGER;if(o=Bn(o,a,c),o!==s)if(this.widgetOptions.zoomAtMousePosition){const u=!!this.graph.getPlugin("scroller")?this.graph.clientToLocal(this.startPos):this.graph.clientToGraph(this.startPos);this.graph.zoom(o,{absolute:!0,center:u.clone()})}else this.graph.zoom(o,{absolute:!0});this.currentScale=null,this.cumulatedFactor=1}}dispose(){this.disable()}}oI([Rn.dispose()],vh.prototype,"dispose",null);var aI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class jv extends wn{init(){this.resetRenderArea=Ix(this.resetRenderArea,200,{leading:!0}),this.resetRenderArea(),this.startListening()}startListening(){this.graph.on("translate",this.resetRenderArea,this),this.graph.on("scale",this.resetRenderArea,this),this.graph.on("resize",this.resetRenderArea,this)}stopListening(){this.graph.off("translate",this.resetRenderArea,this),this.graph.off("scale",this.resetRenderArea,this),this.graph.off("resize",this.resetRenderArea,this)}enableVirtualRender(){this.options.virtual=!0,this.resetRenderArea()}disableVirtualRender(){this.options.virtual=!1,this.graph.renderer.setRenderArea(void 0)}resetRenderArea(){if(this.options.virtual){const t=this.graph.getGraphArea();this.graph.renderer.setRenderArea(t)}}dispose(){this.stopListening()}}aI([wn.dispose()],jv.prototype,"dispose",null);class cI{constructor(){this.isFlushing=!1,this.isFlushPending=!1,this.scheduleId=0,this.queue=[],this.frameInterval=33,this.initialTime=Date.now()}queueJob(t){if(t.priority&Tr.PRIOR)t.cb();else{const e=this.findInsertionIndex(t);e>=0&&this.queue.splice(e,0,t)}}queueFlush(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.scheduleJob())}queueFlushSync(){!this.isFlushing&&!this.isFlushPending&&(this.isFlushPending=!0,this.flushJobsSync())}clearJobs(){this.queue.length=0,this.isFlushing=!1,this.isFlushPending=!1,this.cancelScheduleJob()}flushJobs(){this.isFlushPending=!1,this.isFlushing=!0;const t=this.getCurrentTime();let e;for(;(e=this.queue.shift())&&(e.cb(),!(this.getCurrentTime()-t>=this.frameInterval)););this.isFlushing=!1,this.queue.length&&this.queueFlush()}flushJobsSync(){this.isFlushPending=!1,this.isFlushing=!0;let t;for(;t=this.queue.shift();)try{t.cb()}catch(e){console.log(e)}this.isFlushing=!1}findInsertionIndex(t){let e=0,r=this.queue.length,i=r-1;const s=t.priority;for(;e<=i;){const o=(i-e>>1)+e;s<=this.queue[o].priority?e=o+1:(r=o,i=o-1)}return r}scheduleJob(){"requestIdleCallback"in window?(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.requestIdleCallback(this.flushJobs.bind(this),{timeout:100})):(this.scheduleId&&this.cancelScheduleJob(),this.scheduleId=window.setTimeout(this.flushJobs.bind(this)))}cancelScheduleJob(){"cancelIdleCallback"in window?(this.scheduleId&&window.cancelIdleCallback(this.scheduleId),this.scheduleId=0):(this.scheduleId&&clearTimeout(this.scheduleId),this.scheduleId=0)}getCurrentTime(){return typeof performance=="object"&&typeof performance.now=="function"?performance.now():Date.now()-this.initialTime}}var Tr;(function(n){n[n.Update=2]="Update",n[n.RenderEdge=4]="RenderEdge",n[n.RenderNode=8]="RenderNode",n[n.PRIOR=1048576]="PRIOR"})(Tr||(Tr={}));var lI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class fn extends Rn{get model(){return this.graph.model}get container(){return this.graph.view.stage}constructor(t){super(),this.views={},this.willRemoveViews={},this.queue=new cI,this.graph=t,this.init()}init(){this.startListening(),this.renderViews(this.model.getCells())}startListening(){this.model.on("reseted",this.onModelReseted,this),this.model.on("cell:added",this.onCellAdded,this),this.model.on("cell:removed",this.onCellRemoved,this),this.model.on("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.on("cell:change:visible",this.onCellVisibleChanged,this)}stopListening(){this.model.off("reseted",this.onModelReseted,this),this.model.off("cell:added",this.onCellAdded,this),this.model.off("cell:removed",this.onCellRemoved,this),this.model.off("cell:change:zIndex",this.onCellZIndexChanged,this),this.model.off("cell:change:visible",this.onCellVisibleChanged,this)}onModelReseted({options:t}){this.queue.clearJobs(),this.removeZPivots(),this.resetViews();const e=this.model.getCells();this.renderViews(e,Object.assign(Object.assign({},t),{queue:e.map(r=>r.id)}))}onCellAdded({cell:t,options:e}){this.renderViews([t],e)}onCellRemoved({cell:t}){this.removeViews([t])}onCellZIndexChanged({cell:t,options:e}){const r=this.views[t.id];r&&this.requestViewUpdate(r.view,fn.FLAG_INSERT,e,Tr.Update,!0)}onCellVisibleChanged({cell:t,current:e}){this.toggleVisible(t,!!e)}requestViewUpdate(t,e,r={},i=Tr.Update,s=!0){const o=t.cell.id,a=this.views[o];if(!a)return;a.flag=e,a.options=r,(t.hasAction(e,["translate","resize","rotate"])||r.async===!1)&&(i=Tr.PRIOR,s=!1),this.queue.queueJob({id:o,priority:i,cb:()=>{this.renderViewInArea(t,e,r);const u=r.queue;if(u){const f=u.indexOf(t.cell.id);f>=0&&u.splice(f,1),u.length===0&&this.graph.trigger("render:done")}}}),this.getEffectedEdges(t).forEach(u=>{this.requestViewUpdate(u.view,u.flag,r,i,!1)}),s&&this.flush()}setRenderArea(t){this.renderArea=t,this.flushWaitingViews()}isViewMounted(t){if(t==null)return!1;const e=this.views[t.cell.id];return e?e.state===fn.ViewState.MOUNTED:!1}renderViews(t,e={}){t.sort((r,i)=>r.isNode()&&i.isEdge()?-1:0),t.forEach(r=>{const i=r.id,s=this.views;let o=0,a=s[i];if(a)o=fn.FLAG_INSERT;else{const c=this.createCellView(r);c&&(c.graph=this.graph,o=fn.FLAG_INSERT|c.getBootstrapFlag(),a={view:c,flag:o,options:e,state:fn.ViewState.CREATED},this.views[i]=a)}a&&this.requestViewUpdate(a.view,o,e,this.getRenderPriority(a.view),!1)}),this.flush()}renderViewInArea(t,e,r={}){const i=t.cell,s=i.id,o=this.views[s];if(!o)return;let a=0;this.isUpdatable(t)?(a=this.updateView(t,e,r),o.flag=a):o.state===fn.ViewState.MOUNTED?(a=this.updateView(t,e,r),o.flag=a):o.state=fn.ViewState.WAITING,a&&i.isEdge()&&!(a&t.getFlag(["source","target"]))&&this.queue.queueJob({id:s,priority:Tr.RenderEdge,cb:()=>{this.updateView(t,e,r)}})}removeViews(t){t.forEach(e=>{const r=e.id,i=this.views[r];i&&(this.willRemoveViews[r]=i,delete this.views[r],this.queue.queueJob({id:r,priority:this.getRenderPriority(i.view),cb:()=>{this.removeView(i.view)}}))}),this.flush()}flush(){this.graph.options.async?this.queue.queueFlush():this.queue.queueFlushSync()}flushWaitingViews(){Object.values(this.views).forEach(t=>{if(t&&t.state===fn.ViewState.WAITING){const{view:e,flag:r,options:i}=t;this.requestViewUpdate(e,r,i,this.getRenderPriority(e),!1)}}),this.flush()}updateView(t,e,r={}){if(t==null)return 0;if(nn.isCellView(t)){if(e&fn.FLAG_REMOVE)return this.removeView(t.cell),0;e&fn.FLAG_INSERT&&(this.insertView(t),e^=fn.FLAG_INSERT)}return e?t.confirmUpdate(e,r):0}insertView(t){const e=this.views[t.cell.id];if(e){const r=t.cell.getZIndex(),i=this.addZPivot(r);this.container.insertBefore(t.container,i),t.cell.isVisible()||this.toggleVisible(t.cell,!1),e.state=fn.ViewState.MOUNTED,this.graph.trigger("view:mounted",{view:t})}}resetViews(){this.willRemoveViews=Object.assign(Object.assign({},this.views),this.willRemoveViews),Object.values(this.willRemoveViews).forEach(t=>{t&&this.removeView(t.view)}),this.views={},this.willRemoveViews={}}removeView(t){const e=t.cell,r=this.willRemoveViews[e.id];r&&t&&(r.view.remove(),delete this.willRemoveViews[e.id],this.graph.trigger("view:unmounted",{view:t}))}toggleVisible(t,e){const r=this.model.getConnectedEdges(t);for(let s=0,o=r.length;s<o;s+=1){const a=r[s];if(e){const c=a.getSourceCell(),l=a.getTargetCell();if(c&&!c.isVisible()||l&&!l.isVisible())continue;this.toggleVisible(a,!0)}else this.toggleVisible(a,!1)}const i=this.views[t.id];i&&dn(i.view.container,{display:e?"unset":"none"})}addZPivot(t=0){this.zPivots==null&&(this.zPivots={});const e=this.zPivots;let r=e[t];if(r)return r;r=e[t]=document.createComment(`z-index:${t+1}`);let i=-1/0;for(const o in e){const a=+o;a<t&&a>i&&(i=a,t-1)}const s=this.container;if(i!==-1/0){const o=e[i];s.insertBefore(r,o.nextSibling)}else s.insertBefore(r,s.firstChild);return r}removeZPivots(){this.zPivots&&Object.values(this.zPivots).forEach(t=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),this.zPivots={}}createCellView(t){const e={graph:this.graph},r=this.graph.options.createCellView;if(r){const s=Qt(r,this.graph,t);if(s)return new s(t,e);if(s===null)return null}const i=t.view;if(i!=null&&typeof i=="string"){const s=nn.registry.get(i);return s?new s(t,e):nn.registry.onNotFound(i)}return t.isNode()?new sr(t,e):t.isEdge()?new Pr(t,e):null}getEffectedEdges(t){const e=[],r=t.cell,i=this.model.getConnectedEdges(r);for(let s=0,o=i.length;s<o;s+=1){const a=i[s],c=this.views[a.id];if(!c)continue;const l=c.view;if(!this.isViewMounted(l))continue;const u=["update"];a.getTargetCell()===r&&u.push("target"),a.getSourceCell()===r&&u.push("source"),e.push({id:a.id,view:l,flag:l.getFlag(u)})}return e}isUpdatable(t){if(t.isNodeView())return this.renderArea?this.renderArea.isIntersectWithRect(t.cell.getBBox()):!0;if(t.isEdgeView()){const e=t.cell,r=e.getSourceCell(),i=e.getTargetCell();if(this.renderArea&&r&&i)return this.renderArea.isIntersectWithRect(r.getBBox())||this.renderArea.isIntersectWithRect(i.getBBox())}return!0}getRenderPriority(t){return t.cell.isNode()?Tr.RenderNode:Tr.RenderEdge}dispose(){this.stopListening(),Object.keys(this.views).forEach(t=>{this.views[t].view.dispose()}),this.views={}}}lI([Rn.dispose()],fn.prototype,"dispose",null);(function(n){n.FLAG_INSERT=1<<30,n.FLAG_REMOVE=1<<29,n.FLAG_RENDER=(1<<26)-1})(fn||(fn={}));(function(n){(function(t){t[t.CREATED=0]="CREATED",t[t.MOUNTED=1]="MOUNTED",t[t.WAITING=2]="WAITING"})(n.ViewState||(n.ViewState={}))})(fn||(fn={}));var uI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class yh extends wn{constructor(){super(...arguments),this.schedule=new fn(this.graph)}requestViewUpdate(t,e,r={}){this.schedule.requestViewUpdate(t,e,r)}isViewMounted(t){return this.schedule.isViewMounted(t)}setRenderArea(t){this.schedule.setRenderArea(t)}findViewByElem(t){if(t==null)return null;const e=this.options.container,r=typeof t=="string"?e.querySelector(t):t instanceof Element?t:t[0];if(r){const i=this.graph.view.findAttr("data-cell-id",r);if(i){const s=this.schedule.views;if(s[i])return s[i].view}}return null}findViewByCell(t){if(t==null)return null;const e=Ae.isCell(t)?t.id:t,r=this.schedule.views;return r[e]?r[e].view:null}findViewsFromPoint(t){const e={x:t.x,y:t.y};return this.model.getCells().map(r=>this.findViewByCell(r)).filter(r=>r!=null?Me.getBBox(r.container,{target:this.view.stage}).containsPoint(e):!1)}findEdgeViewsFromPoint(t,e=5){return this.model.getEdges().map(r=>this.findViewByCell(r)).filter(r=>{if(r!=null){const i=r.getClosestPoint(t);if(i)return i.distance(t)<=e}return!1})}findViewsInArea(t,e={}){const r=Bt.create(t);return this.model.getCells().map(i=>this.findViewByCell(i)).filter(i=>{if(i){if(e.nodeOnly&&!i.isNodeView())return!1;const s=Me.getBBox(i.container,{target:this.view.stage});return s.width===0?s.inflate(1,0):s.height===0&&s.inflate(0,1),e.strict?r.containsRect(s):r.isIntersectWithRect(s)}return!1})}dispose(){this.schedule.dispose()}}uI([wn.dispose()],yh.prototype,"dispose",null);var ug=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class Fv extends wn{get cid(){return this.graph.view.cid}get svg(){return this.view.svg}get defs(){return this.view.defs}isDefined(t){return this.svg.getElementById(t)!=null}filter(t){let e=t.id;const r=t.name;if(e||(e=`filter-${r}-${this.cid}-${ql(JSON.stringify(t))}`),!this.isDefined(e)){const i=vs.registry.get(r);if(i==null)return vs.registry.onNotFound(r);const s=i(t.args||{}),o=Object.assign(Object.assign({x:-1,y:-1,width:3,height:3,filterUnits:"objectBoundingBox"},t.attrs),{id:e});ae.create(ke.sanitize(s),o).appendTo(this.defs)}return e}gradient(t){let e=t.id;const r=t.type;if(e||(e=`gradient-${r}-${this.cid}-${ql(JSON.stringify(t))}`),!this.isDefined(e)){const s=t.stops.map(c=>{const l=c.opacity!=null&&Number.isFinite(c.opacity)?c.opacity:1;return`<stop offset="${c.offset}" stop-color="${c.color}" stop-opacity="${l}"/>`}),o=`<${r}>${s.join("")}</${r}>`,a=Object.assign({id:e},t.attrs);ae.create(o,a).appendTo(this.defs)}return e}marker(t){const{id:e,refX:r,refY:i,markerUnits:s,markerOrient:o,tagName:a,children:c}=t,l=ug(t,["id","refX","refY","markerUnits","markerOrient","tagName","children"]);let u=e;if(u||(u=`marker-${this.cid}-${ql(JSON.stringify(t))}`),!this.isDefined(u)){a!=="path"&&delete l.d;const f=ae.create("marker",{refX:r,refY:i,id:u,overflow:"visible",orient:o??"auto",markerUnits:s||"userSpaceOnUse"},c?c.map(h=>{var{tagName:d}=h,p=ug(h,["tagName"]);return ae.create(`${d}`||"path",_o(Object.assign(Object.assign({},l),p)))}):[ae.create(a||"path",_o(l))]);this.defs.appendChild(f.node)}return u}remove(t){const e=this.svg.getElementById(t);e&&e.parentNode&&e.parentNode.removeChild(e)}}class Gv extends wn{getClientMatrix(){return xn(this.view.stage.getScreenCTM())}getClientOffset(){const t=this.view.svg.getBoundingClientRect();return new R(t.left,t.top)}getPageOffset(){return this.getClientOffset().translate(window.scrollX,window.scrollY)}snapToGrid(t,e){return(typeof t=="number"?this.clientToLocalPoint(t,e):this.clientToLocalPoint(t.x,t.y)).snapToGrid(this.graph.getGridSize())}localToGraphPoint(t,e){const r=R.create(t,e);return Me.transformPoint(r,this.graph.matrix())}localToClientPoint(t,e){const r=R.create(t,e);return Me.transformPoint(r,this.getClientMatrix())}localToPagePoint(t,e){return(typeof t=="number"?this.localToGraphPoint(t,e):this.localToGraphPoint(t)).translate(this.getPageOffset())}localToGraphRect(t,e,r,i){const s=Bt.create(t,e,r,i);return Me.transformRectangle(s,this.graph.matrix())}localToClientRect(t,e,r,i){const s=Bt.create(t,e,r,i);return Me.transformRectangle(s,this.getClientMatrix())}localToPageRect(t,e,r,i){return(typeof t=="number"?this.localToGraphRect(t,e,r,i):this.localToGraphRect(t)).translate(this.getPageOffset())}graphToLocalPoint(t,e){const r=R.create(t,e);return Me.transformPoint(r,this.graph.matrix().inverse())}clientToLocalPoint(t,e){const r=R.create(t,e);return Me.transformPoint(r,this.getClientMatrix().inverse())}clientToGraphPoint(t,e){const r=R.create(t,e);return Me.transformPoint(r,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalPoint(t,e){const i=R.create(t,e).diff(this.getPageOffset());return this.graphToLocalPoint(i)}graphToLocalRect(t,e,r,i){const s=Bt.create(t,e,r,i);return Me.transformRectangle(s,this.graph.matrix().inverse())}clientToLocalRect(t,e,r,i){const s=Bt.create(t,e,r,i);return Me.transformRectangle(s,this.getClientMatrix().inverse())}clientToGraphRect(t,e,r,i){const s=Bt.create(t,e,r,i);return Me.transformRectangle(s,this.graph.matrix().multiply(this.getClientMatrix().inverse()))}pageToLocalRect(t,e,r,i){const s=Bt.create(t,e,r,i),o=this.getPageOffset();return s.x-=o.x,s.y-=o.y,this.graphToLocalRect(s)}}var hI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class cc extends wn{constructor(){super(...arguments),this.highlights={}}init(){this.startListening()}startListening(){this.graph.on("cell:highlight",this.onCellHighlight,this),this.graph.on("cell:unhighlight",this.onCellUnhighlight,this)}stopListening(){this.graph.off("cell:highlight",this.onCellHighlight,this),this.graph.off("cell:unhighlight",this.onCellUnhighlight,this)}onCellHighlight({view:t,magnet:e,options:r={}}){const i=this.resolveHighlighter(r);if(!i)return;const s=this.getHighlighterId(e,i);if(!this.highlights[s]){const o=i.highlighter;o.highlight(t,e,Object.assign({},i.args)),this.highlights[s]={cellView:t,magnet:e,highlighter:o,args:i.args}}}onCellUnhighlight({magnet:t,options:e={}}){const r=this.resolveHighlighter(e);if(!r)return;const i=this.getHighlighterId(t,r);this.unhighlight(i)}resolveHighlighter(t){const e=this.options;let r=t.highlighter;if(r==null){const a=t.type;r=a&&e.highlighting[a]||e.highlighting.default}if(r==null)return null;const i=typeof r=="string"?{name:r}:r,s=i.name,o=_r.registry.get(s);return o==null?_r.registry.onNotFound(s):(_r.check(s,o),{name:s,highlighter:o,args:i.args||{}})}getHighlighterId(t,e){return ih(t),e.name+t.id+JSON.stringify(e.args)}unhighlight(t){const e=this.highlights[t];e&&(e.highlighter.unhighlight(e.cellView,e.magnet,e.args),delete this.highlights[t])}dispose(){Object.keys(this.highlights).forEach(t=>this.unhighlight(t)),this.stopListening()}}hI([cc.dispose()],cc.prototype,"dispose",null);var fI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class zv extends wn{getScroller(){const t=this.graph.getPlugin("scroller");return t&&t.options.enabled?t:null}getContainer(){const t=this.getScroller();return t?t.container.parentElement:this.graph.container.parentElement}getSensorTarget(){const t=this.options.autoResize;if(t)return typeof t=="boolean"?this.getContainer():t}init(){if(this.options.autoResize){const e=this.getSensorTarget();e&&Qa.bind(e,()=>{const r=e.offsetWidth,i=e.offsetHeight;this.resize(r,i)})}}resize(t,e){const r=this.getScroller();r?r.resize(t,e):this.graph.transform.resize(t,e)}dispose(){Qa.clear(this.graph.container)}}fI([wn.dispose()],zv.prototype,"dispose",null);var dI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class _t extends $e{get container(){return this.options.container}get[Symbol.toStringTag](){return _t.toStringTag}constructor(t){super(),this.installedPlugins=new Set,this.options=ko.get(t),this.css=new Ou(this),this.view=new yr(this),this.defs=new Fv(this),this.coord=new Gv(this),this.transform=new Bv(this),this.highlight=new cc(this),this.grid=new gh(this),this.background=new mh(this),this.options.model?this.model=this.options.model:(this.model=new pn,this.model.graph=this),this.renderer=new yh(this),this.panning=new bh(this),this.mousewheel=new vh(this),this.virtualRender=new jv(this),this.size=new zv(this)}isNode(t){return t.isNode()}isEdge(t){return t.isEdge()}resetCells(t,e={}){return this.model.resetCells(t,e),this}clearCells(t={}){return this.model.clear(t),this}toJSON(t={}){return this.model.toJSON(t)}parseJSON(t){return this.model.parseJSON(t)}fromJSON(t,e={}){return this.model.fromJSON(t,e),this}getCellById(t){return this.model.getCell(t)}addNode(t,e={}){return this.model.addNode(t,e)}addNodes(t,e={}){return this.addCell(t.map(r=>sn.isNode(r)?r:this.createNode(r)),e)}createNode(t){return this.model.createNode(t)}removeNode(t,e={}){return this.model.removeCell(t,e)}addEdge(t,e={}){return this.model.addEdge(t,e)}addEdges(t,e={}){return this.addCell(t.map(r=>Ke.isEdge(r)?r:this.createEdge(r)),e)}removeEdge(t,e={}){return this.model.removeCell(t,e)}createEdge(t){return this.model.createEdge(t)}addCell(t,e={}){return this.model.addCell(t,e),this}removeCell(t,e={}){return this.model.removeCell(t,e)}removeCells(t,e={}){return this.model.removeCells(t,e)}removeConnectedEdges(t,e={}){return this.model.removeConnectedEdges(t,e)}disconnectConnectedEdges(t,e={}){return this.model.disconnectConnectedEdges(t,e),this}hasCell(t){return this.model.has(t)}getCells(){return this.model.getCells()}getCellCount(){return this.model.total()}getNodes(){return this.model.getNodes()}getEdges(){return this.model.getEdges()}getOutgoingEdges(t){return this.model.getOutgoingEdges(t)}getIncomingEdges(t){return this.model.getIncomingEdges(t)}getConnectedEdges(t,e={}){return this.model.getConnectedEdges(t,e)}getRootNodes(){return this.model.getRoots()}getLeafNodes(){return this.model.getLeafs()}isRootNode(t){return this.model.isRoot(t)}isLeafNode(t){return this.model.isLeaf(t)}getNeighbors(t,e={}){return this.model.getNeighbors(t,e)}isNeighbor(t,e,r={}){return this.model.isNeighbor(t,e,r)}getSuccessors(t,e={}){return this.model.getSuccessors(t,e)}isSuccessor(t,e,r={}){return this.model.isSuccessor(t,e,r)}getPredecessors(t,e={}){return this.model.getPredecessors(t,e)}isPredecessor(t,e,r={}){return this.model.isPredecessor(t,e,r)}getCommonAncestor(...t){return this.model.getCommonAncestor(...t)}getSubGraph(t,e={}){return this.model.getSubGraph(t,e)}cloneSubGraph(t,e={}){return this.model.cloneSubGraph(t,e)}cloneCells(t){return this.model.cloneCells(t)}getNodesFromPoint(t,e){return this.model.getNodesFromPoint(t,e)}getNodesInArea(t,e,r,i,s){return this.model.getNodesInArea(t,e,r,i,s)}getNodesUnderNode(t,e={}){return this.model.getNodesUnderNode(t,e)}searchCell(t,e,r={}){return this.model.search(t,e,r),this}getShortestPath(t,e,r={}){return this.model.getShortestPath(t,e,r)}getAllCellsBBox(){return this.model.getAllCellsBBox()}getCellsBBox(t,e={}){return this.model.getCellsBBox(t,e)}startBatch(t,e={}){this.model.startBatch(t,e)}stopBatch(t,e={}){this.model.stopBatch(t,e)}batchUpdate(t,e,r){const i=typeof t=="string"?t:"update",s=typeof t=="string"?e:t,o=typeof e=="function"?r:e;this.startBatch(i,o);const a=s();return this.stopBatch(i,o),a}updateCellId(t,e){return this.model.updateCellId(t,e)}findView(t){return Ae.isCell(t)?this.findViewByCell(t):this.findViewByElem(t)}findViews(t){return Bt.isRectangleLike(t)?this.findViewsInArea(t):R.isPointLike(t)?this.findViewsFromPoint(t):[]}findViewByCell(t){return this.renderer.findViewByCell(t)}findViewByElem(t){return this.renderer.findViewByElem(t)}findViewsFromPoint(t,e){const r=typeof t=="number"?{x:t,y:e}:t;return this.renderer.findViewsFromPoint(r)}findViewsInArea(t,e,r,i,s){const o=typeof t=="number"?{x:t,y:e,width:r,height:i}:t,a=typeof t=="number"?s:e;return this.renderer.findViewsInArea(o,a)}matrix(t){return typeof t>"u"?this.transform.getMatrix():(this.transform.setMatrix(t),this)}resize(t,e){const r=this.getPlugin("scroller");return r?r.resize(t,e):this.transform.resize(t,e),this}scale(t,e=t,r=0,i=0){return typeof t>"u"?this.transform.getScale():(this.transform.scale(t,e,r,i),this)}zoom(t,e){const r=this.getPlugin("scroller");if(r){if(typeof t>"u")return r.zoom();r.zoom(t,e)}else{if(typeof t>"u")return this.transform.getZoom();this.transform.zoom(t,e)}return this}zoomTo(t,e={}){const r=this.getPlugin("scroller");return r?r.zoom(t,Object.assign(Object.assign({},e),{absolute:!0})):this.transform.zoom(t,Object.assign(Object.assign({},e),{absolute:!0})),this}zoomToRect(t,e={}){const r=this.getPlugin("scroller");return r?r.zoomToRect(t,e):this.transform.zoomToRect(t,e),this}zoomToFit(t={}){const e=this.getPlugin("scroller");return e?e.zoomToFit(t):this.transform.zoomToFit(t),this}rotate(t,e,r){return typeof t>"u"?this.transform.getRotation():(this.transform.rotate(t,e,r),this)}translate(t,e){return typeof t>"u"?this.transform.getTranslation():(this.transform.translate(t,e),this)}translateBy(t,e){const r=this.translate(),i=r.tx+t,s=r.ty+e;return this.translate(i,s)}getGraphArea(){return this.transform.getGraphArea()}getContentArea(t={}){return this.transform.getContentArea(t)}getContentBBox(t={}){return this.transform.getContentBBox(t)}fitToContent(t,e,r,i){return this.transform.fitToContent(t,e,r,i)}scaleContentToFit(t={}){return this.transform.scaleContentToFit(t),this}center(t){return this.centerPoint(t)}centerPoint(t,e,r){const i=this.getPlugin("scroller");return i?i.centerPoint(t,e,r):this.transform.centerPoint(t,e),this}centerContent(t){const e=this.getPlugin("scroller");return e?e.centerContent(t):this.transform.centerContent(t),this}centerCell(t,e){const r=this.getPlugin("scroller");return r?r.centerCell(t,e):this.transform.centerCell(t),this}positionPoint(t,e,r,i={}){const s=this.getPlugin("scroller");return s?s.positionPoint(t,e,r,i):this.transform.positionPoint(t,e,r),this}positionRect(t,e,r){const i=this.getPlugin("scroller");return i?i.positionRect(t,e,r):this.transform.positionRect(t,e),this}positionCell(t,e,r){const i=this.getPlugin("scroller");return i?i.positionCell(t,e,r):this.transform.positionCell(t,e),this}positionContent(t,e){const r=this.getPlugin("scroller");return r?r.positionContent(t,e):this.transform.positionContent(t,e),this}snapToGrid(t,e){return this.coord.snapToGrid(t,e)}pageToLocal(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.pageToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.pageToLocalRect(t,e,r,i):this.coord.pageToLocalPoint(t,e)}localToPage(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.localToPageRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.localToPageRect(t,e,r,i):this.coord.localToPagePoint(t,e)}clientToLocal(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.clientToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.clientToLocalRect(t,e,r,i):this.coord.clientToLocalPoint(t,e)}localToClient(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.localToClientRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.localToClientRect(t,e,r,i):this.coord.localToClientPoint(t,e)}localToGraph(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.localToGraphRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.localToGraphRect(t,e,r,i):this.coord.localToGraphPoint(t,e)}graphToLocal(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.graphToLocalRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.graphToLocalRect(t,e,r,i):this.coord.graphToLocalPoint(t,e)}clientToGraph(t,e,r,i){return Bt.isRectangleLike(t)?this.coord.clientToGraphRect(t):typeof t=="number"&&typeof e=="number"&&typeof r=="number"&&typeof i=="number"?this.coord.clientToGraphRect(t,e,r,i):this.coord.clientToGraphPoint(t,e)}defineFilter(t){return this.defs.filter(t)}defineGradient(t){return this.defs.gradient(t)}defineMarker(t){return this.defs.marker(t)}getGridSize(){return this.grid.getGridSize()}setGridSize(t){return this.grid.setGridSize(t),this}showGrid(){return this.grid.show(),this}hideGrid(){return this.grid.hide(),this}clearGrid(){return this.grid.clear(),this}drawGrid(t){return this.grid.draw(t),this}updateBackground(){return this.background.update(),this}drawBackground(t,e){const r=this.getPlugin("scroller");return r!=null&&(this.options.background==null||!e)?r.drawBackground(t,e):this.background.draw(t),this}clearBackground(t){const e=this.getPlugin("scroller");return e!=null&&(this.options.background==null||!t)?e.clearBackground(t):this.background.clear(),this}enableVirtualRender(){return this.virtualRender.enableVirtualRender(),this}disableVirtualRender(){return this.virtualRender.disableVirtualRender(),this}isMouseWheelEnabled(){return!this.mousewheel.disabled}enableMouseWheel(){return this.mousewheel.enable(),this}disableMouseWheel(){return this.mousewheel.disable(),this}toggleMouseWheel(t){return t==null?this.isMouseWheelEnabled()?this.disableMouseWheel():this.enableMouseWheel():t?this.enableMouseWheel():this.disableMouseWheel(),this}isPannable(){const t=this.getPlugin("scroller");return t?t.isPannable():this.panning.pannable}enablePanning(){const t=this.getPlugin("scroller");return t?t.enablePanning():this.panning.enablePanning(),this}disablePanning(){const t=this.getPlugin("scroller");return t?t.disablePanning():this.panning.disablePanning(),this}togglePanning(t){return t==null?this.isPannable()?this.disablePanning():this.enablePanning():t!==this.isPannable()&&(t?this.enablePanning():this.disablePanning()),this}use(t,...e){return this.installedPlugins.has(t)||(this.installedPlugins.add(t),t.init(this,...e)),this}getPlugin(t){return Array.from(this.installedPlugins).find(e=>e.name===t)}getPlugins(t){return Array.from(this.installedPlugins).filter(e=>t.includes(e.name))}enablePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const r=this.getPlugins(e);return r==null||r.forEach(i=>{var s;(s=i==null?void 0:i.enable)===null||s===void 0||s.call(i)}),this}disablePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const r=this.getPlugins(e);return r==null||r.forEach(i=>{var s;(s=i==null?void 0:i.disable)===null||s===void 0||s.call(i)}),this}isPluginEnabled(t){var e;const r=this.getPlugin(t);return(e=r==null?void 0:r.isEnabled)===null||e===void 0?void 0:e.call(r)}disposePlugins(t){let e=t;Array.isArray(e)||(e=[e]);const r=this.getPlugins(e);return r==null||r.forEach(i=>{i.dispose(),this.installedPlugins.delete(i)}),this}dispose(t=!0){t&&this.model.dispose(),this.css.dispose(),this.defs.dispose(),this.grid.dispose(),this.coord.dispose(),this.transform.dispose(),this.highlight.dispose(),this.background.dispose(),this.mousewheel.dispose(),this.panning.dispose(),this.view.dispose(),this.renderer.dispose(),this.installedPlugins.forEach(e=>{e.dispose()})}}dI([$e.dispose()],_t.prototype,"dispose",null);(function(n){n.View=yr,n.Renderer=yh,n.MouseWheel=vh,n.DefsManager=Fv,n.GridManager=gh,n.CoordManager=Gv,n.TransformManager=Bv,n.HighlightManager=cc,n.BackgroundManager=mh,n.PanningManager=bh})(_t||(_t={}));(function(n){n.toStringTag=`X6.${n.name}`;function t(e){if(e==null)return!1;if(e instanceof n)return!0;const r=e[Symbol.toStringTag];return r==null||r===n.toStringTag}n.isGraph=t})(_t||(_t={}));(function(n){function t(e,r){const i=e instanceof HTMLElement?new n({container:e}):new n(e);return r!=null&&i.fromJSON(r),i}n.render=t})(_t||(_t={}));(function(n){n.registerNode=sn.registry.register,n.registerEdge=Ke.registry.register,n.registerView=nn.registry.register,n.registerAttr=vr.registry.register,n.registerGrid=Vr.registry.register,n.registerFilter=vs.registry.register,n.registerNodeTool=xs.registry.register,n.registerEdgeTool=ws.registry.register,n.registerBackground=Ro.registry.register,n.registerHighlighter=_r.registry.register,n.registerPortLayout=Ti.registry.register,n.registerPortLabelLayout=ys.registry.register,n.registerMarker=Kr.registry.register,n.registerRouter=$r.registry.register,n.registerConnector=Ci.registry.register,n.registerAnchor=As.registry.register,n.registerEdgeAnchor=Ss.registry.register,n.registerConnectionPoint=Ts.registry.register})(_t||(_t={}));(function(n){n.unregisterNode=sn.registry.unregister,n.unregisterEdge=Ke.registry.unregister,n.unregisterView=nn.registry.unregister,n.unregisterAttr=vr.registry.unregister,n.unregisterGrid=Vr.registry.unregister,n.unregisterFilter=vs.registry.unregister,n.unregisterNodeTool=xs.registry.unregister,n.unregisterEdgeTool=ws.registry.unregister,n.unregisterBackground=Ro.registry.unregister,n.unregisterHighlighter=_r.registry.unregister,n.unregisterPortLayout=Ti.registry.unregister,n.unregisterPortLabelLayout=ys.registry.unregister,n.unregisterMarker=Kr.registry.unregister,n.unregisterRouter=$r.registry.unregister,n.unregisterConnector=Ci.registry.unregister,n.unregisterAnchor=As.registry.unregister,n.unregisterEdgeAnchor=Ss.registry.unregister,n.unregisterConnectionPoint=Ts.registry.unregister})(_t||(_t={}));var pI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},gI=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class Os extends sn{}(function(n){class t extends sr{init(){super.init(),this.cell.on("change:*",this.onCellChangeAny,this)}onCellChangeAny({key:r}){const i=n.shapeMaps[this.cell.shape];if(i){const{effect:s}=i;(!s||s.includes(r))&&this.renderHTMLComponent()}}confirmUpdate(r){const i=super.confirmUpdate(r);return this.handleAction(i,t.action,()=>this.renderHTMLComponent())}renderHTMLComponent(){const r=this.selectors&&this.selectors.foContent;if(r){$o(r);const i=n.shapeMaps[this.cell.shape];if(!i)return;let{html:s}=i;typeof s=="function"&&(s=s(this.cell)),s&&(typeof s=="string"?r.innerHTML=s:zn(r,s))}}dispose(){this.cell.off("change:*",this.onCellChangeAny,this)}}pI([t.dispose()],t.prototype,"dispose",null),n.View=t,function(e){e.action="html",e.config({bootstrap:[e.action],actions:{html:e.action}}),sr.registry.register("html-view",e,!0)}(t=n.View||(n.View={}))})(Os||(Os={}));(function(n){n.config({view:"html-view",markup:[{tagName:"rect",selector:"body"},Object.assign({},ke.getForeignObjectMarkup()),{tagName:"text",selector:"label"}],attrs:{body:{fill:"none",stroke:"none",refWidth:"100%",refHeight:"100%"},fo:{refWidth:"100%",refHeight:"100%"}}}),sn.registry.register("html",n,!0)})(Os||(Os={}));(function(n){n.shapeMaps={};function t(e){const{shape:r,html:i,effect:s,inherit:o}=e,a=gI(e,["shape","html","effect","inherit"]);if(!r)throw new Error("should specify shape in config");n.shapeMaps[r]={html:i,effect:s},_t.registerNode(r,Object.assign({inherit:o||"html"},a),!0)}n.register=t})(Os||(Os={}));const mI=`.x6-widget-dnd {
  position: absolute;
  top: -10000px;
  left: -10000px;
  z-index: 999999;
  display: none;
  cursor: move;
  opacity: 0.7;
  pointer-events: 'cursor';
}
.x6-widget-dnd.dragging {
  display: inline-block;
}
.x6-widget-dnd.dragging * {
  pointer-events: none !important;
}
.x6-widget-dnd .x6-graph {
  background: transparent;
  box-shadow: none;
}
`;var bI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class ti extends Ce{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}get snapline(){return this.options.target.getPlugin("snapline")}constructor(t){super(),this.name="dnd",this.options=Object.assign(Object.assign({},ti.defaults),t),this.init()}init(){ks(this.name,mI),this.container=document.createElement("div"),qt(this.container,this.prefixClassName("widget-dnd")),this.draggingGraph=new _t(Object.assign(Object.assign({},this.options.delegateGraphOptions),{container:document.createElement("div"),width:1,height:1,async:!1})),zn(this.container,this.draggingGraph.container)}start(t,e){const r=e;r.preventDefault(),this.targetModel.startBatch("dnd"),qt(this.container,"dragging"),Hr(this.container,this.options.draggingContainer||document.body),this.sourceNode=t,this.prepareDragging(t,r.clientX,r.clientY);const i=this.updateNodePosition(r.clientX,r.clientY);this.isSnaplineEnabled()&&(this.snapline.captureCursorOffset({e:r,node:t,cell:t,view:this.draggingView,x:i.x,y:i.y}),this.draggingNode.on("change:position",this.snap,this)),this.delegateDocumentEvents(ti.documentEvents,r.data)}isSnaplineEnabled(){return this.snapline&&this.snapline.isEnabled()}prepareDragging(t,e,r){const i=this.draggingGraph,s=i.model,o=this.options.getDragNode(t,{sourceNode:t,draggingGraph:i,targetGraph:this.targetGraph});o.position(0,0);let a=5;if(this.isSnaplineEnabled()&&(a+=this.snapline.options.tolerance||0),this.isSnaplineEnabled()||this.options.scaled){const u=this.targetGraph.transform.getScale();i.scale(u.sx,u.sy),a*=Math.max(u.sx,u.sy)}else i.scale(1,1);this.clearDragging(),s.resetCells([o]);const c=i.findViewByCell(o);c.undelegateEvents(),c.cell.off("changed"),i.fitToContent({padding:a,allowNewOrigin:"any",useCellGeometry:!1});const l=c.getBBox();this.geometryBBox=c.getBBox({useCellGeometry:!0}),this.delta=this.geometryBBox.getTopLeft().diff(l.getTopLeft()),this.draggingNode=o,this.draggingView=c,this.draggingBBox=o.getBBox(),this.padding=a,this.originOffset=this.updateGraphPosition(e,r)}updateGraphPosition(t,e){const r=document.body.scrollTop||document.documentElement.scrollTop,i=document.body.scrollLeft||document.documentElement.scrollLeft,s=this.delta,o=this.geometryBBox,a=this.padding||5,c={left:t-s.x-o.width/2-a+i,top:e-s.y-o.height/2-a+r};return this.draggingGraph&&dn(this.container,{left:`${c.left}px`,top:`${c.top}px`}),c}updateNodePosition(t,e){const r=this.targetGraph.clientToLocal(t,e),i=this.draggingBBox;return r.x-=i.width/2,r.y-=i.height/2,this.draggingNode.position(r.x,r.y),r}snap({cell:t,current:e,options:r}){const i=t;if(r.snapped){const s=this.draggingBBox;i.position(s.x+r.tx,s.y+r.ty,{silent:!0}),this.draggingView.translate(),i.position(e.x,e.y,{silent:!0}),this.snapOffset={x:r.tx,y:r.ty}}else this.snapOffset=null}onDragging(t){const e=this.draggingView;if(e){t.preventDefault();const r=this.normalizeEvent(t),i=r.clientX,s=r.clientY;this.updateGraphPosition(i,s);const o=this.updateNodePosition(i,s),a=this.targetGraph.options.embedding.enabled,c=(a||this.isSnaplineEnabled())&&this.isInsideValidArea({x:i,y:s});if(a){e.setEventData(r,{graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView});const l=e.getEventData(r);c?e.processEmbedding(r,l):e.clearEmbedding(l),this.candidateEmbedView=l.candidateEmbedView}this.isSnaplineEnabled()&&(c?this.snapline.snapOnMoving({e:r,view:e,x:o.x,y:o.y}):this.snapline.hide())}}onDragEnd(t){const e=this.draggingNode;if(e){const r=this.normalizeEvent(t),i=this.draggingView,s=this.draggingBBox,o=this.snapOffset;let a=s.x,c=s.y;o&&(a+=o.x,c+=o.y),e.position(a,c,{silent:!0});const l=this.drop(e,{x:r.clientX,y:r.clientY}),u=f=>{f?(this.onDropped(e),this.targetGraph.options.embedding.enabled&&i&&(i.setEventData(r,{cell:f,graph:this.targetGraph,candidateEmbedView:this.candidateEmbedView}),i.finalizeEmbedding(r,i.getEventData(r)))):this.onDropInvalid(),this.candidateEmbedView=null,this.targetModel.stopBatch("dnd")};mu(l)?(this.undelegateDocumentEvents(),l.then(u)):u(l)}}clearDragging(){this.draggingNode&&(this.sourceNode=null,this.draggingNode.remove(),this.draggingNode=null,this.draggingView=null,this.delta=null,this.padding=null,this.snapOffset=null,this.originOffset=null,this.undelegateDocumentEvents())}onDropped(t){this.draggingNode===t&&(this.clearDragging(),Fe(this.container,"dragging"),Yn(this.container))}onDropInvalid(){const t=this.draggingNode;t&&this.onDropped(t)}isInsideValidArea(t){let e,r=null;const i=this.targetGraph,s=this.targetScroller;this.options.dndContainer&&(r=this.getDropArea(this.options.dndContainer));const o=r&&r.containsPoint(t);if(s)if(s.options.autoResize)e=this.getDropArea(s.container);else{const a=this.getDropArea(s.container);e=this.getDropArea(i.container).intersectsWithRect(a)}else e=this.getDropArea(i.container);return!o&&e&&e.containsPoint(t)}getDropArea(t){const e=wu(t),r=document.body.scrollTop||document.documentElement.scrollTop,i=document.body.scrollLeft||document.documentElement.scrollLeft;return Bt.create({x:e.left+parseInt(dn(t,"border-left-width"),10)-i,y:e.top+parseInt(dn(t,"border-top-width"),10)-r,width:t.clientWidth,height:t.clientHeight})}drop(t,e){if(this.isInsideValidArea(e)){const r=this.targetGraph,i=r.model,s=r.clientToLocal(e),o=this.sourceNode,a=this.options.getDropNode(t,{sourceNode:o,draggingNode:t,targetGraph:this.targetGraph,draggingGraph:this.draggingGraph}),c=a.getBBox();s.x+=c.x-c.width/2,s.y+=c.y-c.height/2;const l=this.snapOffset?1:r.getGridSize();a.position(_e.snapToGrid(s.x,l),_e.snapToGrid(s.y,l)),a.removeZIndex();const u=this.options.validateNode,f=u?u(a,{sourceNode:o,draggingNode:t,droppingNode:a,targetGraph:r,draggingGraph:this.draggingGraph}):!0;return typeof f=="boolean"?f?(i.addCell(a,{stencil:this.cid}),a):null:lM(f).then(h=>h?(i.addCell(a,{stencil:this.cid}),a):null)}return null}onRemove(){this.draggingGraph&&(this.draggingGraph.view.remove(),this.draggingGraph.dispose())}dispose(){this.remove(),Bs(this.name)}}bI([Ce.dispose()],ti.prototype,"dispose",null);(function(n){n.defaults={getDragNode:t=>t.clone(),getDropNode:t=>t.clone()},n.documentEvents={mousemove:"onDragging",touchmove:"onDragging",mouseup:"onDragEnd",touchend:"onDragEnd",touchcancel:"onDragEnd"}})(ti||(ti={}));function vI(n,t={}){const e=pn.isModel(n)?n:new pn().resetCells(n,{sort:!1,dryrun:!0}),r=e.getNodes(),i=t.columns||1,s=Math.ceil(r.length/i),o=t.dx||0,a=t.dy||0,c=t.center!==!1,l=t.resizeToFit===!0,u=t.marginX||0,f=t.marginY||0,h=[];let d=t.columnWidth;if(d==="compact")for(let E=0;E<i;E+=1){const y=pr.getNodesInColumn(r,E,i);h.push(pr.getMaxDim(y,"width")+o)}else{(d==null||d==="auto")&&(d=pr.getMaxDim(r,"width")+o);for(let E=0;E<i;E+=1)h.push(d)}const p=pr.accumulate(h,u),m=[];let b=t.rowHeight;if(b==="compact")for(let E=0;E<s;E+=1){const y=pr.getNodesInRow(r,E,i);m.push(pr.getMaxDim(y,"height")+a)}else{(b==null||b==="auto")&&(b=pr.getMaxDim(r,"height")+a);for(let E=0;E<s;E+=1)m.push(b)}const v=pr.accumulate(m,f);e.startBatch("layout"),r.forEach((E,y)=>{const O=y%i,I=Math.floor(y/i),G=h[O],k=m[I];let X=0,Z=0,at=E.getSize();if(l){let ft=G-2*o,H=k-2*a;const Ut=at.height*(at.width?ft/at.width:1),zt=at.width*(at.height?H/at.height:1);k<Ut?ft=zt:H=Ut,at={width:ft,height:H},E.setSize(at,t)}c&&(X=(G-at.width)/2,Z=(k-at.height)/2),E.position(p[O]+o+X,v[I]+a+Z,t)}),e.stopBatch("layout")}var pr;(function(n){function t(s,o){return s.reduce((a,c)=>Math.max(c==null?void 0:c.getSize()[o],a),0)}n.getMaxDim=t;function e(s,o,a){const c=[];for(let l=a*o,u=l+a;l<u;l+=1)s[l]&&c.push(s[l]);return c}n.getNodesInRow=e;function r(s,o,a){const c=[];for(let l=o,u=s.length;l<u;l+=a)s[l]&&c.push(s[l]);return c}n.getNodesInColumn=r;function i(s,o){return s.reduce((a,c,l)=>(a.push(a[l]+c),a),[o||0])}n.accumulate=i})(pr||(pr={}));const yI=`.x6-widget-dnd {
  position: absolute;
  top: -10000px;
  left: -10000px;
  z-index: 999999;
  display: none;
  cursor: move;
  opacity: 0.7;
  pointer-events: 'cursor';
}
.x6-widget-dnd.dragging {
  display: inline-block;
}
.x6-widget-dnd.dragging * {
  pointer-events: none !important;
}
.x6-widget-dnd .x6-graph {
  background: transparent;
  box-shadow: none;
}
.x6-widget-stencil {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
}
.x6-widget-stencil::after {
  position: absolute;
  top: 0;
  display: block;
  width: 100%;
  height: 20px;
  padding: 8px 0;
  line-height: 20px;
  text-align: center;
  opacity: 0;
  transition: top 0.1s linear, opacity 0.1s linear;
  content: ' ';
  pointer-events: none;
}
.x6-widget-stencil-content {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  height: auto;
  overflow-x: hidden;
  overflow-y: auto;
}
.x6-widget-stencil .x6-node [magnet]:not([magnet='passive']) {
  pointer-events: none;
}
.x6-widget-stencil-group {
  padding: 0;
  padding-bottom: 8px;
  overflow: hidden;
  user-select: none;
}
.x6-widget-stencil-group.collapsed {
  height: auto;
  padding-bottom: 0;
}
.x6-widget-stencil-group-title {
  position: relative;
  margin-top: 0;
  margin-bottom: 0;
  padding: 4px;
  cursor: pointer;
}
.x6-widget-stencil-title,
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  user-select: none;
}
.x6-widget-stencil .unmatched {
  opacity: 0.3;
}
.x6-widget-stencil .x6-node.unmatched {
  display: none;
}
.x6-widget-stencil-group.unmatched {
  display: none;
}
.x6-widget-stencil-search-text {
  position: relative;
  z-index: 1;
  box-sizing: border-box;
  width: 100%;
  height: 30px;
  max-height: 30px;
  line-height: 30px;
  outline: 0;
}
.x6-widget-stencil.not-found::after {
  opacity: 1;
  content: attr(data-not-found-text);
}
.x6-widget-stencil.not-found.searchable::after {
  top: 30px;
}
.x6-widget-stencil.not-found.searchable.collapsable::after {
  top: 50px;
}
.x6-widget-stencil {
  color: #333;
  background: #f5f5f5;
}
.x6-widget-stencil-content {
  position: absolute;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-content {
  top: 32px;
}
.x6-widget-stencil.searchable > .x6-widget-stencil-content {
  top: 80px;
}
.x6-widget-stencil.not-found::after {
  position: absolute;
}
.x6-widget-stencil.not-found.searchable.collapsable::after {
  top: 80px;
}
.x6-widget-stencil.not-found.searchable::after {
  top: 60px;
}
.x6-widget-stencil-group {
  height: auto;
  margin-bottom: 1px;
  padding: 0;
  transition: none;
}
.x6-widget-stencil-group .x6-graph {
  background: transparent;
  box-shadow: none;
}
.x6-widget-stencil-group.collapsed {
  height: auto;
  max-height: 31px;
}
.x6-widget-stencil-title,
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  position: relative;
  left: 0;
  box-sizing: border-box;
  width: 100%;
  height: 32px;
  padding: 0 5px 0 8px;
  color: #666;
  font-weight: 700;
  font-size: 12px;
  line-height: 32px;
  cursor: default;
  transition: all 0.3;
}
.x6-widget-stencil-title:hover,
.x6-widget-stencil-group > .x6-widget-stencil-group-title:hover {
  color: #444;
}
.x6-widget-stencil-title {
  background: #e9e9e9;
}
.x6-widget-stencil-group > .x6-widget-stencil-group-title {
  background: #ededed;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title {
  padding-left: 32px;
  cursor: pointer;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {
  position: absolute;
  top: 6px;
  left: 8px;
  display: block;
  width: 18px;
  height: 18px;
  margin: 0;
  padding: 0;
  background-color: transparent;
  background-repeat: no-repeat;
  background-position: 0 0;
  border: none;
  content: ' ';
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title::before {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48L2c+PC9zdmc+');
  opacity: 0.4;
  transition: all 0.3s;
}
.x6-widget-stencil.collapsable > .x6-widget-stencil-title:hover::before,
.x6-widget-stencil-group.collapsable > .x6-widget-stencil-group-title:hover::before {
  opacity: 0.6;
}
.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title::before,
.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title::before {
  background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIj48cGF0aCBkPSJNOS4zNzUuNUM0LjY4Ny41Ljg3NSA0LjMxMy44NzUgOWMwIDQuNjg4IDMuODEyIDguNSA4LjUgOC41IDQuNjg3IDAgOC41LTMuODEyIDguNS04LjUgMC00LjY4Ny0zLjgxMy04LjUtOC41LTguNXptMCAxNS44ODZDNS4zMDMgMTYuMzg2IDEuOTkgMTMuMDcyIDEuOTkgOXMzLjMxMi03LjM4NSA3LjM4NS03LjM4NVMxNi43NiA0LjkyOCAxNi43NiA5YzAgNC4wNzItMy4zMTMgNy4zODYtNy4zODUgNy4zODZ6Ii8+PHBhdGggZD0iTTEyLjc1MyA4LjQ0M0g1Ljk5N2EuNTU4LjU1OCAwIDAwMCAxLjExNmg2Ljc1NmEuNTU4LjU1OCAwIDAwMC0xLjExNnoiLz48cGF0aCBkPSJNOC44MTcgNS42MjN2Ni43NTZhLjU1OC41NTggMCAwMDEuMTE2IDBWNS42MjNhLjU1OC41NTggMCAxMC0xLjExNiAweiIvPjwvZz48L3N2Zz4=');
  opacity: 0.4;
}
.x6-widget-stencil.collapsable.collapsed > .x6-widget-stencil-title:hover::before,
.x6-widget-stencil-group.collapsable.collapsed > .x6-widget-stencil-group-title:hover::before {
  opacity: 0.6;
}
.x6-widget-stencil input[type='search'] {
  appearance: textfield;
}
.x6-widget-stencil input[type='search']::-webkit-search-cancel-button,
.x6-widget-stencil input[type='search']::-webkit-search-decoration {
  appearance: none;
}
.x6-widget-stencil-search-text {
  display: block;
  width: 90%;
  margin: 8px 5%;
  padding-left: 8px;
  color: #333;
  background: #fff;
  border: 1px solid #e9e9e9;
  border-radius: 12px;
  outline: 0;
}
.x6-widget-stencil-search-text:focus {
  outline: 0;
}
.x6-widget-stencil::after {
  color: #808080;
  font-weight: 600;
  font-size: 12px;
  background: 0 0;
}
`;var EI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Bo extends Ce{get targetScroller(){return this.options.target.getPlugin("scroller")}get targetGraph(){return this.options.target}get targetModel(){return this.targetGraph.model}constructor(t={}){super(),this.name="stencil",ks(this.name,yI),this.graphs={},this.groups={},this.options=Object.assign(Object.assign({},Bo.defaultOptions),t),this.init()}init(){this.dnd=new ti(this.options),this.onSearch=Dx(this.onSearch,200),this.initContainer(),this.initSearch(),this.initContent(),this.initGroups(),this.setTitle(),this.startListening()}load(t,e){return Array.isArray(t)?this.loadGroup(t,e):this.options.groups&&Object.keys(this.options.groups).forEach(r=>{t[r]&&this.loadGroup(t[r],r)}),this}unload(t,e){return Array.isArray(t)?this.loadGroup(t,e,!0):this.options.groups&&Object.keys(this.options.groups).forEach(r=>{t[r]&&this.loadGroup(t[r],r,!0)}),this}toggleGroup(t){return this.isGroupCollapsed(t)?this.expandGroup(t):this.collapseGroup(t),this}collapseGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&!this.isGroupCollapsed(t)&&(this.trigger("group:collapse",{name:t}),qt(e,"collapsed"))}return this}expandGroup(t){if(this.isGroupCollapsable(t)){const e=this.groups[t];e&&this.isGroupCollapsed(t)&&(this.trigger("group:expand",{name:t}),Fe(e,"collapsed"))}return this}isGroupCollapsable(t){const e=this.groups[t];return gr(e,"collapsable")}isGroupCollapsed(t){const e=this.groups[t];return e&&gr(e,"collapsed")}collapseGroups(){return Object.keys(this.groups).forEach(t=>this.collapseGroup(t)),this}expandGroups(){return Object.keys(this.groups).forEach(t=>this.expandGroup(t)),this}resizeGroup(t,e){const r=this.graphs[t];return r&&r.resize(e.width,e.height),this}addGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups?this.options.groups.push(...e):this.options.groups=e,e.forEach(r=>this.initGroup(r))}removeGroup(t){const e=Array.isArray(t)?t:[t];this.options.groups&&(this.options.groups=this.options.groups.filter(r=>!e.includes(r.name)),e.forEach(r=>{const i=this.graphs[r];this.unregisterGraphEvents(i),i.dispose(),delete this.graphs[r];const s=this.groups[r];Yn(s),delete this.groups[r]}))}initContainer(){this.container=document.createElement("div"),qt(this.container,this.prefixClassName(Dn.base)),ye(this.container,"data-not-found-text",this.options.notFoundText||"No matches found")}initContent(){this.content=document.createElement("div"),qt(this.content,this.prefixClassName(Dn.content)),Hr(this.content,this.container)}initSearch(){this.options.search&&(qt(this.container,"searchable"),zn(this.container,this.renderSearch()))}initGroup(t){const e=this.options.stencilGraphOptions||{},r=document.createElement("div");qt(r,this.prefixClassName(Dn.group)),ye(r,"data-name",t.name),(t.collapsable==null&&this.options.collapsable||t.collapsable!==!1)&&qt(r,"collapsable"),er(r,"collapsed",t.collapsed===!0);const i=document.createElement("h3");qt(i,this.prefixClassName(Dn.groupTitle)),i.innerHTML=t.title||t.name;const s=document.createElement("div");qt(s,this.prefixClassName(Dn.groupContent));const o=t.graphOptions,a=new _t(Object.assign(Object.assign(Object.assign({},e),o),{container:document.createElement("div"),model:e.model||new pn,width:t.graphWidth||this.options.stencilGraphWidth,height:t.graphHeight||this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));this.registerGraphEvents(a),zn(s,a.container),zn(r,[i,s]),Hr(r,this.content),this.groups[t.name]=r,this.graphs[t.name]=a}initGroups(){if(this.clearGroups(),this.setCollapsableState(),this.options.groups&&this.options.groups.length)this.options.groups.forEach(t=>{this.initGroup(t)});else{const t=this.options.stencilGraphOptions||{},e=new _t(Object.assign(Object.assign({},t),{container:document.createElement("div"),model:t.model||new pn,width:this.options.stencilGraphWidth,height:this.options.stencilGraphHeight,interacting:!1,preventDefaultBlankAction:!1}));zn(this.content,e.container),this.graphs[vo.defaultGroupName]=e}}setCollapsableState(){this.options.collapsable=this.options.collapsable&&this.options.groups&&this.options.groups.some(t=>t.collapsable!==!1),this.options.collapsable?(qt(this.container,"collapsable"),this.options.groups&&this.options.groups.every(e=>e.collapsed||e.collapsable===!1)?qt(this.container,"collapsed"):Fe(this.container,"collapsed")):Fe(this.container,"collapsable")}setTitle(){const t=document.createElement("div");qt(t,this.prefixClassName(Dn.title)),t.innerHTML=this.options.title,Hr(t,this.container)}renderSearch(){const t=document.createElement("div");qt(t,this.prefixClassName(Dn.search));const e=document.createElement("input");return ye(e,{type:"search",placeholder:this.options.placeholder||"Search"}),qt(e,this.prefixClassName(Dn.searchText)),zn(t,e),t}startListening(){const t=this.prefixClassName(Dn.title),e=this.prefixClassName(Dn.searchText),r=this.prefixClassName(Dn.groupTitle);this.delegateEvents({[`click .${t}`]:"onTitleClick",[`touchstart .${t}`]:"onTitleClick",[`click .${r}`]:"onGroupTitleClick",[`touchstart .${r}`]:"onGroupTitleClick",[`input .${e}`]:"onSearch",[`focusin .${e}`]:"onSearchFocusIn",[`focusout .${e}`]:"onSearchFocusOut"})}stopListening(){this.undelegateEvents()}registerGraphEvents(t){t.on("cell:mousedown",this.onDragStart,this)}unregisterGraphEvents(t){t.off("cell:mousedown",this.onDragStart,this)}loadGroup(t,e,r){const i=this.getModel(e);if(i){const c=t.map(l=>sn.isNode(l)?l:sn.create(l));r===!0?i.removeCells(c):i.resetCells(c)}const s=this.getGroup(e);let o=this.options.stencilGraphHeight;s&&s.graphHeight!=null&&(o=s.graphHeight);const a=s&&s.layout||this.options.layout;if(a&&i&&Qt(a,this,i,s),!o){const c=this.getGraph(e);c.fitToContent({minWidth:c.options.width,gridHeight:1,padding:s&&s.graphPadding||this.options.stencilGraphPadding||10})}return this}onDragStart(t){const{e,node:r}=t,i=this.getGroupByNode(r);i&&i.nodeMovable===!1||this.dnd.start(r,e)}filter(t,e){const r=Object.keys(this.graphs).reduce((i,s)=>{const o=this.graphs[s],a=s===vo.defaultGroupName?null:s,c=o.model.getNodes().filter(h=>{let d=!1;typeof e=="function"?d=Qt(e,this,h,t,a,this):typeof e=="boolean"?d=e:d=this.isCellMatched(h,t,e,t.toLowerCase()!==t);const p=o.renderer.findViewByCell(h);return p&&er(p.container,"unmatched",!d),d}),l=c.length>0,u=this.options,f=new pn;return f.resetCells(c),u.layout&&Qt(u.layout,this,f,this.getGroup(s)),this.groups[s]&&er(this.groups[s],"unmatched",!l),o.fitToContent({gridWidth:1,gridHeight:1,padding:u.stencilGraphPadding||10}),i||l},!1);er(this.container,"not-found",!r)}isCellMatched(t,e,r,i){return e&&r?Object.keys(r).some(s=>{if(s==="*"||t.shape===s){const o=r[s];return typeof o=="boolean"?o:(Array.isArray(o)?o:[o]).some(c=>{let l=t.getPropByPath(c);return l!=null?(l=`${l}`,i||(l=l.toLowerCase()),l.indexOf(e)>=0):!1})}return!1}):!0}onSearch(t){this.filter(t.target.value,this.options.search)}onSearchFocusIn(){qt(this.container,"is-focused")}onSearchFocusOut(){Fe(this.container,"is-focused")}onTitleClick(){this.options.collapsable&&(er(this.container,"collapsed"),gr(this.container,"collapsed")?this.collapseGroups():this.expandGroups())}onGroupTitleClick(t){const e=t.target.closest(`.${this.prefixClassName(Dn.group)}`);e&&this.toggleGroup(ye(e,"data-name")||"");const r=Object.keys(this.groups).every(i=>{const s=this.getGroup(i),o=this.groups[i];return s&&s.collapsable===!1||gr(o,"collapsed")});er(this.container,"collapsed",r)}getModel(t){const e=this.getGraph(t);return e?e.model:null}getGraph(t){return this.graphs[t||vo.defaultGroupName]}getGroup(t){const e=this.options.groups;return t!=null&&e&&e.length?e.find(r=>r.name===t):null}getGroupByNode(t){const e=this.options.groups;return e?e.find(r=>{const i=this.getModel(r.name);return i?i.has(t.id):!1}):null}clearGroups(){Object.keys(this.graphs).forEach(t=>{const e=this.graphs[t];this.unregisterGraphEvents(e),e.dispose()}),Object.keys(this.groups).forEach(t=>{const e=this.groups[t];Yn(e)}),this.graphs={},this.groups={}}onRemove(){this.clearGroups(),this.dnd.remove(),this.stopListening(),this.undelegateDocumentEvents()}dispose(){this.remove(),Bs(this.name)}}EI([Ce.dispose()],Bo.prototype,"dispose",null);(function(n){n.defaultOptions=Object.assign({stencilGraphWidth:200,stencilGraphHeight:800,title:"Stencil",collapsable:!1,placeholder:"Search",notFoundText:"No matches found",layout(t,e){const r={columnWidth:this.options.stencilGraphWidth/2-10,columns:2,rowHeight:80,resizeToFit:!1,dx:10,dy:10};vI(t,Object.assign(Object.assign(Object.assign({},r),this.options.layoutOptions),e?e.layoutOptions:{}))}},ti.defaults)})(Bo||(Bo={}));var Dn;(function(n){n.base="widget-stencil",n.title=`${n.base}-title`,n.search=`${n.base}-search`,n.searchText=`${n.search}-text`,n.content=`${n.base}-content`,n.group=`${n.base}-group`,n.groupTitle=`${n.group}-title`,n.groupContent=`${n.group}-content`})(Dn||(Dn={}));var vo;(function(n){n.defaultGroupName="__default__"})(vo||(vo={}));var xI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Uv extends Ce{get model(){return this.graph.model}get view(){return this.graph.renderer.findViewByCell(this.node)}get containerClassName(){return this.prefixClassName("widget-transform")}get resizeClassName(){return`${this.containerClassName}-resize`}get rotateClassName(){return`${this.containerClassName}-rotate`}constructor(t,e,r){super(),this.node=e,this.graph=r,this.options=Object.assign(Object.assign({},hn.defaultOptions),t),this.render(),this.startListening()}startListening(){this.delegateEvents({[`mousedown .${this.resizeClassName}`]:"startResizing",[`touchstart .${this.resizeClassName}`]:"startResizing",[`mousedown .${this.rotateClassName}`]:"startRotating",[`touchstart .${this.rotateClassName}`]:"startRotating"}),this.model.on("*",this.update,this),this.graph.on("scale",this.update,this),this.graph.on("translate",this.update,this),this.node.on("removed",this.remove,this),this.model.on("reseted",this.remove,this),this.view.on("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.on("cell:knob:mouseup",this.onKnobMouseUp,this)}stopListening(){this.undelegateEvents(),this.model.off("*",this.update,this),this.graph.off("scale",this.update,this),this.graph.off("translate",this.update,this),this.node.off("removed",this.remove,this),this.model.off("reseted",this.remove,this),this.view.off("cell:knob:mousedown",this.onKnobMouseDown,this),this.view.off("cell:knob:mouseup",this.onKnobMouseUp,this)}renderHandles(){this.container=document.createElement("div");const t=document.createElement("div");ye(t,"draggable","false");const e=t.cloneNode(!0);qt(e,this.rotateClassName);const r=hn.POSITIONS.map(i=>{const s=t.cloneNode(!0);return qt(s,this.resizeClassName),ye(s,"data-position",i),s});this.empty(),zn(this.container,[...r,e])}render(){return this.renderHandles(),this.view&&this.view.addClass(hn.NODE_CLS),qt(this.container,this.containerClassName),er(this.container,"no-orth-resize",this.options.preserveAspectRatio||!this.options.orthogonalResizing),er(this.container,"no-resize",!this.options.resizable),er(this.container,"no-rotate",!this.options.rotatable),this.options.className&&qt(this.container,this.options.className),this.graph.container.appendChild(this.container),this.update()}update(){const t=this.graph.matrix(),e=this.node.getBBox();e.x*=t.a,e.x+=t.e,e.y*=t.d,e.y+=t.f,e.width*=t.a,e.height*=t.d;const r=Te.normalize(this.node.getAngle()),i=r!==0?`rotate(${r}deg)`:"";return dn(this.container,{transform:i,width:e.width,height:e.height,left:e.x,top:e.y}),this.updateResizerDirections(),this}remove(){return this.view&&this.view.removeClass(hn.NODE_CLS),super.remove()}onKnobMouseDown(){this.startHandle()}onKnobMouseUp(){this.stopHandle()}updateResizerDirections(){const t=Te.normalize(this.node.getAngle()),e=Math.floor(t*(hn.DIRECTIONS.length/360));if(e!==this.prevShift){const r=hn.DIRECTIONS.slice(e).concat(hn.DIRECTIONS.slice(0,e)),i=o=>`${this.containerClassName}-cursor-${o}`;this.container.querySelectorAll(`.${this.resizeClassName}`).forEach((o,a)=>{Fe(o,hn.DIRECTIONS.map(c=>i(c)).join(" ")),qt(o,i(r[a]))}),this.prevShift=e}}getTrueDirection(t){const e=Te.normalize(this.node.getAngle());let r=hn.POSITIONS.indexOf(t);return r+=Math.floor(e*(hn.POSITIONS.length/360)),r%=hn.POSITIONS.length,hn.POSITIONS[r]}toValidResizeDirection(t){return{top:"top-left",bottom:"bottom-right",left:"bottom-left",right:"top-right"}[t]||t}startResizing(t){t.stopPropagation(),this.model.startBatch("resize",{cid:this.cid});const e=ye(t.target,"data-position");this.prepareResizing(t,e),this.startAction(t)}prepareResizing(t,e){const r=this.getTrueDirection(e);let i=0,s=0;e.split("-").forEach(l=>{i={left:-1,right:1}[l]||i,s={top:-1,bottom:1}[l]||s});const o=this.toValidResizeDirection(e),a={"top-right":"bottomLeft","top-left":"bottomRight","bottom-left":"topRight","bottom-right":"topLeft"}[o],c=Te.normalize(this.node.getAngle());this.setEventData(t,{selector:a,direction:o,trueDirection:r,relativeDirection:e,angle:c,resizeX:i,resizeY:s,action:"resizing"})}startRotating(t){t.stopPropagation(),this.model.startBatch("rotate",{cid:this.cid});const e=this.node.getBBox().getCenter(),r=this.normalizeEvent(t),i=this.graph.snapToGrid(r.clientX,r.clientY);this.setEventData(t,{center:e,action:"rotating",angle:Te.normalize(this.node.getAngle()),start:R.create(i).theta(e)}),this.startAction(t)}onMouseMove(t){const e=this.graph.findViewByCell(this.node);let r=this.getEventData(t);if(r.action){const i=this.normalizeEvent(t);let s=i.clientX,o=i.clientY;const a=this.graph.getPlugin("scroller"),c=this.options.restrictedResizing;if(c===!0||typeof c=="number"){const d=c===!0?0:c,p=a?Math.max(d,8):d,m=this.graph.container.getBoundingClientRect();s=Bn(s,m.left+p,m.right-p),o=Bn(o,m.top+p,m.bottom-p)}else this.options.autoScrollOnResizing&&a&&a.autoScroll(s,o);const l=this.graph.snapToGrid(s,o),u=this.graph.getGridSize(),f=this.node,h=this.options;if(r.action==="resizing"){r=r,r.resized||(e&&(e.addClass("node-resizing"),this.notify("node:resize",t,e)),r.resized=!0);const d=f.getBBox(),p=R.create(l).rotate(r.angle,d.getCenter()).diff(d[r.selector]);let m=r.resizeX?p.x*r.resizeX:d.width,b=r.resizeY?p.y*r.resizeY:d.height;const v=m,E=b;if(m=_e.snapToGrid(m,u),b=_e.snapToGrid(b,u),m=Math.max(m,h.minWidth||u),b=Math.max(b,h.minHeight||u),m=Math.min(m,h.maxWidth||1/0),b=Math.min(b,h.maxHeight||1/0),h.preserveAspectRatio){const O=d.width*b/d.height,I=d.height*m/d.width;m<O?b=I:m=O}const y=r.relativeDirection;if(h.allowReverse&&(v<=-m||E<=-b)){let O;y==="left"?v<=-m&&(O="right"):y==="right"?v<=-m&&(O="left"):y==="top"?E<=-b&&(O="bottom"):y==="bottom"?E<=-b&&(O="top"):y==="top-left"?v<=-m&&E<=-b?O="bottom-right":v<=-m?O="top-right":E<=-b&&(O="bottom-left"):y==="top-right"?v<=-m&&E<=-b?O="bottom-left":v<=-m?O="top-left":E<=-b&&(O="bottom-right"):y==="bottom-left"?v<=-m&&E<=-b?O="top-right":v<=-m?O="bottom-right":E<=-b&&(O="top-left"):y==="bottom-right"&&(v<=-m&&E<=-b?O="top-left":v<=-m?O="bottom-left":E<=-b&&(O="top-right"));const I=O;this.stopHandle();const G=this.container.querySelector(`.${this.resizeClassName}[data-position="${I}"]`);this.startHandle(G),this.prepareResizing(t,I),this.onMouseMove(t)}if(d.width!==m||d.height!==b){const O={ui:!0,direction:r.direction,relativeDirection:r.relativeDirection,trueDirection:r.trueDirection,minWidth:h.minWidth,minHeight:h.minHeight,maxWidth:h.maxWidth,maxHeight:h.maxHeight,preserveAspectRatio:h.preserveAspectRatio===!0};f.resize(m,b,O),this.notify("node:resizing",t,e)}}else if(r.action==="rotating"){r=r,r.rotated||(e&&(e.addClass("node-rotating"),this.notify("node:rotate",t,e)),r.rotated=!0);const d=f.getAngle(),p=r.start-R.create(l).theta(r.center);let m=r.angle+p;h.rotateGrid&&(m=_e.snapToGrid(m,h.rotateGrid)),m=Te.normalize(m),d!==m&&(f.rotate(m,{absolute:!0}),this.notify("node:rotating",t,e))}}}onMouseUp(t){const e=this.getEventData(t);e.action&&(this.stopAction(t),this.model.stopBatch(e.action==="resizing"?"resize":"rotate",{cid:this.cid}))}startHandle(t){if(this.handle=t||null,qt(this.container,`${this.containerClassName}-active`),t){qt(t,`${this.containerClassName}-active-handle`);const e=t.getAttribute("data-position");if(e){const r=hn.DIRECTIONS[hn.POSITIONS.indexOf(e)];qt(this.container,`${this.containerClassName}-cursor-${r}`)}}}stopHandle(){if(Fe(this.container,`${this.containerClassName}-active`),this.handle){Fe(this.handle,`${this.containerClassName}-active-handle`);const t=this.handle.getAttribute("data-position");if(t){const e=hn.DIRECTIONS[hn.POSITIONS.indexOf(t)];Fe(this.container,`${this.containerClassName}-cursor-${e}`)}this.handle=null}}startAction(t){this.startHandle(t.target),this.graph.view.undelegateEvents(),this.delegateDocumentEvents(hn.documentEvents,t.data)}stopAction(t){this.stopHandle(),this.undelegateDocumentEvents(),this.graph.view.delegateEvents();const e=this.graph.findViewByCell(this.node),r=this.getEventData(t);e&&(e.removeClass(`node-${r.action}`),r.action==="resizing"&&r.resized?this.notify("node:resized",t,e):r.action==="rotating"&&r.rotated&&this.notify("node:rotated",t,e))}notify(t,e,r,i={}){if(r){const s=r.graph,o=s.view.normalizeEvent(e),a=s.snapToGrid(o.clientX,o.clientY);this.trigger(t,Object.assign({e:o,view:r,node:r.cell,cell:r.cell,x:a.x,y:a.y},i))}}dispose(){this.stopListening(),this.remove(),this.off()}}xI([Ce.dispose()],Uv.prototype,"dispose",null);var hn;(function(n){n.NODE_CLS="has-widget-transform",n.DIRECTIONS=["nw","n","ne","e","se","s","sw","w"],n.POSITIONS=["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"],n.documentEvents={mousemove:"onMouseMove",touchmove:"onMouseMove",mouseup:"onMouseUp",touchend:"onMouseUp"},n.defaultOptions={minWidth:0,minHeight:0,maxWidth:1/0,maxHeight:1/0,rotateGrid:15,rotatable:!0,preserveAspectRatio:!1,orthogonalResizing:!0,restrictedResizing:!1,autoScrollOnResizing:!0,allowReverse:!0}})(hn||(hn={}));const wI=`.x6-widget-transform {
  position: absolute;
  box-sizing: content-box !important;
  margin: -5px 0 0 -5px;
  padding: 4px;
  border: 1px dashed #000;
  border-radius: 5px;
  user-select: none;
  pointer-events: none;
}
.x6-widget-transform > div {
  position: absolute;
  box-sizing: border-box;
  background-color: #fff;
  border: 1px solid #000;
  transition: background-color 0.2s;
  pointer-events: auto;
  -webkit-user-drag: none;
  user-drag: none;
  /* stylelint-disable-line */
}
.x6-widget-transform > div:hover {
  background-color: #d3d3d3;
}
.x6-widget-transform-cursor-n {
  cursor: n-resize;
}
.x6-widget-transform-cursor-s {
  cursor: s-resize;
}
.x6-widget-transform-cursor-e {
  cursor: e-resize;
}
.x6-widget-transform-cursor-w {
  cursor: w-resize;
}
.x6-widget-transform-cursor-ne {
  cursor: ne-resize;
}
.x6-widget-transform-cursor-nw {
  cursor: nw-resize;
}
.x6-widget-transform-cursor-se {
  cursor: se-resize;
}
.x6-widget-transform-cursor-sw {
  cursor: sw-resize;
}
.x6-widget-transform-resize {
  width: 10px;
  height: 10px;
  border-radius: 6px;
}
.x6-widget-transform-resize[data-position='top-left'] {
  top: -5px;
  left: -5px;
}
.x6-widget-transform-resize[data-position='top-right'] {
  top: -5px;
  right: -5px;
}
.x6-widget-transform-resize[data-position='bottom-left'] {
  bottom: -5px;
  left: -5px;
}
.x6-widget-transform-resize[data-position='bottom-right'] {
  right: -5px;
  bottom: -5px;
}
.x6-widget-transform-resize[data-position='top'] {
  top: -5px;
  left: 50%;
  margin-left: -5px;
}
.x6-widget-transform-resize[data-position='bottom'] {
  bottom: -5px;
  left: 50%;
  margin-left: -5px;
}
.x6-widget-transform-resize[data-position='left'] {
  top: 50%;
  left: -5px;
  margin-top: -5px;
}
.x6-widget-transform-resize[data-position='right'] {
  top: 50%;
  right: -5px;
  margin-top: -5px;
}
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='top'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='bottom'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='left'],
.x6-widget-transform.prevent-aspect-ratio .x6-widget-transform-resize[data-position='right'] {
  display: none;
}
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='bottom'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='left'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='right'],
.x6-widget-transform.no-orth-resize .x6-widget-transform-resize[data-position='top'] {
  display: none;
}
.x6-widget-transform.no-resize .x6-widget-transform-resize {
  display: none;
}
.x6-widget-transform-rotate {
  top: -20px;
  left: -20px;
  width: 12px;
  height: 12px;
  border-radius: 6px;
  cursor: crosshair;
}
.x6-widget-transform.no-rotate .x6-widget-transform-rotate {
  display: none;
}
.x6-widget-transform-active {
  border-color: transparent;
  pointer-events: all;
}
.x6-widget-transform-active > div {
  display: none;
}
.x6-widget-transform-active > .x6-widget-transform-active-handle {
  display: block;
  background-color: #808080;
}
`;_t.prototype.createTransformWidget=function(n){const t=this.getPlugin("transform");return t&&t.createWidget(n),this};_t.prototype.clearTransformWidgets=function(){const n=this.getPlugin("transform");return n&&n.clearWidgets(),this};var AI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Ms extends $e{constructor(t={}){super(),this.name="transform",this.widgets=new Map,this.disabled=!1,this.options=t,ks(this.name,wI)}init(t){this.graph=t,!this.disabled&&this.startListening()}startListening(){this.graph.on("node:click",this.onNodeClick,this),this.graph.on("blank:mousedown",this.onBlankMouseDown,this)}stopListening(){this.graph.off("node:click",this.onNodeClick,this),this.graph.off("blank:mousedown",this.onBlankMouseDown,this)}enable(){this.disabled&&(this.disabled=!1,this.startListening())}disable(){this.disabled||(this.disabled=!0,this.stopListening())}isEnabled(){return!this.disabled}createWidget(t){this.clearWidgets();const e=this.createTransform(t);e&&(this.widgets.set(t,e),e.on("*",(r,i)=>{this.trigger(r,i),this.graph.trigger(r,i)}))}onNodeClick({node:t}){this.createWidget(t)}onBlankMouseDown(){this.clearWidgets()}createTransform(t){const e=this.getTransformOptions(t);return e.resizable||e.rotatable?new Uv(e,t,this.graph):null}getTransformOptions(t){this.options.resizing||(this.options.resizing={enabled:!1}),this.options.rotating||(this.options.rotating={enabled:!1}),typeof this.options.resizing=="boolean"&&(this.options.resizing={enabled:this.options.resizing}),typeof this.options.rotating=="boolean"&&(this.options.rotating={enabled:this.options.rotating});const e=Ms.parseOptionGroup(this.graph,t,this.options.resizing),r=Ms.parseOptionGroup(this.graph,t,this.options.rotating);return{resizable:!!e.enabled,minWidth:e.minWidth||0,maxWidth:e.maxWidth||Number.MAX_SAFE_INTEGER,minHeight:e.minHeight||0,maxHeight:e.maxHeight||Number.MAX_SAFE_INTEGER,orthogonalResizing:typeof e.orthogonal=="boolean"?e.orthogonal:!0,restrictedResizing:!!e.restrict,autoScrollOnResizing:typeof e.autoScroll=="boolean"?e.autoScroll:!0,preserveAspectRatio:!!e.preserveAspectRatio,allowReverse:typeof e.allowReverse=="boolean"?e.allowReverse:!0,rotatable:!!r.enabled,rotateGrid:r.grid||15}}clearWidgets(){this.widgets.forEach((t,e)=>{this.graph.getCellById(e.id)&&t.dispose()}),this.widgets.clear()}dispose(){this.clearWidgets(),this.stopListening(),this.off(),Bs(this.name)}}AI([$e.dispose()],Ms.prototype,"dispose",null);(function(n){function t(e,r,i){const s={};return Object.keys(i||{}).forEach(o=>{const a=i[o];s[o]=typeof a=="function"?a.call(e,r):a}),s}n.parseOptionGroup=t})(Ms||(Ms={}));var SI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Vv extends Ce{get graph(){return this.options.graph}get boxClassName(){return this.prefixClassName(kn.classNames.box)}get $boxes(){return SM(this.container,this.boxClassName)}get handleOptions(){return this.options}constructor(t){super(),this.options=t,this.options.model&&(this.options.collection=this.options.model.collection),this.options.collection?this.collection=this.options.collection:(this.collection=new ac([],{comparator:kn.depthComparator}),this.options.collection=this.collection),this.boxCount=0,this.createContainer(),this.startListening()}startListening(){const t=this.graph,e=this.collection;this.delegateEvents({[`mousedown .${this.boxClassName}`]:"onSelectionBoxMouseDown",[`touchstart .${this.boxClassName}`]:"onSelectionBoxMouseDown"},!0),t.on("scale",this.onGraphTransformed,this),t.on("translate",this.onGraphTransformed,this),t.model.on("updated",this.onModelUpdated,this),e.on("added",this.onCellAdded,this),e.on("removed",this.onCellRemoved,this),e.on("reseted",this.onReseted,this),e.on("updated",this.onCollectionUpdated,this),e.on("node:change:position",this.onNodePositionChanged,this),e.on("cell:changed",this.onCellChanged,this)}stopListening(){const t=this.graph,e=this.collection;this.undelegateEvents(),t.off("scale",this.onGraphTransformed,this),t.off("translate",this.onGraphTransformed,this),t.model.off("updated",this.onModelUpdated,this),e.off("added",this.onCellAdded,this),e.off("removed",this.onCellRemoved,this),e.off("reseted",this.onReseted,this),e.off("updated",this.onCollectionUpdated,this),e.off("node:change:position",this.onNodePositionChanged,this),e.off("cell:changed",this.onCellChanged,this)}onRemove(){this.stopListening()}onGraphTransformed(){this.updateSelectionBoxes()}onCellChanged(){this.updateSelectionBoxes()}onNodePositionChanged({node:t,options:e}){const{showNodeSelectionBox:r,pointerEvents:i}=this.options,{ui:s,selection:o,translateBy:a,snapped:c}=e,l=(r!==!0||i&&this.getPointerEventsValue(i)==="none")&&!this.translating&&!o,u=s&&a&&t.id===a;if(l&&(u||c)){this.translating=!0;const f=t.position(),h=t.previous("position"),d=f.x-h.x,p=f.y-h.y;(d!==0||p!==0)&&this.translateSelectedNodes(d,p,t,e),this.translating=!1}}onModelUpdated({removed:t}){t&&t.length&&this.unselect(t)}isEmpty(){return this.length<=0}isSelected(t){return this.collection.has(t)}get length(){return this.collection.length}get cells(){return this.collection.toArray()}select(t,e={}){e.dryrun=!0;const r=this.filter(Array.isArray(t)?t:[t]);return this.collection.add(r,e),this}unselect(t,e={}){return e.dryrun=!0,this.collection.remove(Array.isArray(t)?t:[t],e),this}reset(t,e={}){if(t){if(e.batch){const l=this.filter(Array.isArray(t)?t:[t]);return this.collection.reset(l,Object.assign(Object.assign({},e),{ui:!0})),this}const r=this.cells,i=this.filter(Array.isArray(t)?t:[t]),s={},o={};r.forEach(l=>s[l.id]=l),i.forEach(l=>o[l.id]=l);const a=[],c=[];return i.forEach(l=>{s[l.id]||a.push(l)}),r.forEach(l=>{o[l.id]||c.push(l)}),c.length&&this.unselect(c,Object.assign(Object.assign({},e),{ui:!0})),a.length&&this.select(a,Object.assign(Object.assign({},e),{ui:!0})),c.length===0&&a.length===0&&this.updateContainer(),this}return this.clean(e)}clean(t={}){return this.length&&(t.batch===!1?this.unselect(this.cells,t):this.collection.reset([],Object.assign(Object.assign({},t),{ui:!0}))),this}setFilter(t){this.options.filter=t}setContent(t){this.options.content=t}startSelecting(t){t=this.normalizeEvent(t),this.clean();let e,r;const i=this.graph.container;if(t.offsetX!=null&&t.offsetY!=null&&i.contains(t.target))e=t.offsetX,r=t.offsetY;else{const s=wu(i),o=i.scrollLeft,a=i.scrollTop;e=t.clientX-s.left+window.pageXOffset+o,r=t.clientY-s.top+window.pageYOffset+a}dn(this.container,{top:r,left:e,width:1,height:1}),this.setEventData(t,{action:"selecting",clientX:t.clientX,clientY:t.clientY,offsetX:e,offsetY:r,scrollerX:0,scrollerY:0,moving:!1}),this.delegateDocumentEvents(kn.documentEvents,t.data)}filter(t){const e=this.options.filter;return t.filter(r=>Array.isArray(e)?e.some(i=>typeof i=="string"?r.shape===i:r.id===i.id):typeof e=="function"?Qt(e,this.graph,r):!0)}stopSelecting(t){const e=this.graph,r=this.getEventData(t);switch(r.action){case"selecting":{let s=sP(this.container),o=oP(this.container);const a=wu(this.container),c=e.pageToLocal(a.left,a.top),l=e.transform.getScale();s/=l.sx,o/=l.sy;const u=new Bt(c.x,c.y,s,o),f=this.getCellViewsInArea(u).map(h=>h.cell);this.reset(f,{batch:!0}),this.hideRubberband();break}case"translating":{const s=e.snapToGrid(t.clientX,t.clientY);if(!this.options.following){const o=r;this.updateSelectedNodesPosition({dx:o.clientX-o.originX,dy:o.clientY-o.originY})}this.graph.model.stopBatch("move-selection"),this.notifyBoxEvent("box:mouseup",t,s.x,s.y);break}default:{this.clean();break}}}onMouseUp(t){this.getEventData(t).action&&(this.stopSelecting(t),this.undelegateDocumentEvents())}onSelectionBoxMouseDown(t){this.options.following||t.stopPropagation();const e=this.normalizeEvent(t);this.options.movable&&this.startTranslating(e);const r=this.getCellViewFromElem(e.target);this.setEventData(e,{activeView:r});const i=this.graph.snapToGrid(e.clientX,e.clientY);this.notifyBoxEvent("box:mousedown",e,i.x,i.y),this.delegateDocumentEvents(kn.documentEvents,e.data)}startTranslating(t){this.graph.model.startBatch("move-selection");const e=this.graph.snapToGrid(t.clientX,t.clientY);this.setEventData(t,{action:"translating",clientX:e.x,clientY:e.y,originX:e.x,originY:e.y})}getRestrictArea(){const t=this.graph.options.translating.restrict,e=typeof t=="function"?Qt(t,this.graph,null):t;return typeof e=="number"?this.graph.transform.getGraphArea().inflate(e):e===!0?this.graph.transform.getGraphArea():e||null}getSelectionOffset(t,e){let r=t.x-e.clientX,i=t.y-e.clientY;const s=this.getRestrictArea();if(s){const o=this.collection.toArray(),a=Ae.getCellsBBox(o,{deep:!0})||Bt.create(),c=s.x-a.x,l=s.y-a.y,u=s.x+s.width-(a.x+a.width),f=s.y+s.height-(a.y+a.height);if(r<c&&(r=c),i<l&&(i=l),u<r&&(r=u),f<i&&(i=f),!this.options.following){const h=t.x-e.originX,d=t.y-e.originY;r=h<=c||h>=u?0:r,i=d<=l||d>=f?0:i}}return{dx:r,dy:i}}updateElementPosition(t,e,r){const i=dn(t,"left"),s=dn(t,"top"),o=i?parseFloat(i):0,a=s?parseFloat(s):0;dn(t,"left",o+e),dn(t,"top",a+r)}updateSelectedNodesPosition(t){const{dx:e,dy:r}=t;if(e||r)if(this.translateSelectedNodes(e,r),this.boxesUpdated)this.collection.length>1&&this.updateSelectionBoxes();else{const i=this.graph.transform.getScale();for(let s=0,o=this.$boxes,a=o.length;s<a;s+=1)this.updateElementPosition(o[s],e*i.sx,r*i.sy);this.updateElementPosition(this.selectionContainer,e*i.sx,r*i.sy)}}autoScrollGraph(t,e){const r=this.graph.getPlugin("scroller");return r?r.autoScroll(t,e):{scrollerX:0,scrollerY:0}}adjustSelection(t){const e=this.normalizeEvent(t),r=this.getEventData(e);switch(r.action){case"selecting":{const s=r;s.moving!==!0&&(Hr(this.container,this.graph.container),this.showRubberband(),s.moving=!0);const{scrollerX:o,scrollerY:a}=this.autoScrollGraph(e.clientX,e.clientY);s.scrollerX+=o,s.scrollerY+=a;const c=e.clientX-s.clientX+s.scrollerX,l=e.clientY-s.clientY+s.scrollerY,u=parseInt(dn(this.container,"left")||"0",10),f=parseInt(dn(this.container,"top")||"0",10);dn(this.container,{left:c<0?s.offsetX+c:u,top:l<0?s.offsetY+l:f,width:Math.abs(c),height:Math.abs(l)});break}case"translating":{const s=this.graph.snapToGrid(e.clientX,e.clientY),o=r,a=this.getSelectionOffset(s,o);this.options.following?this.updateSelectedNodesPosition(a):this.updateContainerPosition(a),a.dx&&(o.clientX=s.x),a.dy&&(o.clientY=s.y),this.notifyBoxEvent("box:mousemove",t,s.x,s.y);break}}this.boxesUpdated=!1}translateSelectedNodes(t,e,r,i){const s={},o=[];if(r&&(s[r.id]=!0),this.collection.toArray().forEach(a=>{a.getDescendants({deep:!0}).forEach(c=>{s[c.id]=!0})}),i&&i.translateBy){const a=this.graph.getCellById(i.translateBy);a&&(s[a.id]=!0,a.getDescendants({deep:!0}).forEach(c=>{s[c.id]=!0}),o.push(a))}this.collection.toArray().forEach(a=>{if(!s[a.id]){const c=Object.assign(Object.assign({},i),{selection:this.cid,exclude:o});a.translate(t,e,c),this.graph.model.getConnectedEdges(a).forEach(l=>{s[l.id]||(l.translate(t,e,c),s[l.id]=!0)})}})}getCellViewsInArea(t){const e=this.graph,r={strict:this.options.strict};let i=[];return this.options.rubberNode&&(i=i.concat(e.model.getNodesInArea(t,r).map(s=>e.renderer.findViewByCell(s)).filter(s=>s!=null))),this.options.rubberEdge&&(i=i.concat(e.model.getEdgesInArea(t,r).map(s=>e.renderer.findViewByCell(s)).filter(s=>s!=null))),i}notifyBoxEvent(t,e,r,i){const o=this.getEventData(e).activeView;this.trigger(t,{e,view:o,x:r,y:i,cell:o.cell})}getSelectedClassName(t){return this.prefixClassName(`${t.isNode()?"node":"edge"}-selected`)}addCellSelectedClassName(t){const e=this.graph.renderer.findViewByCell(t);e&&e.addClass(this.getSelectedClassName(t))}removeCellUnSelectedClassName(t){const e=this.graph.renderer.findViewByCell(t);e&&e.removeClass(this.getSelectedClassName(t))}destroySelectionBox(t){this.removeCellUnSelectedClassName(t),this.canShowSelectionBox(t)&&(Yn(this.container.querySelector(`[data-cell-id="${t.id}"]`)),this.$boxes.length===0&&this.hide(),this.boxCount=Math.max(0,this.boxCount-1))}destroyAllSelectionBoxes(t){t.forEach(e=>this.removeCellUnSelectedClassName(e)),this.hide(),Yn(this.$boxes),this.boxCount=0}hide(){Fe(this.container,this.prefixClassName(kn.classNames.rubberband)),Fe(this.container,this.prefixClassName(kn.classNames.selected))}showRubberband(){qt(this.container,this.prefixClassName(kn.classNames.rubberband))}hideRubberband(){Fe(this.container,this.prefixClassName(kn.classNames.rubberband))}showSelected(){lh(this.container,"style"),qt(this.container,this.prefixClassName(kn.classNames.selected))}createContainer(){this.container=document.createElement("div"),qt(this.container,this.prefixClassName(kn.classNames.root)),this.options.className&&qt(this.container,this.options.className),this.selectionContainer=document.createElement("div"),qt(this.selectionContainer,this.prefixClassName(kn.classNames.inner)),this.selectionContent=document.createElement("div"),qt(this.selectionContent,this.prefixClassName(kn.classNames.content)),zn(this.selectionContainer,this.selectionContent),ye(this.selectionContainer,"data-selection-length",this.collection.length),Mb(this.container,this.selectionContainer)}updateContainerPosition(t){(t.dx||t.dy)&&this.updateElementPosition(this.selectionContainer,t.dx,t.dy)}updateContainer(){const t={x:1/0,y:1/0},e={x:0,y:0};this.collection.toArray().filter(s=>this.canShowSelectionBox(s)).forEach(s=>{const o=this.graph.renderer.findViewByCell(s);if(o){const a=o.getBBox({useCellGeometry:!0});t.x=Math.min(t.x,a.x),t.y=Math.min(t.y,a.y),e.x=Math.max(e.x,a.x+a.width),e.y=Math.max(e.y,a.y+a.height)}}),dn(this.selectionContainer,{position:"absolute",pointerEvents:"none",left:t.x,top:t.y,width:e.x-t.x,height:e.y-t.y}),ye(this.selectionContainer,"data-selection-length",this.collection.length);const i=this.options.content;if(i)if(typeof i=="function"){const s=Qt(i,this.graph,this,this.selectionContent);s&&(this.selectionContent.innerHTML=s)}else this.selectionContent.innerHTML=i;this.collection.length>0&&!this.container.parentNode?Hr(this.container,this.graph.container):this.collection.length<=0&&this.container.parentNode&&this.container.parentNode.removeChild(this.container)}canShowSelectionBox(t){return t.isNode()&&this.options.showNodeSelectionBox===!0||t.isEdge()&&this.options.showEdgeSelectionBox===!0}getPointerEventsValue(t){return typeof t=="string"?t:t(this.cells)}createSelectionBox(t){if(this.addCellSelectedClassName(t),this.canShowSelectionBox(t)){const e=this.graph.renderer.findViewByCell(t);if(e){const r=e.getBBox({useCellGeometry:!0}),i=this.boxClassName,s=document.createElement("div"),o=this.options.pointerEvents;qt(s,i),qt(s,`${i}-${t.isNode()?"node":"edge"}`),ye(s,"data-cell-id",t.id),dn(s,{position:"absolute",left:r.x,top:r.y,width:r.width,height:r.height,pointerEvents:o?this.getPointerEventsValue(o):"auto"}),Hr(s,this.container),this.showSelected(),this.boxCount+=1}}}updateSelectionBoxes(){this.collection.length>0&&(this.boxesUpdated=!0,this.confirmUpdate())}confirmUpdate(){if(this.boxCount){this.hide();for(let t=0,e=this.$boxes,r=e.length;t<r;t+=1){const i=e[t],s=ye(i,"data-cell-id");Yn(i),this.boxCount-=1;const o=this.collection.get(s);o&&this.createSelectionBox(o)}this.updateContainer()}return 0}getCellViewFromElem(t){const e=t.getAttribute("data-cell-id");if(e){const r=this.collection.get(e);if(r)return this.graph.renderer.findViewByCell(r)}return null}onCellRemoved({cell:t}){this.destroySelectionBox(t),this.updateContainer()}onReseted({previous:t,current:e}){this.destroyAllSelectionBoxes(t),e.forEach(r=>{this.listenCellRemoveEvent(r),this.createSelectionBox(r)}),this.updateContainer()}onCellAdded({cell:t}){this.listenCellRemoveEvent(t),this.createSelectionBox(t),this.updateContainer()}listenCellRemoveEvent(t){t.off("removed",this.onCellRemoved,this),t.on("removed",this.onCellRemoved,this)}onCollectionUpdated({added:t,removed:e,options:r}){t.forEach(s=>{this.trigger("cell:selected",{cell:s,options:r}),s.isNode()?this.trigger("node:selected",{cell:s,options:r,node:s}):s.isEdge()&&this.trigger("edge:selected",{cell:s,options:r,edge:s})}),e.forEach(s=>{this.trigger("cell:unselected",{cell:s,options:r}),s.isNode()?this.trigger("node:unselected",{cell:s,options:r,node:s}):s.isEdge()&&this.trigger("edge:unselected",{cell:s,options:r,edge:s})});const i={added:t,removed:e,options:r,selected:this.cells.filter(s=>!!this.graph.getCellById(s.id))};this.trigger("selection:changed",i)}dispose(){this.clean(),this.remove(),this.off()}}SI([Ce.dispose()],Vv.prototype,"dispose",null);var kn;(function(n){const t="widget-selection";n.classNames={root:t,inner:`${t}-inner`,box:`${t}-box`,content:`${t}-content`,rubberband:`${t}-rubberband`,selected:`${t}-selected`},n.documentEvents={mousemove:"adjustSelection",touchmove:"adjustSelection",mouseup:"onMouseUp",touchend:"onMouseUp",touchcancel:"onMouseUp"};function e(r){return r.getAncestors().length}n.depthComparator=e})(kn||(kn={}));const TI=`.x6-widget-selection {
  position: absolute;
  top: 0;
  left: 0;
  display: none;
  width: 0;
  height: 0;
  touch-action: none;
}
.x6-widget-selection-rubberband {
  display: block;
  overflow: visible;
  opacity: 0.3;
}
.x6-widget-selection-selected {
  display: block;
}
.x6-widget-selection-box {
  cursor: move;
}
.x6-widget-selection-inner[data-selection-length='0'],
.x6-widget-selection-inner[data-selection-length='1'] {
  display: none;
}
.x6-widget-selection-content {
  position: absolute;
  top: 100%;
  right: -20px;
  left: -20px;
  margin-top: 30px;
  padding: 6px;
  line-height: 14px;
  text-align: center;
  border-radius: 6px;
}
.x6-widget-selection-content:empty {
  display: none;
}
.x6-widget-selection-rubberband {
  background-color: #3498db;
  border: 2px solid #2980b9;
}
.x6-widget-selection-box {
  box-sizing: content-box !important;
  margin-top: -4px;
  margin-left: -4px;
  padding-right: 4px;
  padding-bottom: 4px;
  border: 2px dashed #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-inner {
  box-sizing: content-box !important;
  margin-top: -8px;
  margin-left: -8px;
  padding-right: 12px;
  padding-bottom: 12px;
  border: 2px solid #feb663;
  box-shadow: 2px 2px 5px #d3d3d3;
}
.x6-widget-selection-content {
  color: #fff;
  font-size: 10px;
  background-color: #6a6b8a;
}
`;_t.prototype.isSelectionEnabled=function(){const n=this.getPlugin("selection");return n?n.isEnabled():!1};_t.prototype.enableSelection=function(){const n=this.getPlugin("selection");return n&&n.enable(),this};_t.prototype.disableSelection=function(){const n=this.getPlugin("selection");return n&&n.disable(),this};_t.prototype.toggleSelection=function(n){const t=this.getPlugin("selection");return t&&t.toggleEnabled(n),this};_t.prototype.isMultipleSelection=function(){const n=this.getPlugin("selection");return n?n.isMultipleSelection():!1};_t.prototype.enableMultipleSelection=function(){const n=this.getPlugin("selection");return n&&n.enableMultipleSelection(),this};_t.prototype.disableMultipleSelection=function(){const n=this.getPlugin("selection");return n&&n.disableMultipleSelection(),this};_t.prototype.toggleMultipleSelection=function(n){const t=this.getPlugin("selection");return t&&t.toggleMultipleSelection(n),this};_t.prototype.isSelectionMovable=function(){const n=this.getPlugin("selection");return n?n.isSelectionMovable():!1};_t.prototype.enableSelectionMovable=function(){const n=this.getPlugin("selection");return n&&n.enableSelectionMovable(),this};_t.prototype.disableSelectionMovable=function(){const n=this.getPlugin("selection");return n&&n.disableSelectionMovable(),this};_t.prototype.toggleSelectionMovable=function(n){const t=this.getPlugin("selection");return t&&t.toggleSelectionMovable(n),this};_t.prototype.isRubberbandEnabled=function(){const n=this.getPlugin("selection");return n?n.isRubberbandEnabled():!1};_t.prototype.enableRubberband=function(){const n=this.getPlugin("selection");return n&&n.enableRubberband(),this};_t.prototype.disableRubberband=function(){const n=this.getPlugin("selection");return n&&n.disableRubberband(),this};_t.prototype.toggleRubberband=function(n){const t=this.getPlugin("selection");return t&&t.toggleRubberband(n),this};_t.prototype.isStrictRubberband=function(){const n=this.getPlugin("selection");return n?n.isStrictRubberband():!1};_t.prototype.enableStrictRubberband=function(){const n=this.getPlugin("selection");return n&&n.enableStrictRubberband(),this};_t.prototype.disableStrictRubberband=function(){const n=this.getPlugin("selection");return n&&n.disableStrictRubberband(),this};_t.prototype.toggleStrictRubberband=function(n){const t=this.getPlugin("selection");return t&&t.toggleStrictRubberband(n),this};_t.prototype.setRubberbandModifiers=function(n){const t=this.getPlugin("selection");return t&&t.setRubberbandModifiers(n),this};_t.prototype.setSelectionFilter=function(n){const t=this.getPlugin("selection");return t&&t.setSelectionFilter(n),this};_t.prototype.setSelectionDisplayContent=function(n){const t=this.getPlugin("selection");return t&&t.setSelectionDisplayContent(n),this};_t.prototype.isSelectionEmpty=function(){const n=this.getPlugin("selection");return n?n.isEmpty():!0};_t.prototype.cleanSelection=function(n){const t=this.getPlugin("selection");return t&&t.clean(n),this};_t.prototype.resetSelection=function(n,t){const e=this.getPlugin("selection");return e&&e.reset(n,t),this};_t.prototype.getSelectedCells=function(){const n=this.getPlugin("selection");return n?n.getSelectedCells():[]};_t.prototype.getSelectedCellCount=function(){const n=this.getPlugin("selection");return n?n.getSelectedCellCount():0};_t.prototype.isSelected=function(n){const t=this.getPlugin("selection");return t?t.isSelected(n):!1};_t.prototype.select=function(n,t){const e=this.getPlugin("selection");return e&&e.select(n,t),this};_t.prototype.unselect=function(n,t){const e=this.getPlugin("selection");return e&&e.unselect(n,t),this};var CI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class jo extends $e{get rubberbandDisabled(){return this.options.enabled!==!0||this.options.rubberband!==!0}get disabled(){return this.options.enabled!==!0}get length(){return this.selectionImpl.length}get cells(){return this.selectionImpl.cells}constructor(t={}){super(),this.name="selection",this.movedMap=new WeakMap,this.unselectMap=new WeakMap,this.options=Object.assign(Object.assign({enabled:!0},jo.defaultOptions),t),ks(this.name,TI)}init(t){this.graph=t,this.selectionImpl=new Vv(Object.assign(Object.assign({},this.options),{graph:t})),this.setup(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isMultipleSelection(){return this.isMultiple()}enableMultipleSelection(){return this.enableMultiple(),this}disableMultipleSelection(){return this.disableMultiple(),this}toggleMultipleSelection(t){return t!=null?t!==this.isMultipleSelection()&&(t?this.enableMultipleSelection():this.disableMultipleSelection()):this.isMultipleSelection()?this.disableMultipleSelection():this.enableMultipleSelection(),this}isSelectionMovable(){return this.options.movable!==!1}enableSelectionMovable(){return this.selectionImpl.options.movable=!0,this}disableSelectionMovable(){return this.selectionImpl.options.movable=!1,this}toggleSelectionMovable(t){return t!=null?t!==this.isSelectionMovable()&&(t?this.enableSelectionMovable():this.disableSelectionMovable()):this.isSelectionMovable()?this.disableSelectionMovable():this.enableSelectionMovable(),this}isRubberbandEnabled(){return!this.rubberbandDisabled}enableRubberband(){return this.rubberbandDisabled&&(this.options.rubberband=!0),this}disableRubberband(){return this.rubberbandDisabled||(this.options.rubberband=!1),this}toggleRubberband(t){return t!=null?t!==this.isRubberbandEnabled()&&(t?this.enableRubberband():this.disableRubberband()):this.isRubberbandEnabled()?this.disableRubberband():this.enableRubberband(),this}isStrictRubberband(){return this.selectionImpl.options.strict===!0}enableStrictRubberband(){return this.selectionImpl.options.strict=!0,this}disableStrictRubberband(){return this.selectionImpl.options.strict=!1,this}toggleStrictRubberband(t){return t!=null?t!==this.isStrictRubberband()&&(t?this.enableStrictRubberband():this.disableStrictRubberband()):this.isStrictRubberband()?this.disableStrictRubberband():this.enableStrictRubberband(),this}setRubberbandModifiers(t){this.setModifiers(t)}setSelectionFilter(t){return this.setFilter(t),this}setSelectionDisplayContent(t){return this.setContent(t),this}isEmpty(){return this.length<=0}clean(t={}){return this.selectionImpl.clean(t),this}reset(t,e={}){return this.selectionImpl.reset(t?this.getCells(t):[],e),this}getSelectedCells(){return this.cells}getSelectedCellCount(){return this.length}isSelected(t){return this.selectionImpl.isSelected(t)}select(t,e={}){const r=this.getCells(t);return r.length&&(this.isMultiple()?this.selectionImpl.select(r,e):this.reset(r.slice(0,1),e)),this}unselect(t,e={}){return this.selectionImpl.unselect(this.getCells(t),e),this}setup(){this.selectionImpl.on("*",(t,e)=>{this.trigger(t,e),this.graph.trigger(t,e)})}startListening(){this.graph.on("blank:mousedown",this.onBlankMouseDown,this),this.graph.on("blank:click",this.onBlankClick,this),this.graph.on("cell:mousemove",this.onCellMouseMove,this),this.graph.on("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.on("box:mousedown",this.onBoxMouseDown,this)}stopListening(){this.graph.off("blank:mousedown",this.onBlankMouseDown,this),this.graph.off("blank:click",this.onBlankClick,this),this.graph.off("cell:mousemove",this.onCellMouseMove,this),this.graph.off("cell:mouseup",this.onCellMouseUp,this),this.selectionImpl.off("box:mousedown",this.onBoxMouseDown,this)}onBlankMouseDown({e:t}){if(!this.allowBlankMouseDown(t))return;const e=this.graph.panning.allowPanning(t,!0),r=this.graph.getPlugin("scroller"),i=r&&r.allowPanning(t,!0);(this.allowRubberband(t,!0)||this.allowRubberband(t)&&!i&&!e)&&this.startRubberband(t)}allowBlankMouseDown(t){const e=this.options.eventTypes;return(e==null?void 0:e.includes("leftMouseDown"))&&t.button===0||(e==null?void 0:e.includes("mouseWheelDown"))&&t.button===1}onBlankClick(){this.clean()}allowRubberband(t,e){return!this.rubberbandDisabled&&Yr.isMatch(t,this.options.modifiers,e)}allowMultipleSelection(t){return this.isMultiple()&&Yr.isMatch(t,this.options.multipleSelectionModifiers)}onCellMouseMove({cell:t}){this.movedMap.set(t,!0)}onCellMouseUp({e:t,cell:e}){const r=this.options;let i=this.disabled;!i&&this.movedMap.has(e)&&(i=r.selectCellOnMoved===!1,i||(i=r.selectNodeOnMoved===!1&&e.isNode()),i||(i=r.selectEdgeOnMoved===!1&&e.isEdge())),i||(this.allowMultipleSelection(t)?this.unselectMap.has(e)?this.unselectMap.delete(e):this.isSelected(e)?this.unselect(e):this.select(e):this.reset(e)),this.movedMap.delete(e)}onBoxMouseDown({e:t,cell:e}){this.disabled||this.allowMultipleSelection(t)&&(this.unselect(e),this.unselectMap.set(e,!0))}getCells(t){return(Array.isArray(t)?t:[t]).map(e=>typeof e=="string"?this.graph.getCellById(e):e).filter(e=>e!=null)}startRubberband(t){return this.rubberbandDisabled||this.selectionImpl.startSelecting(t),this}isMultiple(){return this.options.multiple!==!1}enableMultiple(){return this.options.multiple=!0,this}disableMultiple(){return this.options.multiple=!1,this}setModifiers(t){return this.options.modifiers=t,this}setContent(t){return this.selectionImpl.setContent(t),this}setFilter(t){return this.selectionImpl.setFilter(t),this}dispose(){this.stopListening(),this.off(),this.selectionImpl.dispose(),Bs(this.name)}}CI([$e.dispose()],jo.prototype,"dispose",null);(function(n){n.defaultOptions={rubberband:!1,rubberNode:!0,rubberEdge:!1,pointerEvents:"auto",multiple:!0,multipleSelectionModifiers:["ctrl","meta"],movable:!0,strict:!1,selectCellOnMoved:!1,selectNodeOnMoved:!1,selectEdgeOnMoved:!1,following:!0,content:null,eventTypes:["leftMouseDown","mouseWheelDown"]}})(jo||(jo={}));var _I=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},OI=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class $v extends Ce{get model(){return this.graph.model}get containerClassName(){return this.prefixClassName("widget-snapline")}get verticalClassName(){return`${this.containerClassName}-vertical`}get horizontalClassName(){return`${this.containerClassName}-horizontal`}constructor(t){super();const{graph:e}=t,r=OI(t,["graph"]);this.graph=e,this.options=Object.assign({},r),this.offset={x:0,y:0},this.render(),this.disabled||this.startListening()}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.startListening())}disable(){this.disabled||(this.options.enabled=!1,this.stopListening())}setFilter(t){this.options.filter=t}render(){const t=this.containerWrapper=new ae("svg"),e=this.horizontal=new ae("line"),r=this.vertical=new ae("line");t.addClass(this.containerClassName),e.addClass(this.horizontalClassName),r.addClass(this.verticalClassName),t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.setAttribute("display","none"),r.setAttribute("display","none"),t.append([e,r]),this.options.className&&t.addClass(this.options.className),this.container=this.containerWrapper.node}startListening(){this.stopListening(),this.graph.on("node:mousedown",this.captureCursorOffset,this),this.graph.on("node:mousemove",this.snapOnMoving,this),this.model.on("batch:stop",this.onBatchStop,this),this.delegateDocumentEvents({mouseup:"hide",touchend:"hide"})}stopListening(){this.graph.off("node:mousedown",this.captureCursorOffset,this),this.graph.off("node:mousemove",this.snapOnMoving,this),this.model.off("batch:stop",this.onBatchStop,this),this.undelegateDocumentEvents()}onBatchStop({name:t,data:e}){t==="resize"&&this.snapOnResizing(e.cell,e)}captureCursorOffset({view:t,x:e,y:r}){const i=t.getDelegatedView();if(i&&this.isNodeMovable(i)){const s=t.cell.getPosition();this.offset={x:e-s.x,y:r-s.y}}}isNodeMovable(t){return t&&t.cell.isNode()&&t.can("nodeMovable")}getRestrictArea(t){const e=this.graph.options.translating.restrict,r=typeof e=="function"?Qt(e,this.graph,t):e;return typeof r=="number"?this.graph.transform.getGraphArea().inflate(r):r===!0?this.graph.transform.getGraphArea():r||null}snapOnResizing(t,e){if(this.options.resizing&&!e.snapped&&e.ui&&e.direction&&e.trueDirection){const r=this.graph.renderer.findViewByCell(t);if(r&&r.cell.isNode()){const i=t.getBBox(),s=i.bbox(t.getAngle()),o=s.getTopLeft(),a=s.getBottomRight(),c=Te.normalize(t.getAngle()),l=this.options.tolerance||0;let u,f,h,d,p,m;const b={vertical:0,horizontal:0},v=e.direction,E=e.trueDirection,y=e.relativeDirection;E.indexOf("right")!==-1?b.vertical=a.x:b.vertical=o.x,E.indexOf("bottom")!==-1?b.horizontal=a.y:b.horizontal=o.y,this.model.getNodes().some(H=>{if(this.isIgnored(t,H))return!1;const Ut=H.getBBox().bbox(H.getAngle()),zt=Ut.getTopLeft(),W=Ut.getBottomRight(),lt={vertical:[zt.x,W.x],horizontal:[zt.y,W.y]},Rt={};return Object.keys(lt).forEach(Xt=>{const ot=Xt,et=lt[ot].map(K=>({position:K,distance:Math.abs(K-b[ot])})).filter(K=>K.distance<=l);Rt[ot]=Nu(et,K=>K.distance)}),u==null&&Rt.vertical.length>0&&(u=Rt.vertical[0].position,f=Math.min(s.y,Ut.y),h=Math.max(a.y,W.y)-f),d==null&&Rt.horizontal.length>0&&(d=Rt.horizontal[0].position,p=Math.min(s.x,Ut.x),m=Math.max(a.x,W.x)-p),u!=null&&d!=null}),this.hide();let O=0,I=0;(d!=null||u!=null)&&(u!=null&&(O=E.indexOf("right")!==-1?u-a.x:o.x-u),d!=null&&(I=E.indexOf("bottom")!==-1?d-a.y:o.y-d));let G=0,k=0;if(c%90===0)c===90||c===270?(G=I,k=O):(G=O,k=I);else{const H=c>=0&&c<90?1:c>=90&&c<180?4:c>=180&&c<270?3:2;d!=null&&u!=null&&(O<I?(I=0,d=void 0):(O=0,u=void 0));const Ut=Te.toRad(c%90);O&&(G=H===3?O/Math.cos(Ut):O/Math.sin(Ut)),I&&(k=H===3?I/Math.cos(Ut):I/Math.sin(Ut));const zt=H===1||H===3;switch(y){case"top":case"bottom":k=I?I/(zt?Math.cos(Ut):Math.sin(Ut)):O/(zt?Math.sin(Ut):Math.cos(Ut));break;case"left":case"right":G=O?O/(zt?Math.cos(Ut):Math.sin(Ut)):I/(zt?Math.sin(Ut):Math.cos(Ut));break}}switch(y){case"top":case"bottom":G=0;break;case"left":case"right":k=0;break}const X=this.graph.getGridSize();let Z=Math.max(i.width+G,X),at=Math.max(i.height+k,X);e.minWidth&&e.minWidth>X&&(Z=Math.max(Z,e.minWidth)),e.minHeight&&e.minHeight>X&&(at=Math.max(at,e.minHeight)),e.maxWidth&&(Z=Math.min(Z,e.maxWidth)),e.maxHeight&&(at=Math.min(at,e.maxHeight)),e.preserveAspectRatio&&(k<G?at=Z*(i.height/i.width):Z=at*(i.width/i.height)),(Z!==i.width||at!==i.height)&&(t.resize(Z,at,{direction:v,relativeDirection:y,trueDirection:E,snapped:!0,snaplines:this.cid,restrict:this.getRestrictArea(r)}),h&&(h+=at-i.height),m&&(m+=Z-i.width));const ft=t.getBBox().bbox(c);u&&Math.abs(ft.x-u)>1&&Math.abs(ft.width+ft.x-u)>1&&(u=void 0),d&&Math.abs(ft.y-d)>1&&Math.abs(ft.height+ft.y-d)>1&&(d=void 0),this.update({verticalLeft:u,verticalTop:f,verticalHeight:h,horizontalTop:d,horizontalLeft:p,horizontalWidth:m})}}}snapOnMoving({view:t,e,x:r,y:i}){const s=t.getEventData(e).delegatedView||t;if(!this.isNodeMovable(s))return;const o=s.cell,a=o.getSize(),c=o.getPosition(),l=new Bt(r-this.offset.x,i-this.offset.y,a.width,a.height),u=o.getAngle(),f=l.getCenter(),h=l.bbox(u),d=h.getTopLeft(),p=h.getBottomRight(),m=this.options.tolerance||0;let b,v,E,y,O,I,G=0,k=0;if(this.model.getNodes().some(X=>{if(this.isIgnored(o,X))return!1;const Z=X.getBBox().bbox(X.getAngle()),at=Z.getCenter(),ft=Z.getTopLeft(),H=Z.getBottomRight();return b==null&&(Math.abs(at.x-f.x)<m?(b=at.x,G=.5):Math.abs(ft.x-d.x)<m?(b=ft.x,G=0):Math.abs(ft.x-p.x)<m?(b=ft.x,G=1):Math.abs(H.x-p.x)<m?(b=H.x,G=1):Math.abs(H.x-d.x)<m&&(b=H.x),b!=null&&(v=Math.min(h.y,Z.y),E=Math.max(p.y,H.y)-v)),y==null&&(Math.abs(at.y-f.y)<m?(y=at.y,k=.5):Math.abs(ft.y-d.y)<m?y=ft.y:Math.abs(ft.y-p.y)<m?(y=ft.y,k=1):Math.abs(H.y-p.y)<m?(y=H.y,k=1):Math.abs(H.y-d.y)<m&&(y=H.y),y!=null&&(O=Math.min(h.x,Z.x),I=Math.max(p.x,H.x)-O)),b!=null&&y!=null}),this.hide(),y!=null||b!=null){y!=null&&(h.y=y-k*h.height),b!=null&&(h.x=b-G*h.width);const X=h.getCenter(),Z=X.x-l.width/2,at=X.y-l.height/2,ft=Z-c.x,H=at-c.y;(ft!==0||H!==0)&&(o.translate(ft,H,{snapped:!0,restrict:this.getRestrictArea(s)}),I&&(I+=ft),E&&(E+=H)),this.update({verticalLeft:b,verticalTop:v,verticalHeight:E,horizontalTop:y,horizontalLeft:O,horizontalWidth:I})}}isIgnored(t,e){return e.id===t.id||e.isDescendantOf(t)||!this.filter(e)}filter(t){const e=this.options.filter;return Array.isArray(e)?e.some(r=>typeof r=="string"?t.shape===r:t.id===r.id):typeof e=="function"?Qt(e,this.graph,t):!0}update(t){if(t.horizontalTop){const e=this.graph.localToGraph(new R(t.horizontalLeft,t.horizontalTop)),r=this.graph.localToGraph(new R(t.horizontalLeft+t.horizontalWidth,t.horizontalTop));this.horizontal.setAttributes({x1:this.options.sharp?`${e.x}`:"0",y1:`${e.y}`,x2:this.options.sharp?`${r.x}`:"100%",y2:`${r.y}`,display:"inherit"})}else this.horizontal.setAttribute("display","none");if(t.verticalLeft){const e=this.graph.localToGraph(new R(t.verticalLeft,t.verticalTop)),r=this.graph.localToGraph(new R(t.verticalLeft,t.verticalTop+t.verticalHeight));this.vertical.setAttributes({x1:`${e.x}`,y1:this.options.sharp?`${e.y}`:"0",x2:`${r.x}`,y2:this.options.sharp?`${r.y}`:"100%",display:"inherit"})}else this.vertical.setAttribute("display","none");this.show()}resetTimer(){this.timer&&(clearTimeout(this.timer),this.timer=null)}show(){return this.resetTimer(),this.container.parentNode==null&&this.graph.container.appendChild(this.container),this}hide(){this.resetTimer(),this.vertical.setAttribute("display","none"),this.horizontal.setAttribute("display","none");const t=this.options.clean,e=typeof t=="number"?t:t!==!1?3e3:0;return e>0&&(this.timer=window.setTimeout(()=>{this.container.parentNode!==null&&this.unmount()},e)),this}onRemove(){this.stopListening(),this.hide()}dispose(){this.remove()}}_I([Ce.dispose()],$v.prototype,"dispose",null);const MI=`.x6-widget-snapline {
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  pointer-events: none;
}
.x6-widget-snapline-vertical,
.x6-widget-snapline-horizontal {
  stroke: #2ecc71;
  stroke-width: 1px;
}
`;_t.prototype.isSnaplineEnabled=function(){const n=this.getPlugin("snapline");return n?n.isEnabled():!1};_t.prototype.enableSnapline=function(){const n=this.getPlugin("snapline");return n&&n.enable(),this};_t.prototype.disableSnapline=function(){const n=this.getPlugin("snapline");return n&&n.disable(),this};_t.prototype.toggleSnapline=function(){const n=this.getPlugin("snapline");return n&&n.toggleEnabled(),this};_t.prototype.hideSnapline=function(){const n=this.getPlugin("snapline");return n&&n.hide(),this};_t.prototype.setSnaplineFilter=function(n){const t=this.getPlugin("snapline");return t&&t.setFilter(n),this};_t.prototype.isSnaplineOnResizingEnabled=function(){const n=this.getPlugin("snapline");return n?n.isOnResizingEnabled():!1};_t.prototype.enableSnaplineOnResizing=function(){const n=this.getPlugin("snapline");return n&&n.enableOnResizing(),this};_t.prototype.disableSnaplineOnResizing=function(){const n=this.getPlugin("snapline");return n&&n.disableOnResizing(),this};_t.prototype.toggleSnaplineOnResizing=function(n){const t=this.getPlugin("snapline");return t&&t.toggleOnResizing(n),this};_t.prototype.isSharpSnapline=function(){const n=this.getPlugin("snapline");return n?n.isSharp():!1};_t.prototype.enableSharpSnapline=function(){const n=this.getPlugin("snapline");return n&&n.enableSharp(),this};_t.prototype.disableSharpSnapline=function(){const n=this.getPlugin("snapline");return n&&n.disableSharp(),this};_t.prototype.toggleSharpSnapline=function(n){const t=this.getPlugin("snapline");return t&&t.toggleSharp(n),this};_t.prototype.getSnaplineTolerance=function(){const n=this.getPlugin("snapline");if(n)return n.getTolerance()};_t.prototype.setSnaplineTolerance=function(n){const t=this.getPlugin("snapline");return t&&t.setTolerance(n),this};var PI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class RI extends Rn{constructor(t={}){super(),this.name="snapline",this.options=Object.assign({enabled:!0,tolerance:10},t),ks(this.name,MI)}init(t){this.snaplineImpl=new $v(Object.assign(Object.assign({},this.options),{graph:t}))}isEnabled(){return!this.snaplineImpl.disabled}enable(){this.snaplineImpl.enable()}disable(){this.snaplineImpl.disable()}toggleEnabled(t){if(t!=null)t!==this.isEnabled()&&(t?this.enable():this.disable());else return this.isEnabled()?this.disable():this.enable(),this}hide(){return this.snaplineImpl.hide(),this}setFilter(t){return this.snaplineImpl.setFilter(t),this}isOnResizingEnabled(){return this.snaplineImpl.options.resizing===!0}enableOnResizing(){return this.snaplineImpl.options.resizing=!0,this}disableOnResizing(){return this.snaplineImpl.options.resizing=!1,this}toggleOnResizing(t){return t!=null?t!==this.isOnResizingEnabled()&&(t?this.enableOnResizing():this.disableOnResizing()):this.isOnResizingEnabled()?this.disableOnResizing():this.enableOnResizing(),this}isSharp(){return this.snaplineImpl.options.sharp===!0}enableSharp(){return this.snaplineImpl.options.sharp=!0,this}disableSharp(){return this.snaplineImpl.options.sharp=!1,this}toggleSharp(t){return t!=null?t!==this.isSharp()&&(t?this.enableSharp():this.disableSharp()):this.isSharp()?this.disableSharp():this.enableSharp(),this}getTolerance(){return this.snaplineImpl.options.tolerance}setTolerance(t){return this.snaplineImpl.options.tolerance=t,this}captureCursorOffset(t){this.snaplineImpl.captureCursorOffset(t)}snapOnMoving(t){this.snaplineImpl.snapOnMoving(t)}dispose(){this.snaplineImpl.dispose(),Bs(this.name)}}PI([Rn.dispose()],RI.prototype,"dispose",null);var Hv={exports:{}};(function(n){(function(t,e,r){if(!t)return;for(var i={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},s={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},o={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},a={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},c,l=1;l<20;++l)i[111+l]="f"+l;for(l=0;l<=9;++l)i[l+96]=l.toString();function u(k,X,Z){if(k.addEventListener){k.addEventListener(X,Z,!1);return}k.attachEvent("on"+X,Z)}function f(k){if(k.type=="keypress"){var X=String.fromCharCode(k.which);return k.shiftKey||(X=X.toLowerCase()),X}return i[k.which]?i[k.which]:s[k.which]?s[k.which]:String.fromCharCode(k.which).toLowerCase()}function h(k,X){return k.sort().join(",")===X.sort().join(",")}function d(k){var X=[];return k.shiftKey&&X.push("shift"),k.altKey&&X.push("alt"),k.ctrlKey&&X.push("ctrl"),k.metaKey&&X.push("meta"),X}function p(k){if(k.preventDefault){k.preventDefault();return}k.returnValue=!1}function m(k){if(k.stopPropagation){k.stopPropagation();return}k.cancelBubble=!0}function b(k){return k=="shift"||k=="ctrl"||k=="alt"||k=="meta"}function v(){if(!c){c={};for(var k in i)k>95&&k<112||i.hasOwnProperty(k)&&(c[i[k]]=k)}return c}function E(k,X,Z){return Z||(Z=v()[k]?"keydown":"keypress"),Z=="keypress"&&X.length&&(Z="keydown"),Z}function y(k){return k==="+"?["+"]:(k=k.replace(/\+{2}/g,"+plus"),k.split("+"))}function O(k,X){var Z,at,ft,H=[];for(Z=y(k),ft=0;ft<Z.length;++ft)at=Z[ft],a[at]&&(at=a[at]),X&&X!="keypress"&&o[at]&&(at=o[at],H.push("shift")),b(at)&&H.push(at);return X=E(at,H,X),{key:at,modifiers:H,action:X}}function I(k,X){return k===null||k===e?!1:k===X?!0:I(k.parentNode,X)}function G(k){var X=this;if(k=k||e,!(X instanceof G))return new G(k);X.target=k,X._callbacks={},X._directMap={};var Z={},at,ft=!1,H=!1,Ut=!1;function zt(K){K=K||{};var Ct=!1,Lt;for(Lt in Z){if(K[Lt]){Ct=!0;continue}Z[Lt]=0}Ct||(Ut=!1)}function W(K,Ct,Lt,Ot,re,be){var ee,Oe,Zt=[],Yt=Lt.type;if(!X._callbacks[K])return[];for(Yt=="keyup"&&b(K)&&(Ct=[K]),ee=0;ee<X._callbacks[K].length;++ee)if(Oe=X._callbacks[K][ee],!(!Ot&&Oe.seq&&Z[Oe.seq]!=Oe.level)&&Yt==Oe.action&&(Yt=="keypress"&&!Lt.metaKey&&!Lt.ctrlKey||h(Ct,Oe.modifiers))){var ln=!Ot&&Oe.combo==re,An=Ot&&Oe.seq==Ot&&Oe.level==be;(ln||An)&&X._callbacks[K].splice(ee,1),Zt.push(Oe)}return Zt}function lt(K,Ct,Lt,Ot){X.stopCallback(Ct,Ct.target||Ct.srcElement,Lt,Ot)||K(Ct,Lt)===!1&&(p(Ct),m(Ct))}X._handleKey=function(K,Ct,Lt){var Ot=W(K,Ct,Lt),re,be={},ee=0,Oe=!1;for(re=0;re<Ot.length;++re)Ot[re].seq&&(ee=Math.max(ee,Ot[re].level));for(re=0;re<Ot.length;++re){if(Ot[re].seq){if(Ot[re].level!=ee)continue;Oe=!0,be[Ot[re].seq]=1,lt(Ot[re].callback,Lt,Ot[re].combo,Ot[re].seq);continue}Oe||lt(Ot[re].callback,Lt,Ot[re].combo)}var Zt=Lt.type=="keypress"&&H;Lt.type==Ut&&!b(K)&&!Zt&&zt(be),H=Oe&&Lt.type=="keydown"};function Rt(K){typeof K.which!="number"&&(K.which=K.keyCode);var Ct=f(K);if(Ct){if(K.type=="keyup"&&ft===Ct){ft=!1;return}X.handleKey(Ct,d(K),K)}}function Xt(){clearTimeout(at),at=setTimeout(zt,1e3)}function ot(K,Ct,Lt,Ot){Z[K]=0;function re(Yt){return function(){Ut=Yt,++Z[K],Xt()}}function be(Yt){lt(Lt,Yt,K),Ot!=="keyup"&&(ft=f(Yt)),setTimeout(zt,10)}for(var ee=0;ee<Ct.length;++ee){var Oe=ee+1===Ct.length,Zt=Oe?be:re(Ot||O(Ct[ee+1]).action);et(Ct[ee],Zt,Ot,K,ee)}}function et(K,Ct,Lt,Ot,re){X._directMap[K+":"+Lt]=Ct,K=K.replace(/\s+/g," ");var be=K.split(" "),ee;if(be.length>1){ot(K,be,Ct,Lt);return}ee=O(K,Lt),X._callbacks[ee.key]=X._callbacks[ee.key]||[],W(ee.key,ee.modifiers,{type:ee.action},Ot,K,re),X._callbacks[ee.key][Ot?"unshift":"push"]({callback:Ct,modifiers:ee.modifiers,action:ee.action,seq:Ot,level:re,combo:K})}X._bindMultiple=function(K,Ct,Lt){for(var Ot=0;Ot<K.length;++Ot)et(K[Ot],Ct,Lt)},u(k,"keypress",Rt),u(k,"keydown",Rt),u(k,"keyup",Rt)}G.prototype.bind=function(k,X,Z){var at=this;return k=k instanceof Array?k:[k],at._bindMultiple.call(at,k,X,Z),at},G.prototype.unbind=function(k,X){var Z=this;return Z.bind.call(Z,k,function(){},X)},G.prototype.trigger=function(k,X){var Z=this;return Z._directMap[k+":"+X]&&Z._directMap[k+":"+X]({},k),Z},G.prototype.reset=function(){var k=this;return k._callbacks={},k._directMap={},k},G.prototype.stopCallback=function(k,X){var Z=this;if((" "+X.className+" ").indexOf(" mousetrap ")>-1||I(X,Z.target))return!1;if("composedPath"in k&&typeof k.composedPath=="function"){var at=k.composedPath()[0];at!==k.target&&(X=at)}return X.tagName=="INPUT"||X.tagName=="SELECT"||X.tagName=="TEXTAREA"||X.isContentEditable},G.prototype.handleKey=function(){var k=this;return k._handleKey.apply(k,arguments)},G.addKeycodes=function(k){for(var X in k)k.hasOwnProperty(X)&&(i[X]=k[X]);c=null},G.init=function(){var k=G(e);for(var X in k)X.charAt(0)!=="_"&&(G[X]=function(Z){return function(){return k[Z].apply(k,arguments)}}(X))},G.init(),t.Mousetrap=G,n.exports&&(n.exports=G)})(typeof window<"u"?window:null,typeof window<"u"?document:null)})(Hv);var NI=Hv.exports;const LI=kx(NI);var II=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Ps extends Rn{get graph(){return this.options.graph}constructor(t){super(),this.options=t;const e=this.graph.getPlugin("scroller");this.container=e?e.container:this.graph.container,t.global?this.target=document:(this.target=this.container,this.disabled||this.target.setAttribute("tabindex","-1"),this.graph.on("cell:mouseup",this.focus,this),this.graph.on("blank:mouseup",this.focus,this)),this.mousetrap=Ps.createMousetrap(this)}get disabled(){return this.options.enabled!==!0}enable(){this.disabled&&(this.options.enabled=!0,this.target instanceof HTMLElement&&this.target.setAttribute("tabindex","-1"))}disable(){this.disabled||(this.options.enabled=!1,this.target instanceof HTMLElement&&this.target.removeAttribute("tabindex"))}on(t,e,r){this.mousetrap.bind(this.getKeys(t),e,r)}off(t,e){this.mousetrap.unbind(this.getKeys(t),e)}clear(){this.mousetrap.reset()}trigger(t,e){this.mousetrap.trigger(t,e)}focus(t){if(this.isInputEvent(t.e))return;this.target.focus({preventScroll:!0})}getKeys(t){return(Array.isArray(t)?t:[t]).map(e=>this.formatkey(e))}formatkey(t){const e=t.toLocaleLowerCase().replace(/\s/g,"").replace("delete","del").replace("cmd","command").replace("arrowup","up").replace("arrowright","right").replace("arrowdown","down").replace("arrowleft","left"),r=this.options.format;return r?Qt(r,this.graph,e):e}isGraphEvent(t){const e=t.target,r=t.currentTarget;return e?e===this.target||r===this.target||e===document.body?!0:ah(this.container,e):!1}isInputEvent(t){var e;const r=t.target,i=(e=r==null?void 0:r.tagName)===null||e===void 0?void 0:e.toLowerCase();let s=["input","textarea"].includes(i);return ye(r,"contenteditable")==="true"&&(s=!0),s}isEnabledForEvent(t){const e=!this.disabled&&this.isGraphEvent(t),r=this.isInputEvent(t);if(e){if(r&&(t.key==="Backspace"||t.key==="Delete"))return!1;if(this.options.guard)return Qt(this.options.guard,this.graph,t)}return e}dispose(){this.mousetrap.reset()}}II([Rn.dispose()],Ps.prototype,"dispose",null);(function(n){function t(e){const r=new LI(e.target),i=r.stopCallback;return r.stopCallback=(s,o,a)=>e.isEnabledForEvent(s)?i?i.call(r,s,o,a):!1:!0,r}n.createMousetrap=t})(Ps||(Ps={}));_t.prototype.isKeyboardEnabled=function(){const n=this.getPlugin("keyboard");return n?n.isEnabled():!1};_t.prototype.enableKeyboard=function(){const n=this.getPlugin("keyboard");return n&&n.enable(),this};_t.prototype.disableKeyboard=function(){const n=this.getPlugin("keyboard");return n&&n.disable(),this};_t.prototype.toggleKeyboard=function(n){const t=this.getPlugin("keyboard");return t&&t.toggleEnabled(n),this};_t.prototype.bindKey=function(n,t,e){const r=this.getPlugin("keyboard");return r&&r.bindKey(n,t,e),this};_t.prototype.unbindKey=function(n,t){const e=this.getPlugin("keyboard");return e&&e.unbindKey(n,t),this};_t.prototype.clearKeys=function(){const n=this.getPlugin("keyboard");return n&&n.clear(),this};_t.prototype.triggerKey=function(n,t){const e=this.getPlugin("keyboard");return e&&e.trigger(n,t),this};var DI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class kI extends Rn{constructor(t={}){super(),this.name="keyboard",this.options=Object.assign({enabled:!0},t)}init(t){this.keyboardImpl=new Ps(Object.assign(Object.assign({},this.options),{graph:t}))}isEnabled(){return!this.keyboardImpl.disabled}enable(){this.keyboardImpl.enable()}disable(){this.keyboardImpl.disable()}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}bindKey(t,e,r){return this.keyboardImpl.on(t,e,r),this}trigger(t,e){return this.keyboardImpl.trigger(t,e),this}clear(){return this.keyboardImpl.clear(),this}unbindKey(t,e){return this.keyboardImpl.off(t,e),this}dispose(){this.keyboardImpl.dispose()}}DI([Rn.dispose()],kI.prototype,"dispose",null);class BI{constructor(){this.cells=[]}copy(t,e,r={}){this.options=Object.assign({},r);const s=(pn.isModel(e)?e:e.model).cloneSubGraph(t,r);this.cells=Nu(Object.keys(s).map(o=>s[o]),o=>o.isEdge()?2:1),this.serialize(r)}cut(t,e,r={}){this.copy(t,e,r),(_t.isGraph(e)?e.model:e).batchUpdate("cut",()=>{t.forEach(s=>s.remove())})}paste(t,e={}){const r=Object.assign(Object.assign({},this.options),e),{offset:i,edgeProps:s,nodeProps:o}=r;let a=20,c=20;i&&(a=typeof i=="number"?i:i.dx,c=typeof i=="number"?i:i.dy),this.deserialize(r);const l=this.cells;l.forEach(f=>{f.model=null,f.removeProp("zIndex"),(a||c)&&f.translate(a,c),o&&f.isNode()&&f.prop(o),s&&f.isEdge()&&f.prop(s)});const u=_t.isGraph(t)?t.model:t;return u.batchUpdate("paste",()=>{u.addCells(this.cells)}),this.copy(l,t,e),l}serialize(t){t.useLocalStorage!==!1&&yo.save(this.cells)}deserialize(t){if(t.useLocalStorage){const e=yo.fetch();e&&(this.cells=e)}}isEmpty(t={}){return t.useLocalStorage&&this.deserialize(t),this.cells.length<=0}clean(){this.options={},this.cells=[],yo.clean()}}var yo;(function(n){const t=`${Kn.prefixCls}.clipboard.cells`;function e(s){if(window.localStorage){const o=s.map(a=>a.toJSON());localStorage.setItem(t,JSON.stringify(o))}}n.save=e;function r(){if(window.localStorage){const s=localStorage.getItem(t),o=s?JSON.parse(s):[];if(o)return pn.fromJSON(o)}}n.fetch=r;function i(){window.localStorage&&localStorage.removeItem(t)}n.clean=i})(yo||(yo={}));_t.prototype.isClipboardEnabled=function(){const n=this.getPlugin("clipboard");return n?n.isEnabled():!1};_t.prototype.enableClipboard=function(){const n=this.getPlugin("clipboard");return n&&n.enable(),this};_t.prototype.disableClipboard=function(){const n=this.getPlugin("clipboard");return n&&n.disable(),this};_t.prototype.toggleClipboard=function(n){const t=this.getPlugin("clipboard");return t&&t.toggleEnabled(n),this};_t.prototype.isClipboardEmpty=function(n){const t=this.getPlugin("clipboard");return t?t.isEmpty(n):!0};_t.prototype.getCellsInClipboard=function(){const n=this.getPlugin("clipboard");return n?n.getCellsInClipboard():[]};_t.prototype.cleanClipboard=function(){const n=this.getPlugin("clipboard");return n&&n.clean(),this};_t.prototype.copy=function(n,t){const e=this.getPlugin("clipboard");return e&&e.copy(n,t),this};_t.prototype.cut=function(n,t){const e=this.getPlugin("clipboard");return e&&e.cut(n,t),this};_t.prototype.paste=function(n,t){const e=this.getPlugin("clipboard");return e?e.paste(n,t):[]};var jI=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s},FI=function(n,t){var e={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&t.indexOf(r)<0&&(e[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(e[r[i]]=n[r[i]]);return e};class GI extends $e{get disabled(){return this.options.enabled!==!0}get cells(){return this.clipboardImpl.cells}constructor(t={}){super(),this.name="clipboard",this.options=Object.assign({enabled:!0},t)}init(t){this.graph=t,this.clipboardImpl=new BI,this.clipboardImpl.deserialize(this.options)}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}isEmpty(t={}){return this.clipboardImpl.isEmpty(t)}getCellsInClipboard(){return this.cells}clean(t){return(!this.disabled||t)&&(this.clipboardImpl.clean(),this.notify("clipboard:changed",{cells:[]})),this}copy(t,e={}){return this.disabled||(this.clipboardImpl.copy(t,this.graph,Object.assign(Object.assign({},this.commonOptions),e)),this.notify("clipboard:changed",{cells:t})),this}cut(t,e={}){return this.disabled||(this.clipboardImpl.cut(t,this.graph,Object.assign(Object.assign({},this.commonOptions),e)),this.notify("clipboard:changed",{cells:t})),this}paste(t={},e=this.graph){return this.disabled?[]:this.clipboardImpl.paste(e,Object.assign(Object.assign({},this.commonOptions),t))}get commonOptions(){const t=this.options;return FI(t,["enabled"])}notify(t,e){this.trigger(t,e),this.graph.trigger(t,e)}dispose(){this.clean(!0),this.off()}}jI([$e.dispose()],GI.prototype,"dispose",null);_t.prototype.isHistoryEnabled=function(){const n=this.getPlugin("history");return n?n.isEnabled():!1};_t.prototype.enableHistory=function(){const n=this.getPlugin("history");return n&&n.enable(),this};_t.prototype.disableHistory=function(){const n=this.getPlugin("history");return n&&n.disable(),this};_t.prototype.toggleHistory=function(n){const t=this.getPlugin("history");return t&&t.toggleEnabled(n),this};_t.prototype.undo=function(n){const t=this.getPlugin("history");return t&&t.undo(n),this};_t.prototype.redo=function(n){const t=this.getPlugin("history");return t&&t.redo(n),this};_t.prototype.undoAndCancel=function(n){const t=this.getPlugin("history");return t&&t.cancel(n),this};_t.prototype.canUndo=function(){const n=this.getPlugin("history");return n?n.canUndo():!1};_t.prototype.canRedo=function(){const n=this.getPlugin("history");return n?n.canRedo():!1};_t.prototype.cleanHistory=function(n){const t=this.getPlugin("history");return t&&t.clean(n),this};_t.prototype.getHistoryStackSize=function(){return this.getPlugin("history").getSize()};_t.prototype.getUndoStackSize=function(){return this.getPlugin("history").getUndoSize()};_t.prototype.getRedoStackSize=function(){return this.getPlugin("history").getRedoSize()};_t.prototype.getUndoRemainSize=function(){return this.getPlugin("history").getUndoRemainSize()};var Xv=function(n,t,e,r){var i=arguments.length,s=i<3?t:r===null?r=Object.getOwnPropertyDescriptor(t,e):r,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(n,t,e,r);else for(var a=n.length-1;a>=0;a--)(o=n[a])&&(s=(i<3?o(s):i>3?o(t,e,s):o(t,e))||s);return i>3&&s&&Object.defineProperty(t,e,s),s};class Fo extends $e{constructor(t={}){super(),this.name="history",this.batchCommands=null,this.batchLevel=0,this.lastBatchIndex=-1,this.freezed=!1,this.stackSize=0,this.handlers=[];const{stackSize:e=0}=t;this.stackSize=e,this.options=Ve.getOptions(t),this.validator=new Fo.Validator({history:this,cancelInvalid:this.options.cancelInvalid})}init(t){this.graph=t,this.model=this.graph.model,this.clean(),this.startListening()}isEnabled(){return!this.disabled}enable(){this.disabled&&(this.options.enabled=!0)}disable(){this.disabled||(this.options.enabled=!1)}toggleEnabled(t){return t!=null?t!==this.isEnabled()&&(t?this.enable():this.disable()):this.isEnabled()?this.disable():this.enable(),this}undo(t={}){if(!this.disabled){const e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack.push(e),this.notify("undo",e,t))}return this}redo(t={}){if(!this.disabled){const e=this.redoStack.pop();e&&(this.applyCommand(e,t),this.undoStackPush(e),this.notify("redo",e,t))}return this}cancel(t={}){if(!this.disabled){const e=this.undoStack.pop();e&&(this.revertCommand(e,t),this.redoStack=[],this.notify("cancel",e,t))}return this}getSize(){return this.stackSize}getUndoRemainSize(){const t=this.undoStack.length;return this.stackSize-t}getUndoSize(){return this.undoStack.length}getRedoSize(){return this.redoStack.length}canUndo(){return!this.disabled&&this.undoStack.length>0}canRedo(){return!this.disabled&&this.redoStack.length>0}clean(t={}){return this.undoStack=[],this.redoStack=[],this.notify("clean",null,t),this}get disabled(){return this.options.enabled!==!0}validate(t,...e){return this.validator.validate(t,...e),this}startListening(){this.model.on("batch:start",this.initBatchCommand,this),this.model.on("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&this.options.eventNames.forEach((t,e)=>{this.handlers[e]=this.addCommand.bind(this,t),this.model.on(t,this.handlers[e])}),this.validator.on("invalid",t=>this.trigger("invalid",t))}stopListening(){this.model.off("batch:start",this.initBatchCommand,this),this.model.off("batch:stop",this.storeBatchCommand,this),this.options.eventNames&&(this.options.eventNames.forEach((t,e)=>{this.model.off(t,this.handlers[e])}),this.handlers.length=0),this.validator.off("invalid")}createCommand(t){return{batch:t?t.batch:!1,data:{}}}revertCommand(t,e){this.freezed=!0;const r=Array.isArray(t)?Ve.sortBatchCommands(t):[t];for(let i=r.length-1;i>=0;i-=1){const s=r[i],o=Object.assign(Object.assign({},e),wd(s.options,this.options.revertOptionsList||[]));this.executeCommand(s,!0,o)}this.freezed=!1}applyCommand(t,e){this.freezed=!0;const r=Array.isArray(t)?Ve.sortBatchCommands(t):[t];for(let i=0;i<r.length;i+=1){const s=r[i],o=Object.assign(Object.assign({},e),wd(s.options,this.options.applyOptionsList||[]));this.executeCommand(s,!1,o)}this.freezed=!1}executeCommand(t,e,r){const i=this.model,s=i.getCell(t.data.id),o=t.event;if(Ve.isAddEvent(o)&&e||Ve.isRemoveEvent(o)&&!e)s&&s.remove(r);else if(Ve.isAddEvent(o)&&!e||Ve.isRemoveEvent(o)&&e){const a=t.data;a.node?i.addNode(a.props,r):a.edge&&i.addEdge(a.props,r)}else if(Ve.isChangeEvent(o)){const a=t.data,c=a.key;if(c&&s){const l=e?a.prev[c]:a.next[c];a.key==="attrs"&&this.ensureUndefinedAttrs(l,e?a.next[c]:a.prev[c])&&(r.dirty=!0),s.prop(c,l,r)}}else{const a=this.options.executeCommand;a&&Qt(a,this,t,e,r)}}addCommand(t,e){if(this.freezed||this.disabled)return;const r=e,i=r.options||{};if(i.dryrun||Ve.isAddEvent(t)&&this.options.ignoreAdd||Ve.isRemoveEvent(t)&&this.options.ignoreRemove||Ve.isChangeEvent(t)&&this.options.ignoreChange)return;const s=this.options.beforeAddCommand;if(s!=null&&Qt(s,this,t,e)===!1)return;t==="cell:change:*"&&(t=`cell:change:${r.key}`);const o=r.cell,a=pn.isModel(o);let c;if(this.batchCommands){c=this.batchCommands[Math.max(this.lastBatchIndex,0)];const u=a&&!c.modelChange||c.data.id!==o.id,f=c.event!==t;if(this.lastBatchIndex>=0&&(u||f)){const h=this.batchCommands.findIndex(d=>(a&&d.modelChange||d.data.id===o.id)&&d.event===t);h<0||Ve.isAddEvent(t)||Ve.isRemoveEvent(t)?c=this.createCommand({batch:!0}):(c=this.batchCommands[h],this.batchCommands.splice(h,1)),this.batchCommands.push(c),this.lastBatchIndex=this.batchCommands.length-1}}else c=this.createCommand({batch:!1});if(Ve.isAddEvent(t)||Ve.isRemoveEvent(t)){const u=c.data;return c.event=t,c.options=i,u.id=o.id,u.props=De(o.toJSON()),o.isEdge()?u.edge=!0:o.isNode()&&(u.node=!0),this.push(c,i)}if(Ve.isChangeEvent(t)){const u=e.key,f=c.data;return(!c.batch||!c.event)&&(c.event=t,c.options=i,f.key=u,f.prev==null&&(f.prev={}),f.prev[u]=De(o.previous(u)),a?c.modelChange=!0:f.id=o.id),f.next==null&&(f.next={}),f.next[u]=De(o.prop(u)),this.push(c,i)}const l=this.options.afterAddCommand;l&&Qt(l,this,t,e,c),this.push(c,i)}initBatchCommand(t){this.freezed||(this.batchCommands?this.batchLevel+=1:(this.batchCommands=[this.createCommand({batch:!0})],this.batchLevel=0,this.lastBatchIndex=-1))}storeBatchCommand(t){if(!this.freezed)if(this.batchCommands&&this.batchLevel<=0){const e=this.filterBatchCommand(this.batchCommands);e.length>0&&(this.redoStack=[],this.undoStackPush(e),this.consolidateCommands(),this.notify("add",e,t)),this.batchCommands=null,this.lastBatchIndex=-1,this.batchLevel=0}else this.batchCommands&&this.batchLevel>0&&(this.batchLevel-=1)}filterBatchCommand(t){let e=t.slice();const r=[];for(;e.length>0;){const i=e.shift(),s=i.event,o=i.data.id;if(s!=null&&(o!=null||i.modelChange)){if(Ve.isAddEvent(s)){const a=e.findIndex(c=>Ve.isRemoveEvent(c.event)&&c.data.id===o);if(a>=0){e=e.filter((c,l)=>a<l||c.data.id!==o);continue}}else if(Ve.isRemoveEvent(s)){const a=e.findIndex(c=>Ve.isAddEvent(c.event)&&c.data.id===o);if(a>=0){e.splice(a,1);continue}}else if(Ve.isChangeEvent(s)){const a=i.data;if(mr(a.prev,a.next))continue}r.push(i)}}return r}notify(t,e,r){const i=e==null?null:Array.isArray(e)?e:[e];this.emit(t,{cmds:i,options:r}),this.graph.trigger(`history:${t}`,{cmds:i,options:r}),this.emit("change",{cmds:i,options:r}),this.graph.trigger("history:change",{cmds:i,options:r})}push(t,e){this.redoStack=[],t.batch?(this.lastBatchIndex=Math.max(this.lastBatchIndex,0),this.emit("batch",{cmd:t,options:e})):(this.undoStackPush(t),this.consolidateCommands(),this.notify("add",t,e))}consolidateCommands(){var t;const e=this.undoStack[this.undoStack.length-1],r=this.undoStack[this.undoStack.length-2];if(!Array.isArray(e))return;const i=new Set(e.map(o=>o.event));if(i.size!==2||!i.has("cell:change:parent")||!i.has("cell:change:children")||!e.every(o=>{var a;return o.batch&&((a=o.options)===null||a===void 0?void 0:a.ui)})||!Array.isArray(r)||r.length!==1)return;const s=r[0];s.event!=="cell:change:position"||!(!((t=s.options)===null||t===void 0)&&t.ui)||(r.push(...e),this.undoStack.pop())}undoStackPush(t){if(this.stackSize===0){this.undoStack.push(t);return}this.undoStack.length>=this.stackSize&&this.undoStack.shift(),this.undoStack.push(t)}ensureUndefinedAttrs(t,e){let r=!1;return t!==null&&e!==null&&typeof t=="object"&&typeof e=="object"&&Object.keys(e).forEach(i=>{t[i]===void 0&&e[i]!==void 0?(t[i]=void 0,r=!0):typeof t[i]=="object"&&typeof e[i]=="object"&&(r=this.ensureUndefinedAttrs(t[i],e[i]))}),r}dispose(){this.validator.dispose(),this.clean(),this.stopListening(),this.off()}}Xv([$e.dispose()],Fo.prototype,"dispose",null);(function(n){class t extends $e{constructor(r){super(),this.map={},this.command=r.history,this.cancelInvalid=r.cancelInvalid!==!1,this.command.on("add",this.onCommandAdded,this)}onCommandAdded({cmds:r}){return Array.isArray(r)?r.every(i=>this.isValidCommand(i)):this.isValidCommand(r)}isValidCommand(r){if(r.options&&r.options.validation===!1)return!0;const i=r.event&&this.map[r.event]||[];let s=null;return i.forEach(o=>{let a=0;const c=l=>{const u=o[a];a+=1;try{if(u)u(l,r,c);else{s=l;return}}catch(f){c(f)}};c(s)}),s?(this.cancelInvalid&&this.command.cancel(),this.emit("invalid",{err:s}),!1):!0}validate(r,...i){const s=Array.isArray(r)?r:r.split(/\s+/);return i.forEach(o=>{if(typeof o!="function")throw new Error(`${s.join(" ")} requires callback functions.`)}),s.forEach(o=>{this.map[o]==null&&(this.map[o]=[]),this.map[o].push(i)}),this}dispose(){this.command.off("add",this.onCommandAdded,this)}}Xv([$e.dispose()],t.prototype,"dispose",null),n.Validator=t})(Fo||(Fo={}));var Ve;(function(n){function t(o){return o==="cell:added"}n.isAddEvent=t;function e(o){return o==="cell:removed"}n.isRemoveEvent=e;function r(o){return o!=null&&o.startsWith("cell:change:")}n.isChangeEvent=r;function i(o){const a=["cell:added","cell:removed","cell:change:*"],c=["batch:start","batch:stop"],l=o.eventNames?o.eventNames.filter(u=>!(n.isChangeEvent(u)||a.includes(u)||c.includes(u))):a;return Object.assign(Object.assign({enabled:!0},o),{eventNames:l,applyOptionsList:o.applyOptionsList||["propertyPath"],revertOptionsList:o.revertOptionsList||["propertyPath"]})}n.getOptions=i;function s(o){const a=[];for(let c=0,l=o.length;c<l;c+=1){const u=o[c];let f=null;if(n.isAddEvent(u.event)){const h=u.data.id;for(let d=0;d<c;d+=1)if(o[d].data.id===h){f=d;break}}f!==null?a.splice(f,0,u):a.push(u)}return a}n.sortBatchCommands=s})(Ve||(Ve={}));export{mh as B,Kn as C,WI as D,Tn as E,yr as G,Fo as H,kI as K,Yr as M,Wr as P,Bt as R,jo as S,Ms as T,Me as U,Ce as V,qt as a,ch as b,dn as c,zn as d,Hr as e,qI as f,Qt as g,nr as h,R as i,_t as j,$e as k,ks as l,Bs as m,Pi as n,RI as o,GI as p,Bo as q,Fe as r,WL as s,VI as u};
