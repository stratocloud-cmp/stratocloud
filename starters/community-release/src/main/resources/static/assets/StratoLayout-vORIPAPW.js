import{o as v,b as T,t as L,u as _,r as d,m as z,n as y,q as C,w as n,e as t,s as Z,i as E,v as J,l as V,F as A,x as ee,y as O,z as te,d as x,f as ne,A as Q,B as F,C as H,D as X,p as ae,k as re,G as oe,H as se,I as U,J as G,K as ue,L as $,M as le,R as ie}from"./index-C_jnbPMf.js";import{u as P}from"./activeMenu-UZpNpzlf.js";import{d as ce}from"./resource-DdTtSOFP.js";import{u as j}from"./request-BV6gXtmx.js";import de from"./Job-BrxKQ4gm.js";import{u as me}from"./activeJob-H4xjMLbI.js";import{_ as pe,a as fe}from"./UpdateUserForm-BMOXtGcr.js";import{_ as q}from"./StratoDrawer-BQ9z9CYD.js";import{c as ve,u as _e,d as ge}from"./user-BKxh-AQB.js";import{d as he,s as Me,a as be}from"./cartItem-Pm_BcKjw.js";import{S as K,_ as Y}from"./StratoButton-D7m4JR2l.js";import"./StratoTable--zpPaOW_.js";import"./job-B1agJq36.js";import"./asyncJob-ClCdQ0iF.js";const Ie={style:{"font-size":"24px"}},ye={__name:"StratoContentHeader",setup(M){const s=P();return(a,m)=>{var u;return v(),T("span",Ie,L((u=_(s).activeMenu)==null?void 0:u.menuName),1)}}},Se=""+new URL("../svg/StratoCloudSmall.svg",import.meta.url).href,Ce=[{menuName:"云账号",path:"/configuration/external-account",permissionTarget:"ExternalAccount"},{menuName:"租户管理",path:"/configuration/tenant",permissionTarget:"Tenant"},{menuName:"用户管理",path:"/configuration/user",permissionTarget:"User"},{menuName:"角色管理",path:"/configuration/role",permissionTarget:"Role"},{menuName:"用户组管理",path:"/configuration/user-group",permissionTarget:"UserGroup"},{menuName:"标签管理",path:"/configuration/tag",permissionTarget:"ResourceTag"},{menuName:"IP池",path:"/configuration/ip-pool",permissionTarget:"IpPool"},{menuName:"资源栈蓝图",path:"/configuration/blueprint",permissionTarget:"Blueprint"},{menuName:"流程管理",path:"/configuration/workflow",permissionTarget:"Workflow"},{menuName:"任务类型",path:"/configuration/job-definitions",permissionTarget:"JobDefinition"},{menuName:"定时任务",path:"/configuration/job-triggers",permissionTarget:"JobTrigger"},{menuName:"脚本库",path:"/configuration/script-definition",permissionTarget:"ScriptDefinition"},{menuName:"软件库",path:"/configuration/software-definition",permissionTarget:"SoftwareDefinition"}],we=[{menuName:"我的工单",path:"/order/my-orders",permissionTarget:"Order"},{menuName:"待办工单",path:"/order/to-do-orders",permissionTarget:"Order"},{menuName:"已办工单",path:"/order/done-orders",permissionTarget:"Order"},{menuName:"所有工单",path:"/order/all-orders",permissionTarget:"Order"},{menuName:"任务",path:"/order/jobs",permissionTarget:"Job"},{menuName:"审计日志",path:"/order/audit-log",permissionTarget:"AuditLog"}],Ne=[{menuName:"资源栈",path:"/resource/stacks",permissionTarget:"ResourceStack"}],Ee={__name:"StratoHeaderJobButton",setup(M){const s=d(!1),a=d(),m=me(),u=d(!1);return z(()=>m.activeJobId,()=>{m.activeJobId!==void 0&&a.value.refresh().then(()=>{s.value=!0,u.value=!0,setTimeout(()=>{s.value=!1,u.value=!1},5e3)})}),(o,p)=>{const r=y("ElButton"),b=y("ElIcon"),i=y("ElText"),h=y("ElPopover");return v(),C(h,{visible:s.value,"onUpdate:visible":p[0]||(p[0]=N=>s.value=N),placement:"bottom-end",width:800,trigger:"click"},{reference:n(()=>[t(r,{size:"large",class:"job-button",icon:"List"})]),default:n(()=>[u.value?(v(),C(i,{key:0,style:{float:"left","margin-right":"20px"},type:"success"},{default:n(()=>[t(b,null,{default:n(()=>[t(_(Z))]),_:1}),E("任务已提交 ")]),_:1})):J("",!0),t(de,{ref_key:"jobRef",ref:a,"simple-mode":"","my-job":""},null,512)]),_:1},8,["visible"])}}},Te={__name:"StratoHeaderUserConfigButton",setup(M){const s=j(),a=P(),m=V();function u(){a.setCurrentSideMenus(void 0),a.setActiveMenu(void 0),s.setSession(void 0),m.push("/login")}const o=d(!1),p=d(),r=d({userId:s.userId});function b(){o.value=!0}function i(){p.value.validate(c=>{c&&ve(r.value).then(()=>{o.value=!1})})}const h=d(!1),N=d(),S=d({});function D(){ge({userIds:[s.userId]}).then(c=>{(!c.content||c.content.length===0)&&ee.error("用户不存在"),S.value.userId=c.content[0].id,S.value.realName=c.content[0].realName,S.value.emailAddress=c.content[0].emailAddress,S.value.phoneNumber=c.content[0].phoneNumber,S.value.description=c.content[0].description,h.value=!0})}function R(){N.value.validate(c=>{c&&_e(S.value).then(()=>{h.value=!1})})}function f(c){switch(c){case"logout":u();break;case"changePassword":b();break;case"updateSelf":D();break}}return(c,e)=>{const I=y("ElButton"),g=y("ElDropdownItem"),w=y("ElDropdownMenu"),B=y("ElDropdown");return v(),T(A,null,[t(B,{onCommand:f,trigger:"click"},{dropdown:n(()=>[t(w,null,{default:n(()=>[t(g,{command:"updateSelf"},{default:n(()=>[E("个人信息")]),_:1}),t(g,{command:"changePassword"},{default:n(()=>[E("修改密码")]),_:1}),t(g,{command:"logout"},{default:n(()=>[E("退出登录")]),_:1})]),_:1})]),default:n(()=>[t(I,{size:"large",class:"user-config-button",icon:"UserFilled"})]),_:1}),t(q,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=k=>o.value=k),title:"修改密码",onOnConfirm:i},{default:n(()=>[t(pe,{ref_key:"changePasswordFormRef",ref:p,modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=k=>r.value=k)},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(q,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=k=>h.value=k),title:"个人信息",onOnConfirm:R},{default:n(()=>[t(fe,{ref_key:"updateFormRef",ref:N,modelValue:S.value,"onUpdate:modelValue":e[2]||(e[2]=k=>S.value=k)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},xe={style:{height:"32px"}},ke={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Le=["innerHTML"],Ae={__name:"CartItem",setup(M,{expose:s}){const a=d(),m=d([]),u=d([]);function o(){he(r.value).then(f=>{u.value=f.cartItems})}function p(){return m.value.map(f=>f.id)}const r=d({});z(r,o,{immediate:!0}),s({getTotal:i});const b=d();O(()=>{b.value=setInterval(o,5e3)}),te(()=>{clearInterval(b.value)});function i(){return u.value.length}const h=d(!1);function N(){h.value=!0;const c={cartItemIds:p()};Me(c).then(()=>{var e;o(),(e=a.value)==null||e.clearSelection()}).finally(()=>{h.value=!1})}const S=d(!1);function D(){S.value=!0;const c={cartItemIds:p()};be(c).then(()=>{var e;o(),(e=a.value)==null||e.clearSelection()}).finally(()=>{S.value=!1})}function R(f){m.value=f}return(f,c)=>{const e=y("ElTableColumn"),I=y("ElTooltip"),g=y("ElTable");return v(),T(A,null,[x("div",xe,[t(K,{disabled:m.value.length<=0,loading:h.value,size:"small",type:"primary",onClick:N},{default:n(()=>[E(" 提交 ")]),_:1},8,["disabled","loading"]),t(K,{disabled:m.value.length<=0,loading:S.value,size:"small",type:"danger",plain:"",onClick:D},{default:n(()=>[E(" 删除 ")]),_:1},8,["disabled","loading"]),t(_(ne),{size:"small",style:{float:"right",width:"20%"},modelValue:r.value.search,"onUpdate:modelValue":c[0]||(c[0]=w=>r.value.search=w),"suffix-icon":"search"},null,8,["modelValue"])]),t(g,{ref_key:"tableRef",ref:a,size:"small",data:u.value,"row-key":"id","max-height":"600","show-overflow-tooltip":!1,onSelectionChange:R},{default:n(()=>[t(e,{type:"selection","reserve-selection":""}),t(e,{prop:"jobTypeName",label:"待办任务",sortable:"custom"}),t(e,{prop:"summary",label:"任务详情"},{default:n(w=>[t(I,null,{content:n(()=>[x("span",{style:{"white-space":"pre-wrap"},innerHTML:w.row.summary},null,8,Le)]),default:n(()=>[x("div",ke,L(w.row.summary),1)]),_:2},1024)]),_:1}),t(e,{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["data"])],64)}}},De={__name:"StratoHeaderCartButton",setup(M){const s=d(!1),a=Q(()=>{var u;return(u=m.value)==null?void 0:u.getTotal()}),m=d();return(u,o)=>{const p=y("ElButton"),r=y("ElBadge"),b=y("ElPopover");return v(),C(b,{visible:s.value,"onUpdate:visible":o[0]||(o[0]=i=>s.value=i),placement:"bottom-end",width:800,trigger:"click"},{reference:n(()=>[t(r,{"is-dot":a.value>0,type:"warning",offset:[-10,10]},{default:n(()=>[t(p,{size:"large",class:"job-button",icon:"ShoppingCart"})]),_:1},8,["is-dot"])]),default:n(()=>[t(Ae,{ref_key:"cartItemRef",ref:m},null,512)]),_:1},8,["visible"])}}},Re=M=>(ae("data-v-11938713"),M=M(),re(),M),Ve={class:"strato-header"},Pe=Re(()=>x("img",{style:{"margin-left":"5px"},src:Se,alt:"StratoCloud"},null,-1)),Be={style:{float:"right","margin-right":"6px"}},Ue={__name:"StratoHeader",setup(M){const s=d("0"),a=P(),m=j(),u=d([]),o=d([]),p=d([]),r=V();async function b(){await ce({}).then(e=>{const I=[];if(e.resourceCategories&&e.resourceCategories.length>0)for(let g of e.resourceCategories)i(g.categoryId)&&I.push({menuName:g.categoryName,path:"/resource/list/"+g.categoryId,subMenuId:g.groupId,subMenuName:g.groupName});for(let g of Ne)i(g.permissionTarget)&&I.push(g);u.value=I,I.length>0&&f.value.push({name:"云资源",pathPrefix:"/resource/",handler:S,sideMenuList:u.value})})}function i(e){var I;return m.session?m.session.roleType==="SUPER_ADMIN"||m.session.roleType==="TENANT_SUPER_ADMIN"?!0:(I=m.session.permissions[e])==null?void 0:I.includes("READ"):!1}async function h(){for(let e of we)e.path==="/order/all-orders"&&m.isNormalUser||i(e.permissionTarget)&&o.value.push(e);o.value.length>0&&f.value.push({name:"工单与任务",pathPrefix:"/order/",handler:D,sideMenuList:o.value})}async function N(){for(let e of Ce)i(e.permissionTarget)&&p.value.push(e);p.value.length>0&&f.value.push({name:"配置中心",pathPrefix:"/configuration/",handler:R,sideMenuList:p.value})}const S=()=>{a.setCurrentSideMenus(u.value),u.value.length>0&&(a.setActiveMenu(u.value[0]),r.push(u.value[0].path))},D=()=>{a.setCurrentSideMenus(o.value),o.value.length>0&&(a.setActiveMenu(o.value[0]),r.push(o.value[0].path))},R=()=>{a.setCurrentSideMenus(p.value),p.value.length>0&&(a.setActiveMenu(p.value[0]),r.push(p.value[0].path))},f=d([]);function c(){const e=r.currentRoute.value.path;a.setActiveMenu(void 0);for(let I=0;I<f.value.length;I++){const g=f.value[I];for(let w of g.sideMenuList)if(e===w.path)return a.setCurrentSideMenus(g.sideMenuList),a.setActiveMenu(w),s.value=I+"",!0}return console.warn(`Menu of path ${e} not found.`),!1}return z(r.currentRoute,()=>{c()}),O(async()=>{if(await b(),await h(),await N(),!a.activeMenu){f.value[s.value].handler();return}if(a.activeMenu&&!c()){for(let e=0;e<f.value.length;e++)if(a.activeMenu.path.startsWith(f.value[e].pathPrefix)){a.setCurrentSideMenus(f.value[e].sideMenuList),s.value=e+"";return}f.value[s.value].handler()}}),(e,I)=>{const g=y("ElButtonGroup");return v(),T("div",Ve,[Pe,t(_(X),{"default-active":s.value,style:{"margin-right":"200px",border:"0"},mode:"horizontal",ellipsis:!1},{default:n(()=>[(v(!0),T(A,null,F(f.value,(w,B)=>(v(),C(_(H),{class:"strato-menu-item",onClick:w.handler,index:B+""},{default:n(()=>[E(L(w.name),1)]),_:2},1032,["onClick","index"]))),256))]),_:1},8,["default-active"]),x("div",Be,[t(g,null,{default:n(()=>[t(De),i("Job")?(v(),C(Ee,{key:0})):J("",!0),t(Te)]),_:1})])])}}},$e=Y(Ue,[["__scopeId","data-v-11938713"]]);function W(M){switch(M){case"云主机":return"Cpu";case"云硬盘":return l("Disk");case"磁盘类型":return l("Disk");case"弹性网卡":return l("LocalIp");case"可用区":return"Grid";case"集群":return"Grid";case"宿主机":return"Cpu";case"数据存储":return l("Disk");case"密钥对":return l("ApiKey");case"私有网络":return l("Vpc");case"子网":return l("LocalIp");case"弹性IP":return l("FloatingIp");case"带宽包":return l("FloatingIp");case"云主机规格":return"Cpu";case"镜像":return"CopyDocument";case"安全组":return l("Security");case"入站规则":return l("Security");case"出站规则":return l("Security");case"云账号":return l("ApiKey");case"租户管理":return"House";case"用户管理":return"User";case"角色管理":return"UserFilled";case"用户组管理":return"Avatar";case"我的工单":return"User";case"待办工单":return"Bell";case"已办工单":return"MuteNotification";case"所有工单":return"Document";case"任务":return"List";case"任务类型":return"List";case"定时任务":return"AlarmClock";case"标签管理":return"CollectionTag";case"IP池":return l("LocalIp");case"流程管理":return l("Scheduler");case"资源栈蓝图":return"Menu";case"资源栈":return"Menu";case"负载均衡实例":return l("Vpc");case"监听器":return l("Vpc");case"后端服务":return l("LocalIp");case"后端服务器组":return l("LocalIp");case"转发规则":return l("LocalIp");case"服务器SSL证书":return l("ApiKey");case"ACL":return l("LocalIp");case"健康检查器":return l("LocalIp");case"LB可用区":return"Grid";case"LB规格":return l("Vpc");case"脚本库":return"Tickets";case"软件库":return"Box";case"非云主机":return"Monitor";case"软件":return"Box";case"初始化脚本":return"Tickets";case"审计日志":return"VideoCamera"}return"MostlyCloudy"}function Fe(M){switch(M){case"云主机相关":return"Cpu";case"存储":return"Coin";case"网络":return l("Internet");case"负载均衡":return l("Vpc");case"其他":return"Expand";case"运维自动化":return"CoffeeCup"}return"MostlyCloudy"}function l(M){return oe({setup(){return()=>se("img",{src:`/svg/${M}.svg`})}})}const He={style:{"font-size":"18px"}},ze={__name:"StratoMenu",setup(M){const s=V(),a=P(),m=Q(()=>{const o=[],p=[];if(a.currentSideMenus)for(let r of a.currentSideMenus)if(r.subMenuId&&r.subMenuName){let b=o.find(i=>i.subMenuId===r.subMenuId);b||(b={subMenuId:r.subMenuId,subMenuName:r.subMenuName,items:[]},o.push(b)),b.items.push(r)}else p.push(r);return[...o,...p]});function u(o){a.setActiveMenu(o)}return O(()=>{a.activeMenu&&s.push(a.activeMenu.path)}),(o,p)=>{const r=y("ElIcon"),b=y("ElSubMenu");return _(a).activeMenu?(v(),C(_(X),{key:0,class:"strato-menu",router:"","default-active":_(a).activeMenu.path,"unique-opened":""},{default:n(()=>[(v(!0),T(A,null,F(m.value,i=>(v(),T(A,null,[i.subMenuId?(v(),C(b,{key:0,index:i.subMenuId},{title:n(()=>[t(r,null,{default:n(()=>[(v(),C(U(_(Fe)(i.subMenuName))))]),_:2},1024),x("span",He,L(i.subMenuName),1)]),default:n(()=>[(v(!0),T(A,null,F(i.items,h=>(v(),C(_(H),{class:"strato-menu-item",index:h.path,onClick:N=>u(h)},{default:n(()=>[x("span",null,[t(r,null,{default:n(()=>[(v(),C(U(_(W)(h.menuName))))]),_:2},1024),E(" "+L(h.menuName),1)])]),_:2},1032,["index","onClick"]))),256))]),_:2},1032,["index"])):(v(),C(_(H),{key:1,class:"strato-menu-item",index:i.path,onClick:h=>u(i)},{default:n(()=>[x("span",null,[t(r,null,{default:n(()=>[(v(),C(U(_(W)(i.menuName))))]),_:2},1024),E(" "+L(i.menuName),1)])]),_:2},1032,["index","onClick"]))],64))),256))]),_:1},8,["default-active"])):J("",!0)}}},Je=Y(ze,[["__scopeId","data-v-a6841a01"]]),rt={__name:"StratoLayout",setup(M){const s=V();return j().session||s.push("/login"),(a,m)=>(v(),C(_($),{style:{height:"100%",overflow:"hidden","background-image":"linear-gradient(-45deg, #150055 0%, #610099 100%)"}},{default:n(()=>[t(_(G),{style:{padding:"0"}},{default:n(()=>[t($e)]),_:1}),t(_($),{style:{height:"100%"}},{default:n(()=>[t(_(ue),{style:{width:"240px",height:"100%","scrollbar-width":"thin"}},{default:n(()=>[t(Je)]),_:1}),t(_($),{style:{height:"100%","margin-right":"16px","background-color":"rgb(16, 16, 16)"}},{default:n(()=>[t(_(G),{style:{display:"flex","align-items":"center"}},{default:n(()=>[t(ye)]),_:1}),t(_(le),null,{default:n(()=>[(v(),C(_(ie),{key:_(s).currentRoute.value.fullPath}))]),_:1})]),_:1})]),_:1})]),_:1}))}};export{rt as default};
