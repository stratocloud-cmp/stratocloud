import{b as Q,a as W,u as ne,c as de,s as ie,e as me,f as fe,g as pe,h as ce,d as ve}from"./user-DS2hYLSE.js";import{S as q}from"./StratoButton-AnmxT3yq.js";import{_ as X}from"./TenantTreeSelector-C6fV0oEE.js";import{a7 as z,r as u,y as Y,o as y,q as R,w as t,e,u as l,E as C,f as x,j as G,b2 as Z,b3 as S,b4 as be,n as ee,b as O,i as E,P as N,d as j,t as le,b5 as ae,v as T,a6 as te,F as M,O as oe,b0 as L,b6 as Ve,a2 as B,b7 as ge,b8 as K}from"./index-C6PxR8iA.js";import{_ as P}from"./StratoDrawer-BEn6vZyQ.js";import{_ as re}from"./StratoTable-BQdButlV.js";import{s as H}from"./request-BGZJNm7h.js";import{a as ye,_ as he}from"./UpdateUserForm-AkLK75Wl.js";import{u as _e,c as Ue,a as Re,d as we}from"./role-DCPu0vWf.js";const ke={__name:"CreateUserForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(d,{expose:h}){const a=z(d,"modelValue"),f=u();h({validate:i});function i(v){f.value.validate(v)}const c=u({tenantId:[{required:!0,message:"请选择所属租户"}],loginName:[{required:!0,message:"请输入用户名"}],realName:[{required:!0,message:"请输入姓名"}],password:[{required:!0,message:"请输入密码"}]});return Y(()=>{}),(v,r)=>(y(),R(l(G),{ref_key:"formRef",ref:f,model:a.value,"label-position":"top",rules:c.value},{default:t(()=>[e(l(C),{label:"所属租户",prop:"tenantId"},{default:t(()=>[e(X,{modelValue:a.value.tenantId,"onUpdate:modelValue":r[0]||(r[0]=o=>a.value.tenantId=o)},null,8,["modelValue"])]),_:1}),e(l(C),{label:"登录名",prop:"loginName"},{default:t(()=>[e(l(x),{modelValue:a.value.loginName,"onUpdate:modelValue":r[1]||(r[1]=o=>a.value.loginName=o),placeholder:"请输入登录名"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"姓名",prop:"realName"},{default:t(()=>[e(l(x),{modelValue:a.value.realName,"onUpdate:modelValue":r[2]||(r[2]=o=>a.value.realName=o),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"密码",prop:"password"},{default:t(()=>[e(l(x),{autocomplete:"new-password",type:"password","show-password":"",modelValue:a.value.password,"onUpdate:modelValue":r[3]||(r[3]=o=>a.value.password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"邮箱"},{default:t(()=>[e(l(x),{modelValue:a.value.emailAddress,"onUpdate:modelValue":r[4]||(r[4]=o=>a.value.emailAddress=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"手机号",placeholder:"请输入手机号"},{default:t(()=>[e(l(x),{modelValue:a.value.phoneNumber,"onUpdate:modelValue":r[5]||(r[5]=o=>a.value.phoneNumber=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"描述"},{default:t(()=>[e(l(x),{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":r[6]||(r[6]=o=>a.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ie={__name:"CreateRoleForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(d,{expose:h}){const a=z(d,"modelValue"),f=u();h({validate:i});function i(v){f.value.validate(v)}const c=u({tenantId:[{required:!0,message:"请选择所属租户"}],name:[{required:!0,message:"请输入角色名称"}],roleType:[{required:!0,message:"请选择角色类型"}]});return(v,r)=>(y(),R(l(G),{ref_key:"formRef",ref:f,model:a.value,"label-position":"top",rules:c.value},{default:t(()=>[e(l(C),{label:"所属租户",prop:"tenantId"},{default:t(()=>[e(X,{modelValue:a.value.tenantId,"onUpdate:modelValue":r[0]||(r[0]=o=>a.value.tenantId=o)},null,8,["modelValue"])]),_:1}),e(l(C),{label:"角色名称",prop:"name"},{default:t(()=>[e(l(x),{modelValue:a.value.name,"onUpdate:modelValue":r[1]||(r[1]=o=>a.value.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"角色类型",prop:"roleType"},{default:t(()=>[e(l(Z),{style:{width:"100%"},modelValue:a.value.roleType,"onUpdate:modelValue":r[2]||(r[2]=o=>a.value.roleType=o),placeholder:"请选择角色类型"},{default:t(()=>[e(l(S),{label:"全局超级管理员",value:"SUPER_ADMIN"}),e(l(S),{label:"租户级超级管理员",value:"TENANT_SUPER_ADMIN"}),e(l(S),{label:"租户级管理员",value:"TENANT_ADMIN"}),e(l(S),{label:"普通用户",value:"NORMAL_USER"})]),_:1},8,["modelValue"])]),_:1}),e(l(C),{label:"描述"},{default:t(()=>[e(l(x),{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":r[3]||(r[3]=o=>a.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ne=d=>H({url:"/identity-service/describe-permissions",method:"post",data:d}),De=d=>H({url:"/identity-service/add-permissions-to-role",method:"post",data:d}),Ce=d=>H({url:"/identity-service/remove-permissions-from-role",method:"post",data:d}),Te={__name:"PermissionsSelector",props:{roleId:{required:!0,type:String},permissionIds:{required:!0,type:Array}},setup(d){const h=u([]),a=d,f=u([]),i=u([]),c=u([]),v={multiple:!0};function r(){Ne({}).then(_=>{if(_.permissions&&_.permissions.length>0){h.value=[];for(let p of _.permissions){let b=h.value.find(I=>I.value===p.target);b==null&&(b={value:p.target,label:p.targetName,children:[]},h.value.push(b)),b.children.push({value:p.id,label:p.actionName,children:[]}),a.permissionIds.indexOf(p.id)!=-1&&f.value.push([p.target,p.id])}}})}function o(_){let p=[...a.permissionIds,...i.value];p=p.filter(m=>!c.value.includes(m));let b=_.filter(m=>p.find(s=>m[1]===s)==null).map(m=>m[1]),I=p.filter(m=>_.find(s=>s[1]===m)==null);if(I.length>0){Ce({roleId:a.roleId,permissionIds:I}).then(m=>{for(let s of I){let V=i.value.indexOf(s);V!==-1&&i.value.splice(V,1),c.value.push(s)}});return}if(b.length>0){De({roleId:a.roleId,permissionIds:b}).then(m=>{for(let s of b){let V=c.value.indexOf(s);V!==-1&&c.value.splice(V,1),i.value.push(s)}});return}}return Y(()=>{r()}),(_,p)=>(y(),R(l(be),{size:"large",modelValue:f.value,"onUpdate:modelValue":p[0]||(p[0]=b=>f.value=b),style:{width:"fit-content"},options:h.value,props:v,"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":15,clearable:"",onChange:o},null,8,["modelValue","options"]))}},Ae={__name:"UpdateRoleForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(d,{expose:h}){const a=z(d,"modelValue"),f=u();h({validate:i});function i(v){f.value.validate(v)}const c=u({name:[{required:!0,message:"请输入角色名称"}],roleType:[{required:!0,message:"请选择角色类型"}]});return(v,r)=>(y(),R(l(G),{ref_key:"formRef",ref:f,model:a.value,"label-position":"top",rules:c.value},{default:t(()=>[e(l(C),{label:"角色名称",prop:"name"},{default:t(()=>[e(l(x),{modelValue:a.value.name,"onUpdate:modelValue":r[0]||(r[0]=o=>a.value.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(l(C),{label:"角色类型",prop:"roleType"},{default:t(()=>[e(l(Z),{style:{width:"100%"},modelValue:a.value.roleType,"onUpdate:modelValue":r[1]||(r[1]=o=>a.value.roleType=o),placeholder:"请选择角色类型"},{default:t(()=>[e(l(S),{label:"全局超级管理员",value:"SUPER_ADMIN"}),e(l(S),{label:"租户级超级管理员",value:"TENANT_SUPER_ADMIN"}),e(l(S),{label:"租户级管理员",value:"TENANT_ADMIN"}),e(l(S),{label:"普通用户",value:"NORMAL_USER"})]),_:1},8,["modelValue"])]),_:1}),e(l(C),{label:"描述"},{default:t(()=>[e(l(x),{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":r[2]||(r[2]=o=>a.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ee={hidden:""},xe={__name:"RoleActionsColumn",props:{selectedRole:{required:!0,type:Object}},emits:["refresh"],setup(d,{emit:h}){const a=u(!1),f=u({}),i=u(),c=u(!1),v=u(!1);function r(m,s,V,n){V?Q({assignList:[{userId:m,roleId:s}]}).catch(()=>{n.related=!1}):W({removeList:[{userId:m,roleId:s}]}).catch(()=>{n.related=!0})}function o(){c.value=!0}function _(){v.value=!0}function p(m){f.value={roleId:m.id,name:m.name,roleType:m.type,description:m.description},a.value=!0}const b=h;function I(){i.value.validate(m=>{m&&_e(f.value).then(()=>{b("refresh"),a.value=!1})})}return(m,s)=>{const V=ee("ElButton");return y(),O(M,null,[e(V,{link:"",type:"primary",onClick:s[0]||(s[0]=()=>p(d.selectedRole))},{default:t(()=>[E(" 编辑 ")]),_:1}),e(V,{link:"",type:"primary",onClick:o},{default:t(()=>[E(" 关联用户 ")]),_:1}),e(V,{link:"",type:"primary",onClick:_},{default:t(()=>[E(" 关联权限 ")]),_:1}),(y(),R(te,{to:"body"},[e(P,{modelValue:a.value,"onUpdate:modelValue":s[2]||(s[2]=n=>a.value=n),title:"编辑角色",onOnConfirm:I},{default:t(()=>[e(Ae,{ref_key:"updateRoleFormRef",ref:i,modelValue:f.value,"onUpdate:modelValue":s[1]||(s[1]=n=>f.value=n)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:c.value,"onUpdate:modelValue":s[3]||(s[3]=n=>c.value=n),"no-confirm":"",title:"关联用户",size:800},{default:t(()=>[c.value?(y(),R(ue,{key:0,"simple-mode":!0},{default:t(()=>[e(l(N),{label:"关联状态"},{default:t(n=>[j("span",Ee,le(n.row.related=n.row.related===void 0?n.row.roleIds.includes(d.selectedRole.id):n.row.related),1),e(l(ae),{modelValue:n.row.related,"onUpdate:modelValue":k=>n.row.related=k,onChange:k=>r(n.row.id,d.selectedRole.id,n.row.related,n.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1})):T("",!0)]),_:1},8,["modelValue"]),e(P,{modelValue:v.value,"onUpdate:modelValue":s[4]||(s[4]=n=>v.value=n),"no-confirm":"",title:"配置权限",size:800},{default:t(()=>[v.value?(y(),R(Te,{key:0,"role-id":d.selectedRole.id,"permission-ids":d.selectedRole.permissionIds},null,8,["role-id","permission-ids"])):T("",!0)]),_:1},8,["modelValue"])]))],64)}}},Fe={style:{"margin-bottom":"10px"}},se={__name:"Role",props:{simpleMode:{default:!1,required:!1}},setup(d){const h=u(),a=u({}),f=u([]),i=u(!1),c=u({}),v=u();function r(){h.value.fetchData()}function o(s){switch(s){case"SUPER_ADMIN":return"全局超级管理员";case"TENANT_SUPER_ADMIN":return"租户级超级管理员";case"TENANT_ADMIN":return"租户级管理员";case"NORMAL_USER":return"普通用户"}return s}function _(){c.value={},i.value=!0}function p(){v.value.validate(s=>{s&&Ue(c.value).then(()=>{h.value.fetchData(),i.value=!1})})}function b(s){f.value=s}function I(){return f.value.map(s=>s.id)}function m(){const V={roleIds:I()};Re(V).then(()=>{h.value.fetchData()})}return(s,V)=>(y(),O(M,null,[j("div",Fe,[d.simpleMode?T("",!0):(y(),O(M,{key:0},[e(q,{type:"primary",onClick:_},{default:t(()=>[E("创建")]),_:1}),e(l(oe),{title:"确认删除",onConfirm:m},{reference:t(()=>[e(q,{disabled:f.value.length===0,type:"danger",plain:""},{default:t(()=>[E("删除")]),_:1},8,["disabled"])]),_:1})],64)),e(l(x),{style:{float:"right",width:"20%"},modelValue:a.value.search,"onUpdate:modelValue":V[0]||(V[0]=n=>a.value.search=n),"suffix-icon":"search"},null,8,["modelValue"])]),e(re,{ref_key:"roleTableRef",ref:h,"paging-request":a.value,"remote-method":l(we),onSelectionChange:b},{default:t(()=>[d.simpleMode?T("",!0):(y(),R(l(N),{key:0,type:"selection","reserve-selection":""})),e(l(N),{prop:"name",label:"角色名称",sortable:"custom"}),e(l(N),{prop:"type",label:"角色类型",sortable:"custom",formatter:(n,k,w,F)=>o(w)},null,8,["formatter"]),d.simpleMode?T("",!0):(y(),R(l(N),{key:1,prop:"description",label:"描述",sortable:"custom"})),e(l(N),{prop:"createdAt",label:"创建时间",sortable:"custom"}),d.simpleMode?T("",!0):(y(),R(l(N),{key:2},{default:t(n=>[e(xe,{"selected-role":n.row,onRefresh:r},null,8,["selected-role"])]),_:1})),L(s.$slots,"default")]),_:3},8,["paging-request","remote-method"]),e(P,{modelValue:i.value,"onUpdate:modelValue":V[2]||(V[2]=n=>i.value=n),title:"创建角色",onOnConfirm:p},{default:t(()=>[e(Ie,{ref_key:"createRoleFormRef",ref:v,modelValue:c.value,"onUpdate:modelValue":V[1]||(V[1]=n=>c.value=n)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64))}},Je=Object.freeze(Object.defineProperty({__proto__:null,default:se},Symbol.toStringTag,{value:"Module"})),Se={hidden:""},Pe={__name:"UserActionsColumn",props:{selectedUser:{required:!0,type:Object}},emits:["refresh"],setup(d,{emit:h}){const a=d,f=u(!1),i=u({}),c=u(),v=u(!1);function r(){v.value=!0}function o(){i.value={userId:a.selectedUser.id,realName:a.selectedUser.realName,emailAddress:a.selectedUser.emailAddress,phoneNumber:a.selectedUser.phoneNumber,description:a.selectedUser.description},f.value=!0}const _=h;function p(){c.value.validate(k=>{k&&ne(i.value).then(()=>{_("refresh"),f.value=!1})})}const b=u({}),I=u(),m=u(!1);function s(){b.value.userId=a.selectedUser.id,m.value=!0}function V(){I.value.validate(k=>{k&&de(b.value).then(()=>{_("refresh"),m.value=!1})})}function n(k,w,F,g){F?Q({assignList:[{userId:k,roleId:w}]}).catch(()=>{g.related=!1}):W({removeList:[{userId:k,roleId:w}]}).catch(()=>{g.related=!0})}return(k,w)=>{const F=ee("ElButton");return y(),O(M,null,[e(F,{link:"",type:"primary",onClick:r,"disabled-message":"请选择且只选择一项"},{default:t(()=>[E("关联角色")]),_:1}),e(F,{link:"",type:"primary",onClick:s,"disabled-message":"请选择且只选择一项"},{default:t(()=>[E("修改密码")]),_:1}),e(F,{link:"",type:"primary",onClick:o,"disabled-message":"请选择且只选择一项"},{default:t(()=>[E("编辑")]),_:1}),(y(),R(te,{to:"body"},[e(P,{modelValue:f.value,"onUpdate:modelValue":w[1]||(w[1]=g=>f.value=g),title:"编辑用户",onOnConfirm:p},{default:t(()=>[e(ye,{ref_key:"updateUserFormRef",ref:c,modelValue:i.value,"onUpdate:modelValue":w[0]||(w[0]=g=>i.value=g)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:m.value,"onUpdate:modelValue":w[3]||(w[3]=g=>m.value=g),title:"修改密码",onOnConfirm:V},{default:t(()=>[e(he,{ref_key:"changePasswordFormRef",ref:I,modelValue:b.value,"onUpdate:modelValue":w[2]||(w[2]=g=>b.value=g)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:v.value,"onUpdate:modelValue":w[4]||(w[4]=g=>v.value=g),"no-confirm":"",title:"关联角色",size:800},{default:t(()=>[v.value?(y(),R(se,{key:0,"simple-mode":!0},{default:t(()=>[e(l(N),{label:"关联状态"},{default:t(g=>[j("span",Se,le(g.row.related=g.row.related===void 0?d.selectedUser.roleIds.includes(g.row.id):g.row.related),1),e(l(ae),{modelValue:g.row.related,"onUpdate:modelValue":$=>g.row.related=$,onChange:$=>n(d.selectedUser.id,g.row.id,g.row.related,g.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1})):T("",!0)]),_:1},8,["modelValue"])]))],64)}}},qe={style:{"margin-bottom":"10px",height:"32px"}},ue={__name:"User",props:{simpleMode:{default:!1,required:!1,type:Boolean},userGroupIds:{default:void 0,required:!1}},emits:["change"],setup(d,{expose:h,emit:a}){const f=d,i=u(),c=[{text:"已锁定",value:!0},{text:"未锁定",value:!1}],v=[{text:"已禁用",value:!0},{text:"未禁用",value:!1}];function r(U){"locked"in U&&(U.locked.length>0?o.value.locked=U.locked[0]:o.value.locked=void 0),"disabled"in U&&(U.disabled.length>0?o.value.disabled=U.disabled[0]:o.value.disabled=void 0)}const o=u({userGroupIds:f.userGroupIds}),_=u([]),p=u(!1),b=u({}),I=u();function m(){b.value={},p.value=!0}function s(){I.value.validate(U=>{U&&ie(b.value).then(()=>{i.value.fetchData(),p.value=!1})})}const V=a;function n(U){_.value=U,V("change",U)}function k(){return _.value.map(U=>U.id)}function w(){const D={userIds:k()};me(D).then(()=>{i.value.fetchData()}).catch(()=>{})}function F(){const D={userIds:k()};fe(D).then(()=>{i.value.fetchData()}).catch(()=>{})}function g(){const D={userIds:k()};pe(D).then(()=>{i.value.fetchData()}).catch(()=>{})}function $(){const D={userIds:k()};ce(D).then(()=>{i.value.fetchData()}).catch(()=>{})}function J(){i.value.fetchData()}return h({fetchData:J}),(U,D)=>(y(),O(M,null,[j("div",qe,[L(U.$slots,"buttons"),d.simpleMode?T("",!0):(y(),O(M,{key:0},[e(q,{type:"primary",onClick:m},{default:t(()=>[E("创建")]),_:1}),e(q,{disabled:_.value.length===0,type:"success",plain:"",onClick:F},{default:t(()=>[E("启用")]),_:1},8,["disabled"]),e(q,{disabled:_.value.length===0,type:"success",plain:"",onClick:w},{default:t(()=>[E("解锁")]),_:1},8,["disabled"]),e(q,{disabled:_.value.length===0,type:"danger",plain:"",onClick:g},{default:t(()=>[E("禁用")]),_:1},8,["disabled"]),e(l(oe),{title:"确认删除",onConfirm:$},{reference:t(()=>[e(q,{disabled:_.value.length===0,type:"danger",plain:""},{default:t(()=>[E("删除")]),_:1},8,["disabled"])]),_:1})],64)),e(l(x),{style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":D[0]||(D[0]=A=>o.value.search=A),"suffix-icon":"search"},null,8,["modelValue"])]),e(re,{ref_key:"userTableRef",ref:i,"paging-request":o.value,"remote-method":l(ve),onSelectionChange:n,onFilterChange:r},{default:t(()=>[e(l(N),{type:"selection","reserve-selection":""}),e(l(N),{prop:"loginName",label:"登录名",sortable:"custom"}),e(l(N),{prop:"realName",label:"姓名",sortable:"custom"}),e(l(N),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(l(N),{"column-key":"locked",label:"是否锁定",filters:c,"filter-multiple":!1},{default:t(A=>[A.row.locked?(y(),R(l(B),{key:0,color:"red"},{default:t(()=>[e(l(Ve))]),_:1})):T("",!0),A.row.locked?T("",!0):(y(),R(l(B),{key:1,color:"green"},{default:t(()=>[e(l(ge))]),_:1}))]),_:1}),e(l(N),{"column-key":"disabled",label:"是否禁用",filters:v,"filter-multiple":!1},{default:t(A=>[A.row.disabled?(y(),R(l(B),{key:0,color:"red"},{default:t(()=>[e(l(K))]),_:1})):T("",!0),A.row.disabled?T("",!0):(y(),R(l(B),{key:1,color:"green"},{default:t(()=>[e(l(K))]),_:1}))]),_:1}),d.simpleMode?T("",!0):(y(),R(l(N),{key:0,"min-width":"100"},{default:t(A=>[e(Pe,{"selected-user":A.row,onRefresh:J},null,8,["selected-user"])]),_:1})),L(U.$slots,"default")]),_:3},8,["paging-request","remote-method"]),e(P,{modelValue:p.value,"onUpdate:modelValue":D[2]||(D[2]=A=>p.value=A),title:"创建用户",onOnConfirm:s},{default:t(()=>[p.value?(y(),R(ke,{key:0,ref_key:"createUserFormRef",ref:I,modelValue:b.value,"onUpdate:modelValue":D[1]||(D[1]=A=>b.value=A)},null,8,["modelValue"])):T("",!0)]),_:1},8,["modelValue"])],64))}},Ke=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{Je as R,Ke as U,ue as _};
