var ce=Object.defineProperty;var me=(e,c,l)=>c in e?ce(e,c,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[c]=l;var j=(e,c,l)=>me(e,typeof c!="symbol"?c+"":c,l);import{_ as fe}from"./TenantTreeSelector-DrVO4R-0.js";import{u as ye,l as ve}from"./request-BV6gXtmx.js";import{_ as ge}from"./UserSelector-Bks_jgjv.js";import{_ as be}from"./AccountSelector-yRinDs2o.js";import{o as Ie,q as qe,m as Re}from"./resource-DdTtSOFP.js";import{_ as he}from"./StratoSelector-Csy36wxr.js";import{ac as O,a8 as $,r as y,m as K,o as n,q as V,w as o,d as H,t as k,u as w,y as M,n as _,e as r,i as D,A as B,v as x,b as E,F as N,B as P,aa as re,ab as ae,_ as _e,a9 as Ve,E as W,j as Ce}from"./index-C_jnbPMf.js";import{b as L,d as Te,u as Se,c as Ee}from"./ResourceSelector-D-bu7cxQ.js";import{_ as oe}from"./StratoDynamicForm-BeoKTVDl.js";import{v as z}from"./FormUtil-BL1Y36f_.js";import{u as le,a as Ne}from"./AccountContext-Bp4LXd0C.js";import{_ as we}from"./TagValueSelectorGroup-kSkYehu4.js";import{u as J}from"./IpState-yQwbBpiP.js";const xe={style:{float:"left"}},ke={style:{float:"right",color:"grey"}},De={__name:"ResourceTypeSelector",props:O({resourceCategory:{required:!1},disabled:{required:!1,type:Boolean,default:!1},disabledOptionPredicate:{required:!1,type:Function,default:()=>!1},multiple:{required:!1,type:Boolean,default:!1}},{modelValue:{},modelModifiers:{},providerId:{},providerIdModifiers:{}}),emits:["update:modelValue","update:providerId"],setup(e){const c=$(e,"modelValue"),l=$(e,"providerId"),t=e,a=y({providerId:l.value,resourceCategoryId:t.resourceCategory,resourceTypeId:t.multiple?void 0:c.value});K(l,()=>{a.value.providerId=l.value});function p(R){R?(l.value=R.spec.providerId,a.value.providerId=l.value):(l.value=void 0,a.value.providerId=void 0)}return(R,v)=>(n(),V(he,{modelValue:c.value,"onUpdate:modelValue":v[0]||(v[0]=d=>c.value=d),placeholder:"请选择资源类型",disabled:t.disabled,request:a.value,onChange:p,"remote-method":w(Ie),"list-getter":d=>d.resourceTypes,"label-getter":d=>d.spec.resourceTypeName,"value-getter":d=>d.spec.resourceTypeId,"disabled-option-predicate":e.disabledOptionPredicate,multiple:e.multiple},{default:o(d=>[H("span",xe,k(d.row.spec.resourceTypeName),1),H("span",ke,k(d.row.spec.resourceCategoryName),1)]),_:1},8,["modelValue","disabled","request","remote-method","list-getter","label-getter","value-getter","disabled-option-predicate","multiple"]))}},Fe={__name:"ResourceBasicsSubForm",props:O({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:void 0,description:void 0}},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=e,t=$(e,"modelValue"),a=y(),p=y();function R(h){p.value.validate(h)}c({validate:R});const v=y({externalAccountId:[{required:!0,message:"请选择云账号"}],resourceTypeId:[{required:!0,message:"请选择资源类型"}]}),d=y(!1);return M(()=>{var h;(h=t.value)!=null&&h.externalAccountId&&(d.value=!0)}),(h,m)=>{const T=_("ElCol"),s=_("ElFormItem"),f=_("ElRow"),I=_("ElForm");return n(),V(I,{ref_key:"formRef",ref:p,model:t.value,rules:v.value},{default:o(()=>[r(f,{gutter:12},{default:o(()=>[r(T,{span:4},{default:o(()=>[D(" 资源类型 ")]),_:1}),r(T,{span:10},{default:o(()=>[r(s,{prop:"externalAccountId"},{default:o(()=>[r(be,{disabled:d.value,modelValue:t.value.externalAccountId,"onUpdate:modelValue":m[0]||(m[0]=i=>t.value.externalAccountId=i),"provider-id":a.value,"onUpdate:providerId":m[1]||(m[1]=i=>a.value=i),"resource-category":l.resourceCategory},null,8,["disabled","modelValue","provider-id","resource-category"])]),_:1})]),_:1}),r(T,{span:10},{default:o(()=>[r(s,{prop:"resourceTypeId"},{default:o(()=>[r(De,{disabled:t.value.resourceTypeId!==void 0&&t.value.resourceTypeId.length!==0,modelValue:t.value.resourceTypeId,"onUpdate:modelValue":m[2]||(m[2]=i=>t.value.resourceTypeId=i),"provider-id":a.value,"onUpdate:providerId":m[3]||(m[3]=i=>a.value=i),"resource-category":l.resourceCategory,"disabled-option-predicate":i=>!i.spec.buildable},null,8,["disabled","modelValue","provider-id","resource-category","disabled-option-predicate"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])}}},Ue={__name:"SharedTargetEssentialsSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0},isNested:{required:!1,default:!1,type:Boolean}},emits:["addNewRequirement"],setup(e,{expose:c,emit:l}){const t=e,a=l;function p(){if(t.newRequirements.length===0){let m={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",m)}}M(()=>{p()});const R=y();function v(m){R.value.validate(m)}c({validate:v});const d=B(()=>t.requirementDef.targetSpec.resourceCategoryName);function h(m){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(m.state)||m.recycled}return(m,T)=>{const s=_("ElCol"),f=_("ElFormItem"),I=_("ElRow"),i=_("ElForm");return n(),V(i,{ref_key:"formRef",ref:R,model:e.newRequirements,"hide-required-asterisk":"","label-position":"top"},{default:o(()=>[r(I,{gutter:12},{default:o(()=>[e.isNested?x("",!0):(n(),V(s,{key:0,span:4},{default:o(()=>[D(k(t.requirementDef.relationshipSpec.requirementName),1)]),_:1})),r(s,{span:e.isNested?24:20},{default:o(()=>[(n(!0),E(N,null,P(t.newRequirements,(u,g)=>(n(),V(f,{label:e.isNested?e.requirementDef.relationshipSpec.requirementName:void 0,prop:g+".targetResourceId",rules:[{required:!0,message:"请选择"+d.value}]},{default:o(()=>[r(L,{modelValue:u.targetResourceId,"onUpdate:modelValue":C=>u.targetResourceId=C,"context-consumer":w(Te),placeholder:"请选择"+d.value,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":h},null,8,["modelValue","onUpdate:modelValue","context-consumer","placeholder","resource-type-id"])]),_:2},1032,["label","prop","rules"]))),256))]),_:1},8,["span"])]),_:1})]),_:1},8,["model"])}}},Ae={__name:"NotSharedButEssentialSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0},isNested:{required:!1,default:!1,type:Boolean}},emits:["addNewRequirement"],setup(e,{expose:c,emit:l}){const t=e,a=l;function p(){if(t.newRequirements.length===0){let m={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",m)}}M(()=>{p()});function R(m){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(m.state)||m.recycled}const v=B(()=>t.requirementDef.targetSpec.resourceCategoryName),d=y();function h(m){d.value.validate(m)}return c({validate:h}),(m,T)=>{const s=_("ElCol"),f=_("ElFormItem"),I=_("ElRow"),i=_("ElForm");return n(),V(i,{ref_key:"formRef",ref:d,model:e.newRequirements,"hide-required-asterisk":"","label-position":"top"},{default:o(()=>[r(I,{gutter:12},{default:o(()=>[e.isNested?x("",!0):(n(),V(s,{key:0,span:4},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.requirementName),1)]),_:1})),r(s,{span:e.isNested?24:20},{default:o(()=>[(n(!0),E(N,null,P(t.newRequirements,(u,g)=>(n(),V(f,{label:e.isNested?e.requirementDef.relationshipSpec.requirementName:void 0,prop:g+".targetResourceId",rules:[{required:!0,message:"请选择"+v.value}],required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:u.targetResourceId,"onUpdate:modelValue":C=>u.targetResourceId=C,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":R,placeholder:"请选择"+v.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["label","prop","rules"]))),256))]),_:1},8,["span"])]),_:1})]),_:1},8,["model"])}}},Q={__name:"RelationshipPropertiesForm",props:O({relationshipTypeId:{required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=$(e,"modelValue"),t=e,a=y(),p=y();M(()=>{qe({relationshipTypeId:t.relationshipTypeId}).then(v=>{p.value=v.formMetaData})});function R(v){a.value.validate(v)}return c({validate:R}),(v,d)=>p.value?(n(),V(oe,{key:0,ref_key:"formRef",ref:a,"form-meta-data":p.value,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=h=>l.value=h)},null,8,["form-meta-data","modelValue"])):x("",!0)}},Pe={__name:"ExclusiveButNotEssentialSubform",props:{newRequirements:{required:!0},requirementDef:{required:!0}},emits:["addNewRequirement","removeRequirements"],setup(e,{expose:c,emit:l}){const t=e,a=l,p=y(!1);function R(){if(t.newRequirements.length===0){let f={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",f)}}function v(f){f?R():a("removeRequirements",t.requirementDef)}M(()=>{t.newRequirements.length>0&&(p.value=!0)});function d(f){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(f.state)||f.recycled}const h=B(()=>t.requirementDef.targetSpec.resourceCategoryName),m=y();function T(f){z([m.value,...s.value],f)}c({validate:T});const s=y([]);return(f,I)=>{const i=_("ElCol"),u=_("ElCheckbox"),g=_("ElFormItem"),C=_("ElRow"),S=_("ElForm");return n(),V(S,{ref_key:"formRef",ref:m,model:e.newRequirements,"label-position":"top"},{default:o(()=>[r(C,{gutter:12},{default:o(()=>[r(i,{span:4},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.requirementName),1)]),_:1}),r(i,{span:4},{default:o(()=>[r(g,null,{default:o(()=>[r(u,{modelValue:p.value,"onUpdate:modelValue":I[0]||(I[0]=q=>p.value=q),onChange:v},{default:o(()=>[D(k(e.requirementDef.relationshipSpec.connectActionName),1)]),_:1},8,["modelValue"])]),_:1})]),_:1}),r(i,{span:16},{default:o(()=>[p.value?(n(!0),E(N,{key:0},P(e.newRequirements,(q,F)=>(n(),E(N,null,[r(g,{prop:F+".targetResourceId",required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:q.targetResourceId,"onUpdate:modelValue":G=>q.targetResourceId=G,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":d,placeholder:"请选择"+h.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["prop"]),r(Q,{ref_for:!0,ref_key:"propertiesFormRefs",ref:s,"relationship-type-id":q.relationshipTypeId,modelValue:q.relationshipInputs,"onUpdate:modelValue":G=>q.relationshipInputs=G},null,8,["relationship-type-id","modelValue","onUpdate:modelValue"])],64))),256)):x("",!0)]),_:1})]),_:1})]),_:1},8,["model"])}}},Be={__name:"NotExclusiveSubForm",props:{newRequirements:{required:!0},requirementDef:{required:!0}},emits:["addNewRequirement","removeRequirement"],setup(e,{expose:c,emit:l}){const t=e,a=l;function p(){let s={relationshipTypeId:t.requirementDef.relationshipSpec.relationshipTypeId,relationshipInputs:{}};a("addNewRequirement",s)}function R(s){a("removeRequirement",s)}function v(s){return!t.requirementDef.relationshipSpec.allowedTargetStates.includes(s.state)||s.recycled}const d=B(()=>t.requirementDef.targetSpec.resourceCategoryName),h=y();function m(s){z([h.value,...T.value],s)}c({validate:m});const T=y([]);return(s,f)=>{const I=_("ElCol"),i=_("ElButton"),u=_("ElFormItem"),g=_("ElRow"),C=_("ElForm");return n(),V(C,{model:e.newRequirements,ref_key:"formRef",ref:h,"label-position":"top"},{default:o(()=>[r(g,{gutter:12},{default:o(()=>[r(I,{span:4},{default:o(()=>[D(k(t.requirementDef.relationshipSpec.requirementName),1)]),_:1}),r(I,{span:20},{default:o(()=>[r(i,{type:"primary",link:"",icon:"Plus",onClick:p,style:{"margin-top":"2px","margin-bottom":"18px","margin-left":"2px"}},{default:o(()=>[D(k(t.requirementDef.relationshipSpec.connectActionName),1)]),_:1}),(n(!0),E(N,null,P(t.newRequirements,(S,q)=>(n(),V(g,null,{default:o(()=>[r(I,{span:4,style:{"font-size":"14px"}},{default:o(()=>[r(i,{circle:"",link:"",size:"small",icon:"Close",type:"danger",onClick:()=>R(S)},null,8,["onClick"]),D(" "+k(d.value+(q+1)),1)]),_:2},1024),r(I,{span:20},{default:o(()=>[r(u,{prop:q+".targetResourceId",required:"","show-message":!1},{default:o(()=>[r(L,{modelValue:S.targetResourceId,"onUpdate:modelValue":F=>S.targetResourceId=F,"resource-type-id":e.requirementDef.targetSpec.resourceTypeId,"disabled-flag-getter":v,placeholder:"请选择"+d.value},null,8,["modelValue","onUpdate:modelValue","resource-type-id","placeholder"])]),_:2},1032,["prop"]),r(Q,{ref_for:!0,ref_key:"propertiesFormRefs",ref:T,"relationship-type-id":S.relationshipTypeId,modelValue:S.relationshipInputs,"onUpdate:modelValue":F=>S.relationshipInputs=F},null,8,["relationship-type-id","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1},8,["model"])}}};class ie{constructor(){j(this,"ignoredTargetTypeIds",[]);j(this,"ignoredCapabilityTypeIds",[])}addIgnoredTargetTypeId(c){this.ignoredTargetTypeIds.push(c)}isIgnoredTargetType(c){return this.ignoredTargetTypeIds.includes(c)}addIgnoredCapabilityTypeId(c){this.ignoredCapabilityTypeIds.push(c)}isIgnoredCapabilityType(c){return this.ignoredCapabilityTypeIds.includes(c)}}function at(){const e=new ie;return re("resourceStackNodeContext",e),e}function ue(){return ae("resourceStackNodeContext",new ie)}const X={__name:"RequirementsSubForm",props:O({requirementDefs:{required:!0,type:Array},showSharedTargets:{required:!1,default:!0},isNested:{required:!1,default:!1,type:Boolean}},{modelValue:{required:!0,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=$(e,"modelValue"),t=e;function a(b){return b.relationshipSpec.essentialRequirement===!0}function p(b){return b.targetSpec.sharedRequirementTarget===!0}function R(b){return b.relationshipSpec.exclusiveRequirement===!0}function v(b){return b.relationshipSpec.primaryCapability===!0}function d(b){return a(b)&&p(b)&&!v(b)}function h(b){return a(b)&&!p(b)&&!v(b)}function m(b){return R(b)&&!a(b)&&!v(b)}function T(b){return!R(b)&&!v(b)}const s=ue(),f=B(()=>t.requirementDefs.filter(d).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),I=B(()=>t.requirementDefs.filter(h).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),i=B(()=>t.requirementDefs.filter(m).filter(b=>!s.isIgnoredTargetType(b.targetSpec.resourceTypeId))),u=B(()=>t.requirementDefs.filter(T));function g(b){return l.value===void 0?[]:l.value.filter(A=>A.relationshipTypeId===b.relationshipSpec.relationshipTypeId)}function C(b){l.value.push(b)}function S(b){for(let A=l.value.length-1;A>=0;A--)l.value[A].relationshipTypeId===b.relationshipSpec.relationshipTypeId&&l.value.splice(A,1)}function q(b){for(let A=l.value.length-1;A>=0;A--)if(l.value[A]===b){l.value.splice(A,1);break}}const F=y([]),G=y([]),Z=y([]),ee=y([]);function pe(b){z([...F.value,...G.value,...Z.value,...ee.value],b)}return c({validate:pe}),(b,A)=>(n(),E(N,null,[(n(!0),E(N,null,P(f.value,U=>_e((n(),V(Ue,{ref_for:!0,ref_key:"formRefs1",ref:F,onAddNewRequirement:C,"new-requirements":g(U),"requirement-def":U,"is-nested":e.isNested},null,8,["new-requirements","requirement-def","is-nested"])),[[Ve,e.showSharedTargets]])),256)),(n(!0),E(N,null,P(I.value,U=>(n(),V(Ae,{ref_for:!0,ref_key:"formRefs2",ref:G,onAddNewRequirement:C,"new-requirements":g(U),"requirement-def":U,"is-nested":e.isNested},null,8,["new-requirements","requirement-def","is-nested"]))),256)),(n(!0),E(N,null,P(i.value,U=>(n(),V(Pe,{ref_for:!0,ref_key:"formRefs3",ref:Z,onAddNewRequirement:C,onRemoveRequirements:S,"new-requirements":g(U),"requirement-def":U},null,8,["new-requirements","requirement-def"]))),256)),(n(!0),E(N,null,P(u.value,U=>(n(),V(Be,{ref_for:!0,ref_key:"formRefs4",ref:ee,onAddNewRequirement:C,onRemoveRequirement:q,"new-requirements":g(U),"requirement-def":U},null,8,["new-requirements","requirement-def"]))),256))],64))}};class ne{constructor(){j(this,"tags",y())}}function ot(){const e=new ne;return re("resourceStackContext",e),e}function $e(){return ae("resourceStackContext",new ne)}const se={__name:"ResourcePropertiesSubForm",props:O({resourceTypeSpec:{required:!0},enableDescription:{required:!1,default:!1,type:Boolean},enableTags:{required:!1,default:!1,type:Boolean},isPrimaryCapability:{required:!1,default:!1,type:Boolean}},{modelValue:{required:!0,default:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0}},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=e,t=$(e,"modelValue"),a=y(),p=y();c({validate:R});function R(s){a.value.validate(f=>{f&&p.value.validate(s)})}const v=y();M(()=>{Re({resourceTypeId:l.resourceTypeSpec.resourceTypeId,actionId:"BUILD_RESOURCE"}).then(s=>{v.value=s.formMetaData})});const d=y(),h=y({tags:[{validator:(s,f,I)=>{var i;return(i=d.value)==null?void 0:i.validate(s,f,I)},trigger:"change"}]}),m=y({isPrimaryCapability:l.isPrimaryCapability}),T=$e();return K(()=>T.tags.value,()=>{const s=T.tags.value;if(s){for(let f of s)if(t.value.tags)for(let I of t.value.tags)f.tagKey===I.tagKey&&!I.tagValue&&(I.tagValue=f.tagValue,I.tagValueName=f.tagValueName)}},{deep:!0,immediate:!0}),(s,f)=>{const I=_("ElInput"),i=_("ElForm");return n(),V(i,{ref_key:"formRef",ref:a,model:t.value,rules:h.value,"label-position":"top"},{default:o(()=>[v.value?(n(),V(oe,{key:0,ref_key:"dynamicFormRef",ref:p,"form-meta-data":v.value,modelValue:t.value.properties,"onUpdate:modelValue":f[0]||(f[0]=u=>t.value.properties=u),args:m.value},null,8,["form-meta-data","modelValue","args"])):x("",!0),r(w(W),{prop:"resourceName",label:`${e.resourceTypeSpec.resourceCategoryName}名称`},{default:o(()=>[r(I,{placeholder:"留空将按命名规则自动生成",modelValue:t.value.resourceName,"onUpdate:modelValue":f[1]||(f[1]=u=>t.value.resourceName=u)},null,8,["modelValue"])]),_:1},8,["label"]),e.enableTags?(n(),V(w(W),{key:1,label:"标签",prop:"tags"},{default:o(()=>[t.value.tags?(n(),V(we,{key:0,ref_key:"tagRef",ref:d,modelValue:t.value.tags,"onUpdate:modelValue":f[2]||(f[2]=u=>t.value.tags=u),"entry-paging-request":{requiredWhenCreating:!0,resourceCategories:[e.resourceTypeSpec.resourceCategoryId]},"default-add-all-entries":!0},null,8,["modelValue","entry-paging-request"])):x("",!0)]),_:1})):x("",!0),e.enableDescription?(n(),V(w(W),{key:2,prop:"description",label:"描述"},{default:o(()=>[r(I,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":f[3]||(f[3]=u=>t.value.description=u)},null,8,["modelValue"])]),_:1})):x("",!0)]),_:1},8,["model","rules"])}}},de={__name:"CapabilityPropertiesForm",props:O({resourceSpec:{required:!0},relationshipTypeId:{required:!0},isPrimaryCapability:{required:!1,default:!1,type:Boolean}},{resource:{required:!0},resourceModifiers:{},relationshipProperties:{required:!0},relationshipPropertiesModifiers:{}}),emits:["update:resource","update:relationshipProperties"],setup(e,{expose:c}){const l=$(e,"resource"),t=$(e,"relationshipProperties"),a=y([]),p=y([]);function R(v){z([a.value,p.value],v)}return c({validate:R}),(v,d)=>(n(),E(N,null,[r(se,{ref_key:"formRef1",ref:a,modelValue:l.value,"onUpdate:modelValue":d[0]||(d[0]=h=>l.value=h),"resource-type-spec":e.resourceSpec,"is-primary-capability":e.isPrimaryCapability},null,8,["modelValue","resource-type-spec","is-primary-capability"]),r(Q,{ref_key:"formRef2",ref:p,modelValue:t.value,"onUpdate:modelValue":d[1]||(d[1]=h=>t.value=h),"relationship-type-id":e.relationshipTypeId},null,8,["modelValue","relationship-type-id"])],64))}},Me={style:{"margin-top":"4px"}},Oe={__name:"PrimaryCapabilitySubForm",props:{newCapabilities:{required:!0,type:Array,default:[]},capabilityDef:{required:!0}},emits:["addNewCapability","removeCapabilities"],setup(e,{expose:c,emit:l}){const t=e,a=t.capabilityDef.relationshipSpec.essentialPrimaryCapability,p=l,R=le();J(),K(R.accountId,()=>{t.newCapabilities.forEach(i=>i.resource.externalAccountId=R.accountId.value)},{immediate:!0});const v=y(!1);function d(){p("addNewCapability",{resource:{resourceTypeId:t.capabilityDef.sourceSpec.resourceTypeId,externalAccountId:R.accountId.value,properties:{},tags:[]},relationshipTypeId:t.capabilityDef.relationshipSpec.relationshipTypeId,relationshipProperties:{},requirements:[],capabilities:[]})}function h(){p("removeCapabilities",t.capabilityDef)}M(()=>{a&&t.newCapabilities.length===0&&d()});function m(i){i?t.newCapabilities.length===0&&d():h()}const T=y([]),s=y([]),f=y([]);function I(i){z([...T.value,...s.value,...f.value],i)}return c({validate:I}),(i,u)=>{const g=_("ElCol"),C=_("ElCheckbox"),S=_("ElRow");return n(),V(S,null,{default:o(()=>[r(g,{span:4},{default:o(()=>[H("div",Me,k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),r(g,{span:20},{default:o(()=>[w(a)?x("",!0):(n(),V(C,{key:0,modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=q=>v.value=q),onChange:m,style:{"margin-bottom":"18px"}},{default:o(()=>[D(k(e.capabilityDef.relationshipSpec.connectActionName),1)]),_:1},8,["modelValue"])),(n(!0),E(N,null,P(e.newCapabilities,q=>(n(),E(N,null,[r(X,{ref_for:!0,ref_key:"formRefs1",ref:T,"requirement-defs":e.capabilityDef.sourceRequirements,modelValue:q.requirements,"onUpdate:modelValue":F=>q.requirements=F,"is-nested":""},null,8,["requirement-defs","modelValue","onUpdate:modelValue"]),r(de,{ref_for:!0,ref_key:"formRefs2",ref:s,resource:q.resource,"onUpdate:resource":F=>q.resource=F,"resource-spec":e.capabilityDef.sourceSpec,"relationship-properties":q.relationshipProperties,"relationship-type-id":q.relationshipTypeId,"is-primary-capability":""},null,8,["resource","onUpdate:resource","resource-spec","relationship-properties","relationship-type-id"]),r(Y,{ref_for:!0,ref_key:"formRefs3",ref:f,"capability-defs":e.capabilityDef.sourceCapabilities,modelValue:q.capabilities,"onUpdate:modelValue":F=>q.capabilities=F},null,8,["capability-defs","modelValue","onUpdate:modelValue"])],64))),256))]),_:1})]),_:1})}}},ze={__name:"NotPrimaryCapabilitySubForm",props:{newCapabilities:{required:!0,type:Array,default:[]},capabilityDef:{required:!0}},emits:["addNewCapability","removeCapability"],setup(e,{expose:c,emit:l}){const t=e,a=l,p=le();J(),K(p.accountId,()=>{t.newCapabilities.forEach(s=>s.resource.externalAccountId=p.accountId.value)},{immediate:!0});function R(){a("addNewCapability",{resource:{resourceTypeId:t.capabilityDef.sourceSpec.resourceTypeId,externalAccountId:p.accountId.value,properties:{},tags:[]},relationshipTypeId:t.capabilityDef.relationshipSpec.relationshipTypeId,relationshipProperties:{},requirements:[],capabilities:[]})}function v(s){a("removeCapability",s)}M(()=>{});const d=y([]),h=y([]),m=y([]);function T(s){z([...d.value,...h.value,...m.value],s)}return c({validate:T}),(s,f)=>{const I=_("ElCol"),i=_("ElButton"),u=_("ElRow");return n(),V(u,null,{default:o(()=>[r(I,{span:4},{default:o(()=>[D(k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),r(I,{span:20},{default:o(()=>[r(i,{type:"primary",link:"",icon:"Plus",onClick:R,style:{"margin-top":"2px","margin-bottom":"18px","margin-left":"2px"}},{default:o(()=>[D(" 添加"+k(e.capabilityDef.relationshipSpec.capabilityName),1)]),_:1}),(n(!0),E(N,null,P(e.newCapabilities,(g,C)=>(n(),V(u,null,{default:o(()=>[r(I,{span:4,style:{"font-size":"14px"}},{default:o(()=>[r(i,{circle:"",link:"",size:"small",icon:"Close",type:"danger",onClick:()=>v(g)},null,8,["onClick"]),D(" "+k(e.capabilityDef.relationshipSpec.capabilityName+(C+1)),1)]),_:2},1024),r(I,{span:20},{default:o(()=>[r(X,{ref_for:!0,ref_key:"formRefs1",ref:d,"requirement-defs":e.capabilityDef.sourceRequirements,modelValue:g.requirements,"onUpdate:modelValue":S=>g.requirements=S,"is-nested":""},null,8,["requirement-defs","modelValue","onUpdate:modelValue"]),r(de,{ref_for:!0,ref_key:"formRefs2",ref:h,resource:g.resource,"onUpdate:resource":S=>g.resource=S,"resource-spec":e.capabilityDef.sourceSpec,"relationship-properties":g.relationshipProperties,"relationship-type-id":g.relationshipTypeId},null,8,["resource","onUpdate:resource","resource-spec","relationship-properties","relationship-type-id"]),r(Y,{ref_for:!0,ref_key:"formRefs3",ref:m,"capability-defs":e.capabilityDef.sourceCapabilities,modelValue:g.capabilities,"onUpdate:modelValue":S=>g.capabilities=S},null,8,["capability-defs","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),_:1})]),_:1})}}},Y={__name:"CapabilitiesSubForm",props:O({capabilityDefs:{required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=$(e,"modelValue"),t=e;function a(u){return u.relationshipSpec.primaryCapability===!0}function p(u){return u.relationshipSpec.visibleInTarget===!0}function R(u){return l.value===void 0?[]:l.value.filter(g=>g.relationshipTypeId===u.relationshipSpec.relationshipTypeId)}function v(u){l.value.push(u)}function d(u){l.value.splice(l.value.indexOf(u),1)}function h(u){for(let g=l.value.length-1;g>=0;g--)l.value[g].relationshipTypeId===u.relationshipSpec.relationshipTypeId&&l.value.splice(g,1)}const m=ue(),T=B(()=>t.capabilityDefs.filter(p).filter(a).filter(u=>!m.isIgnoredCapabilityType(u.relationshipSpec.relationshipTypeId))),s=B(()=>t.capabilityDefs.filter(p).filter(u=>!a(u)).filter(u=>!m.isIgnoredCapabilityType(u.relationshipSpec.relationshipTypeId))),f=y([]),I=y([]);function i(u){z([...f.value,...I.value],u)}return c({validate:i}),(u,g)=>(n(),E(N,null,[(n(!0),E(N,null,P(T.value,C=>(n(),E(N,null,[C.sourceSpec.buildable?(n(),V(Oe,{key:0,ref_for:!0,ref_key:"formRefs1",ref:f,"new-capabilities":R(C),"capability-def":C,onAddNewCapability:v,onRemoveCapabilities:h},null,8,["new-capabilities","capability-def"])):x("",!0)],64))),256)),(n(!0),E(N,null,P(s.value,C=>(n(),E(N,null,[C.sourceSpec.buildable?(n(),V(ze,{key:0,ref_for:!0,ref_key:"formRefs2",ref:I,"new-capabilities":R(C),"capability-def":C,onAddNewCapability:v,onRemoveCapability:d},null,8,["new-capabilities","capability-def"])):x("",!0)],64))),256))],64))}},te={tenantId:void 0,ownerId:void 0,resource:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0},requirements:[],capabilities:[],number:1},lt={sourceResourceId:void 0,targetResourceId:void 0,relationshipTypeId:void 0,relationshipInputs:{}},it={sourceId:void 0,newTargetId:void 0,relationshipTypeId:void 0,relationshipInputs:{}},ut={__name:"CreateResourceForm",props:O({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:te},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:c}){const l=ye(),t=e,a=$(e,"modelValue"),p=Se(()=>a.value.resource.resourceTypeId);Ee(),Ne(),J(),M(()=>{a.value.tenantId||(a.value.tenantId=l.tenantId),a.value.ownerId||(a.value.ownerId=l.userId)});function R(){return ve.cloneDeep(te)}c({validate:v,getDefaultFormData:R});function v(I){z([d.value,h.value,m.value,T.value,s.value],I)}const d=y(),h=y(),m=y(),T=y(),s=y(),f=y({tenantId:[{required:!0,message:"请选择租户",trigger:"blur"}],ownerId:[{required:!0,message:"请选择所有者",trigger:"blur"}]});return(I,i)=>{const u=_("ElCol"),g=_("ElFormItem"),C=_("ElRow"),S=_("ElInputNumber");return n(),V(w(Ce),{ref_key:"formRef",ref:d,model:a.value,"label-position":"top",rules:f.value},{default:o(()=>[r(C,{gutter:12},{default:o(()=>[r(u,{span:4},{default:o(()=>[D(" 资源归属 ")]),_:1}),r(u,{span:10},{default:o(()=>[r(g,{prop:"tenantId"},{default:o(()=>[r(fe,{modelValue:a.value.tenantId,"onUpdate:modelValue":i[0]||(i[0]=q=>a.value.tenantId=q)},null,8,["modelValue"])]),_:1})]),_:1}),r(u,{span:10},{default:o(()=>[r(g,{prop:"ownerId"},{default:o(()=>[r(ge,{placeholder:"请选择所有者",modelValue:a.value.ownerId,"onUpdate:modelValue":i[1]||(i[1]=q=>a.value.ownerId=q)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),r(Fe,{ref_key:"basicsSubFormRef",ref:h,"resource-category":t.resourceCategory,modelValue:a.value.resource,"onUpdate:modelValue":i[2]||(i[2]=q=>a.value.resource=q)},null,8,["resource-category","modelValue"]),w(p)?(n(),V(C,{key:0,gutter:12},{default:o(()=>[r(u,{span:4},{default:o(()=>[D(" 数量 ")]),_:1}),r(u,{span:10},{default:o(()=>[r(g,{prop:"number"},{default:o(()=>[r(S,{style:{width:"100%"},modelValue:a.value.number,"onUpdate:modelValue":i[3]||(i[3]=q=>a.value.number=q),min:1,max:200,"value-on-clear":1},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):x("",!0),w(p)&&a.value.requirements?(n(),V(X,{key:1,ref_key:"requirementsSubFormRef",ref:m,modelValue:a.value.requirements,"onUpdate:modelValue":i[4]||(i[4]=q=>a.value.requirements=q),"requirement-defs":w(p).requirements},null,8,["modelValue","requirement-defs"])):x("",!0),w(p)&&a.value.capabilities?(n(),V(Y,{key:2,ref_key:"capabilitiesSubFormRef",ref:T,modelValue:a.value.capabilities,"onUpdate:modelValue":i[5]||(i[5]=q=>a.value.capabilities=q),"capability-defs":w(p).capabilities},null,8,["modelValue","capability-defs"])):x("",!0),w(p)?(n(),V(C,{key:3,gutter:12,style:{"margin-top":"12px"}},{default:o(()=>[r(u,{span:4},{default:o(()=>[D(k(w(p).spec.resourceCategoryName)+"属性 ",1)]),_:1}),r(u,{span:20},{default:o(()=>[r(se,{ref_key:"propertiesSubFormRef",ref:s,"resource-type-spec":w(p).spec,"enable-description":"","enable-tags":"",modelValue:a.value.resource,"onUpdate:modelValue":i[6]||(i[6]=q=>a.value.resource=q)},null,8,["resource-type-spec","modelValue"])]),_:1})]),_:1})):x("",!0)]),_:1},8,["model","rules"])}}};export{ut as _,Q as a,it as b,lt as c,ot as d,at as u};
