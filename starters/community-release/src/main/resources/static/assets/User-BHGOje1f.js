import{b as te,a as oe,u as _e,c as ye,s as Ue,e as we,f as Re,g as Ie,h as ke,d as Ne}from"./user-BKxh-AQB.js";import{S as k}from"./StratoButton-D7m4JR2l.js";import{_ as re}from"./TenantTreeSelector-DrVO4R-0.js";import{a8 as Y,r as u,y as ue,o as _,q as C,w as a,e,u as l,E as I,f as T,j as Z,ag as se,ah as x,ai as De,b as G,d as H,F as J,v as E,i as N,O as de,P as D,aj as X,t as ne,ak as ie,al as Ce,a2 as B,am as Te,an as ae}from"./index-C_jnbPMf.js";import{a as Ee,_ as Ae}from"./UpdateUserForm-BMOXtGcr.js";import{_ as P}from"./StratoDrawer-BQ9z9CYD.js";import{_ as me}from"./StratoTable--zpPaOW_.js";import{u as Fe,c as Se,d as xe}from"./role-DAS94606.js";import{s as ee}from"./request-BV6gXtmx.js";const Pe={__name:"CreateUserForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g,{expose:h}){const t=Y(g,"modelValue"),d=u();h({validate:v});function v(R){d.value.validate(R)}const y=u({tenantId:[{required:!0,message:"请选择所属租户"}],loginName:[{required:!0,message:"请输入用户名"}],realName:[{required:!0,message:"请输入姓名"}],password:[{required:!0,message:"请输入密码"}]});return ue(()=>{}),(R,r)=>(_(),C(l(Z),{ref_key:"formRef",ref:d,model:t.value,"label-position":"top",rules:y.value},{default:a(()=>[e(l(I),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(re,{modelValue:t.value.tenantId,"onUpdate:modelValue":r[0]||(r[0]=o=>t.value.tenantId=o)},null,8,["modelValue"])]),_:1}),e(l(I),{label:"登录名",prop:"loginName"},{default:a(()=>[e(l(T),{modelValue:t.value.loginName,"onUpdate:modelValue":r[1]||(r[1]=o=>t.value.loginName=o),placeholder:"请输入登录名"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"姓名",prop:"realName"},{default:a(()=>[e(l(T),{modelValue:t.value.realName,"onUpdate:modelValue":r[2]||(r[2]=o=>t.value.realName=o),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"密码",prop:"password"},{default:a(()=>[e(l(T),{autocomplete:"new-password",type:"password","show-password":"",modelValue:t.value.password,"onUpdate:modelValue":r[3]||(r[3]=o=>t.value.password=o),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"邮箱"},{default:a(()=>[e(l(T),{modelValue:t.value.emailAddress,"onUpdate:modelValue":r[4]||(r[4]=o=>t.value.emailAddress=o),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"手机号",placeholder:"请输入手机号"},{default:a(()=>[e(l(T),{modelValue:t.value.phoneNumber,"onUpdate:modelValue":r[5]||(r[5]=o=>t.value.phoneNumber=o),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"描述"},{default:a(()=>[e(l(T),{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":r[6]||(r[6]=o=>t.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},qe={__name:"CreateRoleForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g,{expose:h}){const t=Y(g,"modelValue"),d=u();h({validate:v});function v(R){d.value.validate(R)}const y=u({tenantId:[{required:!0,message:"请选择所属租户"}],name:[{required:!0,message:"请输入角色名称"}],roleType:[{required:!0,message:"请选择角色类型"}]});return(R,r)=>(_(),C(l(Z),{ref_key:"formRef",ref:d,model:t.value,"label-position":"top",rules:y.value},{default:a(()=>[e(l(I),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(re,{modelValue:t.value.tenantId,"onUpdate:modelValue":r[0]||(r[0]=o=>t.value.tenantId=o)},null,8,["modelValue"])]),_:1}),e(l(I),{label:"角色名称",prop:"name"},{default:a(()=>[e(l(T),{modelValue:t.value.name,"onUpdate:modelValue":r[1]||(r[1]=o=>t.value.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"角色类型",prop:"roleType"},{default:a(()=>[e(l(se),{style:{width:"100%"},modelValue:t.value.roleType,"onUpdate:modelValue":r[2]||(r[2]=o=>t.value.roleType=o),placeholder:"请选择角色类型"},{default:a(()=>[e(l(x),{label:"全局超级管理员",value:"SUPER_ADMIN"}),e(l(x),{label:"租户级超级管理员",value:"TENANT_SUPER_ADMIN"}),e(l(x),{label:"租户级管理员",value:"TENANT_ADMIN"}),e(l(x),{label:"普通用户",value:"NORMAL_USER"})]),_:1},8,["modelValue"])]),_:1}),e(l(I),{label:"描述"},{default:a(()=>[e(l(T),{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":r[3]||(r[3]=o=>t.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Oe={__name:"UpdateRoleForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(g,{expose:h}){const t=Y(g,"modelValue"),d=u();h({validate:v});function v(R){d.value.validate(R)}const y=u({name:[{required:!0,message:"请输入角色名称"}],roleType:[{required:!0,message:"请选择角色类型"}]});return(R,r)=>(_(),C(l(Z),{ref_key:"formRef",ref:d,model:t.value,"label-position":"top",rules:y.value},{default:a(()=>[e(l(I),{label:"角色名称",prop:"name"},{default:a(()=>[e(l(T),{modelValue:t.value.name,"onUpdate:modelValue":r[0]||(r[0]=o=>t.value.name=o),placeholder:"请输入角色名称"},null,8,["modelValue"])]),_:1}),e(l(I),{label:"角色类型",prop:"roleType"},{default:a(()=>[e(l(se),{style:{width:"100%"},modelValue:t.value.roleType,"onUpdate:modelValue":r[1]||(r[1]=o=>t.value.roleType=o),placeholder:"请选择角色类型"},{default:a(()=>[e(l(x),{label:"全局超级管理员",value:"SUPER_ADMIN"}),e(l(x),{label:"租户级超级管理员",value:"TENANT_SUPER_ADMIN"}),e(l(x),{label:"租户级管理员",value:"TENANT_ADMIN"}),e(l(x),{label:"普通用户",value:"NORMAL_USER"})]),_:1},8,["modelValue"])]),_:1}),e(l(I),{label:"描述"},{default:a(()=>[e(l(T),{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":r[2]||(r[2]=o=>t.value.description=o),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Me=g=>ee({url:"/identity-service/describe-permissions",method:"post",data:g}),$e=g=>ee({url:"/identity-service/add-permissions-to-role",method:"post",data:g}),Le=g=>ee({url:"/identity-service/remove-permissions-from-role",method:"post",data:g}),je={__name:"PermissionsSelector",props:{roleId:{required:!0,type:String},permissionIds:{required:!0,type:Array}},setup(g){const h=u([]),t=g,d=u([]),v=u([]),y=u([]),R={multiple:!0};function r(){Me({}).then(i=>{if(i.permissions&&i.permissions.length>0){h.value=[];for(let p of i.permissions){let b=h.value.find(A=>A.value===p.target);b==null&&(b={value:p.target,label:p.targetName,children:[]},h.value.push(b)),b.children.push({value:p.id,label:p.actionName,children:[]}),t.permissionIds.indexOf(p.id)!=-1&&d.value.push([p.target,p.id])}}})}function o(i){let p=[...t.permissionIds,...v.value];p=p.filter(U=>!y.value.includes(U));let b=i.filter(U=>p.find(w=>U[1]===w)==null).map(U=>U[1]),A=p.filter(U=>i.find(w=>w[1]===U)==null);if(A.length>0){Le({roleId:t.roleId,permissionIds:A}).then(U=>{for(let w of A){let F=v.value.indexOf(w);F!==-1&&v.value.splice(F,1),y.value.push(w)}});return}if(b.length>0){$e({roleId:t.roleId,permissionIds:b}).then(U=>{for(let w of b){let F=y.value.indexOf(w);F!==-1&&y.value.splice(F,1),v.value.push(w)}});return}}return ue(()=>{r()}),(i,p)=>(_(),C(l(De),{size:"large",modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=b=>d.value=b),style:{width:"fit-content"},options:h.value,props:R,"collapse-tags":"","collapse-tags-tooltip":"","max-collapse-tags":15,clearable:"",onChange:o},null,8,["modelValue","options"]))}},ze={style:{"margin-bottom":"10px"}},Be={hidden:""},fe={__name:"Role",props:{simpleMode:{default:!1,required:!1}},setup(g){const h=u(),t=u({}),d=u([]),v=u(!1),y=u({}),R=u(),r=u(!1),o=u({}),i=u(),p=u(!1),b=u(!1);function A(V){switch(V){case"SUPER_ADMIN":return"全局超级管理员";case"TENANT_SUPER_ADMIN":return"租户级超级管理员";case"TENANT_ADMIN":return"租户级管理员";case"NORMAL_USER":return"普通用户"}return V}function U(V,c,n,S){n?te({assignList:[{userId:V,roleId:c}]}).catch($=>{S.related=!1}):oe({removeList:[{userId:V,roleId:c}]}).catch($=>{S.related=!0})}function w(){if(d.value.length!=1){ElNotification({title:"错误",message:"请选择一个角色",type:"error"});return}p.value=!0}function F(){if(d.value.length!=1){ElNotification({title:"错误",message:"请选择一个角色",type:"error"});return}b.value=!0}function q(){if(d.value.length!=1){ElNotification({title:"错误",message:"请选择一个角色",type:"error"});return}o.value={roleId:d.value[0].id,name:d.value[0].name,roleType:d.value[0].type,description:d.value[0].description},r.value=!0}function K(){i.value.validate((V,c)=>{V&&Fe(o.value).then(n=>{h.value.fetchData(),r.value=!1})})}function Q(){v.value=!0}function W(){R.value.validate((V,c)=>{V&&Se(y.value).then(n=>{h.value.fetchData(),v.value=!1})})}function O(V){d.value=V}function j(){return d.value.map(V=>V.id)}function M(){const c={userIds:j()};deleteUsers(c).then(n=>{h.value.fetchData()}).catch(n=>{})}return(V,c)=>(_(),G(J,null,[H("div",ze,[g.simpleMode?E("",!0):(_(),G(J,{key:0},[e(k,{type:"primary",onClick:Q},{default:a(()=>[N("创建")]),_:1}),e(k,{disabled:d.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:w},{default:a(()=>[N("关联用户")]),_:1},8,["disabled"]),e(k,{disabled:d.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:F},{default:a(()=>[N("关联权限")]),_:1},8,["disabled"]),e(k,{disabled:d.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:q},{default:a(()=>[N("编辑")]),_:1},8,["disabled"]),e(l(de),{title:"确认删除",onConfirm:M},{reference:a(()=>[e(k,{disabled:d.value.length===0,type:"danger",plain:""},{default:a(()=>[N("删除")]),_:1},8,["disabled"])]),_:1})],64)),e(l(T),{style:{float:"right",width:"20%"},modelValue:t.value.search,"onUpdate:modelValue":c[0]||(c[0]=n=>t.value.search=n),"suffix-icon":"search"},null,8,["modelValue"])]),e(me,{ref_key:"roleTableRef",ref:h,"paging-request":t.value,"remote-method":l(xe),onSelectionChange:O},{default:a(()=>[g.simpleMode?E("",!0):(_(),C(l(D),{key:0,type:"selection","reserve-selection":""})),e(l(D),{prop:"name",label:"角色名称",sortable:"custom"}),e(l(D),{prop:"type",label:"角色类型",sortable:"custom",formatter:(n,S,$,le)=>A($)},null,8,["formatter"]),g.simpleMode?E("",!0):(_(),C(l(D),{key:1,prop:"description",label:"描述",sortable:"custom"})),e(l(D),{prop:"createdAt",label:"创建时间",sortable:"custom"}),X(V.$slots,"default")]),_:3},8,["paging-request","remote-method"]),e(P,{modelValue:v.value,"onUpdate:modelValue":c[2]||(c[2]=n=>v.value=n),title:"创建角色",onOnConfirm:W},{default:a(()=>[e(qe,{ref_key:"createRoleFormRef",ref:R,modelValue:y.value,"onUpdate:modelValue":c[1]||(c[1]=n=>y.value=n)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:r.value,"onUpdate:modelValue":c[4]||(c[4]=n=>r.value=n),title:"编辑角色",onOnConfirm:K},{default:a(()=>[e(Oe,{ref_key:"updateRoleFormRef",ref:i,modelValue:o.value,"onUpdate:modelValue":c[3]||(c[3]=n=>o.value=n)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:p.value,"onUpdate:modelValue":c[5]||(c[5]=n=>p.value=n),"no-confirm":"",title:"关联用户",size:800},{default:a(()=>[p.value?(_(),C(pe,{key:0,"simple-mode":!0},{default:a(()=>[e(l(D),{label:"关联状态"},{default:a(n=>[H("span",Be,ne(n.row.related=n.row.related===void 0?n.row.roleIds.includes(d.value[0].id):n.row.related),1),e(l(ie),{modelValue:n.row.related,"onUpdate:modelValue":S=>n.row.related=S,onChange:S=>U(n.row.id,d.value[0].id,n.row.related,n.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1})):E("",!0)]),_:1},8,["modelValue"]),e(P,{modelValue:b.value,"onUpdate:modelValue":c[6]||(c[6]=n=>b.value=n),"no-confirm":"",title:"配置权限",size:800},{default:a(()=>[b.value?(_(),C(je,{key:0,"role-id":d.value[0].id,"permission-ids":d.value[0].permissionIds},null,8,["role-id","permission-ids"])):E("",!0)]),_:1},8,["modelValue"])],64))}},al=Object.freeze(Object.defineProperty({__proto__:null,default:fe},Symbol.toStringTag,{value:"Module"})),Ge={style:{"margin-bottom":"10px",height:"32px"}},He={hidden:""},pe={__name:"User",props:{simpleMode:{default:!1,required:!1,type:Boolean},userGroupIds:{default:void 0,required:!1}},emits:["change"],setup(g,{expose:h,emit:t}){const d=g,v=u(),y=[{text:"已锁定",value:!0},{text:"未锁定",value:!1}],R=[{text:"已禁用",value:!0},{text:"未禁用",value:!1}];function r(m){"locked"in m&&(m.locked.length>0?o.value.locked=m.locked[0]:o.value.locked=void 0),"disabled"in m&&(m.disabled.length>0?o.value.disabled=m.disabled[0]:o.value.disabled=void 0)}const o=u({userGroupIds:d.userGroupIds}),i=u([]),p=u(!1),b=u({}),A=u(),U=u(!1),w=u({}),F=u(),q=u(!1);function K(){i.value.length===1&&(q.value=!0)}function Q(){i.value.length===1&&(w.value={userId:i.value[0].id,realName:i.value[0].realName,emailAddress:i.value[0].emailAddress,phoneNumber:i.value[0].phoneNumber,description:i.value[0].description},U.value=!0)}function W(){F.value.validate(m=>{m&&_e(w.value).then(()=>{v.value.fetchData(),U.value=!1})})}const O=u({}),j=u(),M=u(!1);function V(){i.value.length===1&&(O.value.userId=i.value[0].id,M.value=!0)}function c(){j.value.validate(m=>{m&&ye(O.value).then(()=>{v.value.fetchData(),M.value=!1})})}function n(){p.value=!0}function S(){A.value.validate(m=>{m&&Ue(b.value).then(()=>{v.value.fetchData(),p.value=!1})})}const $=t;function le(m){i.value=m,$("change",m)}function z(){return i.value.map(m=>m.id)}function ve(){const f={userIds:z()};we(f).then(()=>{v.value.fetchData()}).catch(()=>{})}function ce(){const f={userIds:z()};Re(f).then(()=>{v.value.fetchData()}).catch(()=>{})}function ge(){const f={userIds:z()};Ie(f).then(()=>{v.value.fetchData()}).catch(()=>{})}function be(){const f={userIds:z()};ke(f).then(()=>{v.value.fetchData()}).catch(()=>{})}function Ve(m,f,s,L){s?te({assignList:[{userId:m,roleId:f}]}).catch(()=>{L.related=!1}):oe({removeList:[{userId:m,roleId:f}]}).catch(()=>{L.related=!0})}function he(){v.value.fetchData()}return h({fetchData:he}),(m,f)=>(_(),G(J,null,[H("div",Ge,[X(m.$slots,"buttons"),g.simpleMode?E("",!0):(_(),G(J,{key:0},[e(k,{type:"primary",onClick:n},{default:a(()=>[N("创建")]),_:1}),e(k,{disabled:i.value.length!==1,onClick:K,"disabled-message":"请选择且只选择一项"},{default:a(()=>[N("关联角色")]),_:1},8,["disabled"]),e(k,{disabled:i.value.length!==1,onClick:Q,"disabled-message":"请选择且只选择一项"},{default:a(()=>[N("编辑")]),_:1},8,["disabled"]),e(k,{disabled:i.value.length!==1,onClick:V,"disabled-message":"请选择且只选择一项"},{default:a(()=>[N("修改密码")]),_:1},8,["disabled"]),e(k,{disabled:i.value.length===0,type:"success",plain:"",onClick:ce},{default:a(()=>[N("启用")]),_:1},8,["disabled"]),e(k,{disabled:i.value.length===0,type:"success",plain:"",onClick:ve},{default:a(()=>[N("解锁")]),_:1},8,["disabled"]),e(k,{disabled:i.value.length===0,type:"danger",plain:"",onClick:ge},{default:a(()=>[N("禁用")]),_:1},8,["disabled"]),e(l(de),{title:"确认删除",onConfirm:be},{reference:a(()=>[e(k,{disabled:i.value.length===0,type:"danger",plain:""},{default:a(()=>[N("删除")]),_:1},8,["disabled"])]),_:1})],64)),e(l(T),{style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":f[0]||(f[0]=s=>o.value.search=s),"suffix-icon":"search"},null,8,["modelValue"])]),e(me,{ref_key:"userTableRef",ref:v,"paging-request":o.value,"remote-method":l(Ne),onSelectionChange:le,onFilterChange:r},{default:a(()=>[e(l(D),{type:"selection","reserve-selection":""}),e(l(D),{prop:"loginName",label:"登录名",sortable:"custom"}),e(l(D),{prop:"realName",label:"姓名",sortable:"custom"}),e(l(D),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(l(D),{"column-key":"locked",label:"是否锁定",filters:y,"filter-multiple":!1},{default:a(s=>[s.row.locked?(_(),C(l(B),{key:0,color:"red"},{default:a(()=>[e(l(Ce))]),_:1})):E("",!0),s.row.locked?E("",!0):(_(),C(l(B),{key:1,color:"green"},{default:a(()=>[e(l(Te))]),_:1}))]),_:1}),e(l(D),{"column-key":"disabled",label:"是否禁用",filters:R,"filter-multiple":!1},{default:a(s=>[s.row.disabled?(_(),C(l(B),{key:0,color:"red"},{default:a(()=>[e(l(ae))]),_:1})):E("",!0),s.row.disabled?E("",!0):(_(),C(l(B),{key:1,color:"green"},{default:a(()=>[e(l(ae))]),_:1}))]),_:1}),X(m.$slots,"default")]),_:3},8,["paging-request","remote-method"]),e(P,{modelValue:p.value,"onUpdate:modelValue":f[2]||(f[2]=s=>p.value=s),title:"创建用户",onOnConfirm:S},{default:a(()=>[e(Pe,{ref_key:"createUserFormRef",ref:A,modelValue:b.value,"onUpdate:modelValue":f[1]||(f[1]=s=>b.value=s)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:U.value,"onUpdate:modelValue":f[4]||(f[4]=s=>U.value=s),title:"编辑用户",onOnConfirm:W},{default:a(()=>[e(Ee,{ref_key:"updateUserFormRef",ref:F,modelValue:w.value,"onUpdate:modelValue":f[3]||(f[3]=s=>w.value=s)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:M.value,"onUpdate:modelValue":f[6]||(f[6]=s=>M.value=s),title:"修改密码",onOnConfirm:c},{default:a(()=>[e(Ae,{ref_key:"changePasswordFormRef",ref:j,modelValue:O.value,"onUpdate:modelValue":f[5]||(f[5]=s=>O.value=s)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(P,{modelValue:q.value,"onUpdate:modelValue":f[7]||(f[7]=s=>q.value=s),"no-confirm":"",title:"关联角色",size:800},{default:a(()=>[q.value?(_(),C(fe,{key:0,"simple-mode":!0},{default:a(()=>[e(l(D),{label:"关联状态"},{default:a(s=>[H("span",He,ne(s.row.related=s.row.related===void 0?i.value[0].roleIds.includes(s.row.id):s.row.related),1),e(l(ie),{modelValue:s.row.related,"onUpdate:modelValue":L=>s.row.related=L,onChange:L=>Ve(i.value[0].id,s.row.id,s.row.related,s.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1})]),_:1})):E("",!0)]),_:1},8,["modelValue"])],64))}},tl=Object.freeze(Object.defineProperty({__proto__:null,default:pe},Symbol.toStringTag,{value:"Module"}));export{al as R,tl as U,pe as _};
