import{_ as be}from"./StratoTable-CDLvuijz.js";import{a as je,p as Pe,b as Le,c as Fe,e as Me,f as He,r as Je,g as Ye,h as Te,i as Ge,u as Ke,j as Qe}from"./resource-ChSpNJ4i.js";import{r as c,n as I,o as l,b as y,q as f,w as t,d as E,t as T,u as r,v as C,e as a,F as A,A as re,O as we,f as he,P as O,m as Q,i as B,x as ke,Q as le,B as F,S as Ee,T as Ze,U as We,V as L,W as ie,X as Xe,Y as et,Z as tt,_ as at,y as Re,z as lt,$ as pe,a0 as H,a1 as rt,a2 as Ae,a3 as ot,I as nt,a4 as st,l as ut,a5 as it}from"./index-CGSAaZ7c.js";import{S as P}from"./StratoButton-BbyvpoLv.js";import{_ as ce,u as ct,R as ye,a as Se}from"./ResourceSelector-CNqWYCf0.js";import{_ as Ie,a as qe,b as dt,c as mt,d as ft,e as pt,f as yt,g as vt}from"./ClaimResourcesForm-CvZBAaar.js";import{_ as M}from"./StratoDrawer-SANI4yOp.js";import{_ as xe}from"./CreateResourceForm-BC1EWExE.js";import{r as W}from"./asyncJob-BQqx-GkL.js";import{u as X}from"./activeJob-DuWQaxKt.js";import{R as de,a as me}from"./ResourceTags-tTk0QtlC.js";import{_ as De}from"./ResourceLink-BeEXAYm3.js";import{c as gt}from"./cartItem-BHrfasDT.js";import{u as bt,a as ht}from"./AccountContext-CRGbKwzU.js";import{l as ve,u as Ce}from"./request-BLvKnTIl.js";import{c as Ve}from"./job-D_aeKnDK.js";import{d as Rt}from"./account-B2XyNJSy.js";import{_ as Ct}from"./UserSelector-D6CrvvR3.js";import{_ as _t}from"./TagValueSelectorGroup-ARuF-rHD.js";import"./StratoPagingSelector-BVtmGqMc.js";import"./IpState-DbETxjvx.js";import"./StratoDynamicForm-7WrPYX7O.js";import"./role-BAGE53ge.js";import"./scriptDefinition-BbSCbaPp.js";import"./StratoSelector-CcCz7NMM.js";import"./TenantTreeSelector-D1-Nh39D.js";import"./AccountSelector-DEw35b-n.js";import"./FormUtil-CO0XXxtf.js";import"./user-zWqZjtFx.js";import"./tag-BnHK6w2S.js";const Et={style:{"font-size":"12px"}},St={__name:"CreateCapabilityButton",props:{resource:{required:!0},capability:{required:!0}},setup(e){const i=e,n=c("CREATE"),s=X(),o=i.capability.relationshipSpec,d=c(!1),u=c(!1),m=c(),_=c({tenantId:i.resource.tenantId,ownerId:i.resource.ownerId,resource:{resourceTypeId:i.capability.sourceSpec.resourceTypeId,externalAccountId:i.resource.accountId,properties:{},tags:[]},number:1,requirements:[{targetResourceId:i.resource.id,relationshipTypeId:o.relationshipTypeId,relationshipInputs:{}}],capabilities:[]}),v=c(),b=c({targetResourceId:i.resource.id,relationshipTypeId:o.relationshipTypeId,relationshipInputs:{}});function h(){u.value=!0}function R(){let g,p;if(n.value==="CREATE")g={jobType:"BATCH_CREATE_RESOURCES",jobParameters:{resources:[_.value]}},p=m;else if(n.value==="CONNECT")g={jobType:"BATCH_CONNECT_RESOURCES",jobParameters:{connections:[b.value]}},p=v;else return;p.value.validate(S=>{S&&(d.value=!0,W(g).then($=>{s.setActiveJobId($.jobId),u.value=!1}).finally(()=>{d.value=!1}))})}return(g,p)=>{const S=I("ElRadioButton"),$=I("ElRadioGroup");return l(),y(A,null,[i.capability.sourceSpec.buildable?(l(),f(P,{key:0,size:"small",plain:"",type:"success",onClick:h},{default:t(()=>[E("span",Et,T(r(o).connectActionName),1)]),_:1})):C("",!0),a(M,{modelValue:u.value,"onUpdate:modelValue":p[3]||(p[3]=U=>u.value=U),title:r(o).capabilityName,size:"800",loading:d.value,onOnConfirm:R},{default:t(()=>[a($,{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=U=>n.value=U),style:{"margin-bottom":"20px"}},{default:t(()=>[a(S,{label:`新建${i.capability.sourceSpec.resourceCategoryName}`,value:"CREATE"},null,8,["label"]),a(S,{label:`使用已有${i.capability.sourceSpec.resourceCategoryName}`,disabled:r(o).essentialRequirement||r(o).primaryCapability,value:"CONNECT"},null,8,["label","disabled"])]),_:1},8,["modelValue"]),n.value==="CREATE"?(l(),f(xe,{key:0,ref_key:"createCapabilityFormRef",ref:m,"resource-category":i.capability.sourceSpec.resourceCategoryId,modelValue:_.value,"onUpdate:modelValue":p[1]||(p[1]=U=>_.value=U)},null,8,["resource-category","modelValue"])):C("",!0),n.value==="CONNECT"?(l(),f(Ie,{key:1,ref_key:"connectFormRef",ref:v,modelValue:b.value,"onUpdate:modelValue":p[2]||(p[2]=U=>b.value=U)},null,8,["modelValue"])):C("",!0)]),_:1},8,["modelValue","title","loading"])],64)}}},Tt={style:{"margin-bottom":"10px",height:"20px"}},wt={style:{"font-size":"12px"}},kt={__name:"CapabilityTab",props:{resource:{required:!0},capability:{required:!0}},setup(e){const i=e,n=i.capability.relationshipSpec,s=c({targetId:i.resource.id,relationshipType:n.relationshipTypeId}),o=c([]);function d(h){o.value=h}function u(){}const m=c(),_=re(()=>!(n.primaryCapability&&m.value&&m.value.getTotal())),v=X();function b(){o.value.length!==0&&W({jobType:"BATCH_DISCONNECT_RESOURCES",jobParameters:{relationshipIds:o.value.map(h=>h.id)}}).then(h=>{v.setActiveJobId(h.jobId),m.value.fetchData()})}return(h,R)=>{const g=I("ElSpace");return l(),y(A,null,[E("div",Tt,[a(g,{alignment:"normal"},{default:t(()=>[_.value?(l(),f(St,{key:0,resource:i.resource,capability:i.capability},null,8,["resource","capability"])):C("",!0),!r(n).essentialRequirement&&!r(n).primaryCapability&&i.capability.sourceSpec.destroyable?(l(),f(r(we),{key:1,title:`确认${r(n).disconnectActionName}`,onConfirm:b},{reference:t(()=>[a(P,{size:"small",disabled:o.value.length===0,type:"danger",plain:""},{default:t(()=>[E("span",wt,T(r(n).disconnectActionName),1)]),_:1},8,["disabled"])]),_:1},8,["title"])):C("",!0)]),_:1}),a(r(he),{size:"small",style:{float:"right",width:"20%"},modelValue:s.value.search,"onUpdate:modelValue":R[0]||(R[0]=p=>s.value.search=p),"suffix-icon":"search"},null,8,["modelValue"])]),a(be,{ref_key:"capabilityTableRef",ref:m,"paging-request":s.value,"remote-method":r(je),onSelectionChange:d,onFilterChange:u,"default-page-size":5,size:"small"},{default:t(()=>[a(r(O),{type:"selection","reserve-selection":""}),a(r(O),{prop:"sourceName",label:"资源名称"},{default:t(p=>[a(De,{"resource-category":p.row.source.category,"resource-id":p.row.source.id,"resource-name":p.row.source.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),a(r(O),{prop:"sourceType",label:"类型"},{default:t(p=>[E("span",null,T(p.row.source.typeName),1)]),_:1}),a(r(O),{prop:"sourceState",label:"资源状态"},{default:t(p=>[a(ce,{state:p.row.source.state},null,8,["state"])]),_:1}),a(r(O),{prop:"relationshipState",label:"关联状态"},{default:t(p=>[a(qe,{state:p.row.state},null,8,["state"])]),_:1}),a(r(O),{label:"标签"},{default:t(p=>[a(de,{"in-list":"",resource:p.row.source},null,8,["resource"])]),_:1}),a(r(O),{label:"属性",width:"200"},{default:t(p=>[a(me,{"in-list":"",resource:p.row.source},null,8,["resource"])]),_:1})]),_:1},8,["paging-request","remote-method"])],64)}}},At={key:0},It={key:1},qt={__name:"ChangeEssentialTargetPriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const i=e,n=c(),s=c(!1);return Q(i,()=>{s.value=!0,Pe({changes:[i.formData]}).then(o=>{n.value=o.totalMonthlyCostDescription}).finally(()=>{s.value=!1})},{immediate:!0,deep:!0}),(o,d)=>{const u=I("ElText");return l(),f(u,{type:"warning"},{default:t(()=>[s.value?(l(),y("span",At,"费用查询中...")):(l(),y("span",It,"费用："+T(n.value?n.value:"无"),1))]),_:1})}}},ue={__name:"AddToCartButton",props:{jobParameters:{required:!0,type:Object},jobType:{required:!0,type:String},formRef:{required:!0}},emits:["confirm"],setup(e,{emit:i}){const n=e,s=i;function o(){n.formRef.validate(u=>{u&&(d.value=!0,gt({jobType:n.jobType,jobParameters:n.jobParameters}).then(()=>{s("confirm"),ke.success("已加入待办队列")}).finally(()=>{d.value=!1}))})}const d=c(!1);return(u,m)=>{const _=I("ElButton");return l(),f(_,{type:"primary",plain:"",loading:d.value,icon:"ShoppingCart",onClick:o},{default:t(()=>[B("加入待办队列")]),_:1},8,["loading"])}}},xt={style:{"margin-bottom":"10px",height:"20px"}},Dt={style:{"font-size":"12px"}},Vt={style:{"font-size":"12px"}},Ot={style:{"font-size":"12px"}},Bt={__name:"RequirementTab",props:{resource:{required:!0},requirement:{required:!0}},setup(e){const i=e,n=X(),s=i.requirement.relationshipSpec,o=c({sourceId:i.resource.id,relationshipType:s.relationshipTypeId}),d=c([]);function u(q){d.value=q}function m(){}const _=re(()=>{var x,G;const q=s.exclusiveRequirement&&((x=J.value)==null?void 0:x.getTotal())>0,j=!((G=s.allowedSourceStates)!=null&&G.includes(i.resource.state));return q||j}),v=c(!1),b=c(),h=c(!1),R=c({sourceResourceId:i.resource.id,relationshipTypeId:s.relationshipTypeId,relationshipInputs:{}});function g(){v.value=!0}function p(){b.value.validate(q=>{q&&(h.value=!0,W({jobType:"BATCH_CONNECT_RESOURCES",jobParameters:{connections:[R.value]}}).then(j=>{n.setActiveJobId(j.jobId),J.value.fetchData(),v.value=!1}).finally(()=>{h.value=!1}))})}const S=c(!1),$=c(),U=c(!1),w=c({sourceId:i.resource.id,relationshipTypeId:s.relationshipTypeId,newTargetId:void 0,relationshipInputs:{}});function z(){S.value=!0}function N(){$.value.validate(q=>{q&&(U.value=!0,W({jobType:"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS",jobParameters:{changes:[w.value]}}).then(j=>{n.setActiveJobId(j.jobId),J.value.fetchData(),S.value=!1}).finally(()=>{U.value=!1}))})}function Y(){d.value.length!==0&&W({jobType:"BATCH_DISCONNECT_RESOURCES",jobParameters:{relationshipIds:d.value.map(q=>q.id)}}).then(q=>{n.setActiveJobId(q.jobId),J.value.fetchData()})}const J=c();function Z(){S.value=!1}function ee(){v.value=!1}return(q,j)=>(l(),y(A,null,[E("div",xt,[r(s).changeableEssential?(l(),f(P,{key:0,size:"small",plain:"",type:"success",onClick:z,disabled:d.value.length===0},{default:t(()=>[E("span",Dt," 变更"+T(i.requirement.targetSpec.resourceCategoryName),1)]),_:1},8,["disabled"])):C("",!0),!r(s).essentialRequirement&&!r(s).essentialPrimaryCapability?(l(),f(P,{key:1,size:"small",plain:"",type:"success",disabled:_.value,"disabled-message":"该资源当前无法挂载到此目标",onClick:g},{default:t(()=>[E("span",Vt,T(r(s).connectActionName),1)]),_:1},8,["disabled"])):C("",!0),!r(s).essentialRequirement&&!r(s).essentialPrimaryCapability?(l(),f(r(we),{key:2,title:`确认${r(s).disconnectActionName}`,onConfirm:Y},{reference:t(()=>[a(P,{size:"small",disabled:d.value.length===0,type:"danger",plain:""},{default:t(()=>[E("span",Ot,T(r(s).disconnectActionName),1)]),_:1},8,["disabled"])]),_:1},8,["title"])):C("",!0),a(r(he),{size:"small",style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":j[0]||(j[0]=x=>o.value.search=x),"suffix-icon":"search"},null,8,["modelValue"])]),a(be,{ref_key:"requirementTableRef",ref:J,"paging-request":o.value,"remote-method":r(Le),onSelectionChange:u,onFilterChange:m,"default-page-size":5,size:"small"},{default:t(()=>[a(r(O),{type:"selection","reserve-selection":"",selectable:x=>x.state!=="DISCONNECTED"},null,8,["selectable"]),a(r(O),{prop:"targetName",label:"资源名称"},{default:t(x=>[a(De,{"resource-category":x.row.target.category,"resource-id":x.row.target.id,"resource-name":x.row.target.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),a(r(O),{prop:"targetType",label:"类型"},{default:t(x=>[E("span",null,T(x.row.target.typeName),1)]),_:1}),a(r(O),{prop:"targetState",label:"资源状态"},{default:t(x=>[a(ce,{state:x.row.target.state},null,8,["state"])]),_:1}),a(r(O),{prop:"relationshipState",label:"关联状态"},{default:t(x=>[a(qe,{state:x.row.state},null,8,["state"])]),_:1}),a(r(O),{label:"标签"},{default:t(x=>[a(de,{"in-list":"",resource:x.row.target},null,8,["resource"])]),_:1}),a(r(O),{label:"属性",width:"200"},{default:t(x=>[a(me,{"in-list":"",resource:x.row.target},null,8,["resource"])]),_:1})]),_:1},8,["paging-request","remote-method"]),a(M,{modelValue:v.value,"onUpdate:modelValue":j[2]||(j[2]=x=>v.value=x),size:"800",title:r(s).requirementName,onOnConfirm:p,loading:h.value},le({default:t(()=>[a(Ie,{ref_key:"connectFormRef",ref:b,modelValue:R.value,"onUpdate:modelValue":j[1]||(j[1]=x=>R.value=x)},null,8,["modelValue"])]),_:2},[v.value?{name:"footer",fn:t(()=>[a(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CONNECT_RESOURCES","job-parameters":{connections:[R.value]},"form-ref":b.value,onConfirm:ee},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","loading"]),a(M,{modelValue:S.value,"onUpdate:modelValue":j[4]||(j[4]=x=>S.value=x),size:"800",title:`变更${i.requirement.targetSpec.resourceCategoryName}`,onOnConfirm:N,loading:U.value},le({default:t(()=>[a(dt,{ref_key:"changeFormRef",ref:$,modelValue:w.value,"onUpdate:modelValue":j[3]||(j[3]=x=>w.value=x)},null,8,["modelValue"])]),_:2},[S.value?{name:"footer",fn:t(()=>[a(qt,{"form-data":w.value},null,8,["form-data"]),a(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS","job-parameters":{changes:[w.value]},"form-ref":$.value,onConfirm:Z},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","loading"])],64))}},Ut={__name:"RelationshipTabs",props:{resource:{required:!0},resourceTypeDef:{required:!0}},setup(e){const i=e;return bt(()=>i.resource.accountId),(n,s)=>(l(),f(r(Ze),null,{default:t(()=>[e.resourceTypeDef.requirements&&e.resourceTypeDef.requirements.length>0?(l(!0),y(A,{key:0},F(e.resourceTypeDef.requirements,o=>(l(),f(r(Ee),{lazy:"",label:o.relationshipSpec.requirementName},{default:t(()=>[a(Bt,{resource:i.resource,requirement:o},null,8,["resource","requirement"])]),_:2},1032,["label"]))),256)):C("",!0),e.resourceTypeDef.capabilities&&e.resourceTypeDef.capabilities.length>0?(l(!0),y(A,{key:1},F(e.resourceTypeDef.capabilities.filter(o=>o.relationshipSpec.visibleInTarget),o=>(l(),f(r(Ee),{lazy:"",label:o.relationshipSpec.capabilityName},{default:t(()=>[a(kt,{resource:i.resource,capability:o},null,8,["resource","capability"])]),_:2},1032,["label"]))),256)):C("",!0)]),_:1}))}},Nt={key:0,style:{"font-size":"12px"}},$t={key:1,style:{"font-size":"12px"}},zt={__name:"ResourceUsages",props:{resource:{required:!0,type:Object}},setup(e){const i=e;return(n,s)=>(l(),y("div",null,[i.resource.allocatedUsages&&i.resource.allocatedUsages.length>0?(l(),y("div",Nt,[(l(!0),y(A,null,F(i.resource.allocatedUsages,o=>(l(),y("span",null," 已分配: "+T(o.usageTypeName)+": "+T(o.usageValue)+"  ",1))),256))])):C("",!0),i.resource.preAllocatedUsages&&i.resource.preAllocatedUsages.length>0?(l(),y("div",$t,[(l(!0),y(A,null,F(i.resource.preAllocatedUsages,o=>(l(),y("span",null," 预分配: "+T(o.usageTypeName)+": "+T(o.usageValue)+"  ",1))),256))])):C("",!0)]))}};function oe(e,i){const n=X(),s=c(!1),o=c(!1),d=c();function u(){s.value=!0}function m(){d.value.validate(_=>{_&&(o.value=!0,W(We(e)).then(v=>{n.setActiveJobId(v.jobId),i(),s.value=!1}).finally(()=>{o.value=!1}))})}return{drawerFlag:s,buttonLoading:o,formRef:d,openDrawer:u,confirm:m}}const jt={key:0},Pt={key:1},Lt={__name:"CreateResourcePriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const i=e,n=c(),s=c(!1);return Q(i,()=>{s.value=!0,Fe({createCommand:i.formData}).then(o=>{n.value=o.totalMonthlyCostDescription}).finally(()=>{s.value=!1})},{immediate:!0,deep:!0}),(o,d)=>{const u=I("ElText");return l(),f(u,{type:"warning"},{default:t(()=>[s.value?(l(),y("span",jt,"费用查询中...")):(l(),y("span",Pt,"参考价格："+T(n.value?n.value:"无"),1))]),_:1})}}},Ft={__name:"CreateResourceButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:i}){const n={tenantId:void 0,ownerId:void 0,resource:{resourceTypeId:void 0,externalAccountId:void 0,resourceName:void 0,properties:{},tags:[],description:void 0},requirements:[],capabilities:[],number:1},s=c(ve.cloneDeep(n)),o=i;function d(){o("actionSubmitted")}const{drawerFlag:u,buttonLoading:m,formRef:_,openDrawer:v,confirm:b}=oe(h,d);function h(){return{jobType:"BATCH_CREATE_RESOURCES",jobParameters:{resources:[s.value]}}}function R(){s.value=ve.cloneDeep(n),v()}function g(){u.value=!1}return(p,S)=>(l(),y(A,null,[a(P,{size:e.small?"small":"default",type:"primary",onClick:R,loading:r(m)},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"创建",4)]),_:1},8,["size","loading"]),a(M,{size:1e3,modelValue:r(u),"onUpdate:modelValue":S[1]||(S[1]=$=>ie(u)?u.value=$:null),title:"创建资源",onOnConfirm:r(b),loading:r(m)},le({default:t(()=>[r(u)?(l(),f(xe,{key:0,ref_key:"formRef",ref:_,modelValue:s.value,"onUpdate:modelValue":S[0]||(S[0]=$=>s.value=$),"resource-category":e.category},null,8,["modelValue","resource-category"])):C("",!0)]),_:2},[r(u)?{name:"footer",fn:t(()=>[a(Lt,{"form-data":s.value},null,8,["form-data"]),a(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_CREATE_RESOURCES","job-parameters":{resources:[s.value]},"form-ref":r(_),onConfirm:g},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","onOnConfirm","loading"])],64))}},Mt={key:0},Ht={key:1},Jt={__name:"DestroyResourcesRefundInquiry",props:{formData:{required:!0,default:{}}},setup(e){const i=e,n=c(),s=c(!1);return Q(i,()=>{s.value=!0,Me({resources:i.formData}).then(o=>{n.value=o.refundDescription}).finally(()=>{s.value=!1})},{immediate:!0,deep:!0}),(o,d)=>{const u=I("ElText");return l(),f(u,{type:"warning"},{default:t(()=>[s.value?(l(),y("span",Mt,"费用查询中...")):(l(),y("span",Ht,T(n.value?n.value:"退费：无"),1))]),_:1})}}},ge={__name:"RecycleResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},destroyable:{required:!1,type:Boolean,default:!1},recycleBinMode:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=e,s=i;function o(){s("actionSubmitted")}const d=c([]),{drawerFlag:u,buttonLoading:m,formRef:_,openDrawer:v,confirm:b}=oe(h,o);function h(){return{jobType:"BATCH_RECYCLE_RESOURCES",jobParameters:{resources:d.value}}}function R(){d.value=[];for(let g of n.selectedResources)d.value.push({resourceId:g.id,recyclingCapabilities:!0,executingDestruction:!0,destroyParameters:{}});v()}return(g,p)=>(l(),y(A,null,[a(P,{size:e.small?"small":"default",loading:r(m),onClick:R,disabled:e.selectedResources.length===0,type:"warning",plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.recycleBinMode?"销毁":"回收"),5)]),_:1},8,["size","loading","disabled"]),a(M,{modelValue:r(u),"onUpdate:modelValue":p[1]||(p[1]=S=>ie(u)?u.value=S:null),size:800,title:"回收资源",onOnConfirm:r(b),loading:r(m)},le({default:t(()=>[r(u)?(l(),f(mt,{key:0,ref_key:"formRef",ref:_,modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=S=>d.value=S),destroyable:e.destroyable,"resource-category":e.category},null,8,["modelValue","destroyable","resource-category"])):C("",!0)]),_:2},[r(u)?{name:"footer",fn:t(()=>[a(Jt,{"form-data":d.value},null,8,["form-data"])]),key:"0"}:void 0]),1032,["modelValue","onOnConfirm","loading"])],64))}},Yt={key:0},Gt={key:1},Kt={__name:"RunActionsPriceInquiry",props:{formData:{required:!0,default:{}}},setup(e){const i=e,n=c(),s=c(!1);return Q(i,()=>{s.value=!0,He({actions:i.formData}).then(o=>{n.value=o.totalMonthlyCostDescription}).finally(()=>{s.value=!1})},{immediate:!0,deep:!0}),(o,d)=>{const u=I("ElText");return l(),f(u,{type:"warning"},{default:t(()=>[s.value?(l(),y("span",Yt,"费用查询中...")):(l(),y("span",Gt,"参考价格："+T(n.value?n.value:"无"),1))]),_:1})}}},fe={__name:"ResourcesActionButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},action:{required:!0},disabled:{required:!1,default:!1,type:Boolean},disabledMessage:{required:!1},showButton:{required:!1,default:!0}},emits:["actionSubmitted"],setup(e,{expose:i,emit:n}){const s=e,o=n;function d(){o("actionSubmitted")}const u=c([]),{drawerFlag:m,buttonLoading:_,formRef:v,openDrawer:b,confirm:h}=oe(R,d);function R(){return{jobType:"BATCH_RUN_RESOURCE_ACTIONS",jobParameters:{actions:u.value}}}function g(){u.value=[];for(let w of s.selectedResources)u.value.push({resourceId:w.id,actionId:s.action.id,parameters:{}});b()}i({openActionDrawer:g});const p=["STOP","DESTROY_RESOURCE"],S=["START"];function $(w){if(p.includes(w))return"danger";if(S.includes(w))return"success"}function U(){m.value=!1}return(w,z)=>(l(),y(A,null,[e.showButton?(l(),f(P,{key:0,size:e.small?"small":"default",loading:r(_),onClick:g,disabled:e.disabled,"disabled-message":e.disabledMessage?e.disabledMessage:void 0,type:$(e.action.id),plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.action.name),5)]),_:1},8,["size","loading","disabled","disabled-message","type"])):C("",!0),a(M,{modelValue:r(m),"onUpdate:modelValue":z[1]||(z[1]=N=>ie(m)?m.value=N:null),size:800,title:e.action.name,onOnConfirm:r(h),loading:r(_)},le({default:t(()=>[r(m)?(l(),f(ft,{key:0,ref_key:"formRef",ref:v,modelValue:u.value,"onUpdate:modelValue":z[0]||(z[0]=N=>u.value=N),"resource-category":e.category},null,8,["modelValue","resource-category"])):C("",!0)]),_:2},[r(m)?{name:"footer",fn:t(()=>[a(Kt,{"form-data":u.value},null,8,["form-data"]),a(ue,{style:{"margin-left":"36px"},"job-type":"BATCH_RUN_RESOURCE_ACTIONS","job-parameters":{actions:u.value},"form-ref":r(v),onConfirm:U},null,8,["job-parameters","form-ref"])]),key:"0"}:void 0]),1032,["modelValue","title","onOnConfirm","loading"])],64))}},Oe={__name:"SyncResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=e,s=i;function o(){s("actionSubmitted")}const d=c({}),{drawerFlag:u,buttonLoading:m,formRef:_,openDrawer:v,confirm:b}=oe(h,o);function h(){return{jobType:"SYNCHRONIZE_RESOURCES",jobParameters:d.value}}function R(){d.value.resourceIds=n.selectedResources.map(g=>g.id),d.value.synchronizeAll=!1,v()}return(g,p)=>(l(),y(A,null,[a(P,{size:e.small?"small":"default",loading:r(m),onClick:R,disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"同步",4)]),_:1},8,["size","loading","disabled"]),a(M,{modelValue:r(u),"onUpdate:modelValue":p[1]||(p[1]=S=>ie(u)?u.value=S:null),size:800,title:"同步资源",onOnConfirm:r(b),loading:r(m)},{default:t(()=>[r(u)?(l(),f(pt,{key:0,ref_key:"formRef",ref:_,modelValue:d.value,"onUpdate:modelValue":p[0]||(p[0]=S=>d.value=S)},null,8,["modelValue"])):C("",!0)]),_:1},8,["modelValue","onOnConfirm","loading"])],64))}},Qt={__name:"TransferResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=e,s=i;function o(){s("actionSubmitted")}const d=c([]),u=c(!1),m=c(!1),_=c(),v=X();function b(){d.value=n.selectedResources.map(R=>({resourceId:R.id,newOwnerId:R.ownerId,newTenantId:R.tenantId,enableCascadedTransfer:!0})),u.value=!0}function h(){_.value.validate(R=>{R&&(m.value=!0,Ve({jobType:"TRANSFER_RESOURCES",jobParameters:{transfers:d.value}}).then(g=>{u.value=!1,v.setActiveJobId(g.jobId),o()}).finally(()=>{m.value=!1}))})}return(R,g)=>(l(),y(A,null,[a(P,{size:e.small?"small":"default",loading:m.value,onClick:b,disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"移交",4)]),_:1},8,["size","loading","disabled"]),a(M,{modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=p=>u.value=p),size:800,title:"移交资源",onOnConfirm:h,loading:m.value},{default:t(()=>[u.value?(l(),f(yt,{key:0,ref_key:"formRef",ref:_,modelValue:d.value,"onUpdate:modelValue":g[0]||(g[0]=p=>d.value=p),"resource-category":e.category},null,8,["modelValue","resource-category"])):C("",!0)]),_:1},8,["modelValue","loading"])],64))}},Zt={style:{width:"100%"}},Wt={style:{"max-width":"400px","overflow-wrap":"break-word"}},Xt={key:1},ea={__name:"ResourcesReadActionButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0},selectedResources:{required:!0,type:Array},action:{required:!0},disabled:{required:!1,default:!1,type:Boolean},disabledMessage:{required:!1},showButton:{required:!1,default:!0}},setup(e,{expose:i}){const n=e,s=c(!1),o=c(!1),d=re(()=>n.selectedResources.map(b=>b.id)),u=c([]);function m(){s.value=!0,o.value=!0,Je({resourceIds:d.value,actionId:n.action.id}).then(b=>{u.value=b.responseList}).finally(()=>{o.value=!1})}i({openResultDrawer:m});function _(b){navigator.clipboard.writeText(b),ke.success("文本已复制")}function v(b){window.open(b,"_blank")}return(b,h)=>{const R=I("ElLink"),g=I("ElDescriptionsItem"),p=I("ElDescriptions"),S=I("ElCard"),$=Xe("loading");return l(),y(A,null,[e.showButton?(l(),f(P,{key:0,size:e.small?"small":"default",onClick:m,disabled:e.disabled,"disabled-message":e.disabledMessage?e.disabledMessage:void 0,plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},T(e.action.name),5)]),_:1},8,["size","disabled","disabled-message"])):C("",!0),a(M,{modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=U=>s.value=U),size:800,title:e.action.name,"no-confirm":""},{default:t(()=>[et((l(),y("div",Zt,[(l(!0),y(A,null,F(u.value,U=>(l(),f(S,null,{header:t(()=>[B(T(U.resourceName),1)]),default:t(()=>[U.resultList&&U.resultList.length>0?(l(),f(p,{key:0,border:"",direction:"vertical"},{default:t(()=>[(l(!0),y(A,null,F(U.resultList,w=>(l(),f(g,{span:3,label:w.name},{label:t(()=>[E("span",null,T(w.name),1),w.isUrl?(l(),f(R,{key:0,style:{float:"right"},onClick:()=>v(w.value)},{default:t(()=>[B(" 前往 ")]),_:2},1032,["onClick"])):(l(),f(R,{key:1,style:{float:"right"},onClick:()=>_(w.value)},{default:t(()=>[B(" 复制 ")]),_:2},1032,["onClick"]))]),default:t(()=>[E("div",Wt,T(w.value),1)]),_:2},1032,["label"]))),256))]),_:2},1024)):(l(),y("div",Xt," 无数据 "))]),_:2},1024))),256))])),[[$,o.value]])]),_:1},8,["modelValue","title"])],64)}}},ta={__name:"DropResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=e,s=i;function o(){if(n.selectedResources.length===0)return;const u={resourceIds:n.selectedResources.map(m=>m.id)};Ye(u).then(()=>{s("actionSubmitted")})}return(d,u)=>{const m=I("ElPopconfirm");return l(),f(m,{title:"解除纳管",onConfirm:o},{reference:t(()=>[a(P,{size:e.small?"small":"default",disabled:e.selectedResources.length===0,plain:""},{default:t(()=>[B(" 解除纳管 ")]),_:1},8,["size","disabled"])]),_:1})}}},Be={__name:"ResourceActionButtonsGroup",props:{selectedResources:{type:Array,required:!0},category:{required:!0},small:{required:!1,type:Boolean,default:!1},buildActionHidden:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{expose:i,emit:n}){const s=e,o=c([]),d=c([]),u=c([]),m=c([]);function _(){return s.selectedResources.map(w=>w.id)}Q(s,()=>{h()},{immediate:!0});function v(w){return u.value.some(z=>z.id===w)}const b=c(!1);function h(){Te({category:s.category,resourceIds:_()}).then(w=>{if(o.value=[],d.value=[],w.allActions)for(let z=0;z<w.allActions.length;z++){let N=w.allActions[z];N.id==="DESTROY_RESOURCE"&&(b.value=!0),z<3?o.value.push(N):N.id==="BUILD_RESOURCE"?o.value.unshift(N):N.id==="DESTROY_RESOURCE"?o.value.push(N):d.value.push(N)}b.value=o.value.filter(z=>z.id==="DESTROY_RESOURCE").length!==0,u.value=w.availableActions,m.value=w.readActions})}i({fetchActions:h});const R=n;function g(){R("actionSubmitted")}const p=Ce(),{proxy:S}=at();function $(w){w&&S.$refs[w][0].openActionDrawer()}function U(w){w&&S.$refs[w][0].openResultDrawer()}return(w,z)=>{const N=I("ElIcon"),Y=I("ElDropdownItem"),J=I("ElDropdownMenu"),Z=I("ElDropdown"),ee=I("ElSpace");return l(),f(ee,{alignment:"normal"},{default:t(()=>[(l(!0),y(A,null,F(o.value,q=>(l(),y(A,null,[q.id==="BUILD_RESOURCE"?(l(),y(A,{key:0},[e.buildActionHidden?C("",!0):(l(),f(Ft,{key:0,category:e.category,small:e.small,onActionSubmitted:g},null,8,["category","small"]))],64)):q.id==="DESTROY_RESOURCE"?(l(),y(A,{key:1},[r(p).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(l(),f(ge,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:g,destroyable:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"回收",4)]),_:1},8,["small","category","selected-resources"])):C("",!0)],64)):e.selectedResources.length===0?(l(),f(fe,{key:2,small:e.small,action:q,"selected-resources":e.selectedResources,category:e.category,onActionSubmitted:g,disabled:""},null,8,["small","action","selected-resources","category"])):(l(),f(fe,{key:3,small:e.small,action:q,"selected-resources":e.selectedResources,category:e.category,disabled:!v(q.id),onActionSubmitted:g,"disabled-message":"所选资源无法执行此操作"},null,8,["small","action","selected-resources","category","disabled"]))],64))),256)),!b.value&&r(p).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(l(),f(ge,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:g,destroyable:!1},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"回收",4)]),_:1},8,["small","category","selected-resources"])):C("",!0),r(p).hasPermission("Resource","SYNCHRONIZE_RESOURCES")?(l(),f(Oe,{key:1,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:g},null,8,["small","selected-resources"])):C("",!0),r(p).hasPermission("Resource","TRANSFER")?(l(),f(Qt,{key:2,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:g,category:e.category},null,8,["small","selected-resources","category"])):C("",!0),r(p).hasPermission("Resource","DELETE")?(l(),f(ta,{key:3,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:g},null,8,["small","selected-resources"])):C("",!0),d.value.length>0||m.value.length>0?(l(),y(A,{key:4},[a(Z,{trigger:"click",size:e.small?"small":"default",onCommand:$},{dropdown:t(()=>[a(J,{style:{width:"120px"}},{default:t(()=>[(l(!0),y(A,null,F(d.value,q=>(l(),f(Y,{disabled:!v(q.id),command:q.id},{default:t(()=>[B(T(q.name),1)]),_:2},1032,["disabled","command"]))),256)),(l(!0),y(A,null,F(m.value,q=>(l(),f(Y,{onClick:()=>U(q.id),command:""},{default:t(()=>[B(T(q.name),1)]),_:2},1032,["onClick"]))),256))]),_:1})]),default:t(()=>[a(P,{size:e.small?"small":"default",disabled:e.selectedResources.length===0},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},[B(" 更多操作"),a(N,{class:"el-icon--right"},{default:t(()=>[a(r(tt))]),_:1})],4)]),_:1},8,["size","disabled"])]),_:1},8,["size"]),E("div",null,[(l(!0),y(A,null,F(d.value,q=>(l(),f(fe,{ref_for:!0,ref:q.id,action:q,"selected-resources":e.selectedResources,category:e.category,onActionSubmitted:g,"show-button":!1},null,8,["action","selected-resources","category"]))),256)),(l(!0),y(A,null,F(m.value,q=>(l(),f(ea,{ref_for:!0,ref:q.id,action:q,"selected-resources":e.selectedResources,category:e.category,"show-button":!1},null,8,["action","selected-resources","category"]))),256))])],64)):C("",!0)]),_:1})}}},aa={key:0},la={key:0},ra={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Ue={__name:"ResourceQuickStats",props:{resourceId:{required:!0},hideAfter:{required:!1,default:void 0},span:{required:!1,default:24},showLabel:{required:!1,default:!1,type:Boolean}},setup(e){const i=e,n=c();function s(){d.value=!0,Ge({resourceId:i.resourceId}).then(m=>{n.value=m.quickStats,u.value=!1}).catch(m=>{console.log(m),u.value=!0}).finally(()=>{d.value=!1})}const o=c();Re(()=>{s(),o.value=setInterval(s,1e4)}),lt(()=>{clearInterval(o.value)});const d=c(!1),u=c(!1);return(m,_)=>{const v=I("ElProgress"),b=I("ElCol"),h=I("ElRow"),R=I("Loading"),g=I("ElIcon"),p=I("ElText");return l(),y("div",null,[n.value&&n.value.items&&n.value.items.length>0?(l(),f(h,{key:0,gutter:4},{default:t(()=>[(l(!0),y(A,null,F(n.value.items,(S,$)=>(l(),y(A,null,[!e.hideAfter||$<e.hideAfter?(l(),f(b,{key:0,span:e.span},{default:t(()=>[S.isPercentage?(l(),y(A,{key:0},[e.showLabel?(l(),y("div",aa,T(S.label),1)):C("",!0),a(v,{"stroke-width":16,"text-inside":"",percentage:S.value,color:"darkgreen"},{default:t(()=>[B(T(S.name),1)]),_:2},1032,["percentage"])],64)):(l(),y(A,{key:1},[e.showLabel?(l(),y("div",la,T(S.label),1)):C("",!0),E("div",ra,T((e.showLabel?"":S.name+":")+S.valueStr+S.unit),1)],64))]),_:2},1032,["span"])):C("",!0)],64))),256))]),_:1})):d.value?(l(),f(g,{key:1,class:"is-loading"},{default:t(()=>[a(R)]),_:1})):u.value?(l(),f(p,{key:2,type:"danger"},{default:t(()=>[B("获取失败")]),_:1})):(l(),y(A,{key:3},[B(" 无 ")],64))])}}},oa={__name:"StratoTextEditor",props:{textValue:{required:!0},remoteMethod:{required:!0,type:Function},remoteRequest:{required:!0,type:Object},textKey:{required:!0,type:String}},emits:["confirm"],setup(e,{emit:i}){const n=e,s=c(!1),o=c();function d(){o.value=n.textValue,s.value=!0}const u=i;function m(){const v={...n.remoteRequest};v[n.textKey]=o.value,n.remoteMethod(v).then(()=>{s.value=!1,u("confirm")})}function _(){s.value=!1}return(v,b)=>{const h=I("ElButton"),R=I("ElInput"),g=I("ElText");return l(),y("div",null,[s.value?(l(),f(R,{key:0,modelValue:o.value,"onUpdate:modelValue":b[0]||(b[0]=p=>o.value=p)},{suffix:t(()=>[a(h,{link:"",type:"success",icon:"Check",onClick:m}),a(h,{link:"",type:"danger",icon:"Close",onClick:_})]),_:1},8,["modelValue"])):(l(),y(A,{key:1},[a(g,null,{default:t(()=>[B(T(e.textValue),1)]),_:1}),a(h,{link:"",type:"primary",style:{float:"right"},icon:"Edit",onClick:d})],64))])}}},na={style:{float:"right"}},sa={style:{width:"100%"}},ua=E("div",{style:{width:"100px"}},"类型",-1),ia=E("div",{style:{width:"100px"}},"云账号",-1),ca=E("div",{style:{width:"100px"}},"回收状态",-1),da=E("div",{style:{width:"100px"}},"ID",-1),ma=E("div",{style:{width:"100px"}},"估计费用",-1),fa=E("div",{style:{width:"100px"}},"监控",-1),pa={style:{"min-width":"180px"}},ya=E("div",{style:{width:"100px"}},"属性",-1),va=E("div",{style:{width:"100px"}},"标签",-1),ga=E("div",{style:{width:"100px"}},"描述",-1),ba=E("div",{style:{width:"100px"}},"资源使用",-1),ha={__name:"ResourceDetail",props:{resource:{required:!0}},emits:["refresh"],setup(e,{emit:i}){const n=e,s=ct(()=>n.resource.type);ht();const o=c();Re(()=>{Rt({accountIds:[n.resource.accountId]}).then(m=>{m.content&&(o.value=m.content[0].name)})});const d=i;function u(){d("refresh")}return(m,_)=>{const v=I("ElCol"),b=I("ElRow");return l(),y(A,null,[E("span",na,[a(Be,{"build-action-hidden":"",small:"","selected-resources":[e.resource],category:e.resource.category},null,8,["selected-resources","category"])]),a(r(rt),{column:3,border:""},{title:t(()=>[E("div",sa,[E("span",null,T(e.resource.categoryName)+":",1),a(r(pe),{style:{"margin-left":"10px"}},{default:t(()=>[B(T(e.resource.name),1)]),_:1}),a(ce,{style:{"margin-left":"20px","font-size":"12px"},state:e.resource.state},null,8,["state"])])]),default:t(()=>[a(r(H),{label:"类型"},{label:t(()=>[ua]),default:t(()=>[B(" "+T(e.resource.typeName),1)]),_:1}),a(r(H),{label:"云账号",span:2},{label:t(()=>[ia]),default:t(()=>[B(" "+T(e.resource.providerName)+"-> ",1),a(r(pe),{type:"primary"},{default:t(()=>[B(T(o.value),1)]),_:1})]),_:1}),a(r(H),{label:"回收状态"},{label:t(()=>[ca]),default:t(()=>[B(" "+T(e.resource.recycled?`已于${e.resource.recycledTime}回收`:"未回收"),1)]),_:1}),a(r(H),{label:"ID",span:2},{label:t(()=>[da]),default:t(()=>[B(" "+T(e.resource.externalId),1)]),_:1}),a(r(H),{label:"估计费用",span:1},{label:t(()=>[ma]),default:t(()=>[B(" "+T(e.resource.monthlyCostDescription),1)]),_:1}),a(r(H),{label:"监控",span:2},{label:t(()=>[fa]),default:t(()=>[E("div",pa,[a(Ue,{"resource-id":e.resource.id,span:6,"hide-after":4},null,8,["resource-id"])])]),_:1}),a(r(H),{label:"属性",span:3},{label:t(()=>[ya]),default:t(()=>[a(me,{resource:e.resource},null,8,["resource"])]),_:1}),a(r(H),{label:"标签",span:3},{label:t(()=>[va]),default:t(()=>[a(de,{resource:e.resource,onRefresh:u},null,8,["resource"])]),_:1}),a(r(H),{label:"描述",span:3},{label:t(()=>[ga]),default:t(()=>[a(oa,{"remote-method":r(Ke),"remote-request":{resourceId:e.resource.id},"text-value":e.resource.description,"text-key":"description",onConfirm:u},null,8,["remote-method","remote-request","text-value"])]),_:1}),a(r(H),{label:"资源使用",span:3},{label:t(()=>[ba]),default:t(()=>[a(zt,{resource:e.resource},null,8,["resource"])]),_:1})]),_:1}),a(b,{style:{width:"100%"}},{default:t(()=>[a(v,{span:20}),a(v,{span:4})]),_:1}),r(s)?(l(),f(Ut,{key:0,resource:e.resource,"resource-type-def":r(s)},null,8,["resource","resource-type-def"])):C("",!0)],64)}}},Ra={style:{"margin-left":"6px"}},Ca={__name:"ResourceSyncState",props:{state:{required:!0}},setup(e){const i=e,n=ye,s=re(()=>{let o=n[i.state];return o===void 0&&(o={name:i.state,icon:"QuestionFilled",type:"warning"}),o});return(o,d)=>{const u=I("ElText");return l(),y("span",null,[a(u,{style:{cursor:"pointer"},type:s.value.type},{default:t(()=>[a(r(Ae),{class:ot(s.value.icon==="Loading"?"is-loading":"")},{default:t(()=>[(l(),f(nt(s.value.icon)))]),_:1},8,["class"])]),_:1},8,["type"]),E("span",Ra,T(s.value.name),1)])}}},_a={__name:"ClaimResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},category:{required:!0}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=i;function s(){n("actionSubmitted")}const o=c([]),d=c(!1),u=c(!1),m=c(),_=X();function v(){o.value=[],o.value.push({resourceId:void 0,enableCascadedClaim:!0}),d.value=!0}function b(){m.value.validate(h=>{h&&(u.value=!0,Ve({jobType:"CLAIM_RESOURCES",jobParameters:{claims:o.value}}).then(R=>{d.value=!1,_.setActiveJobId(R.jobId),s()}).finally(()=>{u.value=!1}))})}return(h,R)=>(l(),y(A,null,[a(P,{style:L(h.$attrs.style),size:e.small?"small":"default",loading:u.value,onClick:v,plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"认领",4)]),_:1},8,["style","size","loading"]),a(M,{modelValue:d.value,"onUpdate:modelValue":R[1]||(R[1]=g=>d.value=g),size:800,title:"认领资源",onOnConfirm:b,loading:u.value},{default:t(()=>[d.value?(l(),f(vt,{key:0,ref_key:"formRef",ref:m,modelValue:o.value,"onUpdate:modelValue":R[0]||(R[0]=g=>o.value=g),"resource-category":e.category},null,8,["modelValue","resource-category"])):C("",!0)]),_:1},8,["modelValue","loading"])],64))}},Ea={__name:"RestoreResourcesButton",props:{small:{required:!1,type:Boolean,default:!1},selectedResources:{required:!0,type:Array}},emits:["actionSubmitted"],setup(e,{emit:i}){const n=e,s=i;function o(){s("actionSubmitted")}const{buttonLoading:d,confirm:u,formRef:m}=oe(_,o);m.value={validate(v){v(!0)}};function _(){return{jobType:"BATCH_RESTORE_RESOURCES",jobParameters:{resourceIds:n.selectedResources.map(v=>v.id)}}}return(v,b)=>(l(),f(P,{size:e.small?"small":"default",loading:r(d),onClick:r(u),disabled:e.selectedResources.filter(h=>h.state!=="DESTROYED").length===0,"disabled-message":"请选择回收站中未销毁的资源",type:"success",plain:""},{default:t(()=>[E("span",{style:L(e.small?{fontSize:"12px"}:{})},"还原",4)]),_:1},8,["size","loading","onClick","disabled"]))}},Sa={__name:"RecycleBinButtonsGroup",props:{selectedResources:{type:Array,required:!0},category:{required:!0},small:{required:!1,type:Boolean,default:!1}},emits:["actionSubmitted"],setup(e,{expose:i,emit:n}){const s=e,o=c([]);function d(){return s.selectedResources.map(h=>h.id)}Q(s,()=>{m()},{immediate:!0});const u=c(!1);function m(){Te({category:s.category,resourceIds:d()}).then(h=>{if(o.value=[],h.allActions)for(let R=0;R<h.allActions.length;R++){let g=h.allActions[R];g.id==="DESTROY_RESOURCE"&&(u.value=!0),o.value.push(g)}u.value=o.value.filter(R=>R.id==="DESTROY_RESOURCE").length!==0})}i({fetchActions:m});const _=n;function v(){_("actionSubmitted")}const b=Ce();return(h,R)=>{const g=I("ElSpace");return l(),f(g,{alignment:"normal"},{default:t(()=>[r(b).hasPermission("Resource","BATCH_RESTORE_RESOURCES")?(l(),f(Ea,{key:0,"selected-resources":e.selectedResources,onActionSubmitted:v},null,8,["selected-resources"])):C("",!0),(l(!0),y(A,null,F(o.value,p=>(l(),y(A,null,[p.id==="DESTROY_RESOURCE"?(l(),y(A,{key:0},[r(b).hasPermission("Resource","BATCH_RECYCLE_RESOURCES")?(l(),f(ge,{key:0,small:e.small,category:e.category,"selected-resources":e.selectedResources,onActionSubmitted:v,destroyable:"","recycle-bin-mode":""},null,8,["small","category","selected-resources"])):C("",!0)],64)):C("",!0)],64))),256)),r(b).hasPermission("Resource","SYNCHRONIZE_RESOURCES")?(l(),f(Oe,{key:1,small:e.small,"selected-resources":e.selectedResources,onActionSubmitted:v},null,8,["small","selected-resources"])):C("",!0)]),_:1})}}},Ta={style:{"margin-bottom":"10px",height:"32px"}},al={__name:"Resource",props:{recycled:{required:!1,default:!1},simpleMode:{required:!1,default:!1}},setup(e){const n=c({recycled:e.recycled,ownerIds:[],tagsMap:{}}),s=ut(),o=Ce(),d=c(),u=c(),m=c(),_=c([]),v=c(!1),b=c(),h=c(!1);function R(k){_.value=k}function g(k){var se,te,ae;const D=(se=k==null?void 0:k.params)==null?void 0:se.category,K=(te=k==null?void 0:k.query)==null?void 0:te.id,ne=(ae=k==null?void 0:k.query)==null?void 0:ae.name;D&&(n.value.resourceCategories=[D],N.value=D,_e.value.resourceCategories=[D]),K&&ne&&(u.value=K,m.value=ne,n.value.resourceIds=[K],v.value=!1)}function p(){u.value=void 0,m.value=void 0,n.value.resourceIds=void 0,s.push(`/resource/list/${s.currentRoute.value.params.category}`)}function S(k){b.value=k,v.value=!0}function $(){h.value=!0}const U=c();st(k=>{g(k)}),Re(()=>{g(s.currentRoute.value),ee(),j()});function w(){d.value.fetchData()}function z(k){!k||k.length===0||(_.value.length>0&&(_.value=k.filter(D=>_.value.findIndex(K=>K.id===D.id)!==-1)),b.value&&(b.value=k.find(D=>D.id===b.value.id),b.value||(v.value=!1)))}const N=c(),Y=c(!1);function J(k){k?(Y.value=!0,n.value.states=["DESTROYED"]):(Y.value=!1,n.value.states=void 0)}const Z=c([]);function ee(){for(let k in Se)Z.value.push({text:Se[k].name,value:k})}const q=c([]);function j(){for(let k in ye)q.value.push({text:ye[k].name,value:k})}function x(k){"state"in k&&(n.value.states=k.state),"syncState"in k&&(n.value.syncStates=k.syncState)}const G=c([]),_e=c({requiredWhenFiltering:!0});Q(G,()=>{const k={};for(let D of G.value)!D.tagKey||!D.tagValue||(k[D.tagKey]||(k[D.tagKey]=[]),k[D.tagKey].push(D.tagValue));ve.isEqual(n.value.tagsMap,k)||(n.value.tagsMap=k)},{deep:!0});function Ne(){return["COMPUTE_INSTANCE","CONTAINER","ELASTIC_IP","DISK","CLUSTER","HOST","LOAD_BALANCER","DATASTORE"].includes(N.value)}const $e=re(Ne);return(k,D)=>{const K=I("ElTag"),ne=I("ElCheckbox"),se=I("ElSpace"),te=I("ElButton"),ae=I("ElPopover"),ze=I("Resource",!0);return l(),y(A,null,[E("div",Ta,[e.simpleMode?C("",!0):(l(),y(A,{key:0},[N.value?(l(),f(Be,{key:0,ref_key:"buttonsGroup",ref:U,onActionSubmitted:w,"selected-resources":_.value,category:N.value},null,8,["selected-resources","category"])):C("",!0),a(P,{style:{"margin-left":"10px"},onClick:$,plain:""},{default:t(()=>[a(r(Ae),null,{default:t(()=>[a(r(it))]),_:1}),B(" 回收站 ")]),_:1}),r(o).hasPermission("Resource","CLAIM")?(l(),f(_a,{key:1,style:{"margin-left":"10px"},category:N.value,onActionSubmitted:w},null,8,["category"])):C("",!0),u.value?(l(),f(K,{key:2,style:{"margin-left":"30px"},closable:"",onClose:p},{default:t(()=>[B(" 资源: "+T(m.value),1)]),_:1})):C("",!0)],64)),e.recycled?(l(),f(se,{key:1,alignment:"normal"},{default:t(()=>[N.value&&!Y.value?(l(),f(Sa,{key:0,ref:"recycleBinButtonsGroup",onActionSubmitted:w,"selected-resources":_.value,category:N.value},null,8,["selected-resources","category"])):C("",!0),a(ne,{onChange:J},{default:t(()=>[B("查看已销毁")]),_:1})]),_:1})):C("",!0),a(r(he),{style:{float:"right",width:"15%"},modelValue:n.value.search,"onUpdate:modelValue":D[0]||(D[0]=V=>n.value.search=V),"suffix-icon":"search"},null,8,["modelValue"])]),n.value.resourceCategories?(l(),f(be,{key:0,size:e.recycled?"small":"default",ref_key:"resourceTableRef",ref:d,"paging-request":n.value,"remote-method":r(Qe),onSelectionChange:R,onFilterChange:x,onListChange:z},{default:t(()=>[a(r(O),{type:"selection","reserve-selection":""}),a(r(O),{prop:"name",label:"资源名称",sortable:"custom","min-width":"100"},{default:t(V=>[a(r(pe),{onClick:()=>S(V.row),type:"primary"},{default:t(()=>[B(T(V.row.name),1)]),_:2},1032,["onClick"])]),_:1}),a(r(O),{prop:"type",label:"类型",sortable:"custom"},{default:t(V=>[E("span",null,T(V.row.typeName),1)]),_:1}),a(r(O),{prop:"state",label:"资源状态","column-key":"state",filters:Z.value,sortable:"custom","min-width":90},{default:t(V=>[a(ce,{state:V.row.state},null,8,["state"])]),_:1},8,["filters"]),e.simpleMode?C("",!0):(l(),f(r(O),{key:0,prop:"syncState",label:"同步状态","column-key":"syncState",filters:q.value,sortable:"custom","min-width":90},{default:t(V=>[a(Ca,{state:V.row.syncState},null,8,["state"])]),_:1},8,["filters"])),a(r(O),{label:"标签"},{default:t(V=>[a(de,{"in-list":"",resource:V.row},null,8,["resource"])]),header:t(()=>[E("span",null,[B(" 标签 "),a(ae,{trigger:"click",width:"260"},{reference:t(()=>[a(te,{icon:"Search",style:L({color:G.value.length>0?"#409eff":void 0}),link:""},null,8,["style"])]),default:t(()=>[a(_t,{modelValue:G.value,"onUpdate:modelValue":D[1]||(D[1]=V=>G.value=V),"default-add-all-entries":!1,"entry-paging-request":_e.value},null,8,["modelValue","entry-paging-request"])]),_:1})])]),_:1}),a(r(O),{label:"属性",width:"200"},{default:t(V=>[a(me,{"in-list":"",resource:V.row},null,8,["resource"])]),_:1}),$e.value&&!e.recycled?(l(),f(r(O),{key:1,label:"监控",width:"180","show-overflow-tooltip":!1},{default:t(V=>[a(Ue,{"hide-after":2,span:12,"resource-id":V.row.id},null,8,["resource-id"])]),_:1})):C("",!0),a(r(O),{prop:"ownerId",label:"所有者"},{default:t(V=>[E("span",null,T(V.row.ownerRealName),1)]),header:t(()=>[E("span",null,[B(" 所有者 "),a(ae,{trigger:"click",width:"260"},{reference:t(()=>[a(te,{icon:"Search",style:L({color:n.value.ownerIds.length>0?"#409eff":void 0}),link:""},null,8,["style"])]),default:t(()=>[a(Ct,{modelValue:n.value.ownerIds,"onUpdate:modelValue":D[2]||(D[2]=V=>n.value.ownerIds=V),multiple:""},null,8,["modelValue"])]),_:1})])]),_:1}),a(r(O),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e.recycled?(l(),f(r(O),{key:2,prop:"recycledTime",label:"回收时间",sortable:"custom"})):C("",!0)]),_:1},8,["size","paging-request","remote-method"])):C("",!0),a(M,{size:1e3,modelValue:v.value,"onUpdate:modelValue":D[3]||(D[3]=V=>v.value=V),title:"资源详情","no-confirm":""},{default:t(()=>[v.value?(l(),f(ha,{key:0,resource:b.value,onRefresh:w},null,8,["resource"])):C("",!0)]),_:1},8,["modelValue"]),a(M,{size:1050,modelValue:h.value,"onUpdate:modelValue":D[4]||(D[4]=V=>h.value=V),title:"回收站","no-confirm":""},{default:t(()=>[h.value?(l(),f(ze,{key:0,"simple-mode":!0,recycled:!0})):C("",!0)]),_:1},8,["modelValue"])],64)}}};export{al as default};
