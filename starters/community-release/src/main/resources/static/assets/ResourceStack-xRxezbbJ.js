import{_ as N}from"./StratoTable-CDLvuijz.js";import{_ as L,a as j,b as M,u as J,d as P,c as H}from"./TransferStacksForm-0FfFXEVo.js";import{A as W,n as g,o as p,b as R,e,w as l,u as I,a2 as Y,a3 as G,q as b,I as K,d as x,t as V,r as m,i as k,v as C,F as T,a6 as h,a7 as Q,y as X,$ as Z,a1 as ee,f as te}from"./index-CGSAaZ7c.js";import{S as w}from"./StratoButton-BbyvpoLv.js";import{_ as D}from"./StratoDrawer-SANI4yOp.js";import{r as F}from"./asyncJob-BQqx-GkL.js";import{u as B}from"./activeJob-DuWQaxKt.js";import{_ as ae}from"./TagValueSelectorGroup-ARuF-rHD.js";import{R as U,a as le}from"./ResourceTags-tTk0QtlC.js";import{_ as ne}from"./ResourceSelector-CNqWYCf0.js";import{_ as oe}from"./ResourceLink-BeEXAYm3.js";import"./request-BLvKnTIl.js";import"./StratoPagingSelector-BVtmGqMc.js";import"./blueprint-QhCWZgai.js";import"./UserSelector-D6CrvvR3.js";import"./user-zWqZjtFx.js";import"./TenantTreeSelector-D1-Nh39D.js";import"./FormUtil-CO0XXxtf.js";import"./CreateResourceForm-BC1EWExE.js";import"./AccountSelector-DEw35b-n.js";import"./account-B2XyNJSy.js";import"./AccountContext-CRGbKwzU.js";import"./resource-ChSpNJ4i.js";import"./StratoSelector-CcCz7NMM.js";import"./StratoDynamicForm-7WrPYX7O.js";import"./IpState-DbETxjvx.js";import"./role-BAGE53ge.js";import"./job-D_aeKnDK.js";import"./scriptDefinition-BbSCbaPp.js";import"./tag-BnHK6w2S.js";const se={style:{"margin-left":"6px"}},z={__name:"ResourceStackState",props:{state:{required:!0}},setup(a){const f=a,i={NO_STATE:{name:"未创建",icon:"Clock",type:"info"},CREATING:{name:"创建中",icon:"Loading",type:"primary"},CREATE_ERROR:{name:"创建失败",icon:"Warning",type:"danger"},RUNNING:{name:"运行中",icon:"VideoPlay",type:"success"},SHUTTING_DOWN:{name:"销毁中",icon:"Loading",type:"warning"},SHUTDOWN_ERROR:{name:"销毁失败",icon:"Warning",type:"danger"},SHUTDOWN:{name:"已销毁",icon:"Delete",type:"danger"}},t=W(()=>{let o=i[f.state];return o===void 0&&(o={name:f.state,icon:"QuestionFilled",type:"warning"}),o});return(o,d)=>{const n=g("ElText");return p(),R("span",null,[e(n,{style:{cursor:"pointer"},type:t.value.type},{default:l(()=>[e(I(Y),{class:G(t.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(p(),b(K(t.value.icon)))]),_:1},8,["class"])]),_:1},8,["type"]),x("span",se,V(t.value.name),1)])}}},re={__name:"RecycleBinButton",setup(a){const f=m(!1);function i(){f.value=!0}return(t,o)=>(p(),R(T,null,[e(w,{icon:"Delete",plain:"",onClick:i},{default:l(()=>[k("回收站")]),_:1}),e(D,{size:"800",modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=d=>f.value=d),title:"回收站","no-confirm":""},{default:l(()=>[f.value?(p(),b(ke,{key:0,"recycle-bin-mode":""})):C("",!0)]),_:1},8,["modelValue"])],64))}},ue={__name:"CreateStacksButton",emits:["confirm"],setup(a,{emit:f}){const i=B(),t=m(!1),o=m(),d=m(!1),n=m({tenantId:void 0,ownerId:void 0,blueprintId:void 0,name:void 0,description:void 0,expireTime:void 0,number:1,nodes:[],tags:[]});function r(){t.value=!0}function u(){o.value.validate(v=>{v&&(d.value=!0,F({jobType:"CREATE_RESOURCE_STACKS",jobParameters:n.value}).then(s=>{i.setActiveJobId(s.jobId),t.value=!1,y("confirm")}).finally(()=>{d.value=!1}))})}const y=f;return(v,s)=>(p(),R(T,null,[e(w,{type:"primary",onClick:r},{default:l(()=>[k("创建")]),_:1}),e(D,{loading:d.value,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=c=>t.value=c),title:"创建资源栈",size:1e3,onOnConfirm:u},{default:l(()=>[t.value?(p(),b(L,{key:0,ref_key:"createFormRef",ref:o,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])],64))}},A={__name:"RecycleStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const i=a,t=B(),o=m(),d=m(!1),n=m(!1),r=m({stacks:[]});function u(){r.value.stacks=i.selectedStacks.map(s=>({stackId:s.id,executingDestruction:!0})),n.value=!0}function y(){o.value.validate(s=>{s&&(d.value=!0,F({jobType:"RECYCLE_RESOURCE_STACKS",jobParameters:r.value}).then(c=>{t.setActiveJobId(c.jobId),n.value=!1,v("confirm")}).finally(()=>{d.value=!1}))})}const v=f;return(s,c)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length===0,size:a.size,plain:"",type:"warning",onClick:u},{default:l(()=>[k("回收")]),_:1},8,["disabled","size"]),(p(),b(h,{to:"body"},[e(D,{loading:d.value,modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=_=>n.value=_),title:"回收资源栈",onOnConfirm:y},{default:l(()=>[n.value?(p(),b(j,{key:0,ref_key:"recycleFormRef",ref:o,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=_=>r.value=_)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},$={__name:"TransferStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const i=a,t=B(),o=m(),d=m(!1),n=m(!1),r=m({transfers:[]});function u(){r.value.transfers=i.selectedStacks.map(s=>({stackId:s.id,newOwnerId:s.ownerId,newTenantId:s.tenantId})),n.value=!0}function y(){o.value.validate(s=>{s&&(d.value=!0,F({jobType:"TRANSFER_STACKS",jobParameters:r.value}).then(c=>{t.setActiveJobId(c.jobId),n.value=!1,v("confirm")}).finally(()=>{d.value=!1}))})}const v=f;return(s,c)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length===0,size:a.size,plain:"",onClick:u},{default:l(()=>[k("移交")]),_:1},8,["disabled","size"]),(p(),b(h,{to:"body"},[e(D,{size:600,loading:d.value,modelValue:n.value,"onUpdate:modelValue":c[1]||(c[1]=_=>n.value=_),title:"移交资源栈",onOnConfirm:y},{default:l(()=>[n.value?(p(),b(M,{key:0,ref_key:"transferFormRef",ref:o,modelValue:r.value,"onUpdate:modelValue":c[0]||(c[0]=_=>r.value=_)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},ce={__name:"UpdateStackForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(a,{expose:f}){const i=m(),t=Q(a,"modelValue");X(()=>{t.value&&(t.value.tags||(t.value.tags=[]))});const o=m({name:[{required:!0,message:"请输入资源栈名称"}],tags:[{validator:(r,u,y)=>{var v;return(v=n.value)==null?void 0:v.validate(r,u,y)},trigger:"change"}]});function d(r){i.value.validate(r)}f({validate:d});const n=m();return(r,u)=>{const y=g("ElInput"),v=g("ElFormItem"),s=g("ElDatePicker"),c=g("ElForm");return p(),b(c,{ref_key:"formRef",ref:i,model:t.value,"label-position":"top",rules:o.value},{default:l(()=>[e(v,{label:"资源栈名称",prop:"name"},{default:l(()=>[e(y,{modelValue:t.value.name,"onUpdate:modelValue":u[0]||(u[0]=_=>t.value.name=_)},null,8,["modelValue"])]),_:1}),e(v,{label:"到期时间"},{default:l(()=>[e(s,{style:{width:"100%"},type:"datetime",modelValue:t.value.expireTime,"onUpdate:modelValue":u[1]||(u[1]=_=>t.value.expireTime=_),"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(v,{label:"标签",prop:"tags"},{default:l(()=>[e(ae,{ref_key:"tagRef",ref:n,"entry-paging-request":{userGroupTaggable:!0},modelValue:t.value.tags,"onUpdate:modelValue":u[2]||(u[2]=_=>t.value.tags=_)},null,8,["modelValue"])]),_:1}),e(v,{label:"描述"},{default:l(()=>[e(y,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":u[3]||(u[3]=_=>t.value.description=_)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}},q={__name:"UpdateStackBasicsButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const i=a,t=m(),o=m(),d=m(!1),n=m();function r(){i.selectedStacks.length!==0&&(n.value={stackId:i.selectedStacks[0].id,name:i.selectedStacks[0].name,description:i.selectedStacks[0].description,expireTime:i.selectedStacks[0].expireTime,tags:i.selectedStacks[0].tags},t.value=!0)}function u(){o.value.validate(v=>{v&&(d.value=!0,J(n.value).then(()=>{t.value=!1,y("confirm")}).finally(()=>{d.value=!1}))})}const y=f;return(v,s)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length!==1,"disabled-message":"请选择且只选择一项",size:a.size,plain:"",onClick:r},{default:l(()=>[k("编辑")]),_:1},8,["disabled","size"]),(p(),b(h,{to:"body"},[e(D,{loading:d.value,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=c=>t.value=c),title:"编辑资源栈基本信息",onOnConfirm:u},{default:l(()=>[t.value?(p(),b(ce,{key:0,ref_key:"updateFormRef",ref:o,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=c=>n.value=c)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},ie={__name:"RestoreStacksButton",props:{selectedStacks:{type:Array,required:!0},recycleBinMode:{type:Boolean,required:!0}},emits:["confirm"],setup(a,{emit:f}){const i=a,t=B(),o=m(!1);function d(){o.value=!0,F({jobType:"RESTORE_RESOURCE_STACKS",jobParameters:{stackIds:i.selectedStacks.map(r=>r.id)}}).then(r=>{t.setActiveJobId(r.jobId),n("confirm")}).finally(()=>{o.value=!1})}const n=f;return(r,u)=>a.recycleBinMode?(p(),b(w,{key:0,disabled:a.selectedStacks.length===0,loading:o.value,plain:"",type:"success",onClick:d},{default:l(()=>[k("还原")]),_:1},8,["disabled","loading"])):C("",!0)}},de={style:{float:"right"}},me={style:{width:"100%"}},fe={style:{"margin-top":"12px","margin-bottom":"12px"}},pe={__name:"ResourceStackDetail",props:{stack:{required:!0}},setup(a){return(f,i)=>{const t=g("ElSpace"),o=g("ElDescriptionsItem"),d=g("ElText"),n=g("ElTableColumn"),r=g("ElTable");return p(),R(T,null,[x("span",de,[e(t,null,{default:l(()=>[e(q,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"]),e($,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"]),e(A,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"])]),_:1})]),e(I(ee),{column:3,border:""},{title:l(()=>[x("div",me,[e(I(Z),{type:"primary"},{default:l(()=>[k(V(a.stack.name),1)]),_:1}),e(z,{style:{"margin-left":"20px"},state:a.stack.state},null,8,["state"])])]),default:l(()=>[e(o,{span:1,label:"蓝图"},{default:l(()=>[k(V(a.stack.blueprint.name),1)]),_:1}),e(o,{span:1,label:"所有者"},{default:l(()=>[k(V(a.stack.ownerRealName),1)]),_:1}),e(o,{span:1,label:"回收状态"},{default:l(()=>[k(V(a.stack.recycled?`已于${a.stack.recycledTime}回收`:"未回收"),1)]),_:1}),e(o,{span:3,label:"到期时间"},{default:l(()=>[k(V(a.stack.expireTime),1)]),_:1}),e(o,{span:3,label:"标签"},{default:l(()=>[e(U,{resource:a.stack,"in-list":!1},null,8,["resource"])]),_:1}),e(o,{span:3,label:"描述"},{default:l(()=>[k(V(a.stack.description),1)]),_:1})]),_:1}),x("div",fe,[e(d,null,{default:l(()=>[k("资源")]),_:1})]),e(r,{data:a.stack.nodes,"show-overflow-tooltip":"","max-height":"300"},{default:l(()=>[e(n,{prop:"resource.name",label:"资源名称"},{default:l(u=>[e(oe,{"resource-category":u.row.resource.category,"resource-id":u.row.resource.id,"resource-name":u.row.resource.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),e(n,{prop:"nodeName",label:"节点名称"}),e(n,{label:"状态"},{default:l(u=>[e(ne,{state:u.row.resource.state},null,8,["state"])]),_:1}),e(n,{label:"属性"},{default:l(u=>[e(le,{resource:u.row.resource,"in-list":!0},null,8,["resource"])]),_:1})]),_:1},8,["data"])],64)}}},ve={__name:"DropStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const i=a,t=f;function o(){if(i.selectedStacks.length===0)return;const n={stackIds:i.selectedStacks.map(r=>r.id)};P(n).then(()=>{t("confirm")})}return(d,n)=>{const r=g("ElPopconfirm");return p(),b(r,{title:"解除纳管",onConfirm:o},{reference:l(()=>[e(w,{size:a.size,disabled:a.selectedStacks.length===0,plain:""},{default:l(()=>[k(" 解除纳管 ")]),_:1},8,["size","disabled"])]),_:1})}}},_e={style:{"margin-bottom":"10px"}},ke={__name:"ResourceStack",props:{recycleBinMode:{type:Boolean,required:!1,default:!1}},setup(a){const i=m({recycled:a.recycleBinMode}),t=m([]),o=m();function d(s){t.value=s}function n(){o.value.fetchData()}const r=m(!1),u=m();function y(s){u.value=s,r.value=!0}function v(s){!s||s.length===0||(t.value.length>0&&(t.value=s.filter(c=>t.value.findIndex(_=>_.id===c.id)!==-1)),u.value&&(u.value=s.find(c=>c.id===u.value.id),u.value||(r.value=!1)))}return(s,c)=>{const _=g("ElSpace"),E=g("ElTableColumn"),O=g("ElLink");return p(),R(T,null,[x("div",_e,[a.recycleBinMode?C("",!0):(p(),b(_,{key:0},{default:l(()=>[e(ue,{onConfirm:n}),e(q,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e($,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(A,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(ve,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(re)]),_:1})),e(ie,{"recycle-bin-mode":a.recycleBinMode,"selected-stacks":t.value,onConfirm:n},null,8,["recycle-bin-mode","selected-stacks"]),e(I(te),{style:{float:"right",width:"20%"},modelValue:i.value.search,"onUpdate:modelValue":c[0]||(c[0]=S=>i.value.search=S),"suffix-icon":"search"},null,8,["modelValue"])]),e(N,{ref_key:"tableRef",ref:o,"paging-request":i.value,"remote-method":I(H),onSelectionChange:d,onListChange:v},{default:l(()=>[e(E,{type:"selection","reserve-selection":""}),e(E,{prop:"name",label:"名称",sortable:"custom"},{default:l(S=>[e(O,{type:"primary",onClick:()=>y(S.row)},{default:l(()=>[k(V(S.row.name),1)]),_:2},1032,["onClick"])]),_:1}),e(E,{prop:"state",label:"状态",sortable:"custom"},{default:l(S=>[e(z,{state:S.row.state},null,8,["state"])]),_:1}),e(E,{label:"标签"},{default:l(S=>[e(U,{resource:S.row,"in-list":""},null,8,["resource"])]),_:1}),e(E,{prop:"ownerId",label:"所有者"},{default:l(S=>[k(V(S.row.ownerRealName),1)]),_:1}),e(E,{prop:"description",label:"描述"}),e(E,{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(E,{prop:"expireTime",label:"到期时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e(D,{modelValue:r.value,"onUpdate:modelValue":c[1]||(c[1]=S=>r.value=S),title:"资源栈详情",size:800,"no-confirm":""},{default:l(()=>[e(pe,{stack:u.value},null,8,["stack"])]),_:1},8,["modelValue"])],64)}}};export{ke as default};
