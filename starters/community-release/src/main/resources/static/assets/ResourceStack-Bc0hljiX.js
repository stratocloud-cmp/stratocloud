import{_ as N}from"./StratoTable--zpPaOW_.js";import{_ as L,a as j,b as M,u as J,d as P,c as H}from"./TransferStacksForm-sv-BrmVc.js";import{A as W,o as p,q as g,w as l,e,u as D,a2 as Y,a3 as G,I as K,d as I,t as V,a4 as Q,r as m,b as R,i as _,v as C,F as T,a7 as B,a8 as X,y as Z,n as b,a1 as ee,V as te,f as ae}from"./index-C_jnbPMf.js";import{S as w}from"./StratoButton-D7m4JR2l.js";import{_ as x}from"./StratoDrawer-BQ9z9CYD.js";import{r as F}from"./asyncJob-ClCdQ0iF.js";import{u as z}from"./activeJob-H4xjMLbI.js";import{_ as le}from"./TagValueSelectorGroup-kSkYehu4.js";import{R as h,a as ne}from"./ResourceTags-JwFrBl_C.js";import{_ as oe}from"./ResourceSelector-D-bu7cxQ.js";import{_ as se}from"./ResourceLink-B4i0l-gs.js";import"./request-BV6gXtmx.js";import"./StratoPagingSelector-BY9rDrJk.js";import"./blueprint-BwvMAK18.js";import"./UserSelector-Bks_jgjv.js";import"./user-BKxh-AQB.js";import"./TenantTreeSelector-DrVO4R-0.js";import"./FormUtil-BL1Y36f_.js";import"./CreateResourceForm-CPnav3GR.js";import"./AccountSelector-yRinDs2o.js";import"./account-DxeVqvnD.js";import"./AccountContext-Bp4LXd0C.js";import"./resource-DdTtSOFP.js";import"./StratoSelector-Csy36wxr.js";import"./StratoDynamicForm-BeoKTVDl.js";import"./IpState-yQwbBpiP.js";import"./role-DAS94606.js";import"./job-B1agJq36.js";import"./scriptDefinition-BwQHe3UI.js";import"./tag-CWCUpvbv.js";const re={style:{"margin-left":"2px"}},U={__name:"ResourceStackState",props:{state:{required:!0}},setup(a){const f=a,c={NO_STATE:{name:"未创建",icon:"Clock",type:"info"},CREATING:{name:"创建中",icon:"Loading"},CREATE_ERROR:{name:"创建失败",icon:"Warning",type:"danger"},RUNNING:{name:"运行中",icon:"VideoPlay",type:"success"},SHUTTING_DOWN:{name:"销毁中",icon:"Loading",type:"warning"},SHUTDOWN_ERROR:{name:"销毁失败",icon:"Warning",type:"danger"},SHUTDOWN:{name:"已销毁",icon:"Delete",type:"danger"}},t=W(()=>{let o=c[f.state];return o===void 0&&(o={name:f.state,icon:"QuestionFilled",type:"warning"}),o});return(o,d)=>(p(),g(D(Q),{size:"small",type:t.value.type,style:{"font-size":"12px"}},{default:l(()=>[e(D(Y),{class:G(t.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(p(),g(K(t.value.icon)))]),_:1},8,["class"]),I("span",re,V(t.value.name),1)]),_:1},8,["type"]))}},ue={__name:"RecycleBinButton",setup(a){const f=m(!1);function c(){f.value=!0}return(t,o)=>(p(),R(T,null,[e(w,{icon:"Delete",plain:"",onClick:c},{default:l(()=>[_("回收站")]),_:1}),e(x,{size:"800",modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=d=>f.value=d),title:"回收站","no-confirm":""},{default:l(()=>[f.value?(p(),g(ye,{key:0,"recycle-bin-mode":""})):C("",!0)]),_:1},8,["modelValue"])],64))}},ie={__name:"CreateStacksButton",emits:["confirm"],setup(a,{emit:f}){const c=z(),t=m(!1),o=m(),d=m(!1),n=m({tenantId:void 0,ownerId:void 0,blueprintId:void 0,name:void 0,description:void 0,expireTime:void 0,number:1,nodes:[],tags:[]});function r(){t.value=!0}function u(){o.value.validate(v=>{v&&(d.value=!0,F({jobType:"CREATE_RESOURCE_STACKS",jobParameters:n.value}).then(s=>{c.setActiveJobId(s.jobId),t.value=!1,y("confirm")}).finally(()=>{d.value=!1}))})}const y=f;return(v,s)=>(p(),R(T,null,[e(w,{type:"primary",onClick:r},{default:l(()=>[_("创建")]),_:1}),e(x,{loading:d.value,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=i=>t.value=i),title:"创建资源栈",size:1e3,onOnConfirm:u},{default:l(()=>[t.value?(p(),g(L,{key:0,ref_key:"createFormRef",ref:o,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=i=>n.value=i)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])],64))}},A={__name:"RecycleStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const c=a,t=z(),o=m(),d=m(!1),n=m(!1),r=m({stacks:[]});function u(){r.value.stacks=c.selectedStacks.map(s=>({stackId:s.id,executingDestruction:!0})),n.value=!0}function y(){o.value.validate(s=>{s&&(d.value=!0,F({jobType:"RECYCLE_RESOURCE_STACKS",jobParameters:r.value}).then(i=>{t.setActiveJobId(i.jobId),n.value=!1,v("confirm")}).finally(()=>{d.value=!1}))})}const v=f;return(s,i)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length===0,size:a.size,plain:"",type:"warning",onClick:u},{default:l(()=>[_("回收")]),_:1},8,["disabled","size"]),(p(),g(B,{to:"body"},[e(x,{loading:d.value,modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=k=>n.value=k),title:"回收资源栈",onOnConfirm:y},{default:l(()=>[n.value?(p(),g(j,{key:0,ref_key:"recycleFormRef",ref:o,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=k=>r.value=k)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},$={__name:"TransferStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const c=a,t=z(),o=m(),d=m(!1),n=m(!1),r=m({transfers:[]});function u(){r.value.transfers=c.selectedStacks.map(s=>({stackId:s.id,newOwnerId:s.ownerId,newTenantId:s.tenantId})),n.value=!0}function y(){o.value.validate(s=>{s&&(d.value=!0,F({jobType:"TRANSFER_STACKS",jobParameters:r.value}).then(i=>{t.setActiveJobId(i.jobId),n.value=!1,v("confirm")}).finally(()=>{d.value=!1}))})}const v=f;return(s,i)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length===0,size:a.size,plain:"",onClick:u},{default:l(()=>[_("移交")]),_:1},8,["disabled","size"]),(p(),g(B,{to:"body"},[e(x,{size:600,loading:d.value,modelValue:n.value,"onUpdate:modelValue":i[1]||(i[1]=k=>n.value=k),title:"移交资源栈",onOnConfirm:y},{default:l(()=>[n.value?(p(),g(M,{key:0,ref_key:"transferFormRef",ref:o,modelValue:r.value,"onUpdate:modelValue":i[0]||(i[0]=k=>r.value=k)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},ce={__name:"UpdateStackForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(a,{expose:f}){const c=m(),t=X(a,"modelValue");Z(()=>{t.value&&(t.value.tags||(t.value.tags=[]))});const o=m({name:[{required:!0,message:"请输入资源栈名称"}],tags:[{validator:(r,u,y)=>{var v;return(v=n.value)==null?void 0:v.validate(r,u,y)},trigger:"change"}]});function d(r){c.value.validate(r)}f({validate:d});const n=m();return(r,u)=>{const y=b("ElInput"),v=b("ElFormItem"),s=b("ElDatePicker"),i=b("ElForm");return p(),g(i,{ref_key:"formRef",ref:c,model:t.value,"label-position":"top",rules:o.value},{default:l(()=>[e(v,{label:"资源栈名称",prop:"name"},{default:l(()=>[e(y,{modelValue:t.value.name,"onUpdate:modelValue":u[0]||(u[0]=k=>t.value.name=k)},null,8,["modelValue"])]),_:1}),e(v,{label:"到期时间"},{default:l(()=>[e(s,{style:{width:"100%"},type:"datetime",modelValue:t.value.expireTime,"onUpdate:modelValue":u[1]||(u[1]=k=>t.value.expireTime=k),"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(v,{label:"标签",prop:"tags"},{default:l(()=>[e(le,{ref_key:"tagRef",ref:n,"entry-paging-request":{userGroupTaggable:!0},modelValue:t.value.tags,"onUpdate:modelValue":u[2]||(u[2]=k=>t.value.tags=k)},null,8,["modelValue"])]),_:1}),e(v,{label:"描述"},{default:l(()=>[e(y,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":u[3]||(u[3]=k=>t.value.description=k)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])}}},q={__name:"UpdateStackBasicsButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const c=a,t=m(),o=m(),d=m(!1),n=m();function r(){c.selectedStacks.length!==0&&(n.value={stackId:c.selectedStacks[0].id,name:c.selectedStacks[0].name,description:c.selectedStacks[0].description,expireTime:c.selectedStacks[0].expireTime,tags:c.selectedStacks[0].tags},t.value=!0)}function u(){o.value.validate(v=>{v&&(d.value=!0,J(n.value).then(()=>{t.value=!1,y("confirm")}).finally(()=>{d.value=!1}))})}const y=f;return(v,s)=>(p(),R(T,null,[e(w,{disabled:a.selectedStacks.length!==1,"disabled-message":"请选择且只选择一项",size:a.size,plain:"",onClick:r},{default:l(()=>[_("编辑")]),_:1},8,["disabled","size"]),(p(),g(B,{to:"body"},[e(x,{loading:d.value,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=i=>t.value=i),title:"编辑资源栈基本信息",onOnConfirm:u},{default:l(()=>[t.value?(p(),g(ce,{key:0,ref_key:"updateFormRef",ref:o,modelValue:n.value,"onUpdate:modelValue":s[0]||(s[0]=i=>n.value=i)},null,8,["modelValue"])):C("",!0)]),_:1},8,["loading","modelValue"])]))],64))}},de={__name:"RestoreStacksButton",props:{selectedStacks:{type:Array,required:!0},recycleBinMode:{type:Boolean,required:!0}},emits:["confirm"],setup(a,{emit:f}){const c=a,t=z(),o=m(!1);function d(){o.value=!0,F({jobType:"RESTORE_RESOURCE_STACKS",jobParameters:{stackIds:c.selectedStacks.map(r=>r.id)}}).then(r=>{t.setActiveJobId(r.jobId),n("confirm")}).finally(()=>{o.value=!1})}const n=f;return(r,u)=>a.recycleBinMode?(p(),g(w,{key:0,disabled:a.selectedStacks.length===0,loading:o.value,plain:"",type:"success",onClick:d},{default:l(()=>[_("还原")]),_:1},8,["disabled","loading"])):C("",!0)}},me={style:{float:"right"}},fe={style:{width:"100%"}},pe={style:{"margin-top":"12px","margin-bottom":"12px"}},ve={__name:"ResourceStackDetail",props:{stack:{required:!0}},setup(a){return(f,c)=>{const t=b("ElSpace"),o=b("ElDescriptionsItem"),d=b("ElText"),n=b("ElTableColumn"),r=b("ElTable");return p(),R(T,null,[I("span",me,[e(t,null,{default:l(()=>[e(q,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"]),e($,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"]),e(A,{"selected-stacks":[a.stack],size:"small"},null,8,["selected-stacks"])]),_:1})]),e(D(te),{column:3,border:""},{title:l(()=>[I("div",fe,[e(D(ee),{type:"primary"},{default:l(()=>[_(V(a.stack.name),1)]),_:1}),e(U,{style:{"margin-left":"20px"},state:a.stack.state},null,8,["state"])])]),default:l(()=>[e(o,{span:1,label:"蓝图"},{default:l(()=>[_(V(a.stack.blueprint.name),1)]),_:1}),e(o,{span:1,label:"所有者"},{default:l(()=>[_(V(a.stack.ownerRealName),1)]),_:1}),e(o,{span:1,label:"回收状态"},{default:l(()=>[_(V(a.stack.recycled?`已于${a.stack.recycledTime}回收`:"未回收"),1)]),_:1}),e(o,{span:3,label:"到期时间"},{default:l(()=>[_(V(a.stack.expireTime),1)]),_:1}),e(o,{span:3,label:"标签"},{default:l(()=>[e(h,{resource:a.stack,"in-list":!1},null,8,["resource"])]),_:1}),e(o,{span:3,label:"描述"},{default:l(()=>[_(V(a.stack.description),1)]),_:1})]),_:1}),I("div",pe,[e(d,null,{default:l(()=>[_("资源")]),_:1})]),e(r,{data:a.stack.nodes,"show-overflow-tooltip":"","max-height":"300"},{default:l(()=>[e(n,{prop:"resource.name",label:"资源名称"},{default:l(u=>[e(se,{"resource-category":u.row.resource.category,"resource-id":u.row.resource.id,"resource-name":u.row.resource.name},null,8,["resource-category","resource-id","resource-name"])]),_:1}),e(n,{prop:"nodeName",label:"节点名称"}),e(n,{label:"状态"},{default:l(u=>[e(oe,{state:u.row.resource.state},null,8,["state"])]),_:1}),e(n,{label:"属性"},{default:l(u=>[e(ne,{resource:u.row.resource,"in-list":!0},null,8,["resource"])]),_:1})]),_:1},8,["data"])],64)}}},ke={__name:"DropStacksButton",props:{selectedStacks:{type:Array,required:!0},size:{required:!1}},emits:["confirm"],setup(a,{emit:f}){const c=a,t=f;function o(){if(c.selectedStacks.length===0)return;const n={stackIds:c.selectedStacks.map(r=>r.id)};P(n).then(()=>{t("confirm")})}return(d,n)=>{const r=b("ElPopconfirm");return p(),g(r,{title:"解除纳管",onConfirm:o},{reference:l(()=>[e(w,{size:a.size,disabled:a.selectedStacks.length===0,plain:""},{default:l(()=>[_(" 解除纳管 ")]),_:1},8,["size","disabled"])]),_:1})}}},_e={style:{"margin-bottom":"10px"}},ye={__name:"ResourceStack",props:{recycleBinMode:{type:Boolean,required:!1,default:!1}},setup(a){const c=m({recycled:a.recycleBinMode}),t=m([]),o=m();function d(s){t.value=s}function n(){o.value.fetchData()}const r=m(!1),u=m();function y(s){u.value=s,r.value=!0}function v(s){!s||s.length===0||(t.value.length>0&&(t.value=s.filter(i=>t.value.findIndex(k=>k.id===i.id)!==-1)),u.value&&(u.value=s.find(i=>i.id===u.value.id),u.value||(r.value=!1)))}return(s,i)=>{const k=b("ElSpace"),E=b("ElTableColumn"),O=b("ElLink");return p(),R(T,null,[I("div",_e,[a.recycleBinMode?C("",!0):(p(),g(k,{key:0},{default:l(()=>[e(ie,{onConfirm:n}),e(q,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e($,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(A,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(ke,{"selected-stacks":t.value,onConfirm:n},null,8,["selected-stacks"]),e(ue)]),_:1})),e(de,{"recycle-bin-mode":a.recycleBinMode,"selected-stacks":t.value,onConfirm:n},null,8,["recycle-bin-mode","selected-stacks"]),e(D(ae),{style:{float:"right",width:"20%"},modelValue:c.value.search,"onUpdate:modelValue":i[0]||(i[0]=S=>c.value.search=S),"suffix-icon":"search"},null,8,["modelValue"])]),e(N,{ref_key:"tableRef",ref:o,"paging-request":c.value,"remote-method":D(H),onSelectionChange:d,onListChange:v},{default:l(()=>[e(E,{type:"selection","reserve-selection":""}),e(E,{prop:"name",label:"名称",sortable:"custom"},{default:l(S=>[e(O,{type:"primary",onClick:()=>y(S.row)},{default:l(()=>[_(V(S.row.name),1)]),_:2},1032,["onClick"])]),_:1}),e(E,{prop:"state",label:"状态",sortable:"custom"},{default:l(S=>[e(U,{state:S.row.state},null,8,["state"])]),_:1}),e(E,{label:"标签"},{default:l(S=>[e(h,{resource:S.row,"in-list":""},null,8,["resource"])]),_:1}),e(E,{prop:"ownerId",label:"所有者"},{default:l(S=>[_(V(S.row.ownerRealName),1)]),_:1}),e(E,{prop:"description",label:"描述"}),e(E,{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(E,{prop:"expireTime",label:"到期时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e(x,{modelValue:r.value,"onUpdate:modelValue":i[1]||(i[1]=S=>r.value=S),title:"资源栈详情",size:800,"no-confirm":""},{default:l(()=>[e(ve,{stack:u.value},null,8,["stack"])]),_:1},8,["modelValue"])],64)}}};export{ye as default};
