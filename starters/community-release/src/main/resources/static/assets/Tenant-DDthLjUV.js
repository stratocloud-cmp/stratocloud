import{_ as Z}from"./StratoTable--zpPaOW_.js";import{_ as ee,c as pe,u as fe,e as ve,d as ce,a as ge,b as Ve}from"./TenantTreeSelector-DrVO4R-0.js";import{S as k}from"./StratoButton-D7m4JR2l.js";import{_ as $}from"./StratoDrawer-BQ9z9CYD.js";import{a8 as L,r as d,y as J,o as b,q as C,w as a,e,u as o,E as _,f as G,j as te,ac as W,n as y,b as Y,F as P,v as z,d as q,O as le,P as N,m as _e,B as ae,i as F,t as X,x as ye}from"./index-C_jnbPMf.js";import{s as S}from"./request-BV6gXtmx.js";import{S as ue}from"./StratoCodeBlock-BwyPwVq9.js";import{_ as oe}from"./UserSelector-Bks_jgjv.js";import{_ as ne}from"./ProviderSelector-DfzK_R5I.js";import{_ as re}from"./AccountSelector-yRinDs2o.js";import{_ as se}from"./CategorySelector-Cv_x1LAY.js";import{_ as de}from"./TagValueSelectorGroup-kSkYehu4.js";import{_ as be}from"./StratoSelector-Csy36wxr.js";import"./StratoPagingSelector-BY9rDrJk.js";import"./user-BKxh-AQB.js";import"./resource-DdTtSOFP.js";import"./account-DxeVqvnD.js";import"./AccountContext-Bp4LXd0C.js";import"./tag-CWCUpvbv.js";const Ee={__name:"CreateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(c){v.value.validate(c)}const n=d({parentId:[{required:!0,message:"请选择父级租户"}],name:[{required:!0,message:"请输入租户名称"}]});return J(()=>{}),(c,u)=>(b(),C(o(te),{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(G),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"父级租户",prop:"parentId"},{default:a(()=>[e(ee,{modelValue:l.value.parentId,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.parentId=t)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(G),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[2]||(u[2]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ie={__name:"UpdateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(c){v.value.validate(c)}const n=d({name:[{required:!0,message:"请输入租户名称"}]});return J(()=>{}),(c,u)=>(b(),C(o(te),{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(G),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(G),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ne=r=>S({url:"/identity-service/describe-rules",method:"post",data:r}),Ue=r=>S({url:"/identity-service/create-rule",method:"post",data:r}),xe=r=>S({url:"/identity-service/update-rule",method:"post",data:r}),Ce=r=>S({url:"/identity-service/create-naming-rule",method:"post",data:r}),Re=r=>S({url:"/identity-service/update-naming-rule",method:"post",data:r}),Te=r=>S({url:"/identity-service/delete-rules",method:"post",data:r}),De={__name:"CreateRuleForm",props:W({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(c){v.value.validate(c)}const n=d({tenantId:[{required:!0,message:"请选择租户"}],type:[{required:!0,message:"请输入规则类型"}],name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return J(()=>{}),(c,u)=>{const t=y("ElInput"),m=y("ElOption"),f=y("ElSelect"),s=y("ElInputNumber"),w=y("ElForm");return b(),C(w,{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":u[0]||(u[0]=I=>l.value.tenantId=I)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则类型",prop:"type"},{default:a(()=>[e(t,{modelValue:l.value.type,"onUpdate:modelValue":u[1]||(u[1]=I=>l.value.type=I),placeholder:"请输入规则类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[2]||(u[2]=I=>l.value.name=I),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[3]||(u[3]=I=>l.value.script=I),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),Y(P,{key:0},[e(o(_),{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(f,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[4]||(u[4]=I=>l.value.suffixType=I),placeholder:"请选择后缀类型"},{default:a(()=>[e(m,{key:"NONE",value:"NONE",label:"无后缀"}),e(m,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(m,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(m,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),C(o(_),{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(s,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[5]||(u[5]=I=>l.value.suffixLength=I),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):z("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),C(o(_),{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(s,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[6]||(u[6]=I=>l.value.suffixStartNumber=I),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):z("",!0)],64)):z("",!0)]),_:1},8,["model","rules"])}}},we={__name:"UpdateRuleForm",props:W({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(c){v.value.validate(c)}const n=d({name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return J(()=>{}),(c,u)=>{const t=y("ElInput"),m=y("ElFormItem"),f=y("ElOption"),s=y("ElSelect"),w=y("ElInputNumber"),I=y("ElForm");return b(),C(I,{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(m,{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=D=>l.value.name=D),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[1]||(u[1]=D=>l.value.script=D),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),Y(P,{key:0},[e(m,{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(s,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[2]||(u[2]=D=>l.value.suffixType=D),placeholder:"请选择后缀类型"},{default:a(()=>[e(f,{key:"NONE",value:"NONE",label:"无后缀"}),e(f,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(f,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(f,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),C(m,{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(w,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[3]||(u[3]=D=>l.value.suffixLength=D),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):z("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),C(m,{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(w,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[4]||(u[4]=D=>l.value.suffixStartNumber=D),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):z("",!0)],64)):z("",!0)]),_:1},8,["model","rules"])}}},he={style:{"margin-bottom":"10px",height:"32px"}},ke=q("span",{style:{"font-size":"12px"}},"创建",-1),Se=q("span",{style:{"font-size":"12px"}},"编辑",-1),Fe=q("span",{style:{"font-size":"12px"}},"删除",-1),qe={__name:"Rule",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),v=d(!1),p=d(!1),n=d([]),c=d({tenantIds:V.tenantIds}),u=d(),t=d({}),m=d(!1),f=d(),s=d({}),w=d(!1);function I(h){n.value=h}function D(){return n.value.map(h=>h.id)}function R(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),v.value=!0}function M(){n.value.length===1&&(w.value=n.value[0].isNamingRule,s.value={ruleId:n.value[0].id,name:n.value[0].name,script:n.value[0].script,suffixType:n.value[0].suffixType,suffixLength:n.value[0].suffixLength,suffixStartNumber:n.value[0].suffixStartNumber},p.value=!0)}function H(){u.value.validate((h,E)=>{if(!h)return;(m.value?Ce:Ue)(t.value).then(U=>{l.value.fetchData(),v.value=!1})})}function K(){f.value.validate((h,E)=>{if(!h)return;(w.value?Re:xe)(s.value).then(U=>{l.value.fetchData(),p.value=!1})})}function j(){const E={ruleIds:D()};Te(E).then(O=>{l.value.fetchData()})}return(h,E)=>{const O=y("ElRadioButton"),U=y("ElRadioGroup");return b(),Y(P,null,[q("div",he,[e(k,{size:"small",type:"primary",onClick:R},{default:a(()=>[ke]),_:1}),e(k,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:M},{default:a(()=>[Se]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:j},{reference:a(()=>[e(k,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[Fe]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:c.value.search,"onUpdate:modelValue":E[0]||(E[0]=g=>c.value.search=g),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":c.value,"remote-method":o(Ne),onSelectionChange:I},{default:a(()=>[e(o(N),{type:"selection","reserve-selection":""}),e(o(N),{prop:"type",label:"类型",sortable:"custom"}),e(o(N),{prop:"name",label:"名称",sortable:"custom"}),e(o(N),{prop:"isNamingRule",label:"是否命名规则",formatter:(g,A,B,x)=>B?"是":"否"},null,8,["formatter"]),e(o(N),{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:v.value,"onUpdate:modelValue":E[3]||(E[3]=g=>v.value=g),title:"创建规则",onOnConfirm:H,size:"600"},{default:a(()=>[e(U,{modelValue:m.value,"onUpdate:modelValue":E[1]||(E[1]=g=>m.value=g),style:{"margin-bottom":"12px"}},{default:a(()=>[e(O,{label:"普通规则",value:!1}),e(O,{label:"命名规则",value:!0})]),_:1},8,["modelValue"]),e(De,{ref_key:"createFormRef",ref:u,"is-naming-rule":m.value,modelValue:t.value,"onUpdate:modelValue":E[2]||(E[2]=g=>t.value=g)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:p.value,"onUpdate:modelValue":E[5]||(E[5]=g=>p.value=g),title:"编辑规则",onOnConfirm:K,size:"600"},{default:a(()=>[e(we,{"is-naming-rule":w.value,ref_key:"updateFormRef",ref:f,modelValue:s.value,"onUpdate:modelValue":E[4]||(E[4]=g=>s.value=g)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"])],64)}}},Me=r=>S({url:"/resource-service/describe-resource-usage-limits",method:"post",data:r}),Oe=r=>S({url:"/resource-service/describe-usage-types",method:"post",data:r}),$e=r=>S({url:"/resource-service/create-resource-usage-limit",method:"post",data:r}),Le=r=>S({url:"/resource-service/update-resource-usage-limit",method:"post",data:r}),ze=r=>S({url:"/resource-service/enable-resource-usage-limits",method:"post",data:r}),Ae=r=>S({url:"/resource-service/disable-resource-usage-limits",method:"post",data:r}),Be=r=>S({url:"/resource-service/delete-resource-usage-limits",method:"post",data:r}),Qe={__name:"UsageTypeSelector",props:W({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{},modelModifiers:{},usageTypeName:{},usageTypeNameModifiers:{}}),emits:W(["change"],["update:modelValue","update:usageTypeName"]),setup(r,{emit:V}){const l=L(r,"modelValue"),v=L(r,"usageTypeName"),p=r,n=V;function c(t){v.value=t.usageTypeName,n("change",t)}const u=d({});return _e(p,()=>{u.value.providerIds=p.providerIds,u.value.resourceCategories=p.resourceCategories},{immediate:!0}),(t,m)=>(b(),C(be,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=f=>l.value=f),onChange:c,"list-getter":f=>f.usageTypes,"value-getter":f=>f.usageType,"label-getter":f=>f.usageTypeName,"remote-method":o(Oe),request:u.value},null,8,["modelValue","list-getter","value-getter","label-getter","remote-method","request"]))}},ie={__name:"LimitItemSelectorGroup",props:W({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{required:!0,type:Array,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue");function v(c){l.value.push({usageType:c.usageType,usageTypeName:c.usageTypeName,limitValue:c.limitValue})}function p(c){const u=l.value.indexOf(c);u>=0&&l.value.splice(u,1)}function n(c,u,t){if(!u||u.length===0)return t();for(let m of u)if(!m.usageType||!m.limitValue)return t(new Error("配额上限未完成填写"));return t()}return V({validate:n}),(c,u)=>{const t=y("ElTag"),m=y("ElSpace"),f=y("ElInput"),s=y("ElCol"),w=y("ElRow"),I=y("ElButton"),D=y("ElPopover");return b(),C(D,{width:"450",trigger:"click",teleported:!1},{reference:a(()=>[e(f,{plain:"","suffix-icon":"ArrowDown"},{prefix:a(()=>[e(m,{alignment:"normal",wrap:""},{default:a(()=>[(b(!0),Y(P,null,ae(l.value,R=>(b(),C(t,{closable:"",onClose:()=>p(R)},{default:a(()=>[F(X((R.usageTypeName?R.usageTypeName:"?")+":"+(R.limitValue?R.limitValue:"?")),1)]),_:2},1032,["onClose"]))),256))]),_:1})]),_:1})]),default:a(()=>[q("div",null,[(b(!0),Y(P,null,ae(l.value,R=>(b(),C(w,{gutter:12,style:{"margin-bottom":"6px"}},{default:a(()=>[e(s,{span:10},{default:a(()=>[e(Qe,{"provider-ids":r.providerIds,"resource-categories":r.resourceCategories,modelValue:R.usageType,"onUpdate:modelValue":M=>R.usageType=M,"usage-type-name":R.usageTypeName,"onUpdate:usageTypeName":M=>R.usageTypeName=M},null,8,["provider-ids","resource-categories","modelValue","onUpdate:modelValue","usage-type-name","onUpdate:usageTypeName"])]),_:2},1024),e(s,{span:14},{default:a(()=>[e(f,{modelValue:R.limitValue,"onUpdate:modelValue":M=>R.limitValue=M},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),e(I,{style:{width:"100%","margin-top":"6px"},icon:"Plus",onClick:u[0]||(u[0]=()=>v({}))})]),_:1})}}},Ge={__name:"CreateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(u){v.value.validate(u)}const n=d(),c=d({tenantId:[{required:!0,message:"请选择租户"}],name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var f;return(f=n.value)==null?void 0:f.validate(u,t,m)},trigger:"change"}]});return J(()=>{}),(u,t)=>{const m=y("ElInput"),f=y("ElForm");return b(),C(f,{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:c.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.tenantId=s)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Ye={__name:"UpdateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),v=d();V({validate:p});function p(u){v.value.validate(u)}const n=d(),c=d({name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var f;return(f=n.value)==null?void 0:f.validate(u,t,m)},trigger:"change"}]});return J(()=>{}),(u,t)=>{const m=y("ElInput"),f=y("ElForm");return b(),C(f,{ref_key:"formRef",ref:v,model:l.value,"label-position":"top",rules:c.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Pe={style:{"margin-bottom":"10px",height:"32px"}},je=q("span",{style:{"font-size":"12px"}},"创建",-1),Je=q("span",{style:{"font-size":"12px"}},"编辑",-1),He=q("span",{style:{"font-size":"12px"}},"启用",-1),Ke=q("span",{style:{"font-size":"12px"}},"禁用",-1),We=q("span",{style:{"font-size":"12px"}},"删除",-1),Xe={__name:"ResourceUsageLimit",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),v=d(!1),p=d(!1),n=d([]),c=d({tenantIds:V.tenantIds}),u=d(),t=d({tags:[],items:[]}),m=d(),f=d({});function s(U){n.value=U}function w(){return n.value.map(U=>U.id)}function I(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),v.value=!0}function D(){n.value.length===1&&(f.value={limitId:n.value[0].id,name:n.value[0].name,description:n.value[0].description,ownerIds:n.value[0].ownerIds,providerIds:n.value[0].providerIds,accountIds:n.value[0].accountIds,resourceCategories:n.value[0].resourceCategories,resourceTypes:n.value[0].resourceTypes,tags:n.value[0].tags?n.value[0].tags:[],items:n.value[0].items?n.value[0].items:[]},p.value=!0)}function R(){u.value.validate(U=>{U&&$e(t.value).then(()=>{l.value.fetchData(),v.value=!1})})}function M(){m.value.validate(U=>{U&&Le(f.value).then(()=>{l.value.fetchData(),p.value=!1})})}function H(){const g={limitIds:w()};Be(g).then(()=>{l.value.fetchData()})}function K(){const g={limitIds:w()};ze(g).then(()=>{l.value.fetchData()})}function j(){const g={limitIds:w()};Ae(g).then(()=>{l.value.fetchData()})}const h=d(),E=d(!1);function O(U){h.value=U,E.value=!0}return(U,g)=>{const A=y("ElButton"),B=y("ElText"),x=y("ElTable");return b(),Y(P,null,[q("div",Pe,[e(k,{size:"small",type:"primary",onClick:I},{default:a(()=>[je]),_:1}),e(k,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:D},{default:a(()=>[Je]),_:1},8,["disabled"]),e(k,{size:"small",disabled:n.value.length===0,onClick:K,type:"success",plain:""},{default:a(()=>[He]),_:1},8,["disabled"]),e(k,{size:"small",disabled:n.value.length===0,onClick:j,type:"danger",plain:""},{default:a(()=>[Ke]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:H},{reference:a(()=>[e(k,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[We]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:c.value.search,"onUpdate:modelValue":g[0]||(g[0]=i=>c.value.search=i),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":c.value,"remote-method":o(Me),onSelectionChange:s},{default:a(()=>[e(o(N),{type:"selection","reserve-selection":""}),e(o(N),{prop:"name",label:"名称",sortable:"custom"}),e(o(N),{prop:"description",label:"描述"}),e(o(N),{prop:"disabled",label:"是否禁用",formatter:i=>i.disabled?"是":"否"},null,8,["formatter"]),e(o(N),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(N),null,{default:a(i=>[e(A,{link:"",type:"primary",onClick:()=>O(i.row)},{default:a(()=>[F("查看配额")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:v.value,"onUpdate:modelValue":g[2]||(g[2]=i=>v.value=i),title:"创建配额上限",onOnConfirm:R,size:"600"},{default:a(()=>[e(Ge,{ref_key:"createFormRef",ref:u,modelValue:t.value,"onUpdate:modelValue":g[1]||(g[1]=i=>t.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:p.value,"onUpdate:modelValue":g[4]||(g[4]=i=>p.value=i),title:"编辑配额上限",onOnConfirm:M,size:"600"},{default:a(()=>[e(Ye,{ref_key:"updateFormRef",ref:m,modelValue:f.value,"onUpdate:modelValue":g[3]||(g[3]=i=>f.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:E.value,"onUpdate:modelValue":g[5]||(g[5]=i=>E.value=i),title:"配额详情",size:"600"},{default:a(()=>[e(x,{data:h.value.items},{default:a(()=>[e(o(N),{prop:"usageTypeName",label:"配额项"}),e(o(N),{prop:"usageValue",label:"已使用量"}),e(o(N),{prop:"limitValue",label:"上限"}),e(o(N),{prop:"percentage",label:"百分比"},{default:a(i=>[i.row.percentage<=80?(b(),C(B,{key:0,type:"success"},{default:a(()=>[F(X(i.row.percentage)+"% ",1)]),_:2},1024)):i.row.percentage>80&&i.row.percentage<100?(b(),C(B,{key:1,type:"warning"},{default:a(()=>[F(X(i.row.percentage)+"% ",1)]),_:2},1024)):(b(),C(B,{key:2,type:"danger"},{default:a(()=>[F(X(i.row.percentage)+"% ",1)]),_:2},1024))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}},Ze={style:{"margin-bottom":"10px",height:"32px"}},El={__name:"Tenant",setup(r){const V=d(),l=d(!1),v=d(!1),p=d([]),n=d({}),c=d(),u=d({}),t=d(),m=d({});function f(x){p.value=x}function s(){return p.value.map(x=>x.id)}function w(){l.value=!0}function I(){if(p.value.length!==1){ye({title:"错误",message:"请选择一个租户",type:"error"});return}m.value={tenantId:p.value[0].id,name:p.value[0].name,description:p.value[0].description},v.value=!0}function D(){c.value.validate((x,i)=>{x&&pe(u.value).then(Q=>{V.value.fetchData(),l.value=!1})})}function R(){t.value.validate((x,i)=>{x&&fe(m.value).then(Q=>{V.value.fetchData(),v.value=!1})})}function M(){const i={tenantIds:s()};ve(i).then(Q=>{V.value.fetchData()})}function H(){const i={tenantIds:s()};ce(i).then(Q=>{V.value.fetchData()})}function K(){const i={tenantIds:s()};ge(i).then(Q=>{V.value.fetchData()})}const j=d(),h=d(),E=d(!1);function O(x){j.value=[x.id],h.value=x.name,E.value=!0}const U=d(),g=d(),A=d(!1);function B(x){U.value=[x.id],g.value=x.name,A.value=!0}return(x,i)=>{const Q=y("ElButton");return b(),Y(P,null,[q("div",Ze,[e(k,{type:"primary",onClick:w},{default:a(()=>[F("创建")]),_:1}),e(k,{disabled:p.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:I},{default:a(()=>[F("编辑")]),_:1},8,["disabled"]),e(k,{disabled:p.value.length===0,type:"success",plain:"",onClick:M},{default:a(()=>[F("启用")]),_:1},8,["disabled"]),e(k,{disabled:p.value.length===0,type:"danger",plain:"",onClick:H},{default:a(()=>[F("禁用")]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:K},{reference:a(()=>[e(k,{disabled:p.value.length===0,type:"danger",plain:""},{default:a(()=>[F("删除")]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:n.value.search,"onUpdate:modelValue":i[0]||(i[0]=T=>n.value.search=T),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:V,"paging-request":n.value,"remote-method":o(Ve),onSelectionChange:f},{default:a(()=>[e(o(N),{type:"selection","reserve-selection":""}),e(o(N),{prop:"name",label:"名称",sortable:"custom"}),e(o(N),{prop:"parentName",label:"父级租户"}),e(o(N),{prop:"description",label:"描述"}),e(o(N),{prop:"disabled",label:"是否禁用",formatter:(T,el,me,ll)=>me?"是":"否"},null,8,["formatter"]),e(o(N),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(N),{width:"120"},{default:a(T=>[e(Q,{link:"",type:"primary",onClick:()=>O(T.row)},{default:a(()=>[F(" 规则管理 ")]),_:2},1032,["onClick"])]),_:1}),e(o(N),{width:"120"},{default:a(T=>[e(Q,{link:"",type:"primary",onClick:()=>B(T.row)},{default:a(()=>[F(" 配额上限 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=T=>l.value=T),title:"创建租户",onOnConfirm:D},{default:a(()=>[e(Ee,{ref_key:"createTenantFormRef",ref:c,modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=T=>u.value=T)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:v.value,"onUpdate:modelValue":i[4]||(i[4]=T=>v.value=T),title:"编辑租户",onOnConfirm:R},{default:a(()=>[e(Ie,{ref_key:"updateTenantFormRef",ref:t,modelValue:m.value,"onUpdate:modelValue":i[3]||(i[3]=T=>m.value=T)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:E.value,"onUpdate:modelValue":i[5]||(i[5]=T=>E.value=T),title:`规则管理(租户:${h.value})`,"no-confirm":"",size:"800"},{default:a(()=>[E.value?(b(),C(qe,{key:0,"tenant-ids":j.value},null,8,["tenant-ids"])):z("",!0)]),_:1},8,["modelValue","title"]),e($,{modelValue:A.value,"onUpdate:modelValue":i[6]||(i[6]=T=>A.value=T),title:`配额上限(租户:${g.value})`,"no-confirm":"",size:"800"},{default:a(()=>[A.value?(b(),C(Xe,{key:0,"tenant-ids":U.value},null,8,["tenant-ids"])):z("",!0)]),_:1},8,["modelValue","title"])],64)}}};export{El as default};
