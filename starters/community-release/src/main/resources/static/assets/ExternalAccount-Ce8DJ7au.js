import{_ as Q}from"./StratoTable-BQdButlV.js";import{d as U,c as W,u as X,e as Y,a as Z,b as G}from"./account-Dl5yMWLZ.js";import{S as h}from"./StratoButton-AnmxT3yq.js";import{r as K}from"./asyncJob-DI4BEQdL.js";import{u as ee}from"./activeJob-DfWXj1ie.js";import{_ as w}from"./StratoDrawer-BEn6vZyQ.js";import{_ as N}from"./ProviderSelector-BC5uGiUI.js";import{_ as T}from"./StratoDynamicForm-Dzna3_lB.js";import{a7 as q,r as n,n as C,o as y,q as x,w as l,e,v as S,y as ae,A as te,u as R,a2 as le,a3 as oe,I as ne,d as O,t as B,af as re,b as ue,F as de,i as D,O as se,f as ie}from"./index-C6PxR8iA.js";import"./request-BGZJNm7h.js";import"./StratoSelector-BPbvdP-M.js";import"./resource-Bh2jHR95.js";import"./IpState-B-GWVa2R.js";import"./UserSelector-I3vgcqge.js";import"./StratoPagingSelector-CZtU1yuw.js";import"./user-DS2hYLSE.js";import"./role-DCPu0vWf.js";import"./job-BPKVJ0Lh.js";import"./scriptDefinition-3uUc8gRV.js";const me={__name:"CreateAccountForm",props:{modelValue:{required:!0,default:{providerId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(A,{expose:V}){const a=q(A,"modelValue"),o=n(),r=n();V({validate:I});function I(v){r.value.validate((t,d)=>{t&&o.value.validate(v)})}const E=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),f=n();function p(v){f.value=v}return(v,t)=>{const d=C("ElFormItem"),_=C("ElInput"),k=C("ElForm");return y(),x(k,{ref_key:"formRef",ref:o,model:a.value,"label-position":"top",rules:E.value},{default:l(()=>{var c;return[e(d,{label:"云平台",prop:"providerId"},{default:l(()=>[e(N,{onChange:p,modelValue:a.value.providerId,"onUpdate:modelValue":t[0]||(t[0]=i=>a.value.providerId=i)},null,8,["modelValue"])]),_:1}),e(d,{label:"云账号名称",prop:"name"},{default:l(()=>[e(_,{modelValue:a.value.name,"onUpdate:modelValue":t[1]||(t[1]=i=>a.value.name=i)},null,8,["modelValue"])]),_:1}),f.value?(y(),x(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(c=f.value)==null?void 0:c.accountFormMetaData,modelValue:a.value.properties,"onUpdate:modelValue":t[2]||(t[2]=i=>a.value.properties=i)},null,8,["form-meta-data","modelValue"])):S("",!0),e(d,{label:"云账号描述",prop:"description"},{default:l(()=>[e(_,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":t[3]||(t[3]=i=>a.value.description=i)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},pe={__name:"UpdateAccountForm",props:{modelValue:{required:!0,default:{externalAccountId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(A,{expose:V}){const a=q(A,"modelValue"),o=n(),r=n();V({validate:I});function I(t){r.value.validate((d,_)=>{d&&o.value.validate(t)})}const E=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),f=n(),p=n();function v(t){p.value=t}return ae(()=>{a.value.externalAccountId&&U({accountIds:[a.value.externalAccountId]}).then(t=>{t.content&&t.content.length>0&&(f.value=t.content[0])})}),(t,d)=>{const _=C("ElFormItem"),k=C("ElInput"),c=C("ElForm");return y(),x(c,{ref_key:"formRef",ref:o,model:a.value,"label-position":"top",rules:E.value},{default:l(()=>{var i;return[e(_,{label:"云平台"},{default:l(()=>[f.value?(y(),x(N,{key:0,disabled:"",onChange:v,"model-value":f.value.providerId},null,8,["model-value"])):S("",!0)]),_:1}),e(_,{label:"云账号名称",prop:"name"},{default:l(()=>[e(k,{modelValue:a.value.name,"onUpdate:modelValue":d[0]||(d[0]=b=>a.value.name=b)},null,8,["modelValue"])]),_:1}),p.value?(y(),x(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(i=p.value)==null?void 0:i.accountFormMetaData,modelValue:a.value.properties,"onUpdate:modelValue":d[1]||(d[1]=b=>a.value.properties=b)},null,8,["form-meta-data","modelValue"])):S("",!0),e(_,{label:"云账号描述",prop:"description"},{default:l(()=>[e(k,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":d[2]||(d[2]=b=>a.value.description=b)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},ce={style:{"margin-left":"2px"}},fe={__name:"AccountState",props:{state:{required:!0}},setup(A){const V=A,a={CONNECTED:{name:"已连接",icon:"Check",type:"success"},CONNECTION_LOST:{name:"失去连接",icon:"Warning",type:"warning"},CREDENTIAL_EXPIRED:{name:"凭证失效",icon:"Close",type:"danger"}},o=te(()=>{let r=a[V.state];return r===void 0&&(r={name:V.state,icon:"QuestionFilled",type:"warning"}),r});return(r,I)=>(y(),x(R(re),{size:"small",type:o.value.type,style:{"font-size":"12px"}},{default:l(()=>[e(R(le),{class:oe(o.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(y(),x(ne(o.value.icon)))]),_:1},8,["class"]),O("span",ce,B(o.value.name),1)]),_:1},8,["type"]))}},ve={style:{"margin-bottom":"10px"}},Oe={__name:"ExternalAccount",setup(A){const V=ee(),a=n({}),o=n([]),r=n(),I=n(!1);function E(){return o.value.map(u=>u.id)}function f(u){o.value=u}const p=n(!1),v=n(),t=n(!1),d=n({providerId:void 0,name:void 0,description:void 0,properties:{}});function _(){p.value=!0}function k(){v.value.validate((u,m)=>{u&&(t.value=!0,W(d.value).then(()=>{p.value=!1,r.value.fetchData()}).finally(()=>{t.value=!1}))})}const c=n(),i=n(),b=n(!1),F=n({externalAccountId:void 0,name:void 0,description:void 0,properties:{}});function $(u){F.value.externalAccountId=u.id,F.value.name=u.name,F.value.description=u.description,F.value.properties=u.properties,c.value=!0}function P(){i.value.validate(u=>{u&&(b.value=!0,X(F.value).then(m=>{c.value=!1,r.value.fetchData()}).finally(()=>{b.value=!1}))})}function L(){o.value.length!==0&&(I.value=!0,K({jobType:"SYNCHRONIZE_ACCOUNTS",jobParameters:{accountIds:E()}}).then(u=>{V.setActiveJobId(u.jobId),r.value.fetchData()}).finally(()=>{I.value=!1}))}function M(){o.value.length!==0&&Y({accountIds:E()}).then(u=>{r.value.fetchData()})}function J(){o.value.length!==0&&Z({accountIds:E()}).then(u=>{r.value.fetchData()})}function j(){o.value.length!==0&&G({externalAccountIds:E()}).then(u=>{r.value.fetchData()})}return(u,m)=>{const g=C("ElTableColumn"),z=C("ElButton");return y(),ue(de,null,[O("div",ve,[e(h,{type:"primary",onClick:_},{default:l(()=>[D("创建")]),_:1}),e(h,{disabled:o.value.length===0,plain:"",loading:I.value,onClick:L},{default:l(()=>[D("同步")]),_:1},8,["disabled","loading"]),e(h,{disabled:o.value.length===0,type:"success",plain:"",onClick:M},{default:l(()=>[D("启用")]),_:1},8,["disabled"]),e(h,{disabled:o.value.length===0,type:"danger",plain:"",onClick:J},{default:l(()=>[D("禁用")]),_:1},8,["disabled"]),e(R(se),{title:"确认删除",onConfirm:j},{reference:l(()=>[e(h,{disabled:o.value.length===0,type:"danger",plain:""},{default:l(()=>[D("删除")]),_:1},8,["disabled"])]),_:1}),e(R(ie),{style:{float:"right",width:"20%"},modelValue:a.value.search,"onUpdate:modelValue":m[0]||(m[0]=s=>a.value.search=s),"suffix-icon":"search"},null,8,["modelValue"])]),e(Q,{ref_key:"accountTableRef",ref:r,"paging-request":a.value,"remote-method":R(U),onSelectionChange:f},{default:l(()=>[e(g,{type:"selection","reserve-selection":""}),e(g,{prop:"name",label:"名称",sortable:"custom"}),e(g,{prop:"providerId",label:"云平台",sortable:"custom"},{default:l(s=>[D(B(s.row.providerName),1)]),_:1}),e(g,{prop:"state",label:"状态",sortable:"custom"},{default:l(s=>[e(fe,{state:s.row.state},null,8,["state"])]),_:1}),e(g,{prop:"balance",label:"余额",sortable:"custom"}),e(g,{prop:"description",label:"描述"}),e(g,{prop:"disabled",label:"是否禁用",formatter:(s,_e,H,be)=>H?"是":"否"},null,8,["formatter"]),e(g,{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(g,null,{default:l(s=>[e(z,{link:"",type:"primary",onClick:()=>$(s.row)},{default:l(()=>[D("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e(w,{loading:t.value,modelValue:p.value,"onUpdate:modelValue":m[2]||(m[2]=s=>p.value=s),title:"创建云账号",onOnConfirm:k},{default:l(()=>[e(me,{ref_key:"createFormRef",ref:v,modelValue:d.value,"onUpdate:modelValue":m[1]||(m[1]=s=>d.value=s)},null,8,["modelValue"])]),_:1},8,["loading","modelValue"]),e(w,{loading:b.value,modelValue:c.value,"onUpdate:modelValue":m[4]||(m[4]=s=>c.value=s),title:"编辑云账号",onOnConfirm:P},{default:l(()=>[c.value?(y(),x(pe,{key:0,ref_key:"updateFormRef",ref:i,modelValue:F.value,"onUpdate:modelValue":m[3]||(m[3]=s=>F.value=s)},null,8,["modelValue"])):S("",!0)]),_:1},8,["loading","modelValue"])],64)}}};export{Oe as default};
