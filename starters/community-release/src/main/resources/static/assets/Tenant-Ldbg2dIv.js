import{_ as Z}from"./StratoTable-CDLvuijz.js";import{_ as ee,c as pe,u as fe,e as ve,d as ce,a as ge,b as Ve}from"./TenantTreeSelector-D1-Nh39D.js";import{S as F}from"./StratoButton-BbyvpoLv.js";import{_ as L}from"./StratoDrawer-SANI4yOp.js";import{a7 as z,r as d,y as j,o as b,q as x,w as a,e,u as o,E as _,f as Q,j as te,ab as K,n as y,b as G,F as Y,v as O,d as q,O as le,P as U,m as _e,B as ae,i as S,t as W}from"./index-CGSAaZ7c.js";import{s as h}from"./request-BLvKnTIl.js";import{S as ue}from"./StratoCodeBlock-C9u6aQu2.js";import{_ as oe}from"./UserSelector-D6CrvvR3.js";import{_ as ne}from"./ProviderSelector-DMIPIlb1.js";import{_ as re}from"./AccountSelector-DEw35b-n.js";import{_ as se}from"./CategorySelector-CtGGYw3i.js";import{_ as de}from"./TagValueSelectorGroup-ARuF-rHD.js";import{_ as ye}from"./StratoSelector-CcCz7NMM.js";import"./StratoPagingSelector-BVtmGqMc.js";import"./user-zWqZjtFx.js";import"./resource-ChSpNJ4i.js";import"./account-B2XyNJSy.js";import"./AccountContext-CRGbKwzU.js";import"./tag-BnHK6w2S.js";const be={__name:"CreateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(v){p.value.validate(v)}const n=d({parentId:[{required:!0,message:"请选择父级租户"}],name:[{required:!0,message:"请输入租户名称"}]});return j(()=>{}),(v,u)=>(b(),x(o(te),{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(Q),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"父级租户",prop:"parentId"},{default:a(()=>[e(ee,{modelValue:l.value.parentId,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.parentId=t)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(Q),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[2]||(u[2]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ee={__name:"UpdateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(v){p.value.validate(v)}const n=d({name:[{required:!0,message:"请输入租户名称"}]});return j(()=>{}),(v,u)=>(b(),x(o(te),{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(Q),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(Q),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ie=r=>h({url:"/identity-service/describe-rules",method:"post",data:r}),Ne=r=>h({url:"/identity-service/create-rule",method:"post",data:r}),Ue=r=>h({url:"/identity-service/update-rule",method:"post",data:r}),xe=r=>h({url:"/identity-service/create-naming-rule",method:"post",data:r}),Ce=r=>h({url:"/identity-service/update-naming-rule",method:"post",data:r}),Re=r=>h({url:"/identity-service/delete-rules",method:"post",data:r}),Te={__name:"CreateRuleForm",props:K({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(v){p.value.validate(v)}const n=d({tenantId:[{required:!0,message:"请选择租户"}],type:[{required:!0,message:"请输入规则类型"}],name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return j(()=>{}),(v,u)=>{const t=y("ElInput"),m=y("ElOption"),f=y("ElSelect"),s=y("ElInputNumber"),D=y("ElForm");return b(),x(D,{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":u[0]||(u[0]=N=>l.value.tenantId=N)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则类型",prop:"type"},{default:a(()=>[e(t,{modelValue:l.value.type,"onUpdate:modelValue":u[1]||(u[1]=N=>l.value.type=N),placeholder:"请输入规则类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[2]||(u[2]=N=>l.value.name=N),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[3]||(u[3]=N=>l.value.script=N),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),G(Y,{key:0},[e(o(_),{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(f,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[4]||(u[4]=N=>l.value.suffixType=N),placeholder:"请选择后缀类型"},{default:a(()=>[e(m,{key:"NONE",value:"NONE",label:"无后缀"}),e(m,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(m,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(m,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),x(o(_),{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(s,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[5]||(u[5]=N=>l.value.suffixLength=N),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):O("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),x(o(_),{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(s,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[6]||(u[6]=N=>l.value.suffixStartNumber=N),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):O("",!0)],64)):O("",!0)]),_:1},8,["model","rules"])}}},ke={__name:"UpdateRuleForm",props:K({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(v){p.value.validate(v)}const n=d({name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return j(()=>{}),(v,u)=>{const t=y("ElInput"),m=y("ElFormItem"),f=y("ElOption"),s=y("ElSelect"),D=y("ElInputNumber"),N=y("ElForm");return b(),x(N,{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(m,{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=k=>l.value.name=k),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[1]||(u[1]=k=>l.value.script=k),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),G(Y,{key:0},[e(m,{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(s,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[2]||(u[2]=k=>l.value.suffixType=k),placeholder:"请选择后缀类型"},{default:a(()=>[e(f,{key:"NONE",value:"NONE",label:"无后缀"}),e(f,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(f,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(f,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),x(m,{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(D,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[3]||(u[3]=k=>l.value.suffixLength=k),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):O("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),x(m,{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(D,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[4]||(u[4]=k=>l.value.suffixStartNumber=k),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):O("",!0)],64)):O("",!0)]),_:1},8,["model","rules"])}}},De={style:{"margin-bottom":"10px",height:"32px"}},we=q("span",{style:{"font-size":"12px"}},"创建",-1),he=q("span",{style:{"font-size":"12px"}},"编辑",-1),Se=q("span",{style:{"font-size":"12px"}},"删除",-1),Fe={__name:"Rule",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),p=d(!1),g=d(!1),n=d([]),v=d({tenantIds:V.tenantIds}),u=d(),t=d({}),m=d(!1),f=d(),s=d({}),D=d(!1);function N(w){n.value=w}function k(){return n.value.map(w=>w.id)}function R(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),p.value=!0}function M(){n.value.length===1&&(D.value=n.value[0].isNamingRule,s.value={ruleId:n.value[0].id,name:n.value[0].name,script:n.value[0].script,suffixType:n.value[0].suffixType,suffixLength:n.value[0].suffixLength,suffixStartNumber:n.value[0].suffixStartNumber},g.value=!0)}function J(){u.value.validate((w,E)=>{if(!w)return;(m.value?xe:Ne)(t.value).then(C=>{l.value.fetchData(),p.value=!1})})}function H(){f.value.validate((w,E)=>{if(!w)return;(D.value?Ce:Ue)(s.value).then(C=>{l.value.fetchData(),g.value=!1})})}function P(){const E={ruleIds:k()};Re(E).then($=>{l.value.fetchData()})}return(w,E)=>{const $=y("ElRadioButton"),C=y("ElRadioGroup");return b(),G(Y,null,[q("div",De,[e(F,{size:"small",type:"primary",onClick:R},{default:a(()=>[we]),_:1}),e(F,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:M},{default:a(()=>[he]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:P},{reference:a(()=>[e(F,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[Se]),_:1},8,["disabled"])]),_:1}),e(o(Q),{style:{float:"right",width:"20%"},modelValue:v.value.search,"onUpdate:modelValue":E[0]||(E[0]=c=>v.value.search=c),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":v.value,"remote-method":o(Ie),onSelectionChange:N},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"type",label:"类型",sortable:"custom"}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"isNamingRule",label:"是否命名规则",formatter:(c,A,B,I)=>B?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e(L,{modelValue:p.value,"onUpdate:modelValue":E[3]||(E[3]=c=>p.value=c),title:"创建规则",onOnConfirm:J,size:"600"},{default:a(()=>[e(C,{modelValue:m.value,"onUpdate:modelValue":E[1]||(E[1]=c=>m.value=c),style:{"margin-bottom":"12px"}},{default:a(()=>[e($,{label:"普通规则",value:!1}),e($,{label:"命名规则",value:!0})]),_:1},8,["modelValue"]),e(Te,{ref_key:"createFormRef",ref:u,"is-naming-rule":m.value,modelValue:t.value,"onUpdate:modelValue":E[2]||(E[2]=c=>t.value=c)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"]),e(L,{modelValue:g.value,"onUpdate:modelValue":E[5]||(E[5]=c=>g.value=c),title:"编辑规则",onOnConfirm:H,size:"600"},{default:a(()=>[e(ke,{"is-naming-rule":D.value,ref_key:"updateFormRef",ref:f,modelValue:s.value,"onUpdate:modelValue":E[4]||(E[4]=c=>s.value=c)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"])],64)}}},qe=r=>h({url:"/resource-service/describe-resource-usage-limits",method:"post",data:r}),Me=r=>h({url:"/resource-service/describe-usage-types",method:"post",data:r}),Oe=r=>h({url:"/resource-service/create-resource-usage-limit",method:"post",data:r}),$e=r=>h({url:"/resource-service/update-resource-usage-limit",method:"post",data:r}),Le=r=>h({url:"/resource-service/enable-resource-usage-limits",method:"post",data:r}),ze=r=>h({url:"/resource-service/disable-resource-usage-limits",method:"post",data:r}),Ae=r=>h({url:"/resource-service/delete-resource-usage-limits",method:"post",data:r}),Be={__name:"UsageTypeSelector",props:K({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{},modelModifiers:{},usageTypeName:{},usageTypeNameModifiers:{}}),emits:K(["change"],["update:modelValue","update:usageTypeName"]),setup(r,{emit:V}){const l=z(r,"modelValue"),p=z(r,"usageTypeName"),g=r,n=V;function v(t){p.value=t.usageTypeName,n("change",t)}const u=d({});return _e(g,()=>{u.value.providerIds=g.providerIds,u.value.resourceCategories=g.resourceCategories},{immediate:!0}),(t,m)=>(b(),x(ye,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=f=>l.value=f),onChange:v,"list-getter":f=>f.usageTypes,"value-getter":f=>f.usageType,"label-getter":f=>f.usageTypeName,"remote-method":o(Me),request:u.value},null,8,["modelValue","list-getter","value-getter","label-getter","remote-method","request"]))}},ie={__name:"LimitItemSelectorGroup",props:K({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{required:!0,type:Array,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue");function p(v){l.value.push({usageType:v.usageType,usageTypeName:v.usageTypeName,limitValue:v.limitValue})}function g(v){const u=l.value.indexOf(v);u>=0&&l.value.splice(u,1)}function n(v,u,t){if(!u||u.length===0)return t();for(let m of u)if(!m.usageType||!m.limitValue)return t(new Error("配额上限未完成填写"));return t()}return V({validate:n}),(v,u)=>{const t=y("ElTag"),m=y("ElSpace"),f=y("ElInput"),s=y("ElCol"),D=y("ElRow"),N=y("ElButton"),k=y("ElPopover");return b(),x(k,{width:"450",trigger:"click",teleported:!1},{reference:a(()=>[e(f,{plain:"","suffix-icon":"ArrowDown"},{prefix:a(()=>[e(m,{alignment:"normal",wrap:""},{default:a(()=>[(b(!0),G(Y,null,ae(l.value,R=>(b(),x(t,{closable:"",onClose:()=>g(R)},{default:a(()=>[S(W((R.usageTypeName?R.usageTypeName:"?")+":"+(R.limitValue?R.limitValue:"?")),1)]),_:2},1032,["onClose"]))),256))]),_:1})]),_:1})]),default:a(()=>[q("div",null,[(b(!0),G(Y,null,ae(l.value,R=>(b(),x(D,{gutter:12,style:{"margin-bottom":"6px"}},{default:a(()=>[e(s,{span:10},{default:a(()=>[e(Be,{"provider-ids":r.providerIds,"resource-categories":r.resourceCategories,modelValue:R.usageType,"onUpdate:modelValue":M=>R.usageType=M,"usage-type-name":R.usageTypeName,"onUpdate:usageTypeName":M=>R.usageTypeName=M},null,8,["provider-ids","resource-categories","modelValue","onUpdate:modelValue","usage-type-name","onUpdate:usageTypeName"])]),_:2},1024),e(s,{span:14},{default:a(()=>[e(f,{modelValue:R.limitValue,"onUpdate:modelValue":M=>R.limitValue=M},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),e(N,{style:{width:"100%","margin-top":"6px"},icon:"Plus",onClick:u[0]||(u[0]=()=>p({}))})]),_:1})}}},Qe={__name:"CreateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(u){p.value.validate(u)}const n=d(),v=d({tenantId:[{required:!0,message:"请选择租户"}],name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var f;return(f=n.value)==null?void 0:f.validate(u,t,m)},trigger:"change"}]});return j(()=>{}),(u,t)=>{const m=y("ElInput"),f=y("ElForm");return b(),x(f,{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:v.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.tenantId=s)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Ge={__name:"UpdateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=z(r,"modelValue"),p=d();V({validate:g});function g(u){p.value.validate(u)}const n=d(),v=d({name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var f;return(f=n.value)==null?void 0:f.validate(u,t,m)},trigger:"change"}]});return j(()=>{}),(u,t)=>{const m=y("ElInput"),f=y("ElForm");return b(),x(f,{ref_key:"formRef",ref:p,model:l.value,"label-position":"top",rules:v.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Ye={style:{"margin-bottom":"10px",height:"32px"}},Pe=q("span",{style:{"font-size":"12px"}},"创建",-1),je=q("span",{style:{"font-size":"12px"}},"编辑",-1),Je=q("span",{style:{"font-size":"12px"}},"启用",-1),He=q("span",{style:{"font-size":"12px"}},"禁用",-1),Ke=q("span",{style:{"font-size":"12px"}},"删除",-1),We={__name:"ResourceUsageLimit",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),p=d(!1),g=d(!1),n=d([]),v=d({tenantIds:V.tenantIds}),u=d(),t=d({tags:[],items:[]}),m=d(),f=d({});function s(C){n.value=C}function D(){return n.value.map(C=>C.id)}function N(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),p.value=!0}function k(){n.value.length===1&&(f.value={limitId:n.value[0].id,name:n.value[0].name,description:n.value[0].description,ownerIds:n.value[0].ownerIds,providerIds:n.value[0].providerIds,accountIds:n.value[0].accountIds,resourceCategories:n.value[0].resourceCategories,resourceTypes:n.value[0].resourceTypes,tags:n.value[0].tags?n.value[0].tags:[],items:n.value[0].items?n.value[0].items:[]},g.value=!0)}function R(){u.value.validate(C=>{C&&Oe(t.value).then(()=>{l.value.fetchData(),p.value=!1})})}function M(){m.value.validate(C=>{C&&$e(f.value).then(()=>{l.value.fetchData(),g.value=!1})})}function J(){const c={limitIds:D()};Ae(c).then(()=>{l.value.fetchData()})}function H(){const c={limitIds:D()};Le(c).then(()=>{l.value.fetchData()})}function P(){const c={limitIds:D()};ze(c).then(()=>{l.value.fetchData()})}const w=d(),E=d(!1);function $(C){w.value=C,E.value=!0}return(C,c)=>{const A=y("ElButton"),B=y("ElText"),I=y("ElTable");return b(),G(Y,null,[q("div",Ye,[e(F,{size:"small",type:"primary",onClick:N},{default:a(()=>[Pe]),_:1}),e(F,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:k},{default:a(()=>[je]),_:1},8,["disabled"]),e(F,{size:"small",disabled:n.value.length===0,onClick:H,type:"success",plain:""},{default:a(()=>[Je]),_:1},8,["disabled"]),e(F,{size:"small",disabled:n.value.length===0,onClick:P,type:"danger",plain:""},{default:a(()=>[He]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:J},{reference:a(()=>[e(F,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[Ke]),_:1},8,["disabled"])]),_:1}),e(o(Q),{style:{float:"right",width:"20%"},modelValue:v.value.search,"onUpdate:modelValue":c[0]||(c[0]=i=>v.value.search=i),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":v.value,"remote-method":o(qe),onSelectionChange:s},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"description",label:"描述"}),e(o(U),{prop:"disabled",label:"是否禁用",formatter:i=>i.disabled?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(U),null,{default:a(i=>[e(A,{link:"",type:"primary",onClick:()=>$(i.row)},{default:a(()=>[S("查看配额")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e(L,{modelValue:p.value,"onUpdate:modelValue":c[2]||(c[2]=i=>p.value=i),title:"创建配额上限",onOnConfirm:R,size:"600"},{default:a(()=>[e(Qe,{ref_key:"createFormRef",ref:u,modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=i=>t.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(L,{modelValue:g.value,"onUpdate:modelValue":c[4]||(c[4]=i=>g.value=i),title:"编辑配额上限",onOnConfirm:M,size:"600"},{default:a(()=>[e(Ge,{ref_key:"updateFormRef",ref:m,modelValue:f.value,"onUpdate:modelValue":c[3]||(c[3]=i=>f.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(L,{modelValue:E.value,"onUpdate:modelValue":c[5]||(c[5]=i=>E.value=i),title:"配额详情",size:"600"},{default:a(()=>[e(I,{data:w.value.items},{default:a(()=>[e(o(U),{prop:"usageTypeName",label:"配额项"}),e(o(U),{prop:"usageValue",label:"已使用量"}),e(o(U),{prop:"limitValue",label:"上限"}),e(o(U),{prop:"percentage",label:"百分比"},{default:a(i=>[i.row.percentage<=80?(b(),x(B,{key:0,type:"success"},{default:a(()=>[S(W(i.row.percentage)+"% ",1)]),_:2},1024)):i.row.percentage>80&&i.row.percentage<100?(b(),x(B,{key:1,type:"warning"},{default:a(()=>[S(W(i.row.percentage)+"% ",1)]),_:2},1024)):(b(),x(B,{key:2,type:"danger"},{default:a(()=>[S(W(i.row.percentage)+"% ",1)]),_:2},1024))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}},Xe={style:{"margin-bottom":"10px",height:"32px"}},bl={__name:"Tenant",setup(r){const V=d(),l=d(!1),p=d(!1),g=d([]),n=d({}),v=d(),u=d({}),t=d(),m=d({});function f(I){g.value=I}function s(){return g.value.map(I=>I.id)}function D(){u.value={},l.value=!0}function N(I){m.value={tenantId:I.id,name:I.name,description:I.description},p.value=!0}function k(){v.value.validate(I=>{I&&pe(u.value).then(()=>{V.value.fetchData(),l.value=!1})})}function R(){t.value.validate(I=>{I&&fe(m.value).then(()=>{V.value.fetchData(),p.value=!1})})}function M(){const i={tenantIds:s()};ve(i).then(()=>{V.value.fetchData()})}function J(){const i={tenantIds:s()};ce(i).then(()=>{V.value.fetchData()})}function H(){const i={tenantIds:s()};ge(i).then(()=>{V.value.fetchData()})}const P=d(),w=d(),E=d(!1);function $(I){P.value=[I.id],w.value=I.name,E.value=!0}const C=d(),c=d(),A=d(!1);function B(I){C.value=[I.id],c.value=I.name,A.value=!0}return(I,i)=>{const X=y("ElButton");return b(),G(Y,null,[q("div",Xe,[e(F,{type:"primary",onClick:D},{default:a(()=>[S("创建")]),_:1}),e(F,{disabled:g.value.length===0,type:"success",plain:"",onClick:M},{default:a(()=>[S("启用")]),_:1},8,["disabled"]),e(F,{disabled:g.value.length===0,type:"danger",plain:"",onClick:J},{default:a(()=>[S("禁用")]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:H},{reference:a(()=>[e(F,{disabled:g.value.length===0,type:"danger",plain:""},{default:a(()=>[S("删除")]),_:1},8,["disabled"])]),_:1}),e(o(Q),{style:{float:"right",width:"20%"},modelValue:n.value.search,"onUpdate:modelValue":i[0]||(i[0]=T=>n.value.search=T),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:V,"paging-request":n.value,"remote-method":o(Ve),onSelectionChange:f},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"parentName",label:"父级租户"}),e(o(U),{prop:"description",label:"描述"}),e(o(U),{prop:"disabled",label:"是否禁用",formatter:(T,Ze,me,el)=>me?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(U),{"min-width":"100"},{default:a(T=>[e(X,{link:"",type:"primary",onClick:()=>N(T.row)},{default:a(()=>[S("编辑")]),_:2},1032,["onClick"]),e(X,{link:"",type:"primary",onClick:()=>$(T.row)},{default:a(()=>[S(" 规则管理 ")]),_:2},1032,["onClick"]),e(X,{link:"",type:"primary",onClick:()=>B(T.row)},{default:a(()=>[S(" 配额上限 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e(L,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=T=>l.value=T),title:"创建租户",onOnConfirm:k},{default:a(()=>[l.value?(b(),x(be,{key:0,ref_key:"createTenantFormRef",ref:v,modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=T=>u.value=T)},null,8,["modelValue"])):O("",!0)]),_:1},8,["modelValue"]),e(L,{modelValue:p.value,"onUpdate:modelValue":i[4]||(i[4]=T=>p.value=T),title:"编辑租户",onOnConfirm:R},{default:a(()=>[p.value?(b(),x(Ee,{key:0,ref_key:"updateTenantFormRef",ref:t,modelValue:m.value,"onUpdate:modelValue":i[3]||(i[3]=T=>m.value=T)},null,8,["modelValue"])):O("",!0)]),_:1},8,["modelValue"]),e(L,{modelValue:E.value,"onUpdate:modelValue":i[5]||(i[5]=T=>E.value=T),title:`规则管理(租户:${w.value})`,"no-confirm":"",size:"800"},{default:a(()=>[E.value?(b(),x(Fe,{key:0,"tenant-ids":P.value},null,8,["tenant-ids"])):O("",!0)]),_:1},8,["modelValue","title"]),e(L,{modelValue:A.value,"onUpdate:modelValue":i[6]||(i[6]=T=>A.value=T),title:`配额上限(租户:${c.value})`,"no-confirm":"",size:"800"},{default:a(()=>[A.value?(b(),x(We,{key:0,"tenant-ids":C.value},null,8,["tenant-ids"])):O("",!0)]),_:1},8,["modelValue","title"])],64)}}};export{bl as default};
