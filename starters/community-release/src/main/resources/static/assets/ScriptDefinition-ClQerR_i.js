import{_ as q}from"./StratoDrawer-BQ9z9CYD.js";import{S as E}from"./StratoButton-D7m4JR2l.js";import{_ as h}from"./RemoteScriptDef-GD6_Yjaf.js";import{_ as j}from"./TenantTreeSelector-DrVO4R-0.js";import{_ as z}from"./UserSelector-Bks_jgjv.js";import{v as $}from"./FormUtil-BL1Y36f_.js";import{a8 as B,r as s,n as d,o as S,b as R,e,w as t,F as k,d as F,u as U,i as g,O as P,f as A,t as C,q as x,v as T}from"./index-C_jnbPMf.js";import{c as G,u as H,a as J,e as L,b as Q,d as W}from"./scriptDefinition-BwQHe3UI.js";import{_ as X}from"./StratoTable--zpPaOW_.js";import"./StratoCodeBlock-BwyPwVq9.js";import"./request-BV6gXtmx.js";import"./StratoPagingSelector-BY9rDrJk.js";import"./user-BKxh-AQB.js";const Y={__name:"CreateScriptDefinitionForm",props:{modelValue:{required:!0,type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(y,{expose:V}){const l=B(y,"modelValue"),m=s(),v=s();function I(_){$([m.value,v.value],_)}return V({validate:I}),(_,a)=>{const i=d("ElFormItem"),r=d("ElCol"),p=d("ElInput"),f=d("ElSwitch"),b=d("ElRow"),w=d("ElForm");return S(),R(k,null,[e(w,{ref_key:"formRef",ref:m,model:l.value,"label-position":"top"},{default:t(()=>[e(b,{gutter:24},{default:t(()=>[e(r,{span:12},{default:t(()=>[e(i,{label:"租户",prop:"tenantId",required:"","show-message":!1},{default:t(()=>[e(j,{modelValue:l.value.tenantId,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.tenantId=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(i,{label:"所有者",prop:"ownerId",required:"","show-message":!1},{default:t(()=>[e(z,{modelValue:l.value.ownerId,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.ownerId=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(i,{label:"脚本标识",prop:"definitionKey",required:"","show-message":!1},{default:t(()=>[e(p,{modelValue:l.value.definitionKey,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.definitionKey=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(i,{label:"脚本名称",prop:"name",required:"","show-message":!1},{default:t(()=>[e(p,{modelValue:l.value.name,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.name=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:t(()=>[e(i,{label:"公用脚本",prop:"publicDefinition"},{default:t(()=>[e(f,{modelValue:l.value.publicDefinition,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.publicDefinition=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:6},{default:t(()=>[e(i,{label:"在依赖目标中可见",prop:"visibleInTarget"},{default:t(()=>[e(f,{modelValue:l.value.visibleInTarget,"onUpdate:modelValue":a[5]||(a[5]=o=>l.value.visibleInTarget=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(r,{span:12},{default:t(()=>[e(i,{label:"描述",prop:"description"},{default:t(()=>[e(p,{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":a[6]||(a[6]=o=>l.value.description=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(h,{ref_key:"scriptDefFormRef",ref:v,modelValue:l.value.remoteScriptDef,"onUpdate:modelValue":a[7]||(a[7]=o=>l.value.remoteScriptDef=o)},null,8,["modelValue"])],64)}}},Z={__name:"UpdateScriptDefinitionForm",props:{modelValue:{required:!0,type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(y,{expose:V}){const l=B(y,"modelValue"),m=s(),v=s();function I(_){$([m.value,v.value],_)}return V({validate:I}),(_,a)=>{const i=d("ElInput"),r=d("ElFormItem"),p=d("ElCol"),f=d("ElSwitch"),b=d("ElRow"),w=d("ElForm");return S(),R(k,null,[e(w,{ref_key:"formRef",ref:m,model:l.value,"label-position":"top"},{default:t(()=>[e(b,{gutter:24},{default:t(()=>[e(p,{span:12},{default:t(()=>[e(r,{label:"脚本名称",prop:"name",required:"","show-message":!1},{default:t(()=>[e(i,{modelValue:l.value.name,"onUpdate:modelValue":a[0]||(a[0]=o=>l.value.name=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(r,{label:"公用脚本",prop:"publicDefinition"},{default:t(()=>[e(f,{modelValue:l.value.publicDefinition,"onUpdate:modelValue":a[1]||(a[1]=o=>l.value.publicDefinition=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:t(()=>[e(r,{label:"在依赖目标中可见",prop:"visibleInTarget"},{default:t(()=>[e(f,{modelValue:l.value.visibleInTarget,"onUpdate:modelValue":a[2]||(a[2]=o=>l.value.visibleInTarget=o)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:t(()=>[e(r,{label:"描述",prop:"description"},{default:t(()=>[e(i,{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":a[3]||(a[3]=o=>l.value.description=o)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),e(h,{ref_key:"scriptDefFormRef",ref:v,modelValue:l.value.remoteScriptDef,"onUpdate:modelValue":a[4]||(a[4]=o=>l.value.remoteScriptDef=o)},null,8,["modelValue"])],64)}}},ee={style:{"margin-bottom":"10px",height:"32px"}},ce={__name:"ScriptDefinition",setup(y){const V=s({}),l=s([]),m=s();function v(){return l.value.map(c=>c.id)}function I(c){l.value=c}const _=s(),a=s(!1),i=s();function r(){i.value={remoteScriptDef:{remoteScript:{},customForm:{items:[]}}},a.value=!0}const p=s(),f=s(!1),b=s();function w(){l.value.length!==0&&(b.value={scriptDefinitionId:l.value[0].id,name:l.value[0].name,description:l.value[0].description,publicDefinition:l.value[0].publicDefinition,visibleInTarget:l.value[0].visibleInTarget,remoteScriptDef:l.value[0].remoteScriptDef},f.value=!0)}function o(){_.value.validate(c=>{c&&G(i.value).then(()=>{a.value=!1,m.value.fetchData()})})}function N(){p.value.validate(c=>{c&&H(b.value).then(()=>{f.value=!1,m.value.fetchData()})})}function O(){if(l.value.length===0)return;const u={scriptDefinitionIds:v()};J(u).then(()=>{m.value.fetchData()})}function K(){if(l.value.length===0)return;const u={scriptDefinitionIds:v()};L(u).then(()=>{m.value.fetchData()})}function M(){if(l.value.length===0)return;const u={scriptDefinitionIds:v()};Q(u).then(()=>{m.value.fetchData()})}return(c,u)=>{const D=d("ElTableColumn");return S(),R(k,null,[F("div",ee,[e(E,{type:"primary",onClick:r},{default:t(()=>[g("新建")]),_:1}),e(E,{onClick:w,disabled:l.value.length!==1,"disabled-message":"请选择且只选择一项"},{default:t(()=>[g(" 编辑 ")]),_:1},8,["disabled"]),e(E,{disabled:l.value.length===0,type:"success",plain:"",onClick:K},{default:t(()=>[g(" 启用 ")]),_:1},8,["disabled"]),e(E,{disabled:l.value.length===0,type:"warning",plain:"",onClick:M},{default:t(()=>[g(" 禁用 ")]),_:1},8,["disabled"]),e(U(P),{title:"确认删除",onConfirm:O},{reference:t(()=>[e(E,{disabled:l.value.length===0,type:"danger",plain:""},{default:t(()=>[g(" 删除 ")]),_:1},8,["disabled"])]),_:1}),e(U(A),{style:{float:"right",width:"20%"},modelValue:V.value.search,"onUpdate:modelValue":u[0]||(u[0]=n=>V.value.search=n),"suffix-icon":"search"},null,8,["modelValue"])]),e(X,{ref_key:"tableRef",ref:m,"paging-request":V.value,"remote-method":U(W),onSelectionChange:I},{default:t(()=>[e(D,{type:"selection","reserve-selection":""}),e(D,{prop:"definitionKey",label:"脚本标识",sortable:"custom"}),e(D,{prop:"name",label:"脚本名称",sortable:"custom"}),e(D,{prop:"publicDefinition",label:"公用脚本",sortable:"custom"},{default:t(n=>[F("span",null,C(n.row.publicDefinition?"是":"否"),1)]),_:1}),e(D,{prop:"visibleInTarget",label:"在依赖目标中可见",sortable:"custom"},{default:t(n=>[F("span",null,C(n.row.visibleInTarget?"是":"否"),1)]),_:1}),e(D,{prop:"disabled",label:"是否禁用",sortable:"custom"},{default:t(n=>[F("span",null,C(n.row.disabled?"是":"否"),1)]),_:1}),e(D,{prop:"ownerId",label:"所有者",sortable:"custom"},{default:t(n=>[g(C(n.row.ownerRealName),1)]),_:1})]),_:1},8,["paging-request","remote-method"]),e(q,{modelValue:a.value,"onUpdate:modelValue":u[2]||(u[2]=n=>a.value=n),title:"新建脚本定义",size:"1200",onOnConfirm:o},{default:t(()=>[a.value?(S(),x(Y,{key:0,ref_key:"createFormRef",ref:_,modelValue:i.value,"onUpdate:modelValue":u[1]||(u[1]=n=>i.value=n)},null,8,["modelValue"])):T("",!0)]),_:1},8,["modelValue"]),e(q,{modelValue:f.value,"onUpdate:modelValue":u[4]||(u[4]=n=>f.value=n),title:"编辑脚本定义",size:"1200",onOnConfirm:N},{default:t(()=>[f.value?(S(),x(Z,{key:0,ref_key:"updateFormRef",ref:p,modelValue:b.value,"onUpdate:modelValue":u[3]||(u[3]=n=>b.value=n)},null,8,["modelValue"])):T("",!0)]),_:1},8,["modelValue"])],64)}}};export{ce as default};
