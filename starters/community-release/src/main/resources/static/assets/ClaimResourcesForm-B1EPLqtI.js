import{A as X,o as c,q as V,w as o,e,u as h,a2 as Z,a3 as ee,I as le,d as S,t as A,a4 as oe,a8 as k,r as E,y as O,n,i as $,ae as Y,j as B,v as R,ac as U,m as z,b as D,F,B as M,af as P,E as L}from"./index-C_jnbPMf.js";import{c as j,b as x,_ as ae}from"./ResourceSelector-D-bu7cxQ.js";import{c as G,a as Q,b as W}from"./CreateResourceForm-CPnav3GR.js";import{l as H,m as te,h as re,n as ue}from"./resource-DdTtSOFP.js";import{l as J}from"./request-BV6gXtmx.js";import{_ as ne}from"./StratoDynamicForm-BeoKTVDl.js";import{u as se}from"./IpState-yQwbBpiP.js";import{_ as de}from"./StratoSelector-Csy36wxr.js";import{_ as ce}from"./UserSelector-Bks_jgjv.js";import{_ as ie}from"./TenantTreeSelector-DrVO4R-0.js";import{_ as me}from"./StratoPagingSelector-BY9rDrJk.js";const pe={style:{"margin-left":"2px"}},Fe={__name:"RelationshipState",props:{state:{required:!0}},setup(u){const v=u,l={NO_STATE:{name:"未关联",icon:"Clock",type:"info"},CONNECTED:{name:"已关联",icon:"Connection",type:"success"},ERROR:{name:"错误",icon:"Warning",type:"danger"},DISCONNECTED:{name:"已解除关联",icon:"CircleClose",type:"warning"},CONNECTING:{name:"正在关联",icon:"Loading"},DISCONNECTING:{name:"正在解除关联",icon:"Loading"},LOST:{name:"关系遗失",icon:"Warning",type:"warning"}},d=X(()=>{let i=l[v.state];return i===void 0&&(i={name:v.state,icon:"QuestionFilled",type:"warning"}),i});return(i,m)=>(c(),V(h(oe),{type:d.value.type,style:{"font-size":"12px"}},{default:o(()=>[e(h(Z),{class:ee(d.value.icon==="Loading"?"is-loading":"")},{default:o(()=>[(c(),V(le(d.value.icon)))]),_:1},8,["class"]),S("span",pe,A(d.value.name),1)]),_:1},8,["type"]))}},xe={__name:"ConnectResourcesForm",props:{modelValue:{required:!0,default:G},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue");j();const d=E(),i=E(),m=E(),t=E();O(()=>{!l.value||!l.value.relationshipTypeId||H({relationshipTypeId:l.value.relationshipTypeId}).then(s=>{t.value=s.spec})});const p=E({sourceResourceId:[{required:!0,message:"请选择资源"}],targetResourceId:[{required:!0,message:"请选择资源"}]});function I(s){d.value.validate(s)}function f(){return J.cloneDeep(G)}return v({validate:I,getDefaultFormData:f}),(s,r)=>{const C=n("ElFormItem"),b=n("ElIcon"),w=n("ElText");return t.value?(c(),V(h(B),{key:0,ref_key:"formRef",ref:d,model:l.value,"label-position":"top",rules:p.value},{default:o(()=>{var g,_;return[e(C,{label:(g=i.value)==null?void 0:g.getCategoryName(),prop:"sourceResourceId"},{default:o(()=>[e(x,{ref_key:"sourceResourceRef",ref:i,modelValue:l.value.sourceResourceId,"onUpdate:modelValue":r[0]||(r[0]=a=>l.value.sourceResourceId=a),"resource-type-id":t.value.sourceResourceTypeId,"disabled-flag-getter":a=>{var y;return!((y=t.value.allowedSourceStates)!=null&&y.includes(a.state))||a.recycled}},null,8,["modelValue","resource-type-id","disabled-flag-getter"])]),_:1},8,["label"]),e(C,null,{default:o(()=>[e(w,{type:"success"},{default:o(()=>[$("挂载到"),e(b,null,{default:o(()=>[e(h(Y))]),_:1})]),_:1})]),_:1}),e(C,{label:(_=m.value)==null?void 0:_.getCategoryName(),prop:"targetResourceId"},{default:o(()=>[e(x,{ref_key:"targetResourceRef",ref:m,modelValue:l.value.targetResourceId,"onUpdate:modelValue":r[1]||(r[1]=a=>l.value.targetResourceId=a),"resource-type-id":t.value.targetResourceTypeId,"disabled-flag-getter":a=>{var y;return!((y=t.value.allowedTargetStates)!=null&&y.includes(a.state))||a.recycled}},null,8,["modelValue","resource-type-id","disabled-flag-getter"])]),_:1},8,["label"]),e(Q,{"relationship-type-id":l.value.relationshipTypeId,modelValue:l.value.relationshipInputs,"onUpdate:modelValue":r[2]||(r[2]=a=>l.value.relationshipInputs=a)},null,8,["relationship-type-id","modelValue"])]}),_:1},8,["model","rules"])):R("",!0)}}},qe={__name:"ChangeEssentialTargetForm",props:{modelValue:{required:!0,default:W},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue");j();const d=E(),i=E(),m=E(),t=E();O(()=>{!l.value||!l.value.relationshipTypeId||H({relationshipTypeId:l.value.relationshipTypeId}).then(s=>{t.value=s.spec})});const p=E({sourceId:[{required:!0,message:"请选择资源"}],newTargetId:[{required:!0,message:"请选择资源"}]});function I(s){d.value.validate(s)}function f(){return J.cloneDeep(W)}return v({validate:I,getDefaultFormData:f}),(s,r)=>{const C=n("ElFormItem"),b=n("ElIcon"),w=n("ElText");return t.value?(c(),V(h(B),{key:0,ref_key:"formRef",ref:d,model:l.value,"label-position":"top",rules:p.value},{default:o(()=>{var g,_;return[e(C,{label:(g=i.value)==null?void 0:g.getCategoryName(),prop:"sourceId"},{default:o(()=>[e(x,{ref_key:"sourceResourceRef",ref:i,modelValue:l.value.sourceId,"onUpdate:modelValue":r[0]||(r[0]=a=>l.value.sourceId=a),"resource-type-id":t.value.sourceResourceTypeId,"disabled-flag-getter":a=>{var y;return!((y=t.value.allowedSourceStates)!=null&&y.includes(a.state))||a.recycled}},null,8,["modelValue","resource-type-id","disabled-flag-getter"])]),_:1},8,["label"]),e(C,null,{default:o(()=>[e(w,{type:"success"},{default:o(()=>{var a;return[$("变更"+A((a=m.value)==null?void 0:a.getCategoryName())+" ",1),e(b,null,{default:o(()=>[e(h(Y))]),_:1})]}),_:1})]),_:1}),e(C,{label:(_=m.value)==null?void 0:_.getCategoryName(),prop:"newTargetId"},{default:o(()=>[e(x,{ref_key:"targetResourceRef",ref:m,modelValue:l.value.newTargetId,"onUpdate:modelValue":r[1]||(r[1]=a=>l.value.newTargetId=a),"resource-type-id":t.value.targetResourceTypeId,"isolated-resource-context":t.value.isolatedTargetContext,"disabled-flag-getter":a=>{var y;return!((y=t.value.allowedTargetStates)!=null&&y.includes(a.state))||a.recycled}},null,8,["modelValue","resource-type-id","isolated-resource-context","disabled-flag-getter"])]),_:1},8,["label"]),e(Q,{"relationship-type-id":l.value.relationshipTypeId,modelValue:l.value.relationshipInputs,"onUpdate:modelValue":r[2]||(r[2]=a=>l.value.relationshipInputs=a)},null,8,["relationship-type-id","modelValue"])]}),_:1},8,["model","rules"])):R("",!0)}}},K={__name:"ResourceActionDynamicForm",props:U({resourceId:{required:!0},actionId:{required:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue"),d=u,i=E();v({validate:m});function m(I){i.value.validate(I)}const t=E(),p=se();return z(d,()=>{te({resourceId:d.resourceId,actionId:d.actionId}).then(I=>{t.value=I.formMetaData,p.networkResourceId.value=I.networkResourceId})},{immediate:!0}),(I,f)=>t.value?(c(),V(ne,{key:0,ref_key:"formRef",ref:i,"form-meta-data":t.value,modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=s=>l.value=s)},null,8,["form-meta-data","modelValue"])):R("",!0)}},fe=S("div",{style:{"max-width":"240px"}}," 级联回收指回收依赖该资源的所有连带资源，以级联回收云主机为例， 系统将自动回收挂载到该云主机的数据盘、网卡、弹性IP等连带资源。 若级联回收选择否，系统将保留您的相关连带资源。 ",-1),_e=S("div",{style:{"max-width":"240px"}}," 若立即销毁选择否，系统将仅把资源放入回收站，而不在底层执行实际操作 ",-1),Se={__name:"RecycleResourcesForm",props:U({resourceCategory:{required:!1,default:void 0},destroyable:{required:!1,type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue"),d=u;v({validate:i});function i(I){m.value.validate(I)}const m=E();function t(){l.value.push({resourceId:void 0,recyclingCapabilities:!0,executingDestruction:d.destroyable,destroyParameters:{}})}function p(I){l.value.splice(I,1)}return O(()=>{for(let I of l.value)d.destroyable||(I.executingDestruction=!1,I.recyclingCapabilities=!1)}),(I,f)=>{const s=n("ElDivider"),r=n("ElFormItem"),C=n("ElCol"),b=n("ElIcon"),w=n("ElTooltip"),g=n("ElSwitch"),_=n("ElButton"),a=n("ElRow"),y=n("ElForm");return c(),V(y,{ref_key:"formRef",ref:m,model:l.value,"label-position":"top"},{default:o(()=>[(c(!0),D(F,null,M(l.value,(T,N)=>(c(),D(F,null,[N!==0?(c(),V(s,{key:0})):R("",!0),e(a,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:o(()=>[e(C,{span:14},{default:o(()=>[e(r,{label:`待回收资源${N+1}`,prop:N+".resourceId",required:"","show-message":!1},{default:o(()=>[e(x,{modelValue:T.resourceId,"onUpdate:modelValue":q=>T.resourceId=q,"resource-category":u.resourceCategory},null,8,["modelValue","onUpdate:modelValue","resource-category"])]),_:2},1032,["label","prop"])]),_:2},1024),e(C,{span:4},{default:o(()=>[e(r,null,{label:o(()=>[S("span",null,[$(" 级联回收 "),e(w,null,{content:o(()=>[fe]),default:o(()=>[e(b,{style:{cursor:"pointer"}},{default:o(()=>[e(h(P))]),_:1})]),_:1})])]),default:o(()=>[e(g,{disabled:!u.destroyable,modelValue:T.recyclingCapabilities,"onUpdate:modelValue":q=>T.recyclingCapabilities=q},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(C,{span:4},{default:o(()=>[e(r,null,{label:o(()=>[S("span",null,[$(" 立即销毁 "),e(w,null,{content:o(()=>[_e]),default:o(()=>[e(b,{style:{cursor:"pointer"}},{default:o(()=>[e(h(P))]),_:1})]),_:1})])]),default:o(()=>[e(g,{disabled:!u.destroyable,modelValue:T.executingDestruction,"onUpdate:modelValue":q=>T.executingDestruction=q},null,8,["disabled","modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(C,{span:2},{default:o(()=>[e(_,{style:{float:"right"},size:"small",circle:"",plain:"",icon:"Minus",onClick:()=>p(N)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),u.destroyable&&T.executingDestruction&&T.resourceId?(c(),V(K,{key:1,modelValue:T.destroyParameters,"onUpdate:modelValue":q=>T.destroyParameters=q,"action-id":"DESTROY_RESOURCE","resource-id":T.resourceId},null,8,["modelValue","onUpdate:modelValue","resource-id"])):R("",!0)],64))),256)),e(_,{style:{width:"100%","margin-top":"20px"},onClick:t,plain:"",icon:"Plus"})]),_:1},8,["model"])}}},ge={__name:"ActionSelector",props:U({resourceId:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:U(["change"],["update:modelValue"]),setup(u,{emit:v}){const l=k(u,"modelValue"),d=v;function i(f){d("change",f)}const m=u,t=E({resourceIds:m.resourceId?[m.resourceId]:void 0});z(()=>m.resourceId,()=>{t.value.resourceIds=m.resourceId?[m.resourceId]:void 0});function p(f,s){return s.availableActions&&s.availableActions.length>0?s.availableActions.filter(r=>r.id===f.id).length===0:!0}function I(f){return f.allActions&&f.allActions.length>0?f.allActions.filter(s=>s.id!=="BUILD_RESOURCE"&&s.id!=="DESTROY_RESOURCE"):[]}return(f,s)=>(c(),V(de,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=r=>l.value=r),onChange:i,"list-getter":I,"value-getter":r=>r.id,"label-getter":r=>r.name,"remote-method":h(re),"disabled-option-predicate":p,request:t.value},null,8,["modelValue","value-getter","label-getter","remote-method","request"]))}},$e={__name:"RunResourcesActionForm",props:U({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:[{resourceId:void 0,actionId:void 0,parameters:{}}]},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue");v({validate:d});function d(p){i.value.validate(p)}const i=E();function m(){l.value.push({resourceId:void 0,actionId:void 0,parameters:{}})}function t(p){l.value.splice(p,1)}return(p,I)=>{const f=n("ElDivider"),s=n("ElFormItem"),r=n("ElCol"),C=n("ElButton"),b=n("ElRow"),w=n("ElForm");return c(),V(w,{ref_key:"formRef",ref:i,model:l.value,"label-position":"top"},{default:o(()=>[(c(!0),D(F,null,M(l.value,(g,_)=>(c(),D(F,null,[_!==0?(c(),V(f,{key:0})):R("",!0),e(b,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:o(()=>[e(r,{span:14},{default:o(()=>[e(s,{label:`资源${_+1}`,required:""},{default:o(()=>[e(x,{modelValue:g.resourceId,"onUpdate:modelValue":a=>g.resourceId=a,"resource-category":u.resourceCategory},null,8,["modelValue","onUpdate:modelValue","resource-category"])]),_:2},1032,["label"])]),_:2},1024),e(r,{span:6},{default:o(()=>[g.resourceId?(c(),V(s,{key:0,label:"操作",required:""},{default:o(()=>[e(ge,{modelValue:g.actionId,"onUpdate:modelValue":a=>g.actionId=a,"resource-id":g.resourceId},null,8,["modelValue","onUpdate:modelValue","resource-id"])]),_:2},1024)):R("",!0)]),_:2},1024),e(r,{span:4},{default:o(()=>[e(C,{style:{float:"right"},circle:"",plain:"",size:"small",icon:"Minus",onClick:()=>t(_)},null,8,["onClick"])]),_:2},1024)]),_:2},1024),g.resourceId&&g.actionId?(c(),V(K,{key:1,modelValue:g.parameters,"onUpdate:modelValue":a=>g.parameters=a,"action-id":g.actionId,"resource-id":g.resourceId},null,8,["modelValue","onUpdate:modelValue","action-id","resource-id"])):R("",!0)],64))),256)),u.resourceCategory?(c(),V(C,{key:0,style:{width:"100%","margin-top":"20px"},onClick:m,plain:"",icon:"Plus"})):R("",!0)]),_:1},8,["model"])}}},Ne={__name:"SynchronizeResourcesForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue"),d=E();v({validate:i});function i(t){d.value.validate(t)}const m=E({resourceIds:[{required:!0,message:"请选择资源"}]});return(t,p)=>{const I=n("ElSwitch");return c(),V(h(B),{ref_key:"formRef",ref:d,model:l.value,"label-position":"top",rules:m.value},{default:o(()=>[e(h(L),{label:"同步所有资源",prop:"synchronizeAll"},{default:o(()=>[e(I,{modelValue:l.value.synchronizeAll,"onUpdate:modelValue":p[0]||(p[0]=f=>l.value.synchronizeAll=f)},null,8,["modelValue"])]),_:1}),l.value.synchronizeAll?R("",!0):(c(),V(h(L),{key:0,label:"资源",prop:"resourceIds"},{default:o(()=>[e(x,{multiple:"",modelValue:l.value.resourceIds,"onUpdate:modelValue":p[1]||(p[1]=f=>l.value.resourceIds=f)},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"])}}},Ae={__name:"TransferResourcesForm",props:U({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:[{resourceId:void 0,newOwnerId:void 0,newTenantId:void 0,enableCascadedTransfer:!0}]},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue");v({validate:d});function d(p){i.value.validate(p)}const i=E();function m(){l.value.push({resourceId:void 0,newOwnerId:void 0,newTenantId:void 0,enableCascadedTransfer:!0})}function t(p){l.value.splice(p,1)}return(p,I)=>{const f=n("ElDivider"),s=n("ElFormItem"),r=n("ElCol"),C=n("ElSwitch"),b=n("ElButton"),w=n("ElRow"),g=n("ElForm");return c(),V(g,{ref_key:"formRef",ref:i,model:l.value,"label-position":"top","scroll-to-error":""},{default:o(()=>[(c(!0),D(F,null,M(l.value,(_,a)=>(c(),D(F,null,[a!==0?(c(),V(f,{key:0})):R("",!0),e(w,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:o(()=>[e(r,{span:8},{default:o(()=>[e(s,{prop:a+".resourceId",label:`资源${a+1}`,"show-message":!1},{default:o(()=>[e(x,{modelValue:_.resourceId,"onUpdate:modelValue":y=>_.resourceId=y,"resource-category":u.resourceCategory},null,8,["modelValue","onUpdate:modelValue","resource-category"])]),_:2},1032,["prop","label"])]),_:2},1024),e(r,{span:5},{default:o(()=>[e(s,{prop:a+".newTenantId",label:"租户",required:"","show-message":!1},{default:o(()=>[e(ie,{modelValue:_.newTenantId,"onUpdate:modelValue":y=>_.newTenantId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(r,{span:5},{default:o(()=>[e(s,{prop:a+".newOwnerId",label:"所有者",required:"","show-message":!1},{default:o(()=>[e(ce,{modelValue:_.newOwnerId,"onUpdate:modelValue":y=>_.newOwnerId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(r,{span:3},{default:o(()=>[e(s,{prop:a+".enableCascadedTransfer",label:"级联移交"},{default:o(()=>[e(C,{modelValue:_.enableCascadedTransfer,"onUpdate:modelValue":y=>_.enableCascadedTransfer=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(r,{span:3},{default:o(()=>[e(b,{style:{float:"right"},circle:"",plain:"",size:"small",icon:"Minus",onClick:()=>t(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),u.resourceCategory?(c(),V(b,{key:0,style:{width:"100%","margin-top":"20px"},onClick:m,plain:"",icon:"Plus"})):R("",!0)]),_:1},8,["model"])}}},ye={style:{float:"left"}},ve={style:{float:"right",color:"grey"}},Ie={__name:"UnclaimedResourceSelector",props:U({resourceCategory:{required:!1},placeholder:{required:!1,default:"请选择资源"}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const v=u,l=k(u,"modelValue"),d=E({category:v.resourceCategory,resourceIds:v.multiple?l.value:l.value?[l.value]:void 0});return z(l,()=>{d.value.resourceIds=v.multiple?l.value:l.value?[l.value]:void 0}),(i,m)=>(c(),V(me,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=t=>l.value=t),"paging-request":d.value,"label-getter":t=>t.name,"remote-method":h(ue),placeholder:u.placeholder},{default:o(t=>[S("span",ye,A(t.row.name),1),S("span",ve,[e(ae,{state:t.row.state},null,8,["state"]),$("   "+A(t.row.typeName),1)])]),_:1},8,["modelValue","paging-request","label-getter","remote-method","placeholder"]))}},Me={__name:"ClaimResourcesForm",props:U({resourceCategory:{required:!1,default:void 0}},{modelValue:{required:!0,default:[{resourceId:void 0,enableCascadedClaim:!0}]},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:v}){const l=k(u,"modelValue");v({validate:d});function d(p){i.value.validate(p)}const i=E();function m(){l.value.push({resourceId:void 0,enableCascadedClaim:!0})}function t(p){l.value.splice(p,1)}return(p,I)=>{const f=n("ElDivider"),s=n("ElFormItem"),r=n("ElCol"),C=n("ElSwitch"),b=n("ElButton"),w=n("ElRow"),g=n("ElForm");return c(),V(g,{ref_key:"formRef",ref:i,model:l.value,"label-position":"top","scroll-to-error":""},{default:o(()=>[(c(!0),D(F,null,M(l.value,(_,a)=>(c(),D(F,null,[a!==0?(c(),V(f,{key:0})):R("",!0),e(w,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:o(()=>[e(r,{span:18},{default:o(()=>[e(s,{prop:a+".resourceId",label:`资源${a+1}`,"show-message":!1},{default:o(()=>[e(Ie,{modelValue:_.resourceId,"onUpdate:modelValue":y=>_.resourceId=y,"resource-category":u.resourceCategory},null,8,["modelValue","onUpdate:modelValue","resource-category"])]),_:2},1032,["prop","label"])]),_:2},1024),e(r,{span:3},{default:o(()=>[e(s,{prop:a+".enableCascadedClaim",label:"级联认领"},{default:o(()=>[e(C,{modelValue:_.enableCascadedClaim,"onUpdate:modelValue":y=>_.enableCascadedClaim=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),e(r,{span:3},{default:o(()=>[e(b,{style:{float:"right"},circle:"",plain:"",size:"small",icon:"Minus",onClick:()=>t(a)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),u.resourceCategory?(c(),V(b,{key:0,style:{width:"100%","margin-top":"20px"},onClick:m,plain:"",icon:"Plus"})):R("",!0)]),_:1},8,["model"])}}};export{xe as _,Fe as a,qe as b,Se as c,$e as d,Ne as e,Ae as f,Me as g};
