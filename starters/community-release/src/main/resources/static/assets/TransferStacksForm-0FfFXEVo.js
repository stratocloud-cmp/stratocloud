import{_ as A}from"./StratoPagingSelector-BVtmGqMc.js";import{d as L,g as W}from"./blueprint-QhCWZgai.js";import{ab as B,a7 as N,r as b,o as i,q as k,w as l,d as R,t as F,u as $,y as D,n as o,b as I,e,i as S,v as q,F as x,m as j,B as M,ae as J}from"./index-CGSAaZ7c.js";import{_ as Q}from"./TagValueSelectorGroup-ARuF-rHD.js";import{_ as O}from"./UserSelector-D6CrvvR3.js";import{_ as Y}from"./TenantTreeSelector-D1-Nh39D.js";import{v as X}from"./FormUtil-CO0XXxtf.js";import{u as Z,_ as ee,d as le}from"./CreateResourceForm-BC1EWExE.js";import{s as P}from"./request-BLvKnTIl.js";const te=u=>P({url:"/resource-service/describe-resource-stacks",method:"post",data:u}),Ee=u=>P({url:"/resource-service/update-stack-basics",method:"post",data:u}),we=u=>P({url:"/resource-service/drop-resource-stacks",method:"post",data:u}),ae={style:{float:"left"}},oe={style:{float:"right",color:"grey"}},ne={__name:"BlueprintSelector",props:B({placeholder:{required:!1},multiple:{required:!1,default:!1,type:Boolean},disabled:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const g=N(u,"modelValue"),d=b({});return(t,c)=>(i(),k(A,{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=n=>g.value=n),"paging-request":d.value,"label-getter":n=>n.name,placeholder:u.placeholder,"remote-method":$(L),multiple:u.multiple,disabled:u.disabled,"id-filter-key":"blueprintIds",teleported:""},{default:l(n=>[R("span",ae,F(n.row.name),1),R("span",oe,F(n.row.description),1)]),_:1},8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple","disabled"]))}},ue={key:0,style:{"margin-bottom":"24px"}},re={style:{"margin-bottom":"12px"}},de={key:1,style:{"margin-bottom":"24px"}},se={style:{"margin-bottom":"12px"}},me={__name:"ResourceStackNodeForm",props:B({node:{required:!0},nodes:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u,{expose:g}){const d=N(u,"modelValue"),t=u;function c(f){n.value.validate(f)}g({validate:c});const n=b(),E=Z(),_=b([]),w=b([]);return D(()=>{if(t.node.internalRequirements)for(let f of t.node.internalRequirements)E.addIgnoredTargetTypeId(f.targetResourceTypeId),_.value.push({connectActionName:f.connectActionName,targetNodeName:f.targetNodeName});if(t.nodes){for(let f of t.nodes)if(f.internalRequirements)for(let v of f.internalRequirements)v.targetNodeKey===t.node.nodeKey&&(E.addIgnoredCapabilityTypeId(v.relationshipTypeId),w.value.push({connectActionName:v.connectActionName,sourceNodeName:f.nodeName}))}}),(f,v)=>{const V=o("ElText"),r=o("ElTableColumn"),a=o("ElTable");return i(),I(x,null,[_.value&&_.value.length>0?(i(),I("div",ue,[R("div",re,[e(V,{type:"success"},{default:l(()=>[S(" 依赖于下列节点 ")]),_:1})]),e(a,{data:_.value},{default:l(()=>[e(r,{prop:"connectActionName",label:"关系"}),e(r,{prop:"targetNodeName",label:"节点名称"})]),_:1},8,["data"])])):q("",!0),w.value&&w.value.length>0?(i(),I("div",de,[R("div",se,[e(V,{type:"success"},{default:l(()=>[S(" 被下列节点所依赖 ")]),_:1})]),e(a,{data:w.value},{default:l(()=>[e(r,{prop:"connectActionName",label:"关系"}),e(r,{prop:"sourceNodeName",label:"节点名称"})]),_:1},8,["data"])])):q("",!0),e(ee,{ref_key:"formRef",ref:n,modelValue:d.value,"onUpdate:modelValue":v[0]||(v[0]=p=>d.value=p)},null,8,["modelValue"])],64)}}},he={__name:"CreateStacksForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:g}){const d=b(),t=N(u,"modelValue"),c=b();D(()=>{t.value&&(t.value.blueprintId&&(c.value=t.value.blueprintId),t.value.tags||(t.value.tags=[]))});const n=b(!1);function E(r){var a;r&&r.id!==((a=t.value)==null?void 0:a.blueprintId)&&(n.value=!0,W({blueprintId:r.id}).then(p=>{t.value=p.cmd}).finally(()=>{n.value=!1}))}function _(r){X([d.value,...v.value],r)}g({validate:_});const w=b({blueprintId:[{required:!0,message:"请选择蓝图",trigger:"blur"}],tenantId:[{required:!0,message:"请选择租户",trigger:"blur"}],ownerId:[{required:!0,message:"请选择所有者",trigger:"blur"}],tags:[{validator:(r,a,p)=>{var s;return(s=f.value)==null?void 0:s.validate(r,a,p)},trigger:"change"}]}),f=b(),v=b([]),V=le();return j(()=>{var r;return(r=t.value)==null?void 0:r.tags},()=>{var r;V.tags.value=(r=t.value)==null?void 0:r.tags},{deep:!0,immediate:!0}),(r,a)=>{const p=o("ElFormItem"),s=o("ElCol"),h=o("ElInput"),y=o("ElDatePicker"),C=o("ElInputNumber"),T=o("ElRow"),U=o("ElTabPane"),H=o("ElTabs"),K=o("ElForm");return i(),k(K,{ref_key:"formRef",ref:d,model:t.value,"label-position":"top",rules:w.value},{default:l(()=>[e(p,{label:"蓝图",prop:"blueprintId"},{default:l(()=>[e(ne,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=m=>c.value=m),onChange:E},null,8,["modelValue"])]),_:1}),c.value?(i(),I(x,{key:0},[e(T,{gutter:12},{default:l(()=>[e(s,{span:12},{default:l(()=>[e(p,{label:"租户",prop:"tenantId"},{default:l(()=>[e(Y,{modelValue:t.value.tenantId,"onUpdate:modelValue":a[1]||(a[1]=m=>t.value.tenantId=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(p,{label:"所有者",prop:"ownerId"},{default:l(()=>[e(O,{modelValue:t.value.ownerId,"onUpdate:modelValue":a[2]||(a[2]=m=>t.value.ownerId=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(p,{label:"资源栈名称"},{default:l(()=>[e(h,{modelValue:t.value.name,"onUpdate:modelValue":a[3]||(a[3]=m=>t.value.name=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(p,{label:"到期时间"},{default:l(()=>[e(y,{style:{width:"100%"},type:"datetime",modelValue:t.value.expireTime,"onUpdate:modelValue":a[4]||(a[4]=m=>t.value.expireTime=m),"value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(p,{label:"数量"},{default:l(()=>[e(C,{style:{width:"100%"},min:1,modelValue:t.value.number,"onUpdate:modelValue":a[5]||(a[5]=m=>t.value.number=m)},null,8,["modelValue"])]),_:1})]),_:1}),e(s,{span:12},{default:l(()=>[e(p,{label:"标签",prop:"tags"},{default:l(()=>[t.value.tags&&!n.value?(i(),k(Q,{key:0,ref_key:"tagRef",ref:f,"entry-paging-request":{userGroupTaggable:!0,requiredWhenCreating:!0},modelValue:t.value.tags,"onUpdate:modelValue":a[6]||(a[6]=m=>t.value.tags=m),"default-add-all-entries":!0},null,8,["modelValue"])):q("",!0)]),_:1})]),_:1}),e(s,{span:24},{default:l(()=>[e(p,{label:"描述"},{default:l(()=>[e(h,{type:"textarea",modelValue:t.value.description,"onUpdate:modelValue":a[7]||(a[7]=m=>t.value.description=m)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),n.value?q("",!0):(i(),k(H,{key:0},{default:l(()=>[(i(!0),I(x,null,M(t.value.nodes,m=>(i(),k(U,{label:m.nodeName},{default:l(()=>[e(me,{ref_for:!0,ref_key:"ResourceStackNodeFormRefs",ref:v,node:m,nodes:t.value.nodes,modelValue:m.resourceCmd,"onUpdate:modelValue":G=>m.resourceCmd=G},null,8,["node","nodes","modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]))),256))]),_:1}))],64)):q("",!0)]),_:1},8,["model","rules"])}}},ie={style:{float:"left"}},ce={style:{float:"right",color:"grey"}},z={__name:"ResourceStackSelector",props:B({placeholder:{required:!1},multiple:{required:!1,default:!1,type:Boolean},disabled:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(u){const g=N(u,"modelValue"),d=b({});return(t,c)=>(i(),k(A,{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=n=>g.value=n),"paging-request":d.value,"label-getter":n=>n.name,placeholder:u.placeholder,"remote-method":$(te),multiple:u.multiple,disabled:u.disabled,"id-filter-key":"resourceStackIds",teleported:""},{default:l(n=>[R("span",ie,F(n.row.name),1),R("span",ce,F(n.row.description),1)]),_:1},8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple","disabled"]))}},pe=R("div",{style:{"max-width":"240px"}}," 若立即销毁选择否，系统将仅把资源放入回收站，而不在底层执行实际操作 ",-1),Re={__name:"RecycleStacksForm",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:g}){const d=N(u,"modelValue");g({validate:t});function t(_){c.value.validate(_)}const c=b();function n(){d.value.stacks.push({stackId:void 0,executingDestruction:!0})}function E(_){d.value.stacks.splice(_,1)}return D(()=>{d.value.stacks||(d.value.stacks=[])}),(_,w)=>{const f=o("ElDivider"),v=o("ElFormItem"),V=o("ElCol"),r=o("ElIcon"),a=o("ElTooltip"),p=o("ElSwitch"),s=o("ElButton"),h=o("ElRow"),y=o("ElForm");return i(),k(y,{ref_key:"formRef",ref:c,model:d.value,"label-position":"top"},{default:l(()=>[(i(!0),I(x,null,M(d.value.stacks,(C,T)=>(i(),I(x,null,[T!==0?(i(),k(f,{key:0})):q("",!0),e(h,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:l(()=>[e(V,{span:14},{default:l(()=>[e(v,{label:`待回收资源栈${T+1}`,required:""},{default:l(()=>[e(z,{modelValue:C.stackId,"onUpdate:modelValue":U=>C.stackId=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),e(V,{span:8},{default:l(()=>[e(v,null,{label:l(()=>[R("span",null,[S(" 立即销毁 "),e(a,null,{content:l(()=>[pe]),default:l(()=>[e(r,{style:{cursor:"pointer"}},{default:l(()=>[e($(J))]),_:1})]),_:1})])]),default:l(()=>[e(p,{modelValue:C.executingDestruction,"onUpdate:modelValue":U=>C.executingDestruction=U},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(V,{span:2},{default:l(()=>[e(s,{style:{float:"right"},size:"small",circle:"",plain:"",icon:"Minus",onClick:()=>E(T)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),e(s,{style:{width:"100%","margin-top":"20px"},onClick:n,plain:"",icon:"Plus"})]),_:1},8,["model"])}}},qe={__name:"TransferStacksForm",props:{modelValue:{required:!0,default:{transfers:[{stackId:void 0,newOwnerId:void 0,newTenantId:void 0}]}},modelModifiers:{}},emits:["update:modelValue"],setup(u,{expose:g}){const d=N(u,"modelValue");g({validate:t});function t(_){c.value.validate(_)}const c=b();function n(){d.value.transfers.push({stackId:void 0,newOwnerId:void 0,newTenantId:void 0})}function E(_){d.value.transfers.splice(_,1)}return(_,w)=>{const f=o("ElDivider"),v=o("ElFormItem"),V=o("ElCol"),r=o("ElButton"),a=o("ElRow"),p=o("ElForm");return i(),k(p,{ref_key:"formRef",ref:c,model:d.value,"label-position":"top"},{default:l(()=>[(i(!0),I(x,null,M(d.value.transfers,(s,h)=>(i(),I(x,null,[h!==0?(i(),k(f,{key:0})):q("",!0),e(a,{style:{width:"100%",display:"flex","align-items":"center"},gutter:20},{default:l(()=>[e(V,{span:10},{default:l(()=>[e(v,{label:`待移交资源栈${h+1}`,required:""},{default:l(()=>[e(z,{modelValue:s.stackId,"onUpdate:modelValue":y=>s.stackId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])]),_:2},1024),e(V,{span:6},{default:l(()=>[e(v,{label:"租户"},{default:l(()=>[e(Y,{modelValue:s.newTenantId,"onUpdate:modelValue":y=>s.newTenantId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(V,{span:6},{default:l(()=>[e(v,{label:"所有者"},{default:l(()=>[e(O,{modelValue:s.newOwnerId,"onUpdate:modelValue":y=>s.newOwnerId=y},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),e(V,{span:2},{default:l(()=>[e(r,{style:{float:"right"},size:"small",circle:"",plain:"",icon:"Minus",onClick:()=>E(h)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)],64))),256)),e(r,{style:{width:"100%","margin-top":"20px"},onClick:n,plain:"",icon:"Plus"})]),_:1},8,["model"])}}};export{he as _,Re as a,qe as b,te as c,we as d,Ee as u};
