import{_ as M}from"./StratoDrawer-i3nJdUbZ.js";import{S as A}from"./StratoButton-BRlR7RNE.js";import"./StratoCodeBlock-TLULY6tz.js";import{s as N}from"./request-IeLrxslB.js";import{v as L}from"./FormUtil-CHSbmSKI.js";import{_ as J}from"./StratoTable-EZs1qWj6.js";import{_ as X}from"./TenantTreeSelector-cjxWtDlB.js";import{_ as Y}from"./UserSelector-CoJSGQ4A.js";import{_ as P}from"./RemoteScriptDef-B0TuVjI8.js";import{a7 as K,r as c,y as W,n as u,o as T,b as x,e,w as o,i as k,q as F,F as h,B as z,v as B,u as O,d as C,x as $,O as Z,f as ee,t as q}from"./index-CJwSUwqU.js";import{_ as le}from"./StratoPagingSelector-DNkLqj4O.js";import"./user-Ce1W_vfQ.js";const H=_=>N({url:"/resource-service/describe-software-definitions",method:"post",data:_}),oe=_=>N({url:"/resource-service/create-software-definition",method:"post",data:_}),ae=_=>N({url:"/resource-service/update-software-definition",method:"post",data:_}),te=_=>N({url:"/resource-service/delete-software-definitions",method:"post",data:_}),ne=_=>N({url:"/resource-service/enable-software-definitions",method:"post",data:_}),ue=_=>N({url:"/resource-service/disable-software-definitions",method:"post",data:_}),j={__name:"SoftwareActionsForm",props:{modelValue:{required:!0,type:Array},modelModifiers:{}},emits:["update:modelValue"],setup(_,{expose:y}){const a=K(_,"modelValue"),v=c([]),b=c([]);function g(){let r=a.value.length+1,n="ACTION_"+r;for(;a.value.findIndex(p=>p.actionId===n)>=0;)r++,n="ACTION_"+r;a.value.push({actionId:n,actionName:"操作"+r,remoteScriptDef:{remoteScript:{},customForm:{items:[]}}}),m.value=a.value.length-1}function U(r){const n=r;n>=0&&a.value.splice(n,1),a.value.length>0?m.value=a.value.length-1:m.value=void 0}const m=c();W(()=>{a.value.length>0&&(m.value=0)});function t(r){L([...v.value,...b.value],r)}return y({validate:t}),(r,n)=>{const p=u("ElButton"),s=u("ElInput"),E=u("ElFormItem"),w=u("ElOption"),D=u("ElSelect"),S=u("ElForm"),R=u("ElTabPane"),I=u("ElTabs");return T(),x(h,null,[e(p,{size:"small",style:{"margin-bottom":"20px"},type:"primary",plain:"",icon:"plus",onClick:g},{default:o(()=>[k(" 添加操作 ")]),_:1}),a.value&&a.value.length>0?(T(),F(I,{key:0,modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=V=>m.value=V),type:"border-card",closable:"",onTabRemove:U},{default:o(()=>[(T(!0),x(h,null,z(a.value,(V,l)=>(T(),F(R,{key:l,name:l,label:V.actionName},{default:o(()=>[e(S,{ref_for:!0,ref_key:"baseFormRefs",ref:v,model:V},{default:o(()=>[e(E,{prop:"actionId",label:"操作标识",required:"","show-message":!1},{default:o(()=>[e(s,{modelValue:V.actionId,"onUpdate:modelValue":i=>V.actionId=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(E,{prop:"actionName",label:"操作名称",required:"","show-message":!1},{default:o(()=>[e(s,{modelValue:V.actionName,"onUpdate:modelValue":i=>V.actionName=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(E,{prop:"actionType",label:"操作类型",required:"","show-message":!1},{default:o(()=>[e(D,{modelValue:V.actionType,"onUpdate:modelValue":i=>V.actionType=i},{default:o(()=>[e(w,{value:"INSTALL",label:"安装"}),e(w,{value:"START",label:"启动"}),e(w,{value:"STOP",label:"停止"}),e(w,{value:"RESTART",label:"重启"}),e(w,{value:"UNINSTALL",label:"卸载"}),e(w,{value:"CHECK_STATE",label:"检查状态"}),e(w,{value:"CONFIGURE",label:"配置"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"]),e(P,{ref_for:!0,ref_key:"remoteScriptDefRefs",ref:b,modelValue:V.remoteScriptDef,"onUpdate:modelValue":i=>V.remoteScriptDef=i},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])):B("",!0)],64)}}},re={__name:"SoftwareDefinitionSelector",setup(_){const y=c();return(a,v)=>(T(),F(le,{modelValue:y.value,"onUpdate:modelValue":v[0]||(v[0]=b=>y.value=b),"label-getter":b=>b.name,"remote-method":O(H)},null,8,["modelValue","label-getter","remote-method"]))}},Q={__name:"SoftwareRequirementsForm",props:{modelValue:{required:!0,type:Array},modelModifiers:{}},emits:["update:modelValue"],setup(_,{expose:y}){const a=K(_,"modelValue"),v=c([]),b=c([]);function g(){let r=a.value.length+1,n="REQUIREMENT_"+r;for(;a.value.findIndex(p=>p.requirementKey===n)>=0;)r++,n="REQUIREMENT_"+r;a.value.push({requirementKey:n,requirementName:"依赖"+r,capabilityName:"",connectScriptDef:{remoteScript:{},customForm:{items:[]}},disconnectScriptDef:{remoteScript:{},customForm:{items:[]}},checkConnectionScriptDef:{remoteScript:{},customForm:{items:[]}}}),m.value=a.value.length-1}function U(r){const n=r;n>=0&&a.value.splice(n,1),a.value.length>0?m.value=a.value.length-1:m.value=void 0}const m=c();W(()=>{a.value.length>0&&(m.value=0)});function t(r){L([...v.value,...b.value],r)}return y({validate:t}),(r,n)=>{const p=u("ElButton"),s=u("ElFormItem"),E=u("ElInput"),w=u("ElCheckbox"),D=u("ElForm"),S=u("ElCollapseItem"),R=u("ElCollapse"),I=u("ElTabPane"),V=u("ElTabs");return T(),x(h,null,[e(p,{style:{"margin-bottom":"20px"},type:"primary",size:"small",plain:"",icon:"plus",onClick:g},{default:o(()=>[k(" 添加依赖 ")]),_:1}),a.value&&a.value.length>0?(T(),F(V,{key:0,modelValue:m.value,"onUpdate:modelValue":n[0]||(n[0]=l=>m.value=l),type:"border-card",closable:"",onTabRemove:U},{default:o(()=>[(T(!0),x(h,null,z(a.value,(l,i)=>(T(),F(I,{key:i,name:i,label:l.requirementName},{default:o(()=>[e(D,{ref_for:!0,ref_key:"baseFormRefs",ref:v,model:l},{default:o(()=>[e(s,{prop:"targetSoftwareDefinitionId",label:"依赖软件",required:"","show-message":!1},{default:o(()=>[e(re,{modelValue:l.targetSoftwareDefinitionId,"onUpdate:modelValue":d=>l.targetSoftwareDefinitionId=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{prop:"requirementKey",label:"依赖标识",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:l.requirementKey,"onUpdate:modelValue":d=>l.requirementKey=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{prop:"requirementName",label:"依赖名称",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:l.requirementName,"onUpdate:modelValue":d=>l.requirementName=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{prop:"capabilityName",label:"被依赖名称",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:l.capabilityName,"onUpdate:modelValue":d=>l.capabilityName=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(s,{prop:"exclusive",label:"排他依赖"},{default:o(()=>[e(w,{modelValue:l.exclusive,"onUpdate:modelValue":d=>l.exclusive=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["model"]),e(R,{accordion:""},{default:o(()=>[e(S,{title:"建立依赖脚本"},{default:o(()=>[e(P,{ref_for:!0,ref_key:"remoteScriptDefRefs",ref:b,modelValue:l.connectScriptDef,"onUpdate:modelValue":d=>l.connectScriptDef=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(S,{title:"解除依赖脚本"},{default:o(()=>[e(P,{ref_for:!0,ref_key:"remoteScriptDefRefs",ref:b,modelValue:l.disconnectScriptDef,"onUpdate:modelValue":d=>l.disconnectScriptDef=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(S,{title:"检查依赖脚本"},{default:o(()=>[e(P,{ref_for:!0,ref_key:"remoteScriptDefRefs",ref:b,modelValue:l.checkConnectionScriptDef,"onUpdate:modelValue":d=>l.checkConnectionScriptDef=d},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["name","label"]))),128))]),_:1},8,["modelValue"])):B("",!0)],64)}}},se={__name:"CreateSoftwareDefinitionForm",props:{modelValue:{required:!0,type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(_,{expose:y}){const a=K(_,"modelValue"),v=c(),b=c(),g=c();function U(m){L([v.value,b.value,g.value],m)}return y({validate:U}),(m,t)=>{const r=u("ElFormItem"),n=u("ElCol"),p=u("ElInput"),s=u("ElOption"),E=u("ElSelect"),w=u("ElInputNumber"),D=u("ElSwitch"),S=u("ElRow"),R=u("ElForm"),I=u("ElTabPane"),V=u("ElTabs");return T(),F(V,null,{default:o(()=>[e(I,{label:"基本信息"},{default:o(()=>[e(R,{ref_key:"formRef",ref:v,model:a.value,"label-position":"top"},{default:o(()=>[e(S,{gutter:24},{default:o(()=>[e(n,{span:12},{default:o(()=>[e(r,{label:"租户",prop:"tenantId",required:"","show-message":!1},{default:o(()=>[e(X,{modelValue:a.value.tenantId,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.tenantId=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"所有者",prop:"ownerId",required:"","show-message":!1},{default:o(()=>[e(Y,{modelValue:a.value.ownerId,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.ownerId=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"软件标识",prop:"definitionKey",required:"","show-message":!1},{default:o(()=>[e(p,{modelValue:a.value.definitionKey,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.definitionKey=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"软件名称",prop:"name",required:"","show-message":!1},{default:o(()=>[e(p,{modelValue:a.value.name,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.name=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"软件类型",prop:"softwareType",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:a.value.softwareType,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.softwareType=l)},{default:o(()=>[e(s,{value:"APPLICATION",label:"应用"}),e(s,{value:"DATABASE",label:"数据库"}),e(s,{value:"MIDDLEWARE",label:"中间件"}),e(s,{value:"OTHER",label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"系统类型",prop:"osType",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:a.value.osType,"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.osType=l)},{default:o(()=>[e(s,{value:"Linux",label:"Linux"}),e(s,{value:"Windows",label:"Windows"}),e(s,{value:"Unknown",label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:4},{default:o(()=>[e(r,{label:"服务端口",prop:"servicePort",required:"","show-message":!1},{default:o(()=>[e(w,{min:1,max:65535,modelValue:a.value.servicePort,"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.servicePort=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:4},{default:o(()=>[e(r,{label:"公用软件",prop:"publicDefinition"},{default:o(()=>[e(D,{modelValue:a.value.publicDefinition,"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.publicDefinition=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:4},{default:o(()=>[e(r,{label:"在依赖目标中可见",prop:"visibleInTarget"},{default:o(()=>[e(D,{modelValue:a.value.visibleInTarget,"onUpdate:modelValue":t[8]||(t[8]=l=>a.value.visibleInTarget=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:o(()=>[e(r,{label:"描述",prop:"description"},{default:o(()=>[e(p,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":t[9]||(t[9]=l=>a.value.description=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{label:"定义操作"},{default:o(()=>[e(j,{ref_key:"actionsFormRef",ref:b,modelValue:a.value.actions,"onUpdate:modelValue":t[10]||(t[10]=l=>a.value.actions=l)},null,8,["modelValue"])]),_:1}),e(I,{label:"定义依赖"},{default:o(()=>[e(Q,{ref_key:"requirementsFormRef",ref:g,modelValue:a.value.requirements,"onUpdate:modelValue":t[11]||(t[11]=l=>a.value.requirements=l)},null,8,["modelValue"])]),_:1})]),_:1})}}},ie={__name:"UpdateSoftwareDefinitionForm",props:{modelValue:{required:!0,type:Object},modelModifiers:{}},emits:["update:modelValue"],setup(_,{expose:y}){const a=K(_,"modelValue"),v=c(),b=c(),g=c();function U(m){L([v.value,b.value,g.value],m)}return y({validate:U}),(m,t)=>{const r=u("ElInput"),n=u("ElFormItem"),p=u("ElCol"),s=u("ElOption"),E=u("ElSelect"),w=u("ElInputNumber"),D=u("ElSwitch"),S=u("ElRow"),R=u("ElForm"),I=u("ElTabPane"),V=u("ElTabs");return T(),F(V,null,{default:o(()=>[e(I,{label:"基本信息"},{default:o(()=>[e(R,{ref_key:"formRef",ref:v,model:a.value,"label-position":"top"},{default:o(()=>[e(S,{gutter:24},{default:o(()=>[e(p,{span:12},{default:o(()=>[e(n,{label:"软件名称",prop:"name",required:"","show-message":!1},{default:o(()=>[e(r,{modelValue:a.value.name,"onUpdate:modelValue":t[0]||(t[0]=l=>a.value.name=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:o(()=>[e(n,{label:"软件类型",prop:"softwareType",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:a.value.softwareType,"onUpdate:modelValue":t[1]||(t[1]=l=>a.value.softwareType=l)},{default:o(()=>[e(s,{value:"APPLICATION",label:"应用"}),e(s,{value:"DATABASE",label:"数据库"}),e(s,{value:"MIDDLEWARE",label:"中间件"}),e(s,{value:"OTHER",label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:o(()=>[e(n,{label:"系统类型",prop:"osType",required:"","show-message":!1},{default:o(()=>[e(E,{modelValue:a.value.osType,"onUpdate:modelValue":t[2]||(t[2]=l=>a.value.osType=l)},{default:o(()=>[e(s,{value:"Linux",label:"Linux"}),e(s,{value:"Windows",label:"Windows"}),e(s,{value:"Unknown",label:"其他"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:4},{default:o(()=>[e(n,{label:"服务端口",prop:"servicePort",required:"","show-message":!1},{default:o(()=>[e(w,{min:1,max:65535,modelValue:a.value.servicePort,"onUpdate:modelValue":t[3]||(t[3]=l=>a.value.servicePort=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:4},{default:o(()=>[e(n,{label:"公用软件",prop:"publicDefinition"},{default:o(()=>[e(D,{modelValue:a.value.publicDefinition,"onUpdate:modelValue":t[4]||(t[4]=l=>a.value.publicDefinition=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:4},{default:o(()=>[e(n,{label:"在依赖目标中可见",prop:"visibleInTarget"},{default:o(()=>[e(D,{modelValue:a.value.visibleInTarget,"onUpdate:modelValue":t[5]||(t[5]=l=>a.value.visibleInTarget=l)},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:o(()=>[e(n,{label:"描述",prop:"description"},{default:o(()=>[e(r,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":t[6]||(t[6]=l=>a.value.description=l)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(I,{label:"定义操作"},{default:o(()=>[e(j,{ref_key:"actionsFormRef",ref:b,modelValue:a.value.actions,"onUpdate:modelValue":t[7]||(t[7]=l=>a.value.actions=l)},null,8,["modelValue"])]),_:1}),e(I,{label:"定义依赖"},{default:o(()=>[e(Q,{ref_key:"requirementsFormRef",ref:g,modelValue:a.value.requirements,"onUpdate:modelValue":t[8]||(t[8]=l=>a.value.requirements=l)},null,8,["modelValue"])]),_:1})]),_:1})}}},de={style:{"margin-bottom":"10px",height:"32px"}},Ie={__name:"SoftwareDefinition",setup(_){const y=c({}),a=c([]),v=c();function b(){return a.value.map(l=>l.id)}function g(l){a.value=l}const U=c(),m=c(!1),t=c();function r(){t.value={actions:[],requirements:[]},m.value=!0}const n=c(),p=c(!1),s=c();function E(l){s.value={softwareDefinitionId:l.id,name:l.name,description:l.description,softwareType:l.softwareType,osType:l.osType,publicDefinition:l.publicDefinition,visibleInTarget:l.visibleInTarget,servicePort:l.servicePort,actions:l.actions,requirements:l.requirements},p.value=!0}function w(){U.value.validate(l=>{l&&oe(t.value).then(()=>{m.value=!1,$.success("软件定义已保存"),v.value.fetchData()})})}function D(){n.value.validate(l=>{l&&ae(s.value).then(()=>{p.value=!1,$.success("软件定义已更新"),v.value.fetchData()})})}function S(){if(a.value.length===0)return;const i={softwareDefinitionIds:b()};te(i).then(()=>{v.value.fetchData()})}function R(l){switch(l){case"APPLICATION":return"应用";case"DATABASE":return"数据库";case"MIDDLEWARE":return"中间件";case"OTHER":return"其他";default:return"未知类型"}}function I(){if(a.value.length===0)return;const i={softwareDefinitionIds:b()};ne(i).then(()=>{v.value.fetchData()})}function V(){if(a.value.length===0)return;const i={softwareDefinitionIds:b()};ue(i).then(()=>{v.value.fetchData()})}return(l,i)=>{const d=u("ElTableColumn"),G=u("ElButton");return T(),x(h,null,[C("div",de,[e(A,{type:"primary",onClick:r},{default:o(()=>[k("新建")]),_:1}),e(A,{disabled:a.value.length===0,type:"success",plain:"",onClick:I},{default:o(()=>[k(" 启用 ")]),_:1},8,["disabled"]),e(A,{disabled:a.value.length===0,type:"warning",plain:"",onClick:V},{default:o(()=>[k(" 禁用 ")]),_:1},8,["disabled"]),e(O(Z),{title:"确认删除",onConfirm:S},{reference:o(()=>[e(A,{disabled:a.value.length===0,type:"danger",plain:""},{default:o(()=>[k(" 删除 ")]),_:1},8,["disabled"])]),_:1}),e(O(ee),{style:{float:"right",width:"20%"},modelValue:y.value.search,"onUpdate:modelValue":i[0]||(i[0]=f=>y.value.search=f),"suffix-icon":"search"},null,8,["modelValue"])]),e(J,{ref_key:"tableRef",ref:v,"paging-request":y.value,"remote-method":O(H),onSelectionChange:g},{default:o(()=>[e(d,{type:"selection","reserve-selection":""}),e(d,{prop:"definitionKey",label:"软件标识"}),e(d,{prop:"name",label:"软件名称",sortable:"custom"}),e(d,{prop:"softwareType",label:"软件类型",sortable:"custom"},{default:o(f=>[C("span",null,q(R(f.row.softwareType)),1)]),_:1}),e(d,{prop:"osType",label:"系统类型",sortable:"custom"},{default:o(f=>[C("span",null,q(f.row.osType),1)]),_:1}),e(d,{prop:"publicDefinition",label:"公用软件",sortable:"custom"},{default:o(f=>[C("span",null,q(f.row.publicDefinition?"是":"否"),1)]),_:1}),e(d,{prop:"visibleInTarget",label:"在依赖目标中可见",sortable:"custom","min-width":"100"},{default:o(f=>[C("span",null,q(f.row.visibleInTarget?"是":"否"),1)]),_:1}),e(d,{prop:"disabled",label:"是否禁用",sortable:"custom"},{default:o(f=>[C("span",null,q(f.row.disabled?"是":"否"),1)]),_:1}),e(d,{prop:"ownerId",label:"所有者",sortable:"custom"},{default:o(f=>[C("span",null,q(f.row.ownerRealName),1)]),_:1}),e(d,null,{default:o(f=>[e(G,{link:"",type:"primary",onClick:()=>E(f.row)},{default:o(()=>[k("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e(M,{modelValue:m.value,"onUpdate:modelValue":i[2]||(i[2]=f=>m.value=f),title:"新建软件定义",size:"1200",onOnConfirm:w},{default:o(()=>[m.value?(T(),F(se,{key:0,ref_key:"createFormRef",ref:U,modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=f=>t.value=f)},null,8,["modelValue"])):B("",!0)]),_:1},8,["modelValue"]),e(M,{modelValue:p.value,"onUpdate:modelValue":i[4]||(i[4]=f=>p.value=f),title:"编辑软件定义",size:"1200",onOnConfirm:D},{default:o(()=>[p.value?(T(),F(ie,{key:0,ref_key:"updateFormRef",ref:n,modelValue:s.value,"onUpdate:modelValue":i[3]||(i[3]=f=>s.value=f)},null,8,["modelValue"])):B("",!0)]),_:1},8,["modelValue"])],64)}}};export{Ie as default};
