import{_ as Z}from"./StratoTable-BQdButlV.js";import{_ as ee,c as pe,u as fe,e as ve,d as ce,a as ge,b as Ve}from"./TenantTreeSelector-C6fV0oEE.js";import{S as F}from"./StratoButton-AnmxT3yq.js";import{_ as $}from"./StratoDrawer-BEn6vZyQ.js";import{a7 as L,r as d,y as J,o as b,q as C,w as a,e,u as o,E as _,f as G,j as te,ab as W,n as y,b as Y,F as P,v as A,d as q,O as le,P as U,m as _e,B as ae,i as S,t as X}from"./index-C6PxR8iA.js";import{s as h}from"./request-BGZJNm7h.js";import{S as ue}from"./StratoCodeBlock-DrSVX9xC.js";import{_ as oe}from"./UserSelector-I3vgcqge.js";import{_ as ne}from"./ProviderSelector-BC5uGiUI.js";import{_ as re}from"./AccountSelector-DslFb1Hj.js";import{_ as se}from"./CategorySelector-BC9lVLZm.js";import{_ as de}from"./TagValueSelectorGroup-Tq596lRF.js";import{_ as ye}from"./StratoSelector-BPbvdP-M.js";import"./StratoPagingSelector-CZtU1yuw.js";import"./user-DS2hYLSE.js";import"./resource-Bh2jHR95.js";import"./account-Dl5yMWLZ.js";import"./AccountContext-KhB6J2Ha.js";import"./tag-By1EEBOS.js";const be={__name:"CreateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(v){f.value.validate(v)}const n=d({parentId:[{required:!0,message:"请选择父级租户"}],name:[{required:!0,message:"请输入租户名称"}]});return J(()=>{}),(v,u)=>(b(),C(o(te),{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(G),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"父级租户",prop:"parentId"},{default:a(()=>[e(ee,{modelValue:l.value.parentId,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.parentId=t)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(G),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[2]||(u[2]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ee={__name:"UpdateTenantForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(v){f.value.validate(v)}const n=d({name:[{required:!0,message:"请输入租户名称"}]});return J(()=>{}),(v,u)=>(b(),C(o(te),{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"租户名称",prop:"name"},{default:a(()=>[e(o(G),{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=t=>l.value.name=t),placeholder:"请输入租户名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述"},{default:a(()=>[e(o(G),{type:"textarea",modelValue:l.value.description,"onUpdate:modelValue":u[1]||(u[1]=t=>l.value.description=t),placeholder:"请输入描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ie=r=>h({url:"/identity-service/describe-rules",method:"post",data:r}),Ne=r=>h({url:"/identity-service/create-rule",method:"post",data:r}),Ue=r=>h({url:"/identity-service/update-rule",method:"post",data:r}),xe=r=>h({url:"/identity-service/create-naming-rule",method:"post",data:r}),Ce=r=>h({url:"/identity-service/update-naming-rule",method:"post",data:r}),Re=r=>h({url:"/identity-service/delete-rules",method:"post",data:r}),Te={__name:"CreateRuleForm",props:W({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(v){f.value.validate(v)}const n=d({tenantId:[{required:!0,message:"请选择租户"}],type:[{required:!0,message:"请输入规则类型"}],name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return J(()=>{}),(v,u)=>{const t=y("ElInput"),m=y("ElOption"),p=y("ElSelect"),s=y("ElInputNumber"),w=y("ElForm");return b(),C(w,{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":u[0]||(u[0]=N=>l.value.tenantId=N)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则类型",prop:"type"},{default:a(()=>[e(t,{modelValue:l.value.type,"onUpdate:modelValue":u[1]||(u[1]=N=>l.value.type=N),placeholder:"请输入规则类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[2]||(u[2]=N=>l.value.name=N),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[3]||(u[3]=N=>l.value.script=N),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),Y(P,{key:0},[e(o(_),{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(p,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[4]||(u[4]=N=>l.value.suffixType=N),placeholder:"请选择后缀类型"},{default:a(()=>[e(m,{key:"NONE",value:"NONE",label:"无后缀"}),e(m,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(m,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(m,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),C(o(_),{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(s,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[5]||(u[5]=N=>l.value.suffixLength=N),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):A("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),C(o(_),{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(s,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[6]||(u[6]=N=>l.value.suffixStartNumber=N),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):A("",!0)],64)):A("",!0)]),_:1},8,["model","rules"])}}},De={__name:"UpdateRuleForm",props:W({isNamingRule:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(v){f.value.validate(v)}const n=d({name:[{required:!0,message:"请输入规则名称"}],script:[{required:!0,message:"请粘贴JavaScript脚本"}],suffixType:[{required:!0,message:"请选择后缀类型"}],suffixLength:[{required:!0,message:"请输入后缀长度"}],suffixStartNumber:[{required:!0,message:"请输入后缀起始数字"}]});return J(()=>{}),(v,u)=>{const t=y("ElInput"),m=y("ElFormItem"),p=y("ElOption"),s=y("ElSelect"),w=y("ElInputNumber"),N=y("ElForm");return b(),C(N,{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:n.value},{default:a(()=>[e(m,{label:"规则名称",prop:"name"},{default:a(()=>[e(t,{modelValue:l.value.name,"onUpdate:modelValue":u[0]||(u[0]=D=>l.value.name=D),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),e(m,{label:"JavaScript脚本",prop:"script"},{default:a(()=>[e(ue,{modelValue:l.value.script,"onUpdate:modelValue":u[1]||(u[1]=D=>l.value.script=D),language:"javascript"},null,8,["modelValue"])]),_:1}),r.isNamingRule?(b(),Y(P,{key:0},[e(m,{label:"后缀类型",prop:"suffixType"},{default:a(()=>[e(s,{modelValue:l.value.suffixType,"onUpdate:modelValue":u[2]||(u[2]=D=>l.value.suffixType=D),placeholder:"请选择后缀类型"},{default:a(()=>[e(p,{key:"NONE",value:"NONE",label:"无后缀"}),e(p,{key:"RANDOM_STRING",value:"RANDOM_STRING",label:"随机字符串"}),e(p,{key:"NUMERIC_SEQUENCE",value:"NUMERIC_SEQUENCE",label:"数字序列"}),e(p,{key:"DYNAMIC_NUMERIC_SEQUENCE",value:"DYNAMIC_NUMERIC_SEQUENCE",label:"动态数字序列"})]),_:1},8,["modelValue"])]),_:1}),l.value.suffixType&&l.value.suffixType!=="NONE"?(b(),C(m,{key:0,label:"后缀长度",prop:"suffixLength"},{default:a(()=>[e(w,{style:{width:"100%"},min:1,modelValue:l.value.suffixLength,"onUpdate:modelValue":u[3]||(u[3]=D=>l.value.suffixLength=D),placeholder:"请输入后缀长度"},null,8,["modelValue"])]),_:1})):A("",!0),l.value.suffixType==="NUMERIC_SEQUENCE"||l.value.suffixType==="DYNAMIC_NUMERIC_SEQUENCE"?(b(),C(m,{key:1,label:"后缀起始数字",prop:"suffixStartNumber"},{default:a(()=>[e(w,{style:{width:"100%"},min:0,modelValue:l.value.suffixStartNumber,"onUpdate:modelValue":u[4]||(u[4]=D=>l.value.suffixStartNumber=D),placeholder:"请输入后缀起始数字"},null,8,["modelValue"])]),_:1})):A("",!0)],64)):A("",!0)]),_:1},8,["model","rules"])}}},we={style:{"margin-bottom":"10px",height:"32px"}},ke=q("span",{style:{"font-size":"12px"}},"创建",-1),he=q("span",{style:{"font-size":"12px"}},"编辑",-1),Se=q("span",{style:{"font-size":"12px"}},"删除",-1),Fe={__name:"Rule",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),f=d(!1),g=d(!1),n=d([]),v=d({tenantIds:V.tenantIds}),u=d(),t=d({}),m=d(!1),p=d(),s=d({}),w=d(!1);function N(k){n.value=k}function D(){return n.value.map(k=>k.id)}function R(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),f.value=!0}function M(){n.value.length===1&&(w.value=n.value[0].isNamingRule,s.value={ruleId:n.value[0].id,name:n.value[0].name,script:n.value[0].script,suffixType:n.value[0].suffixType,suffixLength:n.value[0].suffixLength,suffixStartNumber:n.value[0].suffixStartNumber},g.value=!0)}function H(){u.value.validate((k,E)=>{if(!k)return;(m.value?xe:Ne)(t.value).then(x=>{l.value.fetchData(),f.value=!1})})}function K(){p.value.validate((k,E)=>{if(!k)return;(w.value?Ce:Ue)(s.value).then(x=>{l.value.fetchData(),g.value=!1})})}function j(){const E={ruleIds:D()};Re(E).then(O=>{l.value.fetchData()})}return(k,E)=>{const O=y("ElRadioButton"),x=y("ElRadioGroup");return b(),Y(P,null,[q("div",we,[e(F,{size:"small",type:"primary",onClick:R},{default:a(()=>[ke]),_:1}),e(F,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:M},{default:a(()=>[he]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:j},{reference:a(()=>[e(F,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[Se]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:v.value.search,"onUpdate:modelValue":E[0]||(E[0]=c=>v.value.search=c),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":v.value,"remote-method":o(Ie),onSelectionChange:N},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"type",label:"类型",sortable:"custom"}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"isNamingRule",label:"是否命名规则",formatter:(c,B,Q,I)=>Q?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:f.value,"onUpdate:modelValue":E[3]||(E[3]=c=>f.value=c),title:"创建规则",onOnConfirm:H,size:"600"},{default:a(()=>[e(x,{modelValue:m.value,"onUpdate:modelValue":E[1]||(E[1]=c=>m.value=c),style:{"margin-bottom":"12px"}},{default:a(()=>[e(O,{label:"普通规则",value:!1}),e(O,{label:"命名规则",value:!0})]),_:1},8,["modelValue"]),e(Te,{ref_key:"createFormRef",ref:u,"is-naming-rule":m.value,modelValue:t.value,"onUpdate:modelValue":E[2]||(E[2]=c=>t.value=c)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:g.value,"onUpdate:modelValue":E[5]||(E[5]=c=>g.value=c),title:"编辑规则",onOnConfirm:K,size:"600"},{default:a(()=>[e(De,{"is-naming-rule":w.value,ref_key:"updateFormRef",ref:p,modelValue:s.value,"onUpdate:modelValue":E[4]||(E[4]=c=>s.value=c)},null,8,["is-naming-rule","modelValue"])]),_:1},8,["modelValue"])],64)}}},qe=r=>h({url:"/resource-service/describe-resource-usage-limits",method:"post",data:r}),Me=r=>h({url:"/resource-service/describe-usage-types",method:"post",data:r}),Oe=r=>h({url:"/resource-service/create-resource-usage-limit",method:"post",data:r}),$e=r=>h({url:"/resource-service/update-resource-usage-limit",method:"post",data:r}),Le=r=>h({url:"/resource-service/enable-resource-usage-limits",method:"post",data:r}),ze=r=>h({url:"/resource-service/disable-resource-usage-limits",method:"post",data:r}),Ae=r=>h({url:"/resource-service/delete-resource-usage-limits",method:"post",data:r}),Be={__name:"UsageTypeSelector",props:W({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{},modelModifiers:{},usageTypeName:{},usageTypeNameModifiers:{}}),emits:W(["change"],["update:modelValue","update:usageTypeName"]),setup(r,{emit:V}){const l=L(r,"modelValue"),f=L(r,"usageTypeName"),g=r,n=V;function v(t){f.value=t.usageTypeName,n("change",t)}const u=d({});return _e(g,()=>{u.value.providerIds=g.providerIds,u.value.resourceCategories=g.resourceCategories},{immediate:!0}),(t,m)=>(b(),C(ye,{modelValue:l.value,"onUpdate:modelValue":m[0]||(m[0]=p=>l.value=p),onChange:v,"list-getter":p=>p.usageTypes,"value-getter":p=>p.usageType,"label-getter":p=>p.usageTypeName,"remote-method":o(Me),request:u.value},null,8,["modelValue","list-getter","value-getter","label-getter","remote-method","request"]))}},ie={__name:"LimitItemSelectorGroup",props:W({providerIds:{required:!1,type:Array,default:void 0},resourceCategories:{required:!1,type:Array,default:void 0}},{modelValue:{required:!0,type:Array,default:[]},modelModifiers:{}}),emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue");function f(v){l.value.push({usageType:v.usageType,usageTypeName:v.usageTypeName,limitValue:v.limitValue})}function g(v){const u=l.value.indexOf(v);u>=0&&l.value.splice(u,1)}function n(v,u,t){if(!u||u.length===0)return t();for(let m of u)if(!m.usageType||!m.limitValue)return t(new Error("配额上限未完成填写"));return t()}return V({validate:n}),(v,u)=>{const t=y("ElTag"),m=y("ElSpace"),p=y("ElInput"),s=y("ElCol"),w=y("ElRow"),N=y("ElButton"),D=y("ElPopover");return b(),C(D,{width:"450",trigger:"click",teleported:!1},{reference:a(()=>[e(p,{plain:"","suffix-icon":"ArrowDown"},{prefix:a(()=>[e(m,{alignment:"normal",wrap:""},{default:a(()=>[(b(!0),Y(P,null,ae(l.value,R=>(b(),C(t,{closable:"",onClose:()=>g(R)},{default:a(()=>[S(X((R.usageTypeName?R.usageTypeName:"?")+":"+(R.limitValue?R.limitValue:"?")),1)]),_:2},1032,["onClose"]))),256))]),_:1})]),_:1})]),default:a(()=>[q("div",null,[(b(!0),Y(P,null,ae(l.value,R=>(b(),C(w,{gutter:12,style:{"margin-bottom":"6px"}},{default:a(()=>[e(s,{span:10},{default:a(()=>[e(Be,{"provider-ids":r.providerIds,"resource-categories":r.resourceCategories,modelValue:R.usageType,"onUpdate:modelValue":M=>R.usageType=M,"usage-type-name":R.usageTypeName,"onUpdate:usageTypeName":M=>R.usageTypeName=M},null,8,["provider-ids","resource-categories","modelValue","onUpdate:modelValue","usage-type-name","onUpdate:usageTypeName"])]),_:2},1024),e(s,{span:14},{default:a(()=>[e(p,{modelValue:R.limitValue,"onUpdate:modelValue":M=>R.limitValue=M},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),256))]),e(N,{style:{width:"100%","margin-top":"6px"},icon:"Plus",onClick:u[0]||(u[0]=()=>f({}))})]),_:1})}}},Qe={__name:"CreateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(u){f.value.validate(u)}const n=d(),v=d({tenantId:[{required:!0,message:"请选择租户"}],name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var p;return(p=n.value)==null?void 0:p.validate(u,t,m)},trigger:"change"}]});return J(()=>{}),(u,t)=>{const m=y("ElInput"),p=y("ElForm");return b(),C(p,{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:v.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"所属租户",prop:"tenantId"},{default:a(()=>[e(ee,{modelValue:l.value.tenantId,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.tenantId=s)},null,8,["modelValue"])]),_:1}),e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[8]||(t[8]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Ge={__name:"UpdateLimitForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(r,{expose:V}){const l=L(r,"modelValue"),f=d();V({validate:g});function g(u){f.value.validate(u)}const n=d(),v=d({name:[{required:!0,message:"请输入名称"}],tags:[{validator:(u,t,m)=>{var p;return(p=n.value)==null?void 0:p.validate(u,t,m)},trigger:"change"}]});return J(()=>{}),(u,t)=>{const m=y("ElInput"),p=y("ElForm");return b(),C(p,{ref_key:"formRef",ref:f,model:l.value,"label-position":"top",rules:v.value,style:{"padding-left":"20px","padding-right":"20px"}},{default:a(()=>[e(o(_),{label:"名称",prop:"name"},{default:a(()=>[e(m,{modelValue:l.value.name,"onUpdate:modelValue":t[0]||(t[0]=s=>l.value.name=s),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"描述",prop:"description"},{default:a(()=>[e(m,{modelValue:l.value.description,"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.description=s),type:"textarea",placeholder:"请输入描述"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"所有者范围",prop:"ownerIds"},{default:a(()=>[e(oe,{modelValue:l.value.ownerIds,"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.ownerIds=s),multiple:"",placeholder:"留空代表匹配任意所有者"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云平台范围",prop:"providerIds"},{default:a(()=>[e(ne,{modelValue:l.value.providerIds,"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.providerIds=s),multiple:"",placeholder:"留空代表匹配任意云平台"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云账号范围",prop:"accountIds"},{default:a(()=>[e(re,{modelValue:l.value.accountIds,"onUpdate:modelValue":t[4]||(t[4]=s=>l.value.accountIds=s),multiple:"",placeholder:"留空代表匹配任意云账号"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源类型范围",prop:"resourceCategories"},{default:a(()=>[e(se,{modelValue:l.value.resourceCategories,"onUpdate:modelValue":t[5]||(t[5]=s=>l.value.resourceCategories=s),multiple:"",placeholder:"留空代表匹配任意云资源类型"},null,8,["modelValue"])]),_:1}),e(o(_),{label:"云资源标签范围",prop:"tags"},{default:a(()=>[e(de,{ref_key:"tagRef",ref:n,modelValue:l.value.tags,"onUpdate:modelValue":t[6]||(t[6]=s=>l.value.tags=s),"entry-paging-request":{},"default-add-all-entries":!1},null,8,["modelValue"])]),_:1}),e(o(_),{label:"配额上限项",prop:"items"},{default:a(()=>[e(ie,{ref:"itemRef",modelValue:l.value.items,"onUpdate:modelValue":t[7]||(t[7]=s=>l.value.items=s),"provider-ids":l.value.providerIds,"resource-categories":l.value.resourceCategories},null,8,["modelValue","provider-ids","resource-categories"])]),_:1})]),_:1},8,["model","rules"])}}},Ye={style:{"margin-bottom":"10px",height:"32px"}},Pe=q("span",{style:{"font-size":"12px"}},"创建",-1),je=q("span",{style:{"font-size":"12px"}},"编辑",-1),Je=q("span",{style:{"font-size":"12px"}},"启用",-1),He=q("span",{style:{"font-size":"12px"}},"禁用",-1),Ke=q("span",{style:{"font-size":"12px"}},"删除",-1),We={__name:"ResourceUsageLimit",props:{tenantIds:{type:Array,required:!1,default:void 0}},setup(r){const V=r,l=d(),f=d(!1),g=d(!1),n=d([]),v=d({tenantIds:V.tenantIds}),u=d(),t=d({tags:[],items:[]}),m=d(),p=d({});function s(x){n.value=x}function w(){return n.value.map(x=>x.id)}function N(){V.tenantIds&&(t.value.tenantId=V.tenantIds[0]),f.value=!0}function D(){n.value.length===1&&(p.value={limitId:n.value[0].id,name:n.value[0].name,description:n.value[0].description,ownerIds:n.value[0].ownerIds,providerIds:n.value[0].providerIds,accountIds:n.value[0].accountIds,resourceCategories:n.value[0].resourceCategories,resourceTypes:n.value[0].resourceTypes,tags:n.value[0].tags?n.value[0].tags:[],items:n.value[0].items?n.value[0].items:[]},g.value=!0)}function R(){u.value.validate(x=>{x&&Oe(t.value).then(()=>{l.value.fetchData(),f.value=!1})})}function M(){m.value.validate(x=>{x&&$e(p.value).then(()=>{l.value.fetchData(),g.value=!1})})}function H(){const c={limitIds:w()};Ae(c).then(()=>{l.value.fetchData()})}function K(){const c={limitIds:w()};Le(c).then(()=>{l.value.fetchData()})}function j(){const c={limitIds:w()};ze(c).then(()=>{l.value.fetchData()})}const k=d(),E=d(!1);function O(x){k.value=x,E.value=!0}return(x,c)=>{const B=y("ElButton"),Q=y("ElText"),I=y("ElTable");return b(),Y(P,null,[q("div",Ye,[e(F,{size:"small",type:"primary",onClick:N},{default:a(()=>[Pe]),_:1}),e(F,{size:"small",disabled:n.value.length!==1,"disabled-message":"请选择且只选择一项",onClick:D},{default:a(()=>[je]),_:1},8,["disabled"]),e(F,{size:"small",disabled:n.value.length===0,onClick:K,type:"success",plain:""},{default:a(()=>[Je]),_:1},8,["disabled"]),e(F,{size:"small",disabled:n.value.length===0,onClick:j,type:"danger",plain:""},{default:a(()=>[He]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:H},{reference:a(()=>[e(F,{disabled:n.value.length===0,type:"danger",plain:"",size:"small"},{default:a(()=>[Ke]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:v.value.search,"onUpdate:modelValue":c[0]||(c[0]=i=>v.value.search=i),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:l,"paging-request":v.value,"remote-method":o(qe),onSelectionChange:s},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"description",label:"描述"}),e(o(U),{prop:"disabled",label:"是否禁用",formatter:i=>i.disabled?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(U),null,{default:a(i=>[e(B,{link:"",type:"primary",onClick:()=>O(i.row)},{default:a(()=>[S("查看配额")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:f.value,"onUpdate:modelValue":c[2]||(c[2]=i=>f.value=i),title:"创建配额上限",onOnConfirm:R,size:"600"},{default:a(()=>[e(Qe,{ref_key:"createFormRef",ref:u,modelValue:t.value,"onUpdate:modelValue":c[1]||(c[1]=i=>t.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:g.value,"onUpdate:modelValue":c[4]||(c[4]=i=>g.value=i),title:"编辑配额上限",onOnConfirm:M,size:"600"},{default:a(()=>[e(Ge,{ref_key:"updateFormRef",ref:m,modelValue:p.value,"onUpdate:modelValue":c[3]||(c[3]=i=>p.value=i)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:E.value,"onUpdate:modelValue":c[5]||(c[5]=i=>E.value=i),title:"配额详情",size:"600"},{default:a(()=>[e(I,{data:k.value.items},{default:a(()=>[e(o(U),{prop:"usageTypeName",label:"配额项"}),e(o(U),{prop:"usageValue",label:"已使用量"}),e(o(U),{prop:"limitValue",label:"上限"}),e(o(U),{prop:"percentage",label:"百分比"},{default:a(i=>[i.row.percentage<=80?(b(),C(Q,{key:0,type:"success"},{default:a(()=>[S(X(i.row.percentage)+"% ",1)]),_:2},1024)):i.row.percentage>80&&i.row.percentage<100?(b(),C(Q,{key:1,type:"warning"},{default:a(()=>[S(X(i.row.percentage)+"% ",1)]),_:2},1024)):(b(),C(Q,{key:2,type:"danger"},{default:a(()=>[S(X(i.row.percentage)+"% ",1)]),_:2},1024))]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])],64)}}},Xe={style:{"margin-bottom":"10px",height:"32px"}},bl={__name:"Tenant",setup(r){const V=d(),l=d(!1),f=d(!1),g=d([]),n=d({}),v=d(),u=d({}),t=d(),m=d({});function p(I){g.value=I}function s(){return g.value.map(I=>I.id)}function w(){l.value=!0}function N(I){m.value={tenantId:I.id,name:I.name,description:I.description},f.value=!0}function D(){v.value.validate((I,i)=>{I&&pe(u.value).then(z=>{V.value.fetchData(),l.value=!1})})}function R(){t.value.validate((I,i)=>{I&&fe(m.value).then(z=>{V.value.fetchData(),f.value=!1})})}function M(){const i={tenantIds:s()};ve(i).then(z=>{V.value.fetchData()})}function H(){const i={tenantIds:s()};ce(i).then(z=>{V.value.fetchData()})}function K(){const i={tenantIds:s()};ge(i).then(z=>{V.value.fetchData()})}const j=d(),k=d(),E=d(!1);function O(I){j.value=[I.id],k.value=I.name,E.value=!0}const x=d(),c=d(),B=d(!1);function Q(I){x.value=[I.id],c.value=I.name,B.value=!0}return(I,i)=>{const z=y("ElButton");return b(),Y(P,null,[q("div",Xe,[e(F,{type:"primary",onClick:w},{default:a(()=>[S("创建")]),_:1}),e(F,{disabled:g.value.length===0,type:"success",plain:"",onClick:M},{default:a(()=>[S("启用")]),_:1},8,["disabled"]),e(F,{disabled:g.value.length===0,type:"danger",plain:"",onClick:H},{default:a(()=>[S("禁用")]),_:1},8,["disabled"]),e(o(le),{title:"确认删除",onConfirm:K},{reference:a(()=>[e(F,{disabled:g.value.length===0,type:"danger",plain:""},{default:a(()=>[S("删除")]),_:1},8,["disabled"])]),_:1}),e(o(G),{style:{float:"right",width:"20%"},modelValue:n.value.search,"onUpdate:modelValue":i[0]||(i[0]=T=>n.value.search=T),"suffix-icon":"search"},null,8,["modelValue"])]),e(Z,{ref_key:"tableRef",ref:V,"paging-request":n.value,"remote-method":o(Ve),onSelectionChange:p},{default:a(()=>[e(o(U),{type:"selection","reserve-selection":""}),e(o(U),{prop:"name",label:"名称",sortable:"custom"}),e(o(U),{prop:"parentName",label:"父级租户"}),e(o(U),{prop:"description",label:"描述"}),e(o(U),{prop:"disabled",label:"是否禁用",formatter:(T,Ze,me,el)=>me?"是":"否"},null,8,["formatter"]),e(o(U),{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(o(U),{"min-width":"100"},{default:a(T=>[e(z,{link:"",type:"primary",onClick:()=>N(T.row)},{default:a(()=>[S("编辑")]),_:2},1032,["onClick"]),e(z,{link:"",type:"primary",onClick:()=>O(T.row)},{default:a(()=>[S(" 规则管理 ")]),_:2},1032,["onClick"]),e(z,{link:"",type:"primary",onClick:()=>Q(T.row)},{default:a(()=>[S(" 配额上限 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e($,{modelValue:l.value,"onUpdate:modelValue":i[2]||(i[2]=T=>l.value=T),title:"创建租户",onOnConfirm:D},{default:a(()=>[e(be,{ref_key:"createTenantFormRef",ref:v,modelValue:u.value,"onUpdate:modelValue":i[1]||(i[1]=T=>u.value=T)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:f.value,"onUpdate:modelValue":i[4]||(i[4]=T=>f.value=T),title:"编辑租户",onOnConfirm:R},{default:a(()=>[e(Ee,{ref_key:"updateTenantFormRef",ref:t,modelValue:m.value,"onUpdate:modelValue":i[3]||(i[3]=T=>m.value=T)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e($,{modelValue:E.value,"onUpdate:modelValue":i[5]||(i[5]=T=>E.value=T),title:`规则管理(租户:${k.value})`,"no-confirm":"",size:"800"},{default:a(()=>[E.value?(b(),C(Fe,{key:0,"tenant-ids":j.value},null,8,["tenant-ids"])):A("",!0)]),_:1},8,["modelValue","title"]),e($,{modelValue:B.value,"onUpdate:modelValue":i[6]||(i[6]=T=>B.value=T),title:`配额上限(租户:${c.value})`,"no-confirm":"",size:"800"},{default:a(()=>[B.value?(b(),C(We,{key:0,"tenant-ids":x.value},null,8,["tenant-ids"])):A("",!0)]),_:1},8,["modelValue","title"])],64)}}};export{bl as default};
