import{_ as Q}from"./StratoTable-CDLvuijz.js";import{d as U,c as W,u as X,e as Y,a as Z,b as G}from"./account-B2XyNJSy.js";import{S as h}from"./StratoButton-BbyvpoLv.js";import{r as K}from"./asyncJob-BQqx-GkL.js";import{u as ee}from"./activeJob-DuWQaxKt.js";import{_ as w}from"./StratoDrawer-SANI4yOp.js";import{_ as N}from"./ProviderSelector-DMIPIlb1.js";import{_ as T}from"./StratoDynamicForm-7WrPYX7O.js";import{a7 as q,r as n,n as x,o as f,q as V,w as l,e,v as S,y as ae,A as te,u as R,a2 as le,a3 as oe,I as ne,d as O,t as B,af as re,b as ue,F as de,i as D,O as ie,f as se}from"./index-CGSAaZ7c.js";import"./request-BLvKnTIl.js";import"./StratoSelector-CcCz7NMM.js";import"./resource-ChSpNJ4i.js";import"./IpState-DbETxjvx.js";import"./UserSelector-D6CrvvR3.js";import"./StratoPagingSelector-BVtmGqMc.js";import"./user-zWqZjtFx.js";import"./role-BAGE53ge.js";import"./job-D_aeKnDK.js";import"./scriptDefinition-BbSCbaPp.js";const me={__name:"CreateAccountForm",props:{modelValue:{required:!0,default:{providerId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(k,{expose:I}){const a=q(k,"modelValue"),o=n(),r=n();I({validate:E});function E(_){r.value.validate((t,u)=>{t&&o.value.validate(_)})}const C=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),v=n();function m(_){v.value=_}return(_,t)=>{const u=x("ElFormItem"),b=x("ElInput"),A=x("ElForm");return f(),V(A,{ref_key:"formRef",ref:o,model:a.value,"label-position":"top",rules:C.value},{default:l(()=>{var c;return[e(u,{label:"云平台",prop:"providerId"},{default:l(()=>[e(N,{onChange:m,modelValue:a.value.providerId,"onUpdate:modelValue":t[0]||(t[0]=s=>a.value.providerId=s)},null,8,["modelValue"])]),_:1}),e(u,{label:"云账号名称",prop:"name"},{default:l(()=>[e(b,{modelValue:a.value.name,"onUpdate:modelValue":t[1]||(t[1]=s=>a.value.name=s)},null,8,["modelValue"])]),_:1}),v.value?(f(),V(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(c=v.value)==null?void 0:c.accountFormMetaData,modelValue:a.value.properties,"onUpdate:modelValue":t[2]||(t[2]=s=>a.value.properties=s)},null,8,["form-meta-data","modelValue"])):S("",!0),e(u,{label:"云账号描述",prop:"description"},{default:l(()=>[e(b,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":t[3]||(t[3]=s=>a.value.description=s)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},pe={__name:"UpdateAccountForm",props:{modelValue:{required:!0,default:{externalAccountId:void 0,name:void 0,description:void 0,properties:{}}},modelModifiers:{}},emits:["update:modelValue"],setup(k,{expose:I}){const a=q(k,"modelValue"),o=n(),r=n();I({validate:E});function E(t){r.value.validate((u,b)=>{u&&o.value.validate(t)})}const C=n({providerId:[{required:!0,message:"请选择云平台"}],name:[{required:!0,message:"请输入云账号名称"}]}),v=n(),m=n();function _(t){m.value=t}return ae(()=>{a.value.externalAccountId&&U({accountIds:[a.value.externalAccountId]}).then(t=>{t.content&&t.content.length>0&&(v.value=t.content[0])})}),(t,u)=>{const b=x("ElFormItem"),A=x("ElInput"),c=x("ElForm");return f(),V(c,{ref_key:"formRef",ref:o,model:a.value,"label-position":"top",rules:C.value},{default:l(()=>{var s;return[e(b,{label:"云平台"},{default:l(()=>[v.value?(f(),V(N,{key:0,disabled:"",onChange:_,"model-value":v.value.providerId},null,8,["model-value"])):S("",!0)]),_:1}),e(b,{label:"云账号名称",prop:"name"},{default:l(()=>[e(A,{modelValue:a.value.name,"onUpdate:modelValue":u[0]||(u[0]=g=>a.value.name=g)},null,8,["modelValue"])]),_:1}),m.value?(f(),V(T,{key:0,ref_key:"dynamicFormRef",ref:r,"form-meta-data":(s=m.value)==null?void 0:s.accountFormMetaData,modelValue:a.value.properties,"onUpdate:modelValue":u[1]||(u[1]=g=>a.value.properties=g)},null,8,["form-meta-data","modelValue"])):S("",!0),e(b,{label:"云账号描述",prop:"description"},{default:l(()=>[e(A,{type:"textarea",modelValue:a.value.description,"onUpdate:modelValue":u[2]||(u[2]=g=>a.value.description=g)},null,8,["modelValue"])]),_:1})]}),_:1},8,["model","rules"])}}},ce={style:{"margin-left":"2px"}},fe={__name:"AccountState",props:{state:{required:!0}},setup(k){const I=k,a={CONNECTED:{name:"已连接",icon:"Check",type:"success"},CONNECTION_LOST:{name:"失去连接",icon:"Warning",type:"warning"},CREDENTIAL_EXPIRED:{name:"凭证失效",icon:"Close",type:"danger"}},o=te(()=>{let r=a[I.state];return r===void 0&&(r={name:I.state,icon:"QuestionFilled",type:"warning"}),r});return(r,E)=>(f(),V(R(re),{size:"small",type:o.value.type,style:{"font-size":"12px"}},{default:l(()=>[e(R(le),{class:oe(o.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(f(),V(ne(o.value.icon)))]),_:1},8,["class"]),O("span",ce,B(o.value.name),1)]),_:1},8,["type"]))}},ve={style:{"margin-bottom":"10px"}},Oe={__name:"ExternalAccount",setup(k){const I=ee(),a=n({}),o=n([]),r=n(),E=n(!1);function C(){return o.value.map(i=>i.id)}function v(i){o.value=i}const m=n(!1),_=n(),t=n(!1),u=n({providerId:void 0,name:void 0,description:void 0,properties:{}});function b(){u.value={providerId:void 0,name:void 0,description:void 0,properties:{}},m.value=!0}function A(){_.value.validate((i,p)=>{i&&(t.value=!0,W(u.value).then(()=>{m.value=!1,r.value.fetchData()}).finally(()=>{t.value=!1}))})}const c=n(),s=n(),g=n(!1),F=n({externalAccountId:void 0,name:void 0,description:void 0,properties:{}});function $(i){F.value.externalAccountId=i.id,F.value.name=i.name,F.value.description=i.description,F.value.properties=i.properties,c.value=!0}function P(){s.value.validate(i=>{i&&(g.value=!0,X(F.value).then(()=>{c.value=!1,r.value.fetchData()}).finally(()=>{g.value=!1}))})}function L(){o.value.length!==0&&(E.value=!0,K({jobType:"SYNCHRONIZE_ACCOUNTS",jobParameters:{accountIds:C()}}).then(i=>{I.setActiveJobId(i.jobId),r.value.fetchData()}).finally(()=>{E.value=!1}))}function M(){o.value.length!==0&&Y({accountIds:C()}).then(()=>{r.value.fetchData()})}function J(){o.value.length!==0&&Z({accountIds:C()}).then(()=>{r.value.fetchData()})}function j(){o.value.length!==0&&G({externalAccountIds:C()}).then(()=>{r.value.fetchData()})}return(i,p)=>{const y=x("ElTableColumn"),z=x("ElButton");return f(),ue(de,null,[O("div",ve,[e(h,{type:"primary",onClick:b},{default:l(()=>[D("创建")]),_:1}),e(h,{disabled:o.value.length===0,plain:"",loading:E.value,onClick:L},{default:l(()=>[D("同步")]),_:1},8,["disabled","loading"]),e(h,{disabled:o.value.length===0,type:"success",plain:"",onClick:M},{default:l(()=>[D("启用")]),_:1},8,["disabled"]),e(h,{disabled:o.value.length===0,type:"danger",plain:"",onClick:J},{default:l(()=>[D("禁用")]),_:1},8,["disabled"]),e(R(ie),{title:"确认删除",onConfirm:j},{reference:l(()=>[e(h,{disabled:o.value.length===0,type:"danger",plain:""},{default:l(()=>[D("删除")]),_:1},8,["disabled"])]),_:1}),e(R(se),{style:{float:"right",width:"20%"},modelValue:a.value.search,"onUpdate:modelValue":p[0]||(p[0]=d=>a.value.search=d),"suffix-icon":"search"},null,8,["modelValue"])]),e(Q,{ref_key:"accountTableRef",ref:r,"paging-request":a.value,"remote-method":R(U),onSelectionChange:v},{default:l(()=>[e(y,{type:"selection","reserve-selection":""}),e(y,{prop:"name",label:"名称",sortable:"custom"}),e(y,{prop:"providerId",label:"云平台",sortable:"custom"},{default:l(d=>[D(B(d.row.providerName),1)]),_:1}),e(y,{prop:"state",label:"状态",sortable:"custom"},{default:l(d=>[e(fe,{state:d.row.state},null,8,["state"])]),_:1}),e(y,{prop:"balance",label:"余额",sortable:"custom"}),e(y,{prop:"description",label:"描述"}),e(y,{prop:"disabled",label:"是否禁用",formatter:(d,_e,H,be)=>H?"是":"否"},null,8,["formatter"]),e(y,{prop:"createdAt",label:"创建时间",sortable:"custom"}),e(y,null,{default:l(d=>[e(z,{link:"",type:"primary",onClick:()=>$(d.row)},{default:l(()=>[D("编辑")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["paging-request","remote-method"]),e(w,{loading:t.value,modelValue:m.value,"onUpdate:modelValue":p[2]||(p[2]=d=>m.value=d),title:"创建云账号",onOnConfirm:A},{default:l(()=>[m.value?(f(),V(me,{key:0,ref_key:"createFormRef",ref:_,modelValue:u.value,"onUpdate:modelValue":p[1]||(p[1]=d=>u.value=d)},null,8,["modelValue"])):S("",!0)]),_:1},8,["loading","modelValue"]),e(w,{loading:g.value,modelValue:c.value,"onUpdate:modelValue":p[4]||(p[4]=d=>c.value=d),title:"编辑云账号",onOnConfirm:P},{default:l(()=>[c.value?(f(),V(pe,{key:0,ref_key:"updateFormRef",ref:s,modelValue:F.value,"onUpdate:modelValue":p[3]||(p[3]=d=>F.value=d)},null,8,["modelValue"])):S("",!0)]),_:1},8,["loading","modelValue"])],64)}}};export{Oe as default};
