import{A as K,n as C,o as f,q as y,w as l,d as S,e as r,u as b,a4 as ve,a2 as _e,a3 as ge,I as M,t as w,aa as Ee,ab as Ie,r as d,b as T,i as V,v as A,a7 as P,F as U,ac as L,a8 as k,m as ee,E as j,j as G,y as J,_ as he,a9 as ye,B as te,G as oe,H as ae,x as X,a1 as Ce,U as q,V as Oe,ad as Q,f as be}from"./index-C_jnbPMf.js";import{s as F,u as H,l as le}from"./request-BV6gXtmx.js";import{_ as Re}from"./StratoTable--zpPaOW_.js";import{S as z}from"./StratoButton-D7m4JR2l.js";import{_ as $}from"./StratoDrawer-BQ9z9CYD.js";import{_ as Ve}from"./StratoSelector-Csy36wxr.js";import{_ as se}from"./StratoPagingSelector-BY9rDrJk.js";import{d as we}from"./workflow-CLa2u6qS.js";import{_ as Ae,a as Se,b as Te,c as xe,d as Ue}from"./UpdateUserGroupForm-DiKiLtPX.js";import{_ as De}from"./UserSelector-Bks_jgjv.js";import{_ as Fe}from"./AccountSelector-yRinDs2o.js";import{a as ke,e as Ne,g as Be,f as ze,d as $e,c as qe,_ as Le,b as Pe}from"./ClaimResourcesForm-B1EPLqtI.js";import{_ as He}from"./CreateResourceForm-CPnav3GR.js";import{k as Me}from"./resource-DdTtSOFP.js";import{b as je}from"./ResourceSelector-D-bu7cxQ.js";import{v as re}from"./FormUtil-BL1Y36f_.js";import{b as We,a as Ke,_ as Ge}from"./TransferStacksForm-sv-BrmVc.js";import"./TenantTreeSelector-DrVO4R-0.js";import"./TagValueSelectorGroup-kSkYehu4.js";import"./tag-CWCUpvbv.js";import"./user-BKxh-AQB.js";import"./account-DxeVqvnD.js";import"./AccountContext-Bp4LXd0C.js";import"./StratoDynamicForm-BeoKTVDl.js";import"./IpState-yQwbBpiP.js";import"./role-DAS94606.js";import"./job-B1agJq36.js";import"./scriptDefinition-BwQHe3UI.js";import"./blueprint-BwvMAK18.js";const ne=e=>F({url:"/order-service/describe-orders",method:"post",data:e}),Je=e=>F({url:"/order-service/describe-order-rollback-targets",method:"post",data:e}),Ye=e=>F({url:"/order-service/update-order-item",method:"post",data:e}),Qe=e=>F({url:"/order-service/submit-order",method:"post",data:e}),Ze=e=>F({url:"/order-service/approve-order",method:"post",data:e}),Xe=e=>F({url:"/order-service/confirm-order",method:"post",data:e}),et=e=>F({url:"/order-service/rollback-order",method:"post",data:e}),tt=e=>F({url:"/order-service/reject-order",method:"post",data:e}),rt=e=>F({url:"/order-service/cancel-order",method:"post",data:e}),lt=e=>F({url:"/order-service/deny-order",method:"post",data:e}),ot=e=>F({url:"/order-service/clone-order",method:"post",data:e}),at=e=>F({url:"/order-service/create-order",method:"post",data:e}),st={style:{"margin-left":"2px"}},nt=["innerHTML"],de={__name:"OrderState",props:{state:{required:!0},errorMessage:{required:!1}},setup(e){const u=e,t={AWAIT_SUBMIT:{name:"待提交",icon:"Clock",type:"info"},PENDING:{icon:"Loading",type:"info"},CANCELED:{name:"已取消",icon:"CircleClose",type:"danger"},DENIED:{name:"已拒绝",icon:"CircleClose",type:"danger"},REJECTED:{name:"已驳回",icon:"Back",type:"warning"},PROCESS_ROLLED_BACK:{name:"已回退",icon:"Back",type:"warning"},AWAIT_APPROVAL:{name:"待审批",icon:"Avatar",type:"warning"},AWAIT_CONFIRM:{name:"待确认",icon:"User",type:"warning"},EXECUTING:{name:"执行中",icon:"Loading"},FINISHED:{name:"已完成",icon:"Check",type:"success"},FAILED:{name:"已失败",icon:"Delete",type:"danger"}},o=K(()=>{let a=t[u.state];return a===void 0&&(a={name:u.state,icon:"QuestionFilled",type:"warning"}),a});return(a,s)=>{const n=C("ElTooltip");return f(),y(n,{disabled:e.state!=="FAILED"},{content:l(()=>[S("div",{style:{"max-width":"500px","white-space":"pre-wrap"},innerHTML:e.errorMessage},null,8,nt)]),default:l(()=>[r(b(ve),{type:o.value.type,style:{"font-size":"12px"}},{default:l(()=>[r(b(_e),{class:ge(o.value.icon==="Loading"?"is-loading":"")},{default:l(()=>[(f(),y(M(o.value.icon)))]),_:1},8,["class"]),S("span",st,w(o.value.name),1)]),_:1},8,["type"])]),_:1},8,["disabled"])}}};class ue{constructor(){this.orderItemChangeDetector=[]}registerOrderItemChangeDetector(u){this.orderItemChangeDetector.push(u)}isAnyOrderItemChanged(){for(let u of this.orderItemChangeDetector)if(u())return!0;return!1}}function dt(){const e=new ue;return Ee("orderContext",e),e}function Y(){return Ie("orderContext",new ue)}const ut={__name:"OrderSubmitButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=u,a=d(!1),s=d(!1),n=Y(),p=d(!1);function i(){p.value=n.isAnyOrderItemChanged(),a.value=!0}const I=d({}),h=d();function O(){h.value.validate(c=>{c&&(I.value.orderId=t.selectedOrders[0].id,s.value=!0,Qe(I.value).then(m=>{a.value=!1,o("refresh")}).finally(()=>{s.value=!1}))})}function R(){const c=["AWAIT_SUBMIT","REJECTED"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)}return(c,m)=>{const _=C("ElText"),g=C("ElFormItem"),E=C("ElInput"),v=C("ElForm");return R()?(f(),T(U,{key:0},[r(z,{type:"success",plain:"",size:e.size,onClick:i,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 提交 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:a.value,"onUpdate:modelValue":m[1]||(m[1]=x=>a.value=x),title:"提交工单",loading:s.value,onOnConfirm:O},{default:l(()=>[r(v,{ref_key:"formRef",ref:h,model:I.value,"label-position":"top"},{default:l(()=>[p.value?(f(),y(g,{key:0},{default:l(()=>[r(_,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击提交 ")]),_:1})]),_:1})):A("",!0),r(g,{label:"提交说明"},{default:l(()=>[r(E,{type:"textarea",modelValue:I.value.message,"onUpdate:modelValue":m[0]||(m[0]=x=>I.value.message=x)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},it={__name:"OrderApproveButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1),p=Y(),i=d(!1);function I(){i.value=p.isAnyOrderItemChanged(),s.value=!0}const h=d({}),O=d();function R(){O.value.validate(_=>{_&&(h.value.orderId=t.selectedOrders[0].id,n.value=!0,Ze(h.value).then(g=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function c(){var _;return t.selectedOrders.length===0?!1:((_=t.selectedOrders[0].possibleHandlers)==null?void 0:_.findIndex(g=>g.userId===o.userId))!==-1}function m(){const _=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&_.includes(t.selectedOrders[0].status)&&c()}return(_,g)=>{const E=C("ElText"),v=C("ElFormItem"),x=C("ElInput"),N=C("ElForm");return m()?(f(),T(U,{key:0},[r(z,{type:"success",plain:"",size:e.size,onClick:I,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 通过 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=B=>s.value=B),title:"审批通过",loading:n.value,onOnConfirm:R},{default:l(()=>[r(N,{ref_key:"formRef",ref:O,model:h.value,"label-position":"top"},{default:l(()=>[i.value?(f(),y(v,{key:0},{default:l(()=>[r(E,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击通过 ")]),_:1})]),_:1})):A("",!0),r(v,{label:"审批意见"},{default:l(()=>[r(x,{type:"textarea",modelValue:h.value.message,"onUpdate:modelValue":g[0]||(g[0]=B=>h.value.message=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},mt={__name:"OrderDenyButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1);function p(){s.value=!0}const i=d({}),I=d();function h(){I.value.validate(c=>{c&&(i.value.orderId=t.selectedOrders[0].id,n.value=!0,lt(i.value).then(m=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function O(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function R(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&O()}return(c,m)=>{const _=C("ElInput"),g=C("ElFormItem"),E=C("ElForm");return R()?(f(),T(U,{key:0},[r(z,{type:"danger",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 拒绝 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":m[1]||(m[1]=v=>s.value=v),title:"拒绝工单",loading:n.value,onOnConfirm:h},{default:l(()=>[r(E,{ref_key:"formRef",ref:I,model:i.value,"label-position":"top"},{default:l(()=>[r(g,{label:"审批意见"},{default:l(()=>[r(_,{type:"textarea",modelValue:i.value.message,"onUpdate:modelValue":m[0]||(m[0]=v=>i.value.message=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},ct={__name:"OrderRejectButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1);function p(){s.value=!0}const i=d({}),I=d();function h(){I.value.validate(c=>{c&&(i.value.orderId=t.selectedOrders[0].id,n.value=!0,tt(i.value).then(m=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function O(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function R(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&O()}return(c,m)=>{const _=C("ElInput"),g=C("ElFormItem"),E=C("ElForm");return R()?(f(),T(U,{key:0},[r(z,{type:"warning",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 驳回至申请人 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":m[1]||(m[1]=v=>s.value=v),title:"驳回至申请人",loading:n.value,onOnConfirm:h},{default:l(()=>[r(E,{ref_key:"formRef",ref:I,model:i.value,"label-position":"top"},{default:l(()=>[r(g,{label:"审批意见"},{default:l(()=>[r(_,{type:"textarea",modelValue:i.value.message,"onUpdate:modelValue":m[0]||(m[0]=v=>i.value.message=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},ft={style:{color:"grey"}},pt={__name:"RollbackTargetSelector",props:L({orderId:{required:!0}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=d({orderId:e.orderId}),o=k(e,"modelValue");return(a,s)=>(f(),y(Ve,{modelValue:o.value,"onUpdate:modelValue":s[0]||(s[0]=n=>o.value=n),placeholder:"请选择回退节点",request:t.value,"remote-method":b(Je),"list-getter":n=>n.targets,"label-getter":n=>n.nodeName,"value-getter":n=>n.nodeId},{default:l(n=>{var p;return[S("div",null,w(n.row.nodeName),1),S("div",ft,w((p=n.row.possibleHandlers)==null?void 0:p.map(i=>i.realName).join()),1)]}),_:1},8,["modelValue","request","remote-method","list-getter","label-getter","value-getter"]))}},vt={__name:"OrderRollbackButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1);function p(){s.value=!0}const i=d({}),I=d();function h(){I.value.validate(c=>{c&&(i.value.orderId=t.selectedOrders[0].id,n.value=!0,et(i.value).then(m=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function O(){var c;return t.selectedOrders.length===0?!1:((c=t.selectedOrders[0].possibleHandlers)==null?void 0:c.findIndex(m=>m.userId===o.userId))!==-1}function R(){const c=["AWAIT_APPROVAL","PROCESS_ROLLED_BACK"];return t.selectedOrders.length>0&&c.includes(t.selectedOrders[0].status)&&O()}return(c,m)=>{const _=C("ElFormItem"),g=C("ElInput"),E=C("ElForm");return R()?(f(),T(U,{key:0},[r(z,{type:"warning",plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 退回至审批人 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":m[2]||(m[2]=v=>s.value=v),title:"退回至审批人",loading:n.value,onOnConfirm:h},{default:l(()=>[s.value?(f(),y(E,{key:0,ref_key:"formRef",ref:I,model:i.value,"label-position":"top"},{default:l(()=>[r(_,{label:"退回至",prop:"nodeId"},{default:l(()=>[r(pt,{modelValue:i.value.nodeId,"onUpdate:modelValue":m[0]||(m[0]=v=>i.value.nodeId=v),"order-id":e.selectedOrders[0].id},null,8,["modelValue","order-id"])]),_:1}),r(_,{label:"审批意见"},{default:l(()=>[r(g,{type:"textarea",modelValue:i.value.message,"onUpdate:modelValue":m[1]||(m[1]=v=>i.value.message=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])):A("",!0)]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},_t={__name:"OrderCancelButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1);function p(){s.value=!0}const i=d({}),I=d();function h(){I.value.validate(R=>{R&&(i.value.orderId=t.selectedOrders[0].id,n.value=!0,rt(i.value).then(c=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function O(){const R=["AWAIT_SUBMIT","REJECTED","PROCESS_ROLLED_BACK","AWAIT_APPROVAL","AWAIT_CONFIRM"];return t.selectedOrders.length>0&&R.includes(t.selectedOrders[0].status)&&(o.isSuperAdmin||t.selectedOrders.every(c=>c.id===o.userId))}return(R,c)=>{const m=C("ElInput"),_=C("ElFormItem"),g=C("ElForm");return O()?(f(),T(U,{key:0},[r(z,{plain:"",size:e.size,onClick:p,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 取消工单 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":c[1]||(c[1]=E=>s.value=E),title:"取消工单",loading:n.value,onOnConfirm:h},{default:l(()=>[r(g,{ref_key:"formRef",ref:I,model:i.value,"label-position":"top"},{default:l(()=>[r(_,{label:"取消说明"},{default:l(()=>[r(m,{type:"textarea",modelValue:i.value.message,"onUpdate:modelValue":c[0]||(c[0]=E=>i.value.message=E)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},gt={__name:"OrderConfirmButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=H(),a=u,s=d(!1),n=d(!1),p=Y(),i=d(!1);function I(){i.value=p.isAnyOrderItemChanged(),s.value=!0}const h=d({}),O=d();function R(){O.value.validate(_=>{_&&(h.value.orderId=t.selectedOrders[0].id,n.value=!0,Xe(h.value).then(g=>{s.value=!1,a("refresh")}).finally(()=>{n.value=!1}))})}function c(){var _;return t.selectedOrders.length===0?!1:((_=t.selectedOrders[0].possibleHandlers)==null?void 0:_.findIndex(g=>g.userId===o.userId))!==-1}function m(){const _=["AWAIT_CONFIRM"];return t.selectedOrders.length>0&&_.includes(t.selectedOrders[0].status)&&c()}return(_,g)=>{const E=C("ElText"),v=C("ElFormItem"),x=C("ElInput"),N=C("ElForm");return m()?(f(),T(U,{key:0},[r(z,{type:"success",plain:"",size:e.size,onClick:I,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项"},{default:l(()=>[V(" 确认 ")]),_:1},8,["size","disabled"]),(f(),y(P,{to:"body"},[r($,{modelValue:s.value,"onUpdate:modelValue":g[1]||(g[1]=B=>s.value=B),title:"确认工单",loading:n.value,onOnConfirm:R},{default:l(()=>[i.value?(f(),y(v,{key:0},{default:l(()=>[r(E,{type:"warning"},{default:l(()=>[V(" 检测到当前页面存在工单项修改后未保存，如需保存，请前往工单详情页点击对应的[保存工单项]后再次点击确认 ")]),_:1})]),_:1})):A("",!0),r(N,{ref_key:"formRef",ref:O,model:h.value,"label-position":"top"},{default:l(()=>[r(v,{label:"审批意见"},{default:l(()=>[r(x,{type:"textarea",modelValue:h.value.message,"onUpdate:modelValue":g[0]||(g[0]=B=>h.value.message=B)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","loading"])]))],64)):A("",!0)}}},Et={__name:"OrderCloneButton",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=u,a=d({}),s=d(!1);function n(){a.value.orderId=t.selectedOrders[0].id,s.value=!0,ot(a.value).then(i=>{o("refresh")}).finally(()=>{s.value=!1})}function p(){return t.selectedOrders.length>0}return(i,I)=>p()?(f(),y(z,{key:0,plain:"",size:e.size,onClick:n,disabled:e.selectedOrders.length!==1,"disabled-message":"请只选择一项",loading:s.value},{default:l(()=>[V(" 克隆 ")]),_:1},8,["size","disabled","loading"])):A("",!0)}},It={__name:"WorkflowSelector",props:L({placeholder:{required:!1,default:"请选择流程"},multiple:{required:!1,default:!1,type:Boolean}},{modelValue:{},modelModifiers:{}}),emits:L(["change"],["update:modelValue"]),setup(e,{emit:u}){const t=k(e,"modelValue"),o=e,a=d({workflowIds:o.multiple?t.value:t.value?[t.value]:void 0});ee(()=>t.value,()=>{a.value.workflowIds=o.multiple?t.value:t.value?[t.value]:void 0});const s=u;function n(p){s("change",p)}return(p,i)=>(f(),y(se,{modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=I=>t.value=I),"paging-request":a.value,"label-getter":I=>I.name,placeholder:e.placeholder,"remote-method":b(we),multiple:e.multiple,onChange:n},null,8,["modelValue","paging-request","label-getter","placeholder","remote-method","multiple"]))}},ht={__name:"RemoveUsersFromGroupForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:u}){const t=k(e,"modelValue"),o=d();u({validate:a});function a(n){o.value.validate(n)}const s=d({userGroupId:[{required:!0,message:"请选择用户组"}],userIds:[{required:!0,message:"请选择用户"}]});return(n,p)=>(f(),y(b(G),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:s.value},{default:l(()=>[r(b(j),{label:"用户组",prop:"userGroupId"},{default:l(()=>[r(Ae,{"all-groups":"",modelValue:t.value.userGroupId,"onUpdate:modelValue":p[0]||(p[0]=i=>t.value.userGroupId=i)},null,8,["modelValue"])]),_:1}),r(b(j),{label:"移除用户",prop:"userIds"},{default:l(()=>[r(De,{multiple:"",modelValue:t.value.userIds,"onUpdate:modelValue":p[1]||(p[1]=i=>t.value.userIds=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},yt={__name:"SynchronizeAccountsForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:u}){const t=k(e,"modelValue"),o=d();u({validate:a});function a(n){o.value.validate(n)}const s=d({accountIds:[{required:!0,message:"请选择云账号"}]});return(n,p)=>(f(),y(b(G),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:s.value},{default:l(()=>[r(b(j),{label:"云账号",prop:"accountIds"},{default:l(()=>[r(Fe,{modelValue:t.value.accountIds,"onUpdate:modelValue":p[0]||(p[0]=i=>t.value.accountIds=i),multiple:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Ct={style:{float:"left"}},Ot={style:{float:"right",color:"grey"}},bt={__name:"RelationshipSelector",props:L({disabled:{required:!1,type:Boolean,default:!1}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const u=k(e,"modelValue"),t=d({relationshipIds:u.value});ee(u,()=>{t.value.relationshipIds=u.value});function o(a){return a.source.name+" -> "+a.target.name}return(a,s)=>(f(),y(se,{modelValue:u.value,"onUpdate:modelValue":s[0]||(s[0]=n=>u.value=n),disabled:e.disabled,"paging-request":t.value,"label-getter":o,"remote-method":b(Me),placeholder:"请选择关系"},{default:l(n=>[S("span",Ct,w(o(n.row)),1),S("span",Ot,[r(ke,{state:n.row.state},null,8,["state"]),V("   ")])]),_:1},8,["modelValue","disabled","paging-request","remote-method"]))}},Rt={__name:"DisconnectResourcesForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:u}){const t=k(e,"modelValue"),o=d();u({validate:a});function a(n){o.value.validate(n)}const s=d({relationshipIds:[{required:!0,message:"请选择资源关系"}]});return(n,p)=>(f(),y(b(G),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:s.value},{default:l(()=>[r(b(j),{label:"解除关系",prop:"relationshipIds"},{default:l(()=>[r(bt,{modelValue:t.value.relationshipIds,"onUpdate:modelValue":p[0]||(p[0]=i=>t.value.relationshipIds=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},Vt={__name:"RestoreResourcesForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:u}){const t=k(e,"modelValue"),o=d();u({validate:a});function a(n){o.value.validate(n)}const s=d({resourceIds:[{required:!0,message:"请选择资源"}]});return(n,p)=>(f(),y(b(G),{ref_key:"formRef",ref:o,model:t.value,"label-position":"top",rules:s.value},{default:l(()=>[r(b(j),{label:"资源",prop:"resourceIds"},{default:l(()=>[r(je,{multiple:"",modelValue:t.value.resourceIds,"onUpdate:modelValue":p[0]||(p[0]=i=>t.value.resourceIds=i)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]))}},wt={style:{width:"100%",height:"24px"}},At={__name:"BatchFormWrapper",props:L({formComponent:{required:!0,type:Object},itemsPath:{required:!0},cardTitle:{required:!0},enableEdit:{required:!0,type:Boolean}},{modelValue:{required:!0,type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:u}){const t=e,o=k(e,"modelValue"),a=K(()=>o.value[t.itemsPath]);J(()=>{console.log(a.value)});function s(O){o.value[t.itemsPath].splice(O,1)}function n(){o.value[t.itemsPath].push(p.value.getDefaultFormData())}const p=d(),i=d(),I=d([]);u({validate:h});function h(O){re(I.value,O)}return(O,R)=>{const c=C("ElButton"),m=C("ElCard");return f(),T(U,null,[he((f(),y(M(e.formComponent),{ref_key:"hiddenFormRef",ref:p,modelValue:i.value,"onUpdate:modelValue":R[0]||(R[0]=_=>i.value=_)},null,8,["modelValue"])),[[ye,!1]]),(f(!0),T(U,null,te(a.value,(_,g)=>(f(),y(m,{style:{"margin-bottom":"12px"}},{header:l(()=>[S("div",wt,[S("span",null,w(e.cardTitle+(g+1)),1),e.enableEdit?(f(),y(c,{key:0,link:"",icon:"Close",type:"danger",style:{float:"right"},onClick:()=>s(g)},null,8,["onClick"])):A("",!0)])]),default:l(()=>[(f(),y(M(e.formComponent),{ref_for:!0,ref_key:"formRefs",ref:I,modelValue:a.value[g],"onUpdate:modelValue":E=>a.value[g]=E},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024))),256)),e.enableEdit?(f(),y(c,{key:0,style:{width:"100%"},icon:"Plus",onClick:n},{default:l(()=>[V(" 添加"+w(e.cardTitle),1)]),_:1})):A("",!0)],64)}}},St={__name:"FormDataPathWrapper",props:L({formComponent:{required:!0,type:Object},formDataPath:{required:!0}},{modelValue:{required:!0,type:Object},modelModifiers:{}}),emits:["update:modelValue"],setup(e,{expose:u}){const t=k(e,"modelValue"),o=d();u({validate:a});function a(s){re([o.value],s)}return(s,n)=>(f(),y(M(e.formComponent),{ref_key:"formRef",ref:o,modelValue:t.value[e.formDataPath],"onUpdate:modelValue":n[0]||(n[0]=p=>t.value[e.formDataPath]=p)},null,8,["modelValue"]))}};function ie(e){return["AWAIT_SUBMIT","REJECTED","PROCESS_ROLLED_BACK","AWAIT_APPROVAL","AWAIT_CONFIRM"].includes(e)}function Tt(e){switch(e){case"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS":return{changes:[]};case"BATCH_CONNECT_RESOURCES":return{connections:[]};case"BATCH_CREATE_RESOURCES":return{resources:[]};case"BATCH_RECYCLE_RESOURCES":return{resources:[]};case"BATCH_RUN_RESOURCE_ACTIONS":return{actions:[]};case"TRANSFER_RESOURCES":return{transfers:[]};case"CLAIM_RESOURCES":return{claims:[]};default:return{}}}function me(e,u){switch(e){case"CREATE_USER_GROUP":return Ue;case"INVITE_USERS_TO_GROUP":return xe;case"JOIN_USER_GROUP":return Te;case"REMOVE_USERS_FROM_GROUP":return ht;case"UPDATE_USER_GROUP":return Se;case"SYNCHRONIZE_ACCOUNTS":return yt;case"BATCH_CHANGE_ESSENTIAL_REQUIREMENTS":return Z(Pe,u,"changes","变更");case"BATCH_CONNECT_RESOURCES":return Z(Le,u,"connections","资源关系");case"BATCH_DISCONNECT_RESOURCES":return Rt;case"BATCH_CREATE_RESOURCES":return Z(He,u,"resources","资源");case"BATCH_RECYCLE_RESOURCES":return W(qe,"resources");case"BATCH_RESTORE_RESOURCES":return Vt;case"BATCH_RUN_RESOURCE_ACTIONS":return W($e,"actions");case"SYNCHRONIZE_RESOURCES":return Ne;case"TRANSFER_RESOURCES":return W(ze,"transfers");case"CLAIM_RESOURCES":return W(Be,"claims");case"CREATE_RESOURCE_STACKS":return Ge;case"RECYCLE_RESOURCE_STACKS":return Ke;case"TRANSFER_STACKS":return We}}function Z(e,u,t,o){const a=ie(u),s=d();return oe({setup(){return()=>ae(At,{formComponent:e,itemsPath:t,cardTitle:o,enableEdit:a,ref:s})},expose:["validate"],methods:{validate(n){s.value.validate(n)}}})}function W(e,u){const t=d();return oe({setup(){return()=>ae(St,{formComponent:e,formDataPath:u,ref:t})},expose:["validate"],methods:{validate(o){t.value.validate(o)}}})}const xt={key:0,style:{"margin-top":"24px"}},Ut={style:{"font-size":"16px"}},Dt={__name:"CreateOrderButton",emits:["refresh"],setup(e,{emit:u}){const t=d(),o=d(),a=d(),s={};function n(g){if(g&&!(t.value&&g.id===t.value.workflowId)){a.value=g,t.value={orderName:void 0,note:void 0,workflowId:g.id,items:g.nodes.filter(E=>E.nodeType==="JOB_NODE").map(E=>({jobNodeKey:E.nodeKey,parameters:Tt(E.nodeProperties.jobType)}))};for(let E of g.nodes.filter(v=>v.nodeType==="JOB_NODE")){const v=i(E.nodeKey);if(!v){X.warning("此流程不支持新建工单"),_();return}s[E.nodeKey]=v}}}function p(g){return a.value.nodes.filter(E=>E.nodeType==="JOB_NODE").filter(E=>E.nodeKey===g)[0]}function i(g){const E=p(g);return me(E.nodeProperties.jobType,"AWAIT_SUBMIT")}const I=d(!1),h=d(!1);function O(){h.value=!0}const R=u;function c(){if(!t.value){X.warning("请先选择流程");return}re(m.value,g=>{g&&(I.value=!0,at(t.value).then(E=>{console.log("Order created: "+E.orderId),h.value=!1,_(),R("refresh")}).finally(()=>{I.value=!1}))})}const m=d([]);function _(){t.value=void 0,a.value=void 0,o.value=void 0}return(g,E)=>{const v=C("ElFormItem"),x=C("ElInput"),N=C("ElForm"),B=C("ElCard");return f(),T(U,null,[r(z,{type:"primary",plain:"",onClick:O},{default:l(()=>[V(" 新建 ")]),_:1}),(f(),y(P,{to:"body"},[h.value?(f(),y($,{key:0,modelValue:h.value,"onUpdate:modelValue":E[3]||(E[3]=D=>h.value=D),title:"新建工单",loading:I.value,onOnConfirm:c,onOnClose:_,size:1e3},{default:l(()=>[r(N,{"label-position":"top"},{default:l(()=>[r(v,{label:"流程"},{default:l(()=>[r(It,{modelValue:o.value,"onUpdate:modelValue":E[0]||(E[0]=D=>o.value=D),onChange:n},null,8,["modelValue"])]),_:1}),t.value?(f(),y(v,{key:0,label:"工单标题"},{default:l(()=>[r(x,{placeholder:"留空则自动生成",modelValue:t.value.orderName,"onUpdate:modelValue":E[1]||(E[1]=D=>t.value.orderName=D)},null,8,["modelValue"])]),_:1})):A("",!0),t.value?(f(),y(v,{key:1,label:"备注"},{default:l(()=>[r(x,{type:"textarea",modelValue:t.value.note,"onUpdate:modelValue":E[2]||(E[2]=D=>t.value.note=D)},null,8,["modelValue"])]),_:1})):A("",!0)]),_:1}),t.value?(f(),T("div",xt,[(f(!0),T(U,null,te(t.value.items,(D,fe)=>(f(),y(B,{shadow:"never"},{header:l(()=>[S("span",Ut,w(`工单项${fe+1}: ${p(D.jobNodeKey).nodeName}`),1)]),default:l(()=>[(f(),y(M(s[D.jobNodeKey]),{ref_for:!0,ref_key:"orderItemFormRefs",ref:m,modelValue:D.parameters,"onUpdate:modelValue":pe=>D.parameters=pe},null,8,["modelValue","onUpdate:modelValue"]))]),_:2},1024))),256))])):A("",!0)]),_:1},8,["modelValue","loading"])):A("",!0)]))],64)}}},ce={__name:"OrderButtonsGroup",props:{selectedOrders:{required:!0,default:[],type:Array},size:{required:!1,default:"default"},showCreate:{type:Boolean,default:!1}},emits:["refresh"],setup(e,{emit:u}){const t=u;function o(){t("refresh")}return(a,s)=>(f(),T(U,null,[e.showCreate?(f(),y(Dt,{key:0,onRefresh:o})):A("",!0),r(ut,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(it,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(gt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(mt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(ct,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(vt,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(_t,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"]),r(Et,{"selected-orders":e.selectedOrders,size:e.size,onRefresh:o},null,8,["selected-orders","size"])],64))}},Ft={style:{width:"100%",height:"32px"}},kt={__name:"OrderItem",props:{order:{required:!0},orderItem:{required:!0}},emits:["refresh"],setup(e,{emit:u}){const t=e,o=d({orderId:t.order.id,orderItemId:t.orderItem.id});J(()=>{o.value.parameters=le.cloneDeep(t.orderItem.parameters)});function a(){return me(t.orderItem.jobType,t.order.status)}const s=a(),n=K(()=>!ie(t.order.status)),p=d(),i=d(!1),I=u;function h(){console.log(p.value.$options),p.value.validate(c=>{c&&(i.value=!0,Ye(o.value).then(m=>{X.success({message:"工单项保存成功"})}).finally(()=>{i.value=!1,I("refresh")}))})}function O(){return console.log(t.orderItem.parameters),console.log(o.value.parameters),!le.isEqual(t.orderItem.parameters,o.value.parameters)}return Y().registerOrderItemChangeDetector(O),(c,m)=>{const _=C("ElButton");return f(),T("div",null,[o.value.parameters?(f(),y(M(b(s)),{key:0,ref_key:"formRef",ref:p,modelValue:o.value.parameters,"onUpdate:modelValue":m[0]||(m[0]=g=>o.value.parameters=g)},null,8,["modelValue"])):A("",!0),S("div",Ft,[r(_,{loading:i.value,type:"primary",style:{float:"right","margin-top":"12px"},disabled:n.value,onClick:h,plain:""},{default:l(()=>[V(" 保存工单项 ")]),_:1},8,["loading","disabled"])])])}}},Nt={style:{width:"100%"}},Bt=S("span",null,"工单编号:",-1),zt={style:{"font-size":"16px"}},$t={__name:"OrderDetail",props:L({orderId:{required:!0}},{modelValue:{type:Boolean,required:!0,default:!1},modelModifiers:{}}),emits:L(["refresh"],["update:modelValue"]),setup(e,{emit:u}){const t=k(e,"modelValue"),o=e;dt();const a=d();function s(){ne({orderIds:[o.orderId]}).then(I=>{I.content&&I.content.length>0&&(a.value=I.content[0])})}J(s);const n=K(()=>a.value?[a.value]:[]),p=u;function i(){t.value=!1,p("refresh")}return(I,h)=>{const O=C("ElSpace"),R=C("ElCollapseItem"),c=C("ElCollapse");return f(),y($,{size:1e3,modelValue:t.value,"onUpdate:modelValue":h[0]||(h[0]=m=>t.value=m),title:"工单详情","custom-footer":""},{footer:l(()=>[r(ce,{"selected-orders":n.value,onRefresh:i},null,8,["selected-orders"])]),default:l(()=>[a.value?(f(),T(U,{key:0},[r(b(Oe),{column:3,border:""},{title:l(()=>[S("div",Nt,[r(O,null,{default:l(()=>[Bt,r(b(Ce),{type:"primary"},{default:l(()=>[V(w(a.value.orderNo),1)]),_:1}),r(de,{state:a.value.status,"error-message":a.value.errorMessage},null,8,["state","error-message"])]),_:1})])]),default:l(()=>[r(b(q),{label:"标题"},{default:l(()=>[V(w(a.value.orderName),1)]),_:1}),r(b(q),{label:"工作流"},{default:l(()=>[V(w(a.value.workflowName),1)]),_:1}),r(b(q),{label:"创建时间"},{default:l(()=>[V(w(a.value.createdAt),1)]),_:1}),r(b(q),{label:"提交时间"},{default:l(()=>[V(w(a.value.submittedAt),1)]),_:1}),r(b(q),{label:"最近审批时间"},{default:l(()=>[V(w(a.value.lastApprovedAt),1)]),_:1}),r(b(q),{label:"结束时间"},{default:l(()=>[V(w(a.value.endedAt),1)]),_:1}),r(b(q),{label:"当前意见"},{default:l(()=>[V(w(a.value.userMessage),1)]),_:1}),r(b(q),{label:"备注"},{default:l(()=>[V(w(a.value.note),1)]),_:1})]),_:1}),r(c,{style:{"margin-top":"32px"},accordion:""},{default:l(()=>[(f(!0),T(U,null,te(a.value.orderItems,(m,_)=>(f(),y(R,null,{title:l(()=>[S("span",zt,w(`工单项${_+1}: ${m.jobTypeName}`),1)]),default:l(()=>[r(kt,{style:{"margin-top":"6px"},order:a.value,"order-item":m,onRefresh:s},null,8,["order","order-item"])]),_:2},1024))),256))]),_:1})],64)):A("",!0)]),_:1},8,["modelValue"])}}},qt={style:{"margin-bottom":"10px",height:"32px"}},Lt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Pt=["innerHTML"],Ht={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Mt={style:{"max-width":"240px","white-space":"pre-wrap"}},jt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Wt={style:{"max-width":"240px","white-space":"pre-wrap"}},Cr={__name:"Orders",setup(e){const u=H(),o=d({ownerIds:[],possibleHandlerIds:[],historyHandlerIds:[],search:void 0}),a=d(!1);function s(c){const m=c.fullPath;m==="/order/my-orders"?(o.value.ownerIds=[u.userId],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[],a.value=!0):m==="/order/to-do-orders"?(o.value.ownerIds=[],o.value.possibleHandlerIds=[u.userId],o.value.historyHandlerIds=[]):m==="/order/done-orders"?(o.value.ownerIds=[],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[u.userId]):(o.value.ownerIds=[],o.value.possibleHandlerIds=[],o.value.historyHandlerIds=[])}ee(()=>Q.currentRoute.value.fullPath,()=>{s(Q.currentRoute.value)}),J(()=>{s(Q.currentRoute.value)});const n=d([]);function p(c){n.value=c}const i=d();function I(){i.value.fetchData()}const h=d(),O=d();function R(c){O.value=c,h.value=!0}return(c,m)=>{const _=C("ElTableColumn"),g=C("ElLink"),E=C("ElTooltip");return f(),T(U,null,[S("div",qt,[r(ce,{"show-create":a.value,"selected-orders":n.value,onRefresh:I},null,8,["show-create","selected-orders"]),r(b(be),{style:{float:"right",width:"20%"},modelValue:o.value.search,"onUpdate:modelValue":m[0]||(m[0]=v=>o.value.search=v),"suffix-icon":"search"},null,8,["modelValue"])]),r(Re,{ref_key:"tableRef",ref:i,"paging-request":o.value,"remote-method":b(ne),onSelectionChange:p},{default:l(()=>[r(_,{type:"selection","reserve-selection":""}),r(_,{"min-width":"100",prop:"orderNo",label:"工单编号",sortable:"custom"},{default:l(v=>[r(g,{type:"primary",onClick:()=>R(v.row.id)},{default:l(()=>[V(w(v.row.orderNo),1)]),_:2},1032,["onClick"])]),_:1}),r(_,{prop:"orderName",label:"工单标题",sortable:"custom"}),r(_,{prop:"workflowName",label:"工作流"}),r(_,{prop:"status",label:"工单状态",sortable:"custom"},{default:l(v=>[r(de,{state:v.row.status,"error-message":v.row.errorMessage},null,8,["state","error-message"])]),_:1}),r(_,{prop:"summary",label:"工单内容","show-overflow-tooltip":!1},{default:l(v=>[r(E,null,{content:l(()=>[S("span",{style:{"white-space":"pre-wrap"},innerHTML:v.row.summary},null,8,Pt)]),default:l(()=>[S("div",Lt,w(v.row.summary),1)]),_:2},1024)]),_:1}),r(_,{label:"当前处理人","show-overflow-tooltip":!1},{default:l(v=>[r(E,null,{content:l(()=>{var x;return[S("div",Mt,w((x=v.row.possibleHandlers)==null?void 0:x.map(N=>N.userName).join()),1)]}),default:l(()=>{var x;return[S("div",Ht,w((x=v.row.possibleHandlers)==null?void 0:x.map(N=>N.userName).join()),1)]}),_:2},1024)]),_:1}),r(_,{prop:"userMessage",label:"当前意见","show-overflow-tooltip":!1},{default:l(v=>[r(E,null,{content:l(()=>[S("div",Wt,w(v.row.userMessage),1)]),default:l(()=>[S("div",jt,w(v.row.userMessage),1)]),_:2},1024)]),_:1}),r(_,{prop:"lastApprovedAt",label:"审批时间",sortable:"custom"}),r(_,{prop:"ownerId",label:"申请人",width:"100",sortable:"custom"},{default:l(v=>[S("span",null,w(v.row.ownerRealName),1)]),_:1}),r(_,{prop:"submittedAt",label:"提交时间",sortable:"custom"}),r(_,{prop:"endedAt",label:"结束时间",sortable:"custom"})]),_:1},8,["paging-request","remote-method"]),h.value?(f(),y($t,{key:0,modelValue:h.value,"onUpdate:modelValue":m[1]||(m[1]=v=>h.value=v),"order-id":O.value,onRefresh:I},null,8,["modelValue","order-id"])):A("",!0)],64)}}};export{Cr as default};
