import{o as v,b as k,t as A,u as _,r as i,m as J,n as y,q as w,w as t,e,s as te,i as T,v as O,l as B,F as D,x as ne,y as j,z as ae,d as L,f as re,A as X,B as F,C as z,D as Y,p as oe,k as se,G as ue,H as le,I as $,J as q,K as ie,L as H,M as ce,R as de}from"./index-C6PxR8iA.js";import{u as U}from"./activeMenu-sK6fbFY9.js";import{d as me}from"./resource-Bh2jHR95.js";import{u as G}from"./request-BGZJNm7h.js";import pe from"./Job-kZzM5hdH.js";import{u as fe}from"./activeJob-DfWXj1ie.js";import{_ as ve,a as _e}from"./UpdateUserForm-AkLK75Wl.js";import{_ as K}from"./StratoDrawer-BEn6vZyQ.js";import{c as ge,u as he,d as Me}from"./user-DS2hYLSE.js";import{d as be,s as ye,a as Ie}from"./cartItem-DqzVKxXt.js";import{S as W,_ as Z}from"./StratoButton-AnmxT3yq.js";import"./StratoTable-BQdButlV.js";import"./job-BPKVJ0Lh.js";import"./asyncJob-DI4BEQdL.js";const Ce={style:{"font-size":"24px"}},Se={__name:"StratoContentHeader",setup(b){const s=U();return(n,m)=>{var u;return v(),k("span",Ce,A((u=_(s).activeMenu)==null?void 0:u.menuName),1)}}},we=""+new URL("../svg/StratoCloudSmall.svg",import.meta.url).href,Ne=[{menuName:"租户管理",path:"/system-configuration/tenant",permissionTarget:"Tenant"},{menuName:"用户管理",path:"/system-configuration/user",permissionTarget:"User"},{menuName:"角色管理",path:"/system-configuration/role",permissionTarget:"Role"},{menuName:"用户组管理",path:"/system-configuration/user-group",permissionTarget:"UserGroup"},{menuName:"审计日志",path:"/system-configuration/audit-log",permissionTarget:"AuditLog"}],Ee=[{menuName:"云账号",path:"/cloud-configuration/external-account",permissionTarget:"ExternalAccount"},{menuName:"标签管理",path:"/cloud-configuration/tag",permissionTarget:"ResourceTag"},{menuName:"IP池",path:"/cloud-configuration/ip-pool",permissionTarget:"IpPool"},{menuName:"资源栈蓝图",path:"/cloud-configuration/blueprint",permissionTarget:"Blueprint"},{menuName:"脚本库",path:"/cloud-configuration/script-definition",permissionTarget:"ScriptDefinition"},{menuName:"软件库",path:"/cloud-configuration/software-definition",permissionTarget:"SoftwareDefinition"}],Te=[{menuName:"我的工单",path:"/order/my-orders",permissionTarget:"Order"},{menuName:"待办工单",path:"/order/to-do-orders",permissionTarget:"Order"},{menuName:"已办工单",path:"/order/done-orders",permissionTarget:"Order"},{menuName:"所有工单",path:"/order/all-orders",permissionTarget:"Order"},{menuName:"任务",path:"/order/jobs",permissionTarget:"Job"},{menuName:"流程管理",path:"/order/workflow",permissionTarget:"Workflow"},{menuName:"任务类型",path:"/order/job-definitions",permissionTarget:"JobDefinition"},{menuName:"定时任务",path:"/order/job-triggers",permissionTarget:"JobTrigger"}],xe=[{menuName:"资源栈",path:"/resource/stacks",permissionTarget:"ResourceStack"}],ke={__name:"StratoHeaderJobButton",setup(b){const s=i(!1),n=i(),m=fe(),u=i(!1);return J(()=>m.activeJobId,()=>{m.activeJobId!==void 0&&n.value.refresh().then(()=>{s.value=!0,u.value=!0,setTimeout(()=>{s.value=!1,u.value=!1},5e3)})}),(o,p)=>{const a=y("ElButton"),f=y("ElIcon"),g=y("ElText"),c=y("ElPopover");return v(),w(c,{visible:s.value,"onUpdate:visible":p[0]||(p[0]=E=>s.value=E),placement:"bottom-end",width:800,trigger:"click"},{reference:t(()=>[e(a,{size:"large",class:"job-button",icon:"List"})]),default:t(()=>[u.value?(v(),w(g,{key:0,style:{float:"left","margin-right":"20px"},type:"success"},{default:t(()=>[e(f,null,{default:t(()=>[e(_(te))]),_:1}),T("任务已提交 ")]),_:1})):O("",!0),e(pe,{ref_key:"jobRef",ref:n,"simple-mode":"","my-job":""},null,512)]),_:1},8,["visible"])}}},Le={__name:"StratoHeaderUserConfigButton",setup(b){const s=G(),n=U(),m=B();function u(){n.setCurrentSideMenus(void 0),n.setActiveMenu(void 0),s.setSession(void 0),m.push("/login")}const o=i(!1),p=i(),a=i({userId:s.userId});function f(){o.value=!0}function g(){p.value.validate(d=>{d&&ge(a.value).then(()=>{o.value=!1})})}const c=i(!1),E=i(),S=i({});function R(){Me({userIds:[s.userId]}).then(d=>{(!d.content||d.content.length===0)&&ne.error("用户不存在"),S.value.userId=d.content[0].id,S.value.realName=d.content[0].realName,S.value.emailAddress=d.content[0].emailAddress,S.value.phoneNumber=d.content[0].phoneNumber,S.value.description=d.content[0].description,c.value=!0})}function V(){E.value.validate(d=>{d&&he(S.value).then(()=>{c.value=!1})})}function N(d){switch(d){case"logout":u();break;case"changePassword":f();break;case"updateSelf":R();break}}return(d,h)=>{const I=y("ElButton"),x=y("ElDropdownItem"),r=y("ElDropdownMenu"),C=y("ElDropdown");return v(),k(D,null,[e(C,{onCommand:N,trigger:"click"},{dropdown:t(()=>[e(r,null,{default:t(()=>[e(x,{command:"updateSelf"},{default:t(()=>[T("个人信息")]),_:1}),e(x,{command:"changePassword"},{default:t(()=>[T("修改密码")]),_:1}),e(x,{command:"logout"},{default:t(()=>[T("退出登录")]),_:1})]),_:1})]),default:t(()=>[e(I,{size:"large",class:"user-config-button",icon:"UserFilled"})]),_:1}),e(K,{modelValue:o.value,"onUpdate:modelValue":h[1]||(h[1]=M=>o.value=M),title:"修改密码",onOnConfirm:g},{default:t(()=>[e(ve,{ref_key:"changePasswordFormRef",ref:p,modelValue:a.value,"onUpdate:modelValue":h[0]||(h[0]=M=>a.value=M)},null,8,["modelValue"])]),_:1},8,["modelValue"]),e(K,{modelValue:c.value,"onUpdate:modelValue":h[3]||(h[3]=M=>c.value=M),title:"个人信息",onOnConfirm:V},{default:t(()=>[e(_e,{ref_key:"updateFormRef",ref:E,modelValue:S.value,"onUpdate:modelValue":h[2]||(h[2]=M=>S.value=M)},null,8,["modelValue"])]),_:1},8,["modelValue"])],64)}}},Ae={style:{height:"32px"}},De={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},Re=["innerHTML"],Ve={__name:"CartItem",setup(b,{expose:s}){const n=i(),m=i([]),u=i([]);function o(){be(a.value).then(N=>{u.value=N.cartItems})}function p(){return m.value.map(N=>N.id)}const a=i({});J(a,o,{immediate:!0}),s({getTotal:g});const f=i();j(()=>{f.value=setInterval(o,5e3)}),ae(()=>{clearInterval(f.value)});function g(){return u.value.length}const c=i(!1);function E(){c.value=!0;const d={cartItemIds:p()};ye(d).then(()=>{var h;o(),(h=n.value)==null||h.clearSelection()}).finally(()=>{c.value=!1})}const S=i(!1);function R(){S.value=!0;const d={cartItemIds:p()};Ie(d).then(()=>{var h;o(),(h=n.value)==null||h.clearSelection()}).finally(()=>{S.value=!1})}function V(N){m.value=N}return(N,d)=>{const h=y("ElTableColumn"),I=y("ElTooltip"),x=y("ElTable");return v(),k(D,null,[L("div",Ae,[e(W,{disabled:m.value.length<=0,loading:c.value,size:"small",type:"primary",onClick:E},{default:t(()=>[T(" 提交 ")]),_:1},8,["disabled","loading"]),e(W,{disabled:m.value.length<=0,loading:S.value,size:"small",type:"danger",plain:"",onClick:R},{default:t(()=>[T(" 删除 ")]),_:1},8,["disabled","loading"]),e(_(re),{size:"small",style:{float:"right",width:"20%"},modelValue:a.value.search,"onUpdate:modelValue":d[0]||(d[0]=r=>a.value.search=r),"suffix-icon":"search"},null,8,["modelValue"])]),e(x,{ref_key:"tableRef",ref:n,size:"small",data:u.value,"row-key":"id","max-height":"600","show-overflow-tooltip":!1,onSelectionChange:V},{default:t(()=>[e(h,{type:"selection","reserve-selection":""}),e(h,{prop:"jobTypeName",label:"待办任务",sortable:"custom"}),e(h,{prop:"summary",label:"任务详情"},{default:t(r=>[e(I,null,{content:t(()=>[L("span",{style:{"white-space":"pre-wrap"},innerHTML:r.row.summary},null,8,Re)]),default:t(()=>[L("div",De,A(r.row.summary),1)]),_:2},1024)]),_:1}),e(h,{prop:"createdAt",label:"创建时间",sortable:"custom"})]),_:1},8,["data"])],64)}}},Pe={__name:"StratoHeaderCartButton",setup(b){const s=i(!1),n=X(()=>{var u;return(u=m.value)==null?void 0:u.getTotal()}),m=i();return(u,o)=>{const p=y("ElButton"),a=y("ElBadge"),f=y("ElPopover");return v(),w(f,{visible:s.value,"onUpdate:visible":o[0]||(o[0]=g=>s.value=g),placement:"bottom-end",width:800,trigger:"click"},{reference:t(()=>[e(a,{"is-dot":n.value>0,type:"warning",offset:[-10,10]},{default:t(()=>[e(p,{size:"large",class:"job-button",icon:"ShoppingCart"})]),_:1},8,["is-dot"])]),default:t(()=>[e(Ve,{ref_key:"cartItemRef",ref:m},null,512)]),_:1},8,["visible"])}}},Be=b=>(oe("data-v-756427d5"),b=b(),se(),b),Ue={class:"strato-header"},$e=Be(()=>L("img",{style:{"margin-left":"5px"},src:we,alt:"StratoCloud"},null,-1)),He={style:{float:"right","margin-right":"6px"}},Fe={__name:"StratoHeader",setup(b){const s=i("0"),n=U(),m=G(),u=i([]),o=i([]),p=i([]),a=i([]),f=B();async function g(){await me({}).then(r=>{const C=[];if(r.resourceCategories&&r.resourceCategories.length>0)for(let M of r.resourceCategories)c(M.categoryId)&&C.push({menuName:M.categoryName,path:"/resource/list/"+M.categoryId,subMenuId:M.groupId,subMenuName:M.groupName});for(let M of xe)c(M.permissionTarget)&&C.push(M);u.value=C,C.length>0&&I.value.push({name:"云资源",pathPrefix:"/resource/",handler:V,sideMenuList:u.value})})}function c(r){var C;return m.session?m.session.roleType==="SUPER_ADMIN"||m.session.roleType==="TENANT_SUPER_ADMIN"?!0:(C=m.session.permissions[r])==null?void 0:C.includes("READ"):!1}async function E(){for(let r of Te)r.path==="/order/all-orders"&&m.isNormalUser||c(r.permissionTarget)&&o.value.push(r);o.value.length>0&&I.value.push({name:"工单与任务",pathPrefix:"/order/",handler:N,sideMenuList:o.value})}async function S(){for(let r of Ee)c(r.permissionTarget)&&p.value.push(r);p.value.length>0&&I.value.push({name:"云管理",pathPrefix:"/cloud-configuration/",handler:d,sideMenuList:p.value})}async function R(){for(let r of Ne)c(r.permissionTarget)&&a.value.push(r);a.value.length>0&&I.value.push({name:"系统管理",pathPrefix:"/system-configuration/",handler:h,sideMenuList:a.value})}const V=()=>{n.setCurrentSideMenus(u.value),u.value.length>0&&(n.setActiveMenu(u.value[0]),f.push(u.value[0].path))},N=()=>{n.setCurrentSideMenus(o.value),o.value.length>0&&(n.setActiveMenu(o.value[0]),f.push(o.value[0].path))},d=()=>{n.setCurrentSideMenus(p.value),p.value.length>0&&(n.setActiveMenu(p.value[0]),f.push(p.value[0].path))},h=()=>{n.setCurrentSideMenus(a.value),a.value.length>0&&(n.setActiveMenu(a.value[0]),f.push(a.value[0].path))},I=i([]);function x(){const r=f.currentRoute.value.path;n.setActiveMenu(void 0);for(let C=0;C<I.value.length;C++){const M=I.value[C];for(let P of M.sideMenuList)if(r===P.path)return n.setCurrentSideMenus(M.sideMenuList),n.setActiveMenu(P),s.value=C+"",!0}return console.warn(`Menu of path ${r} not found.`),!1}return J(f.currentRoute,()=>{x()}),j(async()=>{if(await g(),await E(),await S(),await R(),!n.activeMenu){I.value[s.value].handler();return}if(n.activeMenu&&!x()){for(let r=0;r<I.value.length;r++)if(n.activeMenu.path.startsWith(I.value[r].pathPrefix)){n.setCurrentSideMenus(I.value[r].sideMenuList),s.value=r+"";return}I.value[s.value].handler()}}),(r,C)=>{const M=y("ElButtonGroup");return v(),k("div",Ue,[$e,e(_(Y),{"default-active":s.value,style:{"margin-right":"200px",border:"0"},mode:"horizontal",ellipsis:!1},{default:t(()=>[(v(!0),k(D,null,F(I.value,(P,ee)=>(v(),w(_(z),{class:"strato-menu-item",onClick:P.handler,index:ee+""},{default:t(()=>[T(A(P.name),1)]),_:2},1032,["onClick","index"]))),256))]),_:1},8,["default-active"]),L("div",He,[e(M,null,{default:t(()=>[e(Pe),c("Job")?(v(),w(ke,{key:0})):O("",!0),e(Le)]),_:1})])])}}},ze=Z(Fe,[["__scopeId","data-v-756427d5"]]);function Q(b){switch(b){case"云主机":return"Cpu";case"云硬盘":return l("Disk");case"磁盘类型":return l("Disk");case"弹性网卡":return l("LocalIp");case"可用区":return"Grid";case"集群":return"Grid";case"宿主机":return"Cpu";case"数据存储":return l("Disk");case"密钥对":return l("ApiKey");case"私有网络":return l("Vpc");case"子网":return l("LocalIp");case"弹性IP":return l("FloatingIp");case"带宽包":return l("FloatingIp");case"云主机规格":return"Cpu";case"镜像":return"CopyDocument";case"安全组":return l("Security");case"入站规则":return l("Security");case"出站规则":return l("Security");case"云账号":return l("ApiKey");case"租户管理":return"House";case"用户管理":return"User";case"角色管理":return"UserFilled";case"用户组管理":return"Avatar";case"我的工单":return"User";case"待办工单":return"Bell";case"已办工单":return"MuteNotification";case"所有工单":return"Document";case"任务":return"List";case"任务类型":return"List";case"定时任务":return"AlarmClock";case"标签管理":return"CollectionTag";case"IP池":return l("LocalIp");case"流程管理":return l("Scheduler");case"资源栈蓝图":return"Menu";case"资源栈":return"Menu";case"负载均衡实例":return l("Vpc");case"监听器":return l("Vpc");case"后端服务":return l("LocalIp");case"后端服务器组":return l("LocalIp");case"转发规则":return l("LocalIp");case"服务器SSL证书":return l("ApiKey");case"ACL":return l("LocalIp");case"健康检查器":return l("LocalIp");case"LB可用区":return"Grid";case"LB规格":return l("Vpc");case"脚本库":return"Tickets";case"软件库":return"Box";case"非云主机":return"Monitor";case"软件":return"Box";case"初始化脚本":return"Tickets";case"审计日志":return"VideoCamera"}return"MostlyCloudy"}function Je(b){switch(b){case"云主机相关":return"Cpu";case"存储":return"Coin";case"网络":return l("Internet");case"负载均衡":return l("Vpc");case"其他":return"Expand";case"运维自动化":return"CoffeeCup"}return"MostlyCloudy"}function l(b){return ue({setup(){return()=>le("img",{src:`/svg/${b}.svg`})}})}const Oe={style:{"font-size":"18px"}},je={__name:"StratoMenu",setup(b){const s=B(),n=U(),m=X(()=>{const o=[],p=[];if(n.currentSideMenus)for(let a of n.currentSideMenus)if(a.subMenuId&&a.subMenuName){let f=o.find(g=>g.subMenuId===a.subMenuId);f||(f={subMenuId:a.subMenuId,subMenuName:a.subMenuName,items:[]},o.push(f)),f.items.push(a)}else p.push(a);return[...o,...p]});function u(o){n.setActiveMenu(o)}return j(()=>{n.activeMenu&&s.push(n.activeMenu.path)}),(o,p)=>{const a=y("ElIcon"),f=y("ElSubMenu");return _(n).activeMenu?(v(),w(_(Y),{key:0,class:"strato-menu",router:"","default-active":_(n).activeMenu.path,"unique-opened":""},{default:t(()=>[(v(!0),k(D,null,F(m.value,g=>(v(),k(D,null,[g.subMenuId?(v(),w(f,{key:0,index:g.subMenuId},{title:t(()=>[e(a,null,{default:t(()=>[(v(),w($(_(Je)(g.subMenuName))))]),_:2},1024),L("span",Oe,A(g.subMenuName),1)]),default:t(()=>[(v(!0),k(D,null,F(g.items,c=>(v(),w(_(z),{class:"strato-menu-item",index:c.path,onClick:E=>u(c)},{default:t(()=>[L("span",null,[e(a,null,{default:t(()=>[(v(),w($(_(Q)(c.menuName))))]),_:2},1024),T(" "+A(c.menuName),1)])]),_:2},1032,["index","onClick"]))),256))]),_:2},1032,["index"])):(v(),w(_(z),{key:1,class:"strato-menu-item",index:g.path,onClick:c=>u(g)},{default:t(()=>[L("span",null,[e(a,null,{default:t(()=>[(v(),w($(_(Q)(g.menuName))))]),_:2},1024),T(" "+A(g.menuName),1)])]),_:2},1032,["index","onClick"]))],64))),256))]),_:1},8,["default-active"])):O("",!0)}}},Ge=Z(je,[["__scopeId","data-v-a6841a01"]]),ut={__name:"StratoLayout",setup(b){const s=B();return G().session||s.push("/login"),(n,m)=>(v(),w(_(H),{style:{height:"100%",overflow:"hidden","background-image":"linear-gradient(-45deg, #150055 0%, #610099 100%)"}},{default:t(()=>[e(_(q),{style:{padding:"0"}},{default:t(()=>[e(ze)]),_:1}),e(_(H),{style:{height:"100%"}},{default:t(()=>[e(_(ie),{style:{width:"240px",height:"100%","scrollbar-width":"thin"}},{default:t(()=>[e(Ge)]),_:1}),e(_(H),{style:{height:"100%","margin-right":"16px","background-color":"rgb(16, 16, 16)"}},{default:t(()=>[e(_(q),{style:{display:"flex","align-items":"center"}},{default:t(()=>[e(Se)]),_:1}),e(_(ce),null,{default:t(()=>[(v(),w(_(de),{key:_(s).currentRoute.value.fullPath}))]),_:1})]),_:1})]),_:1})]),_:1}))}};export{ut as default};
